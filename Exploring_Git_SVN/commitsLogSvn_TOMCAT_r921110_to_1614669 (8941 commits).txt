Make StandardContext aliases work with ServletContext.getResourcePaths()
Complete fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48701
Bug 48701 test cases
Too many 48nnn bugs in context root
Move the 48nnn bugs
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48790 Make maxActive thread safe. Technically a bug but seems like overkill.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48258 for TC7 Allow session cookie domain to be over-ridden by context configuration in the same way httpOnly may be Based on a patch by Donn Aiken
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48379 Allow session cookie path to be configured per context With this option, the servlet 3 options and Connector.emptySessionPath there were just too many places this was being configured so the Connector option has been removed for Tomcat 7. Based on a patch by Brane F. Gracnar
Remove some changes that have since made it into 6.0.x
Remainder of fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48379 Allow session cookie name to be configured per context With this option, the servlet 3 options and system property there were just too many places this was being configured so the system property option has been removed for Tomcat 7.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48793 Make catalina.sh more robust to different return values on different platforms Patch provided by Thomas GL
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48795 If compilation fails, always try to re-compile the next time around
Fix download of commons-daemon-1.0.2: The "destfile" parameter has to be specified for "downloadzip" task. It specifies the file which absence triggers the download of the archive. Thus, without it the archive was redownloaded again and again with each build.
Update to NSIS 2.46
Revert 921464 for rework
Mark the min(a,b) method as static. Inspired by https://issues.apache.org/bugzilla/show_bug.cgi?id=44265
Alternative fix for bug 48795. Add a new property to control if the next request always triggers recompilation after a compilation failure. Defaults to false and only applies in development mode
Re-work the script to make it more Gump friendly  No functional change for normal builds, but allows skipping a taskdef that Gump doesn't want or need when running tests.   
Suppress anoying Terminate batch job prompt when hitting CTRL+C. Note however that it leaves the file named yes in the bin directory
Use real exit value if shutdown via stop
correct a comment
Use TEMP environment for storing the autoresponse file, and make sure the file was created
Use better variable name.
https://issues.apache.org/bugzilla/show_bug.cgi?id=48934 The wrong sender was disconnected, should only be the sender holding the actual TCP connections.  
More async stuff, only timeout left  
Fix a couple of ASync issues that were causing Servlet 3.0 TCK test failures. 1. <quote section="2.3.3.3" page="17"> The complete method can be invoked by the container if the request is dispatched to a servlet that does not support async processing, or the target servlet called by AsyncContext.dispatch does not do a subsequent call to startAsync. In this case, it is the container's responsibility to call complete() as soon as that servlet's service method is exited. </quote> 2. <quote section="2.3.3.3" page ="13"> public boolean isAsyncStarted() - Returns true if async processing has started on this request, and false otherwise. If this request has been dispatched using one of the AsyncContext.dispatch methods since it was put in asynchronous mode, or a call to AsynContext.complete is made, this method returns false. </quote>
Fix various exceptions that prevented one of the TCK web applications from starting
Doh! Return the newly created registrations rather than just creating work for the garbage collector.
Arrays indexes start at zero so no need for "... + 1"
Always use the InstanceManager to create listeners, filters & servlets
It is valid to call startAsync() inside a dispatched request
Servlets added through the new ServletContext.addServlet(...) methods may not be initialised
Fire listeners in reverse order for requestDestroyed
Fix some TCK issues. The behaviour is undefined in the spec, so go with the TCK requirements
Make method names consistent with the names the digester looks for
More async stuff, implement timeout handling 
Provide the method expected by the digester for adding security-role-ref elements
SRV.9.3 says we must throw a FNFE
TCK failures: Servlets do not support async by default
TCK failures: Make sure FilterDefs where async-support was not defined are set to the default of false before being added to the context
TCK failures: Look for the right element
TCK failures: Don't delegate dispatcher type to wrapped request as it may well be different.
TCK failures: Fix session expiry on cross-context requests. Need to test the local session is valid before calling access() which will make it valid again.
Revert fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48790 in preparation for a simpler solution
Simpler fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48790 based on a patch by kkolinko Make maxActive thread safe. Probably unnecessary but technically a bug.
Add support for detecting Spring Security user names in the manager app
Tracking down a memory leak. Add some debug logging to the mapper.
Add in a slightly different behavior for dispatch. dispatch() will return immediately, according to spec. But if dispatch is called from the tomcat worker thread, then the dispatch will not happen until the worker thread has backed out of the call. This prevents multiple threads being launched into the same request/response and causing potential concurrency issues. The Async state machine guarantees that multiple dispatch can not be called. 
Use context path in debug log message
Make sure start() and stop() are called on Wrappers. This was a regression in the recent Lifecycle changes.
Prevent looping by correctly setting the socket wrapper async state 
Enable async behavior for the AJP connector 
recycle properly 
TCK failures: Make valve Async aware - with some help from Filip
Clean up. The setAsync can be done in a single bottleneck, instead mixed into the processor 
Address various class-loader deadlock / sync issues https://issues.apache.org/bugzilla/show_bug.cgi?id=44041 https://issues.apache.org/bugzilla/show_bug.cgi?id=48694 https://issues.apache.org/bugzilla/show_bug.cgi?id=48903  Whilst parallel class-loading would be a nice feature, the various issues that have emerged have demonstrated that anything other than synchronized(this) is likely to cause issues.  Parallel class-loading will be explored for Tomcat 7 (disabled by default) and ported back to 6.0.x when proven to be stable.
Update project name
Ignore setenv.* so I don't accidently check it in
prevent duplicate threads processing the same socket 
Remove unused imports
Add an additional test case for bug 45015.
Re-fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45015 Regression in recent parsing re-factoring
Obey the rules on quoting
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48992 Fix XML tags in examples for CombinedRealm and LockOutRealm Based on the patch by Fumiyuki Shimizu
Remove tests rendered unnecessary when context.xml files were moved from appBase to configBase
spec says that "started" is defined as started until the thread has returned to the container. 
Improve log message when deploying from configBase to make it clearer where xml file is read from. Javadoc tweak
Missed a file in r927850
Mark ResourceEntry.loadedClass as volatile. That is because WebappClassLoader#findClassInternal() uses double-checked locking to initialize this field.
Mark example servlets as async 
Adjust examples to the latest implementation 
Clean up  - Eclipse warnings  - Unnecessary code  - Line length  - i18n message names
Adjust startAsync().complete() behavior 
Add in some debug, what is causing some TCK failures is a request/response pair not being recycled properly 
Use both single and double quotes in the test, for diversity
MUST_STOP is also a valid state from which to transition to STOPPING_PREP
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48662 Make extraction of context.xml files configurable and disable it by default for Tomcat 7
Language tweaks
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48717 When a node joins a cluster and it receives all the current sessions, ensure the sessionCreated event is fired if the Manager is configured to replicate session events
New installer side graphics. Artwork provided by Adela Turk
Test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=48839 Fix to follow shortly
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48839 Correctly handle multi-line headers with the NIO connector Patch suggested by Richa Baronia
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48840 If CDPATH is set, cd may result in output to stdout. Swallow the output. This is safe since the script outputs the value used for CATALINA_HOME so any issues will be visible then. Patch provided by mdietze
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48895 Make clearing thread locals optional and disabled by default since it isn't thread-safe
Clear up state handling a bit 
When changing a session ID, use the internal add cookie method in the same way as when first creating a session cookie.
commit access test
delete test file
commit access test
delete test file
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49030 Failure of one connector should not leave some connectors started and some ignored
Fix copy paste error 
TCK failures: If a servlet/filter has any mappings in the main web.xml, these override rather than replace the mappings defined in the fragments. The same goes for fragments and annotations.
Cleanup. Remove field that is never initialized and never read. req.getResponse() is used instead of it when needed.
Modify unit tests to take account of https://issues.apache.org/bugzilla/show_bug.cgi?id=48914 Invoke should use parameters provided in expression in preference to parameters provided in invoke() call
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48914 Invoke should use parameters provided in expression in preference to parameters provided in invoke() call
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48983 Additional debug logging for when RemoteIp(Valve|Filter) is not invoked
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49014 Add test cases for the RemoteIpFilter Patch provided by Cyrille Le Clerc 
Fix the immediate problem described in https://issues.apache.org/bugzilla/show_bug.cgi?id=48648 Still need review remainder of bug report
Revert accidental commit
memberAlive is not called if member has not already existed in membership. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49018 Fix processing of time argument in the "Expire sessions" action in the Manager web application  Also, provide separate templates for the "managerServlet.sessiontimeout" message, to allow it to be properly translated into other languages. I cannot provide the actual translations, though. The translated variants of the new messages are now a mix of English and translated text, which just mimics the old behaviour.
Start working on a statement cache. Add in disconnect event for interceptors, make the statement decorator extensible 
Fix typo
Further corrections to SSL session timeout attribute name.
Use chunked encoding for http 1.1 requests with no content-length (regardless of keep-alive) so client can differentiate between complete and partial responses.
Update EL & JSP versions Minor tweaks
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49075 NPE protection if roles is null and roles needs to be modifiable
Javadoc update
TCK failure (with security manager): Preload required class.
Add missing class. 
Add permission to read the STRICT_SERVLET_COMPLIANCE property to our default policy for the security manager. 
Add another property access to our security policy. 
And another property for the policy. 
Ignore request handling time in session lastAccessedTime when acting servlet spec compliant. 
Allow JioEndpoint to switch context class loader under security manager. Code copied from standard session.  Add two more classes to class pre-loading to improve security manager interoperability. 
Add test cases for https://issues.apache.org/bugzilla/show_bug.cgi?id=49081 "#${1+1}" should evaluate to "#2"
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49081 "#${1+1}" should evaluate to "#2" Note that all files apart from ELParser.jjt are generated by javacc from the changes to ELParser.jjt
Reduce failures of new API when running under security manager. 
Use spec compliant session expiration in STRICT_SERVLET_COMPLIANCE mode. 
TCK failures: EL TCK with security manager
Prepare for RC1 release
Back to -dev
Re-factor to allow easier addition of extra tests
Add some additional tests
Partial fox for https://issues.apache.org/bugzilla/show_bug.cgi?id=49082 java.home may not include the final path separator
Make public constant final
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49091 Reduce visibility
Make constant final
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49086 Add Javadocs to javax.servlet.annotation Patch provided by Pid.
Fix download location for native binaries
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49116 If session is already invalid, expire session to prevent memory leak.
Alternative fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49089 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49045 Add support for adding Services and Engines via JMX Based on a patch by Chamith Buddhika
Fully fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49082
Add info on API stability to the release.
Tomcat 7 needs Java 6
AL2 header
Add license headers to NSIS files
Parametrise current year in all embedded NOTICE files Don't use the same property name for different output files
Don't include modules in the src release
CPL allows us to elect to distribute under a later version of the license so elect to distribute under EPL as we are already using EPL for Eclipse JDT.
Two BCEL files have IBM copyright and EPL licensing. Update LICENSE and NOTICE files accordingly.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49103 Add @Override where appropriate
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49104 Generics
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49105 Misc Javadoc corrections.
https://issues.apache.org/bugzilla/show_bug.cgi?id=49106 Remove unused import
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49109 Remove unused authenticate() method with a broken default impl
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49110 Make inner class static to prevent possible memory leak - found by FindBugs
https://issues.apache.org/bugzilla/show_bug.cgi?id=49118 Use StringBuilder rather than concatenation
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49129
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49024 Enhance the RemoteIpFilter docs Patch provided by Cyrille Le Clerc
sessionCounter and expiredSessions declares as long instead of int.
Update release plan.
Section 3.2 of the Servlet 3 spec says getParameter should still work for parameters that do not represent file uploads (it doesn't at the moment - patch to follow)
if error, next request 
Implement SRV.3.2. Non file parts should be exposed via getParameters() Cache results so multiple calls to getParts() work
Section 3 of spec checked
Followup to r934220. Set svn:eol-style=native for the added files. No change in their content.
Correct a misprint (s/provide/provided), wrap the long line.
Add in statement cache 
Clean up a bit 
Review section 4. More stuff to do.
Fix asyn with APR. 
Remove unused dependency on o.a.t.util.collections.MultiMap. An indication here is that MultiMap$Field.name and .value fields are never assigned.
Get build working with relative base.path
More checking against the spec
Improve the ChatServlet comet example. 1. Fix possible deadlock in ChatServlet$MessageSender, similar to BZ 48843. 2. Properly wake up ChatServlet$MessageSender when the servlet is destroyed. 3. Filter special characters when printing the message in ChatServlet. 4. Provide an explicit charset everywhere. 5. Fix frames layout. Fix redirections. Use target="<name>" attribute in HTML to send request to a particular frame. 6. Fix DTDs. Use frameset DTD for the page containing frames. 7. Add "xxx joined the chat" message at startup. 8. Rename chat.jsp -> index.jsp, so that the entry point to this example is more visible. 9. Corrected the link that opens a new chat window. It referenced an undefined JavaScript function. Now it is implemented just by using target="_blank". 10. Added submit button to the form pages. 11. Minor message tweaks.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49150
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49151
remove null check.
Additional patch for https://issues.apache.org/bugzilla/show_bug.cgi?id=48589 Do not access JNDIRealm$User class fields directly, but use the getter methods, as (theoretically) those can be overwritten in subclasses.
Add test case for bug 49158 
https://issues.apache.org/bugzilla/show_bug.cgi?id=49158 Session cookies should only set one header  
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49141 Stop Findbugs complaining
getCookies is a httpServletRequestMethod, not a httpServletResponseMethod
Remove mystery method
Minor fixes
Fix for 43642. 
Fix CVE-2010-1157. Prevent possible disclosure of host name or IP address via the HTTP WWW-Authenticate header when using BASIC or DIGEST authentication.
Fix typo in overridden method name
Fix Eclipse warnings
typos
Add support for loading static resources from /META-INF/resources inside JARs bundled with a web application
Update
Complete review of spec. One additional requirement
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49170
Expose properties of VirtualWebappLoader and WebappClassLoader via JMX. 
Add property "searchExternalFirst" to WebappLoader: if set the external repositories will be searched before the WEB-INF ones. Default (false) is unchanged behaviour. Expose the new property via JMX and document it.. 
Expose the new WebappLoader flag in the VirtualWebappLoader, but allow alternative name searchVirtualFirst to make it consistent with the "virtual" terminology.  Now you can decide, whether the virtual paths will be searched before the webapp or after it.  If searched before, external resources take precendence over internal ones. Before that change one couldn't overwrite resources already present in the webapp. 
Add docs about VirtualWebappLoader. 
Update changelog. 
Respect configurable search order in getURLs(). 
Context aliases: - add a little to the docs - disallow an alias for "/" 
Servlet 3. Implement ServletContainerInitializer support
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49171 Fix IDE warning Patch provided by sebb
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49164 Improve unit tests by propagating failures from spawned threads to main thread. Patch provided by Felix Schumacher.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49144 Not an issue but stop FindBugs complaining Also fix one other FindBugs report for this class.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49143 Threading / initialisation issues. Not all were valid. Make them volatile anyway so FindBugs doesn't complain. Fix some additional issues - use of valueOf() - found along the way
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49140 Use appropriate iterators and for-each where possible
Remove impossible tests ID'd by FindBugs
Remove unnecessary instanceof tests ID'd by FindBugs
Add test case for bug 49132. Check JNDI is available when ServletContextListeners start
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49132 Need to start JNDI before listeners are called
Restore global JNDI support broken in r937542
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48644 Don't silently swallow Throwables that need to be re-thrown Patch provided by Charlotte H (with a few tweaks) Patch developed during the London GDC OS Jumpstart 2010
The release build doesn't run the tests
Build script improvements:  - build src jars for every jar  - use ecj-x.x.x.jar directly  - add an embed-release target   Note: src JARs are required to fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48222 (providing src JARs for Maven)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48222 Provide src JARs for Maven
Trigger a DBCP rebuild if src or bin is missing Should fix buildbot
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49181 Patch provided by Pid
Update
Allow time for the OS to do a context switch.  Otherwise this fails 100% of the time on my Windows 7 box
Update ignore list now ecj-x.x.x.jar is used directly
Fix SCI when there is more than one JAR on the classpath
Fix leftover bug from changing the design
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48358 Add the ability to limit the number of JSPs loaded at any one time.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48689 Access TLD files through a new JarResource interface to make extending Jasper simpler, particularly in OSGi environments. Patch provided by Jarek Gawor.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49184 Prevent ArrayIndexOutOfBoundsException Patch provided by Pid
Include .project and .classpath files to src distribution. s. http://ant.apache.org/manual/dirtasks.html#defaultexcludes to not include scm files!
Simplify code
If the class implements both interfaces then call addApplicationLifecycleListener only once.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49073
s/2.1/2.2/ for jsp spec version  
java 6, not java5 
minor tweaks for versions  
Use a helper class to manage the filter mappings. Fix ArrayIndexOutOfBoundsException in addFilterMapBefore as reported in re: r937975 thread.
Mark StandardContext#aliases as private, because there is a getter method.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49207 FilterMap#filterName was null when it was configured dynamically with addMappingForUrlPatterns() Patch provided by Pid
Implement support for running the tests when the build output directory has non-default value.
web.xml and fragments overwrite annotation parameters (s. Servlet API Sepc Nov 2009 Section 8.2.3.3 pages 80-84) not yet complete -- filter support is missing!
web.xml and fragments overwrite annotation parameters (s. Servlet API Sepc Nov 2009 Section 8.2.3.3 pages 80-84) not yet complete -- filter support is missing!
Follow up on pero's review comments.
It isn't practical to list every single commit that implemented Servlet 3.0.
Fix my IDE and use spaces. - No functional change
$Date$ was wrapped and thus broken in r939212  Replacing with $Id$ because of i18n and timezone issues that $Date$ has (http://subversion.tigris.org/issues/show_bug.cgi?id=2332)
Tests for Servlet 3.0 support of bundling static resources in META-INF/resources subdirectory of a jar file. It is a separate web application, because the old "webapp-3.0" has metadata-complete="true".  The tests in TestStandardContextResources are currently failing, and thus are disabled until a solution is found. See the comment in TestStandardContextResources.java
Move and rename the aliases support test.
Remove MultiMap class. It is never used. Note, that its implementation was incomplete, e.g. MultiMap.Field#name and #value fields are never assigned.
Replace $Date$ with $Id$ because of its i18n and timezone issues (http://subversion.tigris.org/issues/show_bug.cgi?id=2332) 
Replace $Date$ with $Id$ because of its i18n and timezone issues (http://subversion.tigris.org/issues/show_bug.cgi?id=2332) 
Replace $Date$ with $Id$ because of its i18n and timezone issues (http://subversion.tigris.org/issues/show_bug.cgi?id=2332)
Replace $Date$ with $Id$ because of its i18n and timezone issues (http://subversion.tigris.org/issues/show_bug.cgi?id=2332)
Replace $Date$ with $Id$ because of its i18n and timezone issues (http://subversion.tigris.org/issues/show_bug.cgi?id=2332)
Set svn:keywords=Id where there is unexpanded $Id$ keyword in the files
Fix to correct JarScanner (StandardJarScanner) default! 
Per documentation: http://java.sun.com/javase/6/docs/api/javax/security/auth/Subject.html  Therefore all concrete Principal implementations associated with Subjects must implement Serializable.   
Log unexpected runtima and IO errors in ApplicationContext#getResource() and ApplicationContext#getResourceAsStream(). This is inspired by BZ 49218.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49218 The test runs successfully if JreMemoryLeakPreventionListener is present.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49236 Do not use indexing when packing Tomcat JARs.
web.xml or fragment must merge with annotations s. Servlet Spec 3.0 8.2.3
Fix NPE if no encoding parameter exists at request!
Add second resource jar and testcase failed again :-( You can switch assert resourceF and see that also resourceB test failed..
Space to tab
Fix wrapped and thus broken $Id$. Use $Revision$ instead, because it is shorter.
Add init() and destroy() to the Lifecycle interface Note that this commit breaks the shutdown hook. I'll fix that in a following commit.
Document must destroy state
Clean up start code. Catalina no longer implements Service. The model is now: Bootstrap sorts out the class loaders, Catalina does the remaining plumbing and holds a reference to a Server object which in turn contains 1 or more services etc. Still need to fix the shutdown hook.
Clarify
Get the shutdown hook working again. Now LifecycleBase uses synchronized methods, Catalina can't extend it else the shutdown hook can't function.
Minor clean-up having reviewed the diff between current code and the code prior to the Lifecycle re-factoring
Another fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49092 Make constant final
I can't see any reason why a Realm shouldn't be re-startable by default. Individual Realms can always override this.
Make md volatile to be sure there are no threading issues
Log any unexpected errors that might occur during server shutdown from the shutdown hook, and do not forget to shutdown (read: flush) the logging subsystem.
Remove the controller - MBean registration will always happen in init()/destroy() after Lifecycle refactoring Fix a handful of Eclipse/FindBugs warnings
Add License Header
Revert... Editor seams display problem... Sorry!
try to fix async for APR. 
Clean-up post init/destroy lifecycle refactoring By default, remove children on destroy, not stop
Clean-up post init/destroy lifecycle refactoring Allow Loader objects to be restarted
Clean-up post init/destroy lifecycle refactoring Allow Manager objects to be restarted
Add MBean registration and de-registration to LifecycleBase The new interface will need to be added to each component to get this to work.
Line lengths. No functional change.
Add new interface to StandardServer to enable MBean (de)registration on init/destroy
Remove invalid auto-generated import.
Align test with expected behaviour (currently fails). Will fix in following commits.
Add init() and destroy() support
Add call to destroy() that should unregister all the MBeans
No longer need ServerLifecycleListener
Register the MBeanFactory Make sure all the objects registered are unregistered
Make sure Server calls destroy() on subordinate Services
Add LifecycleMBeanRegistration Align init() and destroy() Executors and Connectors need to handle their own (de)registration
Just log multiple calls to destroy rather than throwing an Exception.
Add a setDomain() method to LifecycleMBeanRegistration since not all components (eg Exectutor) retain a reference to their parent. Implement this new method where required. Implement MBean (de)registration for Executors using the new interface.
Increase the threshold to try and catch if MBean registration breaks and MBeans don't get registered.
Clean-up prior to MBean changes
Simplify the connector. Keep a reference to just the Service rather than the Service and the Engine.
Search to more jars and fix testcase!
Better error message
Remove classes that are no longer in the source tree
https://issues.apache.org/bugzilla/show_bug.cgi?id=49241  
With the benefit of some sleep, refactor the MBean support for Lifecycle (still some components to convert) Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49134 Thanks to Marc Guillemot whose test case for 49134 provided the basis of o.a.c.mbeans.TestRegistration
Fix the tests the Lifecycle/MBean refactoring in r940634 broke.
Remove unnecessary code
Move ManagerBase to new Lifecycle/MBean implementation Fix a bunch of Eclipse/FindBugs warnings
Re-factor Valves to use LifecycleMBeanBase
Rename Eclipse files so they become samples Align the svn ignores list and the excludes list for the src tarball. The sample Eclipse files will be included, the 'real' ones will be excluded. Add ALv2 headers to sample Eclipse files
Fix copy&paste error in script comment. 
Re-factor Realms to use LifecycleMBeanBase
GSoC 2010: Add missing JMX attributes Patch provided by Chamith Buddhika
Replace spaces with underscore in HTML anchor names. To preserve compatibility each (sub)section will now generate two anchors: the old one and the new one, if they differ. It is port of r936982 from tomcat/site
Correct a sentence
More anchor handling improvements: 1) escape '#' character as well as spaces. See virtual-hosting-howto.html for an example. 2) allow to explicitly specify anchor name, using anchor="" attribute on a (sub)section. See default-servlet.html for an example.
Document comet package move
Typo
GSoC 2010: Make some JMX attributes read-only Based on a patch provided by Chamith Buddhika
GSoC 2010: Add missing attributes, use alphabetical ordering Patch provided by Chamith Buddhika
Descriptions need to be on a single line Fix attribute alignment so file is consistent
make sure the entropy can be converted to a String. 
IBM has agreed to re-license the affected files. A patch was provided by an IBM employee with a CLA on file under https://issues.apache.org/bugzilla/show_bug.cgi?id=49259 The files can now therefore be treated the same way as the other BCEL files. The updated files have been applied to BCEL and I have copied them across to Tomcat 7 and made the same set of changes as I made previously. The various LICENSE and NOTICE changes made in r934220 have been reverted. Thanks to Kevan Miller and his IBM colleagues for working to resolve this so quickly. 
Add a simple CSRF prevention filter. It has been tested with the Tomcat 6 manager app and a back-port proposal will follow shortly.
Clean up experimental (from Tomcat 5) MBean registration feature of StandardEngine prior to Lifecycle/MBean refactoring for ContainerBase
Fix JULI configuration so JULI is actually used. Fix FindBugs warnings
Stop the tests failing
Fix FindBugs warning
Allow the transition from NEW to DESTROYED for objects that are never started.
Make sure Tomcat instance is closed down correctly (prevents warnings in the logs).
Extend Lifecycle/MBean refactoring to ContainerBase
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49269 Set maxIdle to maxActive by default to prevent warning on start when maxIdle > maxActive Patch provided by Matt Passell
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49240 If a class can't be loaded, don't scan HandlesTypes for it Also handle NoClassDefFoundError Patch provided by pid
ContainerListener != LifecycleListener. Use the correct one.
No need to remove LifecycleListeners from destroyed components
Fix typos
NPE protection
https://issues.apache.org/bugzilla/show_bug.cgi?id=49235 Fix handlesTypes with annotations. The annotated class should be reported, not the annotation class.
https://issues.apache.org/bugzilla/show_bug.cgi?id=49228 Use English Locale since other Locale's may give add results
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49227 Ensure case conversion behaves as expected Patch provided by sebb
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49226 Ensure case conversion behaves as expected Patch provided by sebb
Change role name for Manager GUI access to manager-gui to align with planned changes to Tomcat 5/6
Fix remainder of https://issues.apache.org/bugzilla/show_bug.cgi?id=49181 Add additional check to prevent adding Servlet context listeners once the calls to the Servlet Context listeners start
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49224 Only try setting the username and password if they are non-null Patch provided by Matt Passell
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49221 Ensure case conversion behaves as expected Patch provided by sebb
Fix remaining issue described in https://issues.apache.org/bugzilla/show_bug.cgi?id=49218 doLookup should return null if the resource cannot be found and should not throw an exception Fixes a potential infinite loop in VirtualDirContext
Multiple TCK failures. Child containers are started during the STARTING_PREP state so if a child whilst the container is in that state, it must also be started.
Remove unused imports
Fix TCK failure Restore initialisation of logger that was triggering an NPE
Wrappers are started when added to the Context (since the Context is already starting). Don't try and start them twice.
Fix HTML niggles.
Remove completed item
Remove some stuff we have already done.
Simplify xml validation configuration. It is now configurable per context and can be set per host using a host-level context.xml file so remove the attributes on the host. If running with STRICT_SERVLET_COMPLIANCE, enable validation by default.
Identify source of TLD validation errors to aid debugging
Update to JSTL 1.1.2 to fix numerous XML validation issues with TLD files
Essentially revert r943726 Children may be added prior to calling Context.start() and they *do* need to be started in that case.
Whitespace tweaks
Fix copy/paste error Add whitespace to aid readability
Warn to be used wrong fragment name at web.xml!
Fix change fragment absolute-ordering at web.xml with manager redeploy!
Fix change fragment absolute-ordering at web.xml with manager redeploy! (Add test fragment samples)
Preparation be fore adding a new leak prevention feature: change order of features to alphabetic like in listener docs. Makes checking easier. 
Add Token Poller protection to our list of special leak protection. It initializes Java Cryptography Architecture early during startup to prevent the occasional Token Poller thread being started with the web app class loader as TCCL. 
Add the new contextName property of WebappClassLoader to its toString() and expose a read only via JMX. 
Remove whitespace
Better comment
Better handling for public ID when validation is enabled
Check whether context is null. 
TCK failures: Fix remaining failures with APR/native and a security Manager
List array elements in the JMX proxy output of the Manager application. 
Revert r944511
Fix auto-deploy issues caused by Lifecycle refactoring.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49290 Allow Tomcat to start when using a JarScanner with scanAllDirectories=true Patch by Larry Issacs (with minor tweaks)
Minor code cleanup. No functional change
Code cleanup.
Tabs -> 8 spaces Format long lines
Code cleanup. No functional change
Code clean-up
Role name change. Be explicit about the URL that the role is used with.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49299 Implement the requirements of section 7.1.1 of the Servlet 3.0 spec that require the path parameter to change name as well. Remove the option to set the default via a system property for the sake of simplicity.
Refactor XML validation error handling. Error reporting in web.xml and web-fragment.xml now includes source info.
Revert r944918
Improve comments, make param names consistent, clean up formatting. No functional change.
findChar is inconsistent in that it only supports characters in the range 0-127 while all the other methods support all single byte characters. It isn't used within the Tomcat codebase. Make it's behaviour consistent with the other character search methods.
Fix comments
Align comment and example
Correct example
Add some debug logging for state changes
Wrap debug message is usual tyest
More clean-up: - findCharXXX to findByteXXX - whitespace - make code consistent where possible
cleanup code added in r945074
Remove the dependency on MBean notifications for the mapper Unit tests pass. Fixes an issue with the TCK and welcome files.
Fix some Eclipse warnings
Tests for ByteChunk indexOf/find* methods.  It caught a bug in implementation of ByteChunk.indexOf(String, ...) when searching for a single-character string. I will commit a fix soon.
Fix a bug in ByteChunk.indexOf(String, ...)  The problem is that the method could not find a string which length is 1, as the only successful exit from the method was from inside the loop that checks the second and subsequent characters.  I added the testcase for this in r945230. In the test the bc.indexOf("o", 0, 1, 5) call returned -1, instead of 7.
Don't recommend a version that hasn't been released
Prepare for 7.0.0-RC2
Return version to 7.0.0-dev
Fix Eclipse warning in webapps
Simplify test
Fix Eclipse warnings. Reduce line length.
Fix tests for a pure Ant run
Do not abort testing after the first failure, but report about existence of failures after all the tests were run.
Re-factor test to get a clearer idea of why Gump is failing
Only register the MapperListener once per component and remove it as soon as it is no longer required.
Clear results of SCI scan on reload
Document recompileOnFail
Fix an Eclipse warning
Only redirect stdout
Make list of user roles immutable Modify a copy in getRoles()
Add missing keyword
re-add all-in-one testcase, in case if it matters for the failure that was observed by Gump
A simple testcase that prints version info
Fix Eclipse warnings, line-length
Make Log and StringManager instances private to the class. This fixes: - messages for one class being logged via the logger of another - messages not being found since the class is in a different packager to the super class
Clean-up
Otherwise it will fail with java 1.6.0_18 +. 
Sync Windows installer config files with 'normal' versions
Remove blank lines
revert r946149 Those "blank lines" must be there, because they separate sections of the manifest.
Move encoding outside the loop
Typo
Do not try to find compiled class files of test classes by looking directly into "known" places, but ask the classloader where it loads them from. This fixes test failure when ${tomcat.output} ant property has non-default value.
Typo in a comment
Corrent name
Add some debug logging for investigating the Gump failures. I may remove it once those have been resolved.
Additional change required for debug logging
Enable debug logging to investigate Gump failures
Complete correction of name
Add method TomcatBaseTest#getTemporaryDirectory() Use mkdirs() to create tempDir directory in TomcatBaseTest#setUp() Fix issue with TestRegistration test failing when ${tomcat.output} ant property had non-default value.  The failure was due to the contextDir.mkdir() call in TestRegistration#testMBeanDeregistration() failing to create a subdirectory because its parent directory did not exist.
Allow to test with APR. 
GSOC 2010: Further improvements to o.a.c.connector Patch provided by Chamith Buddhika
GSOC 2010: ResourceLink Patch provided by Chamith Buddhika
REpurpose the duplicate pathPath test to test the redirect process
Fix lost session path parameter on redirect
Remove unused code identified by Eclipse
Minor clean-up. Result is always converted to String so just do it once.
Add the certificate and key for the APR tests. 
Prevent core due to wrong synchronisation. 
Needed to test APR. 
Arrange APR logic. 
Oops... Minor errors. 
Additional fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48840 Port the fix from catalina.sh to tool-wrapper.sh as well.
The SSL gets cleaned too. 
Tabs to 8 spaces. No functional change.
Improvement suggested by Sebastian Bazley. 
Tabs to 8 spaces. No functional change.
Add a 403 page. If the user tries to use the old manager role, they'll get a 403.
Align host-manager role names with manager role names. Add a 403 page to inform users of changed role name.
Don't add HostConfig as a listener twice. It breaks the Manager app and probably other stuff too.
Prep for RC3
Restore -dev suffix post tag
According to Konstantin's review comments: - eliminate line breaks in descriptions - change capitalization of attribute from "uRLs" to   "URLs". 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48976 Document JAVA_ENDORSED_DIRS
Fix some TCK failures with the BIO AJP connector when using a security manager
Correct a typo
Removing the mini-'servlet' code from lite. The goal is to implement connector and http client, this creates confusion.     
Remove the 'integration' - ObjectManager and wrapping of DI frameworks. Lite is just a library/connector - doesn't need it, instead will integrate  it with existing tomcat JNI model. I may add it back for an example of using tomcat-lite standalone, but for now it's better to avoid confusion. 
Broken, not used. Source in o.a.t.util.buf was removed as well.  
Moved the JSSE code to separate package. Added a bunch of workarounds to support harmony/android, there seems to be a problem with the ciphers. Probably the code will go away after I add APR support - too many problems, in particular SPDY can't be implemented as it relies on SSL protocol negotiation. For now it mostly works on android.  
More coyote support. 
Various changes to better support coyote, remove integration package, prepare to replace jsse with apr, etc.  
Matching test fixes. Seems to pass ( maven can be used, but will build/test against tomcat6 ). 
Missed 2 files - older version of the protocol, will update them when I get to the new proto. 
It would a lot of work to have it switchable in APR. 
Remove duplicate code
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49095 AprEndpoint does not wakeup accepts with deferred accept or BSD filters Based on a patch provided by Ruediger Pluem
Tabs to spaces
Add a test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=49196 Patch to follow shortly
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49196 Avoid NPE on PageContext.getErrorData()
Remove unused imports
Add missing classes. 
Clean-up
Restore the naming resource MBeans
Make test more exact. Want to spot any change in the number of MBeans.

GSOC 2010 Add the container although it isn't much use yet. Patch provided by chamith buddhika 
GSOC 2010 Expose additional cluster attributes Patch provided by chamith buddhika 
GSOC 2010 Expose additional cluster attributes Patch provided by chamith buddhika 
Fix for BZ49343. When ChannelException is thrown, remove listener from channel.
Extend to test deferred expressions. Need to use request scope attributes since page scope ones won't be visible to the tag file when evaluating the deferred expressions.
Fix APR AJP logic. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49340 Simplify the mapper listener registration/de-registration process
It works (I fixed it for 6.0.20) but it still needs docs.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49360 Managers will be restarted on Context reload
Test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=49345 Fix to follow
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49345 Second parameter for new ValueReference should be property. There is no guarantee that the property will be the second child node.
Add some checks that nulls are handled correctly.
Fix EL issue reported on users list by obtaining class information directly from the values rather than via getType() which is likely to return a more generic type that the actual type of the value.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48971 Make stopping of TimerThreads optional and disabled by default
Fix test failure. Need to explicitly configure stopping timer threads
Fix Eclipse warnings in the o.a.c.tribes.test package
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49099 Hooking the CoyoteAdaptor into the existing AccessLog wasn't as invasive as I feared so go that route to log requests rejected by the Adaptor before the request/response reaches the AcessLogValve
Improve comment
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49178 Using ${catalina.base}/lib will require an additional permission
Add whitespace between words. It is trivial followup to r950164 
Followup to r948043 that was a fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49095 We should not use PrintWriter(OutputStream), because that implicitly uses the platform default charset. Specify the charset explicitly.
Followup to r950587 which was a fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49099 Fix lookup of the root context: its name is "", not "/".
Prevent possible deadlocks in AprEndpoint.Poller and AprEndpoint.Sendfile, caused by missing Object.notify() wakeup, which is similar to https://issues.apache.org/bugzilla/show_bug.cgi?id=48843
Include major.minor version numbers into the name of the registry key used to autolaunch Tomcat Monitor at Windows startup. This allows Tomcat 7 monitor to be installed and run in parallel to the Tomcat 6 one.
Fix an Eclipse nag
Clean up FastHttpDateFormat initialisation when using a security manager as prompted by Konstantin
"this.channel.removeChannelListener(this.rpcChannel);" call is replaced with "this.rpcChannel.breakdown();". 
Re-order so it is easier to check all objects are re-cycled
Enable access logs by default for 7.0.x
Expand the common pattern as an example to users
Refactor the hooks from the CoyoteAdapter to the access logs - cleaner interface - handles AccessLogs at multiple levels (but not multiple AccessLogs per container)
Extend access logging to requests rejected in the Processors
Started is only used in BIO connector
Correct Javadoc Fix whitespace
Remove code duplication by used abstract base class
Use provided parameter
Correct wording in a comment. It is a followup to r950596
Wrap long lines, so that this file could be copied to security-manager-howto.xml as is.
Update in-document copy of the default catalina.policy file
Rearrange tomcat-juli permissions, for better readability.
Add AccessLog interface to JDBCAccessLog
Remove the warning. The bug reports received indicate that folks are using this, generally successfully.
Use STRICT_SERVLET_COMPLIANCE to override the default for ACTIVITY_CHECK to align behaviour with other system properties
Put the comment in the right place
Part of refactoring STRICT_SERVLET_COMPLIANCE so it just changes defaults New ACCESS_SESSION property
Part of refactoring STRICT_SERVLET_COMPLIANCE so it just changes defaults New GET_RESOURCE_REQUIRE_SLASH property
Typo
Copy/paste error. Sorry for the noise.
Part of refactoring STRICT_SERVLET_COMPLIANCE so it just changes defaults New WRAP_SAME_OBJECT property
correct a typo in a comment
Additional fix required for http://svn.apache.org/viewvc?rev=951926&view=rev 
Use the constant rather than re-reading
Final part of refactoring STRICT_SERVLET_COMPLIANCE so it just changes defaults New property LAST_ACCESS_AT_START
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49376 Correct package names in info properties
Make syncs consistent Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49372 Avoid invalid Lifecycle transitions on failed start due to already bound shutdown port
Remainder of fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49372 Avoid invalid Lifecycle transitions on failed start due to already bound shutdown port
Remove unnecessary comment
Make constants final.
Make 'info' fields in these classes static and final, like in other places in Tomcat.
Do not evaluate the "execute.installer" property, because it is never used in this build file: "skip.installer" is used instead.
Remove unneeded phrase from a comment. It should be evident that someone should unwrap the line.
s/jre5/jre6/  
Cleanup JDT vs. ECJ:  - Replace "jasper-jdt.jar component" with "Eclipse JDT Java compiler"   in license texts  - Add JDT version to our ant version filter   and replace explicit version in release notes file with version tag  - Replace "jasper-jdt.jar" by "ecj-*.jar" in generated documentation.   I assume people know what we mean by "ecj-*.jar".   We shouldn't maintain detailed versions in those pages. Alternatively   running them through the filter means either adding maintenance by   keeping the file list up-to-date or much overhead by running all of   them through the filter.   Renaming the ecj-*.jar to simply ecj.jar or ecj-3.jar would hide   the full version from the interested observer. 
BZ49410: Missing tomcat-juli.jar in tool-wraper CLASSPATH.  Fixed by aligning toolwrapper scripbt closer with catalina script (not only for the juli jar).  The jar is now needed, because the classpath manifest entry for it has been removed from bootstrap.jar in order to support per instance juli.  It seems the tool-wrapper is only used for digest generation. If so, we could drop it and keep a much simpler digest script. I don't know any other use cases for the tool-wrapper. 
Test cases for bug49424 based on a patch by Earl Nolan
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49424 Avoid NPE if no input data is provided in a chunked POST request
Test method invocation with super classes
We already have the exact types. Don't try and derive them.
Fix an Eclipse warning
GSOC: MBean clean-up Patch provided by Chamith Buddhika
Update changelog
Modules are separate - should have own changelog etc.
Remove all references to Jikes since it won't work on a 1.6 jdk
After deprecating the Embedded class, move the package access/protection initialisation to Catalina
Cleanup. Make consistent, remove duplication, correct names.
Previous cleanup missed one string
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49213 Add permissions required by Manager application
Update changelog
Fix problem with JSF convertors - restore behaviour prior to r894720 that only checks a subsets of types for validity
Remove an unused method
Update changelog
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49445 The change in session ID is notified to other node. 
Typo in previous fix for 44285 
Update the doc. It is a followup to r954435
Strictly speaking, the webapps are in ${catalina.base}, not .home, as well as it is shown by examples below those lines in the policy file.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49436 Correct default for UserDatabase's readonly attribute
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49443 Use remoteIp... rather then remoteIP... consistently
Fix Gump failure
Update changelog
When using a Loader configured with searchExternalFirst="true" failure to find the class in an external repository should not prevent searching of the local repositories.
Alphabetical order
Add entryPoint support to the CSRF prevention filter.
Reduce code duplication in connectors: Use AbstractInputBuffer with APR/native connector
Reduce code duplication in connectors: Use AbstractOutputBuffer with APR/native connector
Reduce code duplication in connectors: Move addFilter() and addInputFilter() to base class
Fix Eclipse warnings in this package. No functional change.
Reduce code duplication in connectors: Move initializeFilters()to base class
Add support for additional 500 error codes. Allow responses to include blank lines
Add useful test JSP. Not used in unit tests yet but I expect to use it in later commits.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49230 Enhance JRE leak prevention listener with protection for the keep-alive thread started by sun.net.www.http.HttpClient Patch provided by Rob Kooper.
Update version number
https://issues.apache.org/bugzilla/show_bug.cgi?id=49122 Update ROOT's index page Patch provided by pid
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49475 Use new role name for manager app access
Add fix of 49475
Fix some old copy/paste errors
Improve the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49230 Don't log an error about loading Sun class on non-Sun JVMs. Use i18n for message.
Trim the value before adding to the list Review feedback from kkolinko
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49476 CSRF protection was preventing access to session expiration features Also: - Switch Manager app to generic CSRF protection - Add support for multiple nonces to CSRF filter - Improve 403 page - Don't open JSP pages in session expiration in a new window - makes CSRF prevention a real pain 
Must get in the habit of updating the 7.0.x changelog
Remove unneeded classcasts
Fix the Eclipse warnings and as a result better handle directory creation failures
Typos
Clean-up
Switch the Host Manager app to the generic CSRF protection Don't allow starting of hosts that are started Don't allow stopping of hosts that are stopped
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49414 Try to differentiate between request threads and threads started by applications
Add a check of the edge cases for bug 49488. As expected, they all pass.
Update changelog
Additional fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49030 When initializing/starting/stopping connectors and one of them fails, do not ignore the others.  These changes are already included in the BZ 49030 patch that I proposed for TC6.
Improve fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49414 Just look for presence of CoyoteAdapter class
Remove unused code
Fix some Eclispe / Findbugs warnings
Better way to keep Eclipse happy
Simplify code
Start JioEndpoint timeout thread, to handle timeout a AsyncListener.
remove second fix entry. Sorry!
Implement support for using *.jar pattern in VirtualWebappLoader to specify all JAR files in a certain directory.  This is inspired by Bootstrap.createClassLoader(..) and ClassLoaderFactory.createClassLoader(..). There is a small difference with regards to ClassLoaderFactory.createClassLoader(..) implementation: 1. I removed the file.canRead() checks as I think that they are not necessary here. I am checking existence and type only. 2. Note that isFile()/isDirectory() are documented to return false if the path does not exist, so using a separate exists() call there is not necessary.  Also three other changes: 1. Added trim() to the tokens. 2. Implemented debug logging. 3. Removed "not for production" warning from the JavaDoc.   An update for the documentation (/config/loader.html) should follow later.
Arrange filter logic. This is the fix for CVE-2010-2227.
Fix typo
Correct broken link on the index.html page of the jsp examples.
Re-factor to make upcoming changes easier to understand
Improve handling for method invocation in EL, in particular the method used to identify the method to invoke. This reverts r953440 and implements a more comprehensive solution. The method identification code attempts to mimic how the Java compiler works. In a few cases it finds methods where the Java complier reports an ambiguous method. The EL spec is sufficiently vague on method selection that I don't think this will be an issue.
Improve default security settings. Enable the LockOutRealm by default.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49518 Correct typo
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49522 Just use host and path in NamingResources MBean name rather than full Context MBean name
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49525 Cookies for ROOT context need a path of /
Fix typo
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49536 Ensure a 404 response for an unmapped request when no ROOT context is deployed. Most of the change is getting the mapper to use the Host object rather than the ObjectName or an empty string
Additional debug logging for manager selection
Make new timeout thread a daemon thread so Tomcat will shutdown properly
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49530 Make sure children are stopped if they are running when the parent stops.
Further MBean improvements. Patch provided by chamith buddhika
Test NIO AsyncListener timeout.
Fix FindBugs niggle
A few more FindBugs issues
Fix Bug 49528 - HttpServletRequest.isAsyncStarted() returns false when a Runnable is started Add isDebugEnabled statements.  Todo: Why we doesn't start directly a container thread with asyncContext.start()? Currently we start user runnable as an internal forward. 
Fix NPE and add small test case to check VirtualWebappLoader.
Fix indentation...
no functional change. reformating and fix some checkstyle warnings
Revert r960283, r960316, r960318. r960283 broke the spec and the other commits were sufficiently tightly coupled to it that it was easier to revert all of them than try to unpick them.
Revert r958362, r960083, r958406, r960069. r958362 broke the TCK tests and the other commits were sufficiently tightly coupled to it that it was easier to revert all of them than try to unpick them.
Remove *.rtf from fixcrlf patternset.  No need for native line ends in RTF files. Their spec indicates they should use CRLF. 
Add a test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=49528
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49528 AsyncContext.start() uses an internal dispatch but this should not have the same side-effects as calling dispatch() TCK and test cases passes with this patch
Clean up
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49528 Previous fix was incomplete. Improve test case and fix TCK and test cases pass with this patch
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49550 Trivial code clean up
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49551 Allow default context.xml file to be specified using an absolute path.
Test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=49217
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49217 Prevent use of Java keywords in identifiers
Side effect of fixing https://issues.apache.org/bugzilla/show_bug.cgi?id=49217 Make the examples and the unit tests spec compliant
Improve fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49217 Make sure identifiers meet the requirements of the JLS
Better error message
Fix some Eclipse warnings
Improve logging of unhandled servlet exceptions by including the context name. For JasperExceptions, the JSP snippet will be logged (if enabled). Previously this was not logged and only displayed in the error page seen by the user.
Include session ID in error message logged when trying to set an attribute on an invalid session.
Update post release of 7.0.0 beta
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49503 Revert the protocol handler component of r940656. Subsequent lifecycle fixes have resolved the issues that required this change
Tab police
Test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=49555 Fix to follow shortly
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49555 Correctly handle tag libraries that use functions defined in static inner classes
GSOC 2010. Continue work to align MBean descriptors with reality. Patch provided by Chamith Buddhika.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48297 Use the HandlerInfo to initialise the HandlerChain, rather than adding to it which clearly isn't correct. From looking at the javadoc, I believe this is the fix required but I don't have a test case.
Documentation improvements: - Explicit version number in <title ../> - Add version and date to every page - Remove duplicate "Apache Tomcat 7" and promote real page title - Automate copyright end date
Add release date
Align docs with reality
Improve CSRF protection filter by using SecureRandom rather than Random
Add CVE-2010-2227 test case
Align implementation with docs. nonceCacheSize should be configurable
Make the random source used for nonces user configurable
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49570 When using the example compression filter, set the Vary header on compressed responses
Typo
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49478 Add support for user specified character sets to the AddDefaultCharsetFilter. Based on a patch by Felix Schumacher.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49442 Trivial code clean-up. No functional change. Based on a patch provided by Sebb.
Trivial cleanup no functional change
javax.mail is a dummy implementation - mark it as such to stop Eclipse complaining about empty methods and unused parameters
Eclipse warnings for annotations
Remove unnecessary code since Class.getCanonicalName() is available
Make the fix for bug 49555 more robust
Prepare for the next release
Hard code the snapshot version for 7.0. 7.0-SNAPSHOT will always point to the latest snapshot. I'll clean out the snapshot repo before I do the next update
Avoid NullPointerException, when copyXML=true and META-INF/context.xml does not exist.
Sign the pom. Make sure source jar signature doesn't overwrite the non-source jar signature.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48960 Disable exec by default in SSI and provide an option to enable it for both  Servlet and Filter
Add myself to the list.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49182 Align setclasspath comments with reality. Based on a patch provided by sebb.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49130 Better describe the core package Patch provided by sebb.
Fxi https://issues.apache.org/bugzilla/show_bug.cgi?id=49128 Don't swallow exceptions unnecessarily
Fxi https://issues.apache.org/bugzilla/show_bug.cgi?id=49127 Don't swallow exceptions unnecessarily
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48998 Add the ExpiresFilter, a port of mod_expires Patch provided by Cyrille Le Clerc
Remove the ExpiresActive option. Just comment it out if you don't want to use it.
Test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=49598 Multiple invalid session cookies
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49598 When updating the session cookie header, actually update it rather than adding a new header without a name.
As suggested on the users list, add redirects to the HTML interface to the root of the host-manager and manager applications
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49428 Add a work-around for the known namespace issues for some Microsoft WebDAV clients. Patch provided by Panagiotis Astithas. 
Make the bean Serializable so I can use the example to test/demo session persistence on restart Add required getters/setters Indent using 4 spaces Fix FindBugs warning
Remove unused code
Clean-up. No functional change.
Expose executor. Required so Servlet 3 Async implementation can use the container thread pool when a new thread needs to be dispatched. (e.g. from AsyncContext.start(Runnable)
Trivial - align comment
Restore pero's timeout fix for the BIO connector. Add configuration of the timeout.
Eclipse sample files need to have correct (platform specific) line endings in src distributions.
Add note about message processing order.
Correct explanation. mapSendOptions=6 is synchronous, not asynchronous.
Return copies of the URL array rather than the original. This facilitated CVE-2010-1622 although the root cause was in the Spring Framework. Returning a copy in this case seems like a good idea.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49617 Correct the ExpiresFilter documentation after changes to the submitted patch
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49600 Return a consistent exception for 'Not Found' resources.
Test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=49600 Based on a patch by Marc Guillemot
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49567 Better handling of calls to complete() from a separate thread. There are still a handful of TODOs around this which will follow shortly but I'm committing this since it passes the unit tests and the Servlet TCK (with BIO)
Fix possible NPE
Poll time and wait are both in milliseconds
Run all unit tests will all connectors
Remove some TODOs that have been implemented
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49613 Improve performance for multiple calls to Request.getAttributeNames() when using SSL. Patch provided by Sampo Savolainen.
Extend Lifecycle state machine so global listeners can start before everything else without impacting the context and TLD config listeners
Implement some Servlet 3 TODOs
Fix some Eclipse warnings, remove some implemented TODOs
Fix copy/paste error
Fix regression in previous fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49555 Use TCCL to load webapp classes
Use specific imports
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49268 Add necessary plumbing to enable Checkstyle The config file is deliberately empty. The check will be uncommented once the source code has been fixed (~200 files contain tabs).
Tab police: javax.el Thanks to Checkstyle
Tab police: javax.servlet (partial) Thanks to Checkstyle and Eclipse source formatting
Code clean-up. Fix Eclipse warnings. Implement TODOs.
Revert part of previous clean-up. Jar needs to remain open
Fix the paths used for JAR resources
Handle the edge cases where resources packaged in JARs have names that start with a single quote character or a double quote character.
Tab police: javax.servlet (remainder - not sub-packages) Thanks to Checkstyle and Eclipse source formatting
Tab police: javax.servlet.http Thanks to Checkstyle and Eclipse source formatting
More tab police - javax.servlet.jsp
More tab police - misc packages
Update to require Ant 1.8.x+ to take advantage of the new property expansion for if/unless and then use it control if the validate code is executed.
Tab police in org.apache.catalina
More tab police
Check the tests too.
Extend checks to webapps Tab police for /test and /webapps
Ignore config for checkstyle Eclipse plugin
Remainder of tabs to spaces changes Enable check in checkstyle config
Add additional tests known to pass - list provided by Marc Guillemot.
no reason to do indirect here
reverting, since 1.8 requires an indirect
Update changelog
Provide control over which connectors are used to run tests - helpful when (as now) only one of the connectors has issues
Prevent JVM crashes caused by shutting down the APR library too early.
Only need to wait a single pollTime, not one pollTime for each poller.
Fix unit test failure with APR connector. Make sure MBeans are de-registered when connector stops.
Fix unit test failure with APR. SSL renegotiation will not work by default for this connector.
Fix unit test failure. Ignore exceptions when destroying APR connector if APR was never initialised.
Code clean-up Remove deps on o.a.catalina Fix a couple of Eclipse nags
More unit test fixes - better handling when APR/native connector is not started
Only download Checkstyle if it is going to be used Add note the Checkstyle is LGPL Add option (off by default) to fail test target as soon as one test fails.
Reduce log level for debug messages from error to debug
Fix a failing test with the APR connector. Handle async requests that timeout.
Make life easier when debugging failing tests
Fix copy/paste typo
Remove unused SimpleTcpReplicationManager and associated ReplicatedSession
Remove deprecated defaultMode attribute Clarify current behaviour of maxActiveSessions Clean-up cluster-manager docs
Remove unused property
Rejected session count should not be writable
Remove deprecated method
Fix an Eclipse nag
Revert part of r980399 - attribute is present and used in ManagerBase so will be inherited
Refactoring - reduce duplication Handle maxActiveSessions, rejectedSessions and processingTime in ManagerBase
Refactoring Move propertyChange() implementation to ManagerBase to reduce code duplication
Refactoring Change BackupManager to extend ClusterManagerBase rather than StandardManager - The functionality being inherited from StandardManager (persistence over restart) was being bypassed - Further reduces code duplication, mainly in BackupManager
Follow on to r980418 Need to move registration with context to ManagerBase too
Update the changelog with a note on the session manager refactoring
Enable the HTML Manager application to differentiate between primary & backup sessions. Both can be invalidated Attributes can be viewed in both Attributes can only be removed from primary sessions
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49407 Make BackupManager and DeltaManager handle primary and backup sessions consistently
Add optional support to the HTML Manager application to display Proxy sessions. It is disabled by default.
Fix possible threading issue in unit tests. Adding some Thread.sleep() calls in the right place can cause the tests to fail. This is probably one of the causes of the current Gump failures.
Revert r966596 - pollTime is in microseconds, wait is in milliseconds Add an additional wait that prevents a JVM crash on shutdown detected in TestAsyncContextImpl tests 
Switch back to standard commons file-upload layout - simpler to merge updates. Part 1.
Switch back to standard commons file-upload layout - simpler to merge updates. Part 2.
Update to commons-fileupload 1.2.2
Missed prop update
Tab police
Update packaged re-named Jakarta BCEL
Bump version post 7.0.1 tag
Add an explicit test case for bug 49655
Fix svn properties: - java/org/apache/tomcat/util/http/fileupload/InvalidFileNameException.java   Removed mime-type and added eol-style and keywords.   Already pinged upstream about that.   Used the same keywords as the other files, slightly   different from TC conventions. - We should add tag, tagx, jspf, jspx to our eol-style   subversion configuration for native line endings. 
Fix running with a security manager
Javadoc fixes
nit
Not ready for this check yet
Tab police
Javadocs fix: @Link -> @link 
Javadocs fix: @returns -> @return. 
Use source encoding ISO-8859-1 for javadoc just like we do for javac. 
Replace UTF section sign in Javadoc by HTML entity. 
Tab police
Tab police
Tab police
Tab police
Tab police
Tab police
Tab police
Tab police
Extend Checkstyle to most text files Fix tabs in remaining files
Correct Javadoc copy and paste error
Handful of Javadoc fixes
Update to commons-daemon 1.0.3
Fix the remaining Javadocs except the external links to JAX-RPC
More Javadoc fixes that were missed earlier
Provide Javadoc for Servlet, JSP & EL Provide external links to JAX-RPC Javadoc
Update changelog
Fix multiple copies of RUNNING.txt in full-docs.tar.gz
Fix typo
Upgrade the Eclipse compiler
Further places where our JDT version is hard coded.  It would be nice to at least support globs in the jar scanner configuration, so instance configuration can be kept stable when doing product updates.  Otherwise things will not break in an obvious way, but e.g. startup performance might drop. 
Add SKIP_IDENTIFIER_CHECK system property to control checking of EL expressions
Allow glob patterns in the jarsToSkip configuration and add some debug logging to the jar scanner.  Still need to localize debug log messages. ecj Jar in catalina.properties now uses a glob, did not yet add globs to all the commons jars in the default configuration. 
- clean up Javadoc of new class - localize log messages - remove unused imports and members 
Spread out some glob patterns for the commons JARs in jarsToSkip. 
Bump version number
Use new admin-gui and manager-gui roles for the user
Add default --PidFile (new with daemon 1.0.3)
Remove domainReplication attribute from ClusterManager. 
Fix class name of default jar scanner in docs. 
Update the changelog
Move stuff that didn't make the 7.0.2 tag
Let's be more explicit in logging, what the actual jar file is. 
- Remove duplicate entry - Fix typo 
Fix Eclipse warnings in webapps
Extend checkstyle to include checking * imports Fix all current * imports Fix a few other issues along the way  - Missing @Override  - serialVersionUID
Remove redundant imports  (Bugzilla was down)
Tried to add GenericWhitespace test - has to be disabled due to a bug
Couple more whitespace checks. In both cases went with the nospace option since that is what the majority of the current code uses
Skip repackaged DBCP in validate target (Gump was running it). Any build where the deps are downloaded inside the svn checkout would fail in a similar manner
Code clean up in o.a.t.until.net.jsse  - @Override  - import order  - unused code  - unnecessary code
Extend fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48545 to aid back-port to 6.0.x by better aligning behaviours
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49585 Update for changes in Commons Daemon packaging
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48817 Add Validator interface and allow users to configure a Validator class name 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49714 The annotation process of Jar doesn't influence distributable element of web.xml.
Add Null check when CHANGE_SESSION_ID message received.
No need for autoconf
Enable off-line building of extrsa - moves commons-logging libs to standard Tomcat lib download process
Fix broken docs link. 
Small fixes to TC 7 build docs:  - correct download link - remove "ant download" - update ant version requirements from 1.6.5 to 1.8.1  CTR 
Correct a typo
Fix spec version numbers in comments
Link the MBeanFactory to the Server that creates it as some MBeanFactory methods need the container to be set.
Add a message to the exception
Fix POM reference error ID'd on users list
Update changelog
Fix import ordering - no functional change  -javax.* packages
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49757 Correct generics warnings and a couple of other warnings whilst I had the files open. Based on a patch by Gbor
Fix tpyos. 
Code clean-up. No functional change. Extend Checkstyle checks to import order. Use Eclipse tooling to fix current code base.
Extend the simple MapRealm use for testing to support roles.
Add support for parsing a session ID and the 100-continue expectation
Provide 100 Continue responses if required during FORM authentication Side issues from investigating https://issues.apache.org/bugzilla/show_bug.cgi?id=49779
Correct test name since this turned out to be a side issue
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49779 Improve handling of POST requests and FORM authentication, particularly when the user agent responds to the 302 response by repeating the POST request including a request body. Any request body provided at this point is now swallowed. Clean up the FormAuthenticator test case and extend the coverage to include bug 49779 and the remaining combinations of request methods.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49758 Fix generics warnings exposed by a fix in Eclipse 3.6. Patch provided by sebb.
Add support for LAST_ACCESS_AT_START system property to DeltaSession.
Fix Gump build
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49750 Align WebappClassLoader.validate() implementation with Javadoc and ensure that javax.servlet.* classes can not be loaded by a WebappClassLoader instance. Patch provided by pid.
Fix the Eclipse warnings in o.a.c.loader
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49726 Specifying a default content type via a JSP property group should not prevent a page from setting some other content type Includes test cases
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49721 All JARs can be resource JARs. Although the spec defines no order, use ordered JARs in order then the remaining JARs in any order.
Update changelog
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49670 Fix SSO - broken by Lifecycle refactoring
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49669 Another Java class triggering a memory leak. This time javax.security.auth.Policy
Remove methods already defined by Container
Fix typo
Correctly handle anchors in URLs with the CSRF prevention filter.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48738 Workaround a couple of long standing JDK bugs to enable GZIP compressed output streams to be flushed. Based on a patch provided by Jiong Wang.
Notes on a couple more checks
Fix logger visibility
Fix some edge cases in the NIO connector when handling requests that are not received all at the same time and the socket needs to be returned to the poller. This should fix the current Gump failures in the NIO tests.
Fix memory leak on context stop
Remove empty package
Simplify APR version requirement checks by calculating compound versions and doing a simple compare
Minor clean-up. Merge methods.
Trivial code clean-up
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49749 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=38113
BZ49828: Remove deprecated J2SE/J2EE terminology and replace links to Sun with links to Oracle (for those Oracle links that look static). 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49698 Allow listeners to call complete when a async request times out Add a test case based on pero's previous timeout test case
Remove the debug logging since we got to the bottom of this failure a while ago.
Fix warnings
Fix likely cause of Gump failure. Fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49698 in r990342 was incomplete
Remove some unused code
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49799 The new omit< attribute for <jsp:attribute .../> elements now supports the use of expressions and expression language.
Clean-up unused attributes
Fix warnings
Fix warnings
Some Lifecycle clean-up
Clean-up
Re-factoring. Preparing for Http11AprProtocol to extend AbstractHttp11Protocol
Re-factoring. Reduce code duplication. More still to be done.
Remove excludes for files no longer in source tree
Remove setting distributable on the Context from the docs. It gets lost on webapp reload() e.g. when triggered from the manager app.
Add a comment as a reminder
Update the Servlet, JSP & EL javadoc links and add spec links.
Fix warnings
BZ 48967: Replace strings "catalina.base" and "catalina.home" by globally defined constants.  Patch provided by Marc Guillemot. 
Followup to r991959.  Forgot the two classes. 
BZ 49865: ExceptionUtils throw NoClassDefFoundError during startup. Add TODO markers. 
Trim trailing spaces. No functional change
Store the Acceptor instances in the array like we do for other threads
Make sure we exit the thread if not running. Otherwise the thread will block in run until the VM shuts down
Join poller and sendfile threads on destroy. This requires to change the Poller and Sendile to Thread instead Runnable for simplicity.
BZ 49869: Javadoc Fix. 
Expose current state of Lifecycle components via JMX beans (where a component has one). Mainly useful for monitoring web application status.
Remove method that no longer exists
Add wrapper over Socket.destroy which will make sure we don't call destory for sockets already closed by the parent pool cleanup
Call join only for alive threads
Make destroy method returning when the worker thread finishes instead separately calling destroy followed by join
Keep MBean names consistent with Tomact 6.
Sync with Jakarta. Add generated serialVersionUID's. Don't use the same values as Jakarta since the code has been structurally modified (to removed unused elements)
Update merge info
Trace through some unused code and remove it.
Add @Override markers. Auto generated by Eclipse. Checked manually.
White-space clean-up Reduce sequences of three or more blank lines to two blank lines
Remove some unnecessary code and fix an Eclipse warning
https://issues.apache.org/bugzilla/show_bug.cgi?id=49876 Generics warnings in the copied Apache Jakarta BCEL code. Based on a patch by Gbor. (markt) 
Hard close the accepting socket if unlockAccept failed
Use shutdown instead close for hard closing the socket which is inside Socket.accept call
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49865 Allow Tomcat to start if catalina.properties is not present
Remove debug code that was added in r991959 
Fix an Eclispe nag.
Make sure acceptor threads are stopped when the connector is stopped. Also fix @Override warnings for the method
Make sure async timeout thread is stopped when the connector is stopped. Correct copy and pasted comment Also fix @Override warning for the method
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49802  Allow the connectors to be stopped via JMX.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49883 Return a name for use in log messages rather than throwing an UnsupportedOperationException
Misc code clean-up.

Switch to a JSP for the Tomcat home page and make the version numebr dynamic as the hard-coded version number in the static page can cause confusion in when using CATALINA_BASE and switching between multiple CATALINA_HOMEs
Fix typo
Extend fix for bz49883
If a ping message fails, removed the failed members from the map rather than propagating the exception
manager -> manager-script
Couple of trivial Eclipse nags
Avoid NPE when a parallel request invalidates the current session
Add @Override to test code
Reduce visibility, remove unused/unnecessary methods prior to fixing bz49884
Additional debug logging to investigate https://issues.apache.org/bugzilla/show_bug.cgi?id=49884 - logs hashcodes for current request, coyote request and request processor - logs thread name - makes debug stack trace optional (enabled with trace level logging) - adds debug statements to additional methods
Remove unused attributes. This all moved to Context.
Remove unused attributes. This all moved to Context.
Fix warnings in the host manager package
Bring changelog up to date
Update to latest Tomact 6.0.x and DBCP 1.3.x release
Update changelog
Remove some unused code
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49831 Make sure pooled XA connections are properly closed when the pool shuts down. Based on a patch by Daniel Mikusa.
Document new validation class (https://issues.apache.org/bugzilla/show_bug.cgi?id=48817) Patch provided by Matt Passell.
Update changelog
Fix @Override warnings
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49892 Correct JNDI name for method resource injections Based on a patch by Gurkan Erdogdu
Update changelog
Trim whitespace from interceptor class names, property names and property values.
Update change log
Shorten the debug output
Refactor log messages to use logger from concrete class
Code clean up
Remove pointless comment. Schema validation moved to the context
Remove unnecessary digester configuration hostConfigClass and engineConfigClass were removed before 6.0.x
Revert r996112. At least some of that config is required.
Fix an issue where <Context .../> elements defined in server.xml did not use the configClass specified by the parent <Host .../> element
Update changelog
Update commons pool to 1.5.5
Further work for https://issues.apache.org/bugzilla/show_bug.cgi?id=49234 GSOC 2010. Enable the creation of Services, Engines, Connectors, Hosts and Contexts via JMX from a minimal server.xml that contains only a Server element. Based on a patch by Chamith Buddhika. I added the additional changes to pass the parent class loader down the hierarchy.
Fix typos. Remove attributes that don't exist. Add a missing attribute.
Fix Eclipse warnings prior to working on bz49884 refactoring
Code clean-up
Re-factoring the connectors. Remove large chunks of duplicated code in the Processors. Some minor changes elsewhere to support the re-factoring.
Convert ActionCode to an enum. Shorten all the names by removing ACTION_ from the beginning. We have to use ActionCode.XXX to ACTION_ is just wasted screen space.
Add @Override markers to package
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49924 When non-primary node changes into a primary node, make sure isPrimarySession is changed to true.
Fix most of the warnings in this package
Code clean-up and a little preparatory re-factoring prior to large async changes
More re-factoring prior to large async changes
More re-factoring: expose the Executor
More re-factoring: AsyncContext will throw exception
Address a concern raised in https://issues.apache.org/bugzilla/show_bug.cgi?id=49584 Re-factor code to clarify con is never null when release is called.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49584 Move the offering of a new thread on release from the abandoned connection code to the release code to eliminate the possibility of a blocked thread on release.
Update changelog
Fix Javadoc
Include the suffix in the version number
Fix niggle
Remove empty dir
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49909 Re-enable JSTL. This was a regression in the fix for bz 47950
NIO and APR processors don't use START/STOP so this code is unnecessary
Remove START/STOP actions and started attribute. They aren't adding anything.
Remove more START/STOP actions and started attribute. They aren't adding anything.
Code clean-up. Align BIO and NIO to make Async refactoring easier
Remove unnecessary code. Superclass method does exactly the same thing.
Remove unused import
Misc Eclipse and FindBugs warnings
Also handle NPEs (seen during testing of new async re-factoring) and ignore them if the endpoint is shutting down.
Nothing was reading this. Remove it. It can always be added back in later if we need it for something.
Code clean-up. Align BIO and NIO to make Async refactoring easier
Code clean-up Align end-point behaviours. Should then be easier to apply async chnages.
Code clean-up Use a single method for unlockAccept
More refactoring. This one very simple.
Remove unused imports
Re-factor JIO end point to look more like NIO end point. Moving stuff around, processing order should remain the same.
Remove unused constructor
Remove unused code as identified by UCDetector 
correct a typo
add release date for 7.0.2 beta, from announcement on tomcat.apache.org
Delete reference to option that was previously removed.
Add connector wait for shutdown to changelog
Use *modern* types of nsis install/uninstall icons
Need ant-launcher.jar to compile JSPs with Ant rather than ECJ
Fix typo
Improving the documentation for logging configuration in Apache Tomcat
Add the missing onStartAsync event
Correctly define the ROOT context in unit tests
Parameterize the APR location for the unit tests
Fix Javadoc warnings highlighted by buildbot
Adding a description for build-docs task
https://issues.apache.org/bugzilla/show_bug.cgi?id=49955  Improvements and corrections for the Building Tomcat guide, plus sample Eclipse launch targets.  Based on contribution from Wesley Acheson.
https://issues.apache.org/bugzilla/show_bug.cgi?id=49102  Protecting AJP code -> header/method lookup arrays with getters. No measurable slowdown (especially after a profiling JIT gets done with it).
Take care of line endings for the two files added in r1000392
Add a comment. I guess it is too late to change it now, as the code is more than 3 years old.
Reduce timeout from 60s to 3s to speed up async tests
Fix Bz #49993 by checking the JAVA_HOME/JRE_HOME environment variables
Fixing Tomcat startup class in building instructions.
Tab police
Clean-up. Reduce whitespace, unnecessary comments
Better Javadoc. If endpoint is shutting down, return false so connection to client is closed immediately.
Add some Javadoc. Use SocketStatus.OPEN rather than STOP since the BIO connector treats them the same way and it reduces code complexity. It also simplifies async re-factoring I have in the works,
Since SocketStatus is always OPEN or TIMEOUT for BIO, remove the test.
Fix a handful of Eclipse warnings
More NPE avoidance. Keep process methods aligned.
Remove some unused code.
Change method name so it is easier to distinguish between async and comet processing. No so important here since comet isn't supported, but need to change it to align with changes to be made in NIO and APR
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49884  This required a major re-factoring of the async implementation. In summary: - Moved state management to the Coyote Processor - Added a SocketWrapper to the APR socket - Added syncs to ensure only one async state change at a time - Added syncs to ensure only one thread changing a socket's state at a time  A number of new bugs were also uncovered and fixed by this re-factoring: - delay processing complete() and dispatch() until request where startAsync() is called finished processing - onAsyncStart listener event  Currently the test case for bug 49884 passes with the security manager enabled using "ab -n 5000 -c 150 -k ..." (it broke with "ab -n 50 -c 10 ..." previously)   The unit tests pass for all three HTTP connectors.  The AJP connectors have only been modified to ensure the code compiles.  The following work remains: - Testing all connectors (HTTP and AJP) with TCK + security manager and fixing whatever is broken - Further clean-up - There is further scope for reducing code duplication between the connectors / aligning the code so it is easier to maintain.
Corrected a typo s/vesion/version/g
Fix comment typo
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48644 Don't catch Throwable
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48644 Some Throwables must always be re-thrown
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48644 Some Throwables must always be re-thrown
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48644 Some Throwables must always be re-thrown
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48644 Some Throwables must always be re-thrown
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48644 Some Throwables must always be re-thrown
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48644 Some Throwables must always be re-thrown
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48644 Some Throwables must always be re-thrown
Remaining fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48644 Some Throwables must always be re-thrown
Update
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49209 Prevent possible AccessControlException during undeployment when running with a security manager Patch provided by Sylvain Laurent
Update
Adding myself to active devs list.
Moved all Eclipse specific files into res/ide-support/eclipse. Removed spaces from launch target filenames. Corrected launch targets to run in output/build instead of root directory (still not sure if they're a good idea) Added an Ant ide-eclipse target to prepare the working copy to be built with Eclipse and create Eclipse project files. Updated the Building docs to document new Eclipse setup method. Added descriptions of how to configure Eclipse to respect Tomcat coding conventions to the Building guide.
Add license header
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49625 Ensure Vary header is set if response may be compressed rather than only setting it if it is compressed.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49657 Correctly handle CGI executables with spaces in the name/path
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49728 Improve PID file handling, particularly when another process creates it and Tomcat is unable to write to the file.
Update
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49665 Better handling for missing TLD files. Report JSP filename and location.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49195 Avoid error message when shutting down Windows service when the shutdown port is disabled.
Respond to mturk's review. Make rm  more robust. Avoid potential issues with (...).
More review comments form mturk. Tighten up handling of ps output.
Be consistent with CATALINA_PID quoting and always redirect all streams to /dev/null cause we are interested only in return value
https://issues.apache.org/bugzilla/show_bug.cgi?id=50018 Minor javadoc corrections in Jasper.
Correct a typo in message
Fix error in fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48644 Should use ExcpetionUtils from o.a.tomcat.util, not o.a.jasper.util Fixed with the help of Eclipe's organise imports that also removed a few unused imports.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50021 Don't reference ExceptionUtisl from Bootstrap - it won't be visible at startup.
Reduce code duplication in the APR connectors (prior to aligning with the Async refactoring)
Refactor logging
Rename local variable to make code clearer
Re-factor the async state machine into a separate class so it can be re-used for the AJP processors as well.
Tweak the refactoring
Minor clean-up to align with AJP
Get AJP working after async refactoring. Some issues remain with AJP/APR connector which still has a handful of TCK failures.
Clean-up. No functional change.
Avoid NPE when mapOwner is null.
Fix some of the remaining issues with the AJP/APR connector post async refactoring. Still does not pass the TCK.
Fix remaining issues with AJP/APR and TCK. Note mod_jk log is full of warnings so there is still work to do here.
Fix the root cause of the previous TCK failures (badly re-factored flush()) and restore the changes that were just working around the symptoms (poller stuff). Servlet 3.0 passes for the AJP/APR connector as of this commit.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49730 Race condition in executor can lead to long delays in request processing
Fix warnings in this package
Register and deregister Executors in JMX
Fix Eclipse warnings
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49856 Add an executorName attribute to Connectors so it is possible to trace ThreadPool to Connector to Executor via JMX.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49860 Add support for trailing headers
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49667 Ensure JDBC leak prevention code doesn't trigger the very memory leak it is meant to be fixing.
Fix Eclipse warnings
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49861 Don't use commas when logging RMI port values
getKeyCount() didn't do anything due to local variable definition
https://issues.apache.org/bugzilla/show_bug.cgi?id=49890 Detect when the JVM bug occurs and log an error asking for more information.
Add a TODO
-e doesn't exist on Solaris
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49905 Prevent memory leak when using aysnc session replication
Update changelog
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49915 Make error more obvious, particularly when accessed via JConsole, if StandardServer.storeConfig() is called when there is no StoreConfig implementation present.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49916 Switch to using an initialisation parameter to pass JSP file information from Catalina to Jasper. This simplifies the Catalina code as well as making it easier for Geronimo and others to integrate Jasper. Patch provided by David Jencks.
Create service-install.log file during installation with params that were used to invoke commons daemon
Revert r1003552 & r1003550 as it had a significant negative performance impact (orders of magnitude) on Windows during testing.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49985 Make thread safe
Fix NPE and TCK failures caused by previous fix for bug 49799.
Bump version
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49998 Handle single quoted attributes in detection of jsp:root element in XML syntax JSP files.
Correct changelog entry for r1003923 7.0.3 was cut from r1003911, so this one will be in 7.0.4 as Mark noted in BZ Correct a typo in the bug number. It is BZ 49998
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49922 Don't map filter twice if filter matches multiple mapping.
Improve handling of setting primitive values on beans.
Correct fix version. I think a few more of these need correcting. Checking now...
ADd missing entry
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49937 Use InstanceManager to create AsyncListeners so annotations are processed. Based on a patch by David Jencks.
Tweak generics. fix a handful of warnings.
Simplify instantiating parent loggers. No need to instantiate all of them all at once since Logger.getLogger() will result in a call to this method.
To avoid NoSuchMethodException, xmlValidation and xmlNamespaceAware are removed from the createStandardHost definition of mbeans-descriptors.xml.  xmlValidation and xmlNamespaceAware are attributes of not Host but Contex. 
Add log.warn if unlockAccept fails to wakeup the listening socket
Use better explanation
Fix 49923 by making sure timeouts can't be negative
Mladen fixed 49923
Use absolute time spend to unlockAccept and lower down the timeout to 30 secs
Remove todo for bad idea
Remove duplicate method. Rename remaining method.
Reduce code duplication. Convert file names to a context path in a single method.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50026 Always calculate path of resource to be served relative to the context root. This invokes the standard protection of WEB-INF and META-INF directories. This is a breaking change for the unofficial use of DefaultServlet to remount the webapp base under a new path.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50026 for WebdavServlet Factored checking of special WEB-INF and META-INF paths into service to trap requests for GET methods handled by DefaultServlet (which does not check access). Retained checking of special paths in handlers for copy, delete, move (copy + delete), and in enumeration of resources (propfind).
More fixes for https://issues.apache.org/bugzilla/show_bug.cgi?id=50026 Calculating path prefix used in listings correctly so links in listings produced by WebdavServlet mounted to a subpath are correct.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49945 More JMX improvements. Patch provided by Chamith Buddhika.
Add missing AL2 header
Updating changelog with fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=50026
Correct fix fot 49669
typo
Make sure copyright year is replaced for root webapp
Make sure copyright year is replaced for root webapp
Simplify. Path is stored in MapElement.name
Turn the commented out test code into a unit test.
Amending the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49669 Do not depend on the deprecated class. Use reflection instead.
Remove @SuppressWarnings that is no more needed
More fixes for https://issues.apache.org/bugzilla/show_bug.cgi?id=50026 Calculating complete resource path when accessed via RequestDispatcher.include()
Correcting JavaDoc for HTTP methods. No functional change
Making TomcatBaseTest.getUrl() work for get requests that return 404 responses
Adding unit tests for DefaultServlet and WebdavServlet to test basic serving/mounting behaviour and protection of special paths
Colleague at $work reported issues path parameters and extension mapping so add some tests. Looks OK.
7.0.3 not released. Missing license header in src file.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49952 Allow ServletContainerInitializers to add listeners to a web application. Patch provided by David Jencks. 
Fix comment typo Better error message when a SCL can not be added since the listeners have already been called.
Whitespace police
Fix indent
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49956 Handle case when @Resource annotation uses the full JNDI name for a resource. Based on a patch by Gurkan Erdogdu.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49957 Correct regression due to Lifecycle re-factoring that cleared all work directories (with compiled JSPs and persisted sessions) when Tomcat was stopped.
Adding license headers. No functional change
Setting native line encoding. No functional change
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50054 Correctly handle the setting of minSpareThreads in AJP connector. Other attributes (acceptorThreadCount etc.) are correctly set by this fix. 
Set not maxThreads  but minSpareThreads to corePoolSize, if AbstractEndpoint.setMinSpareThreads is called.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49972 Address potential thread safety issues.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49978 Don't try to create directories that already exist
Fix import order
Couple of updates.
Add bug reference - looks like this one was reported and fixed independently.
Fix warnings
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49986 Thread safety issues in JSP reload process. (timw)
Add latest fix
Fix some failing tests. No regression in Tomcat/Jasper, just need to take account of changes in test framework.
Fix some failing tests. No regression in Tomcat/Jasper, just need to take account of changes in test framework.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49987 Fix thread safety issue with population of servlet context initialization parameters.
Minor fixes to DefaultServlet docs
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49994 Lookup of JNDI references should return a new object instance each time
Add test cases for: - https://issues.apache.org/bugzilla/show_bug.cgi?id=49994 - https://issues.apache.org/bugzilla/show_bug.cgi?id=23950 Based on the original test case for bug 23950 provided by Eli Miller
Update change log
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50013 Correctly package classes from org.apache.tomcat.util.file and add the tomcat-util.jar to the class path for the Ant tasks. Based on a patch provided by Sylvain Laurent. 
Additional fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48716 Don't call reset if the default LngManager is in use
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50015 Re-factor dynamic servlet security implementation to make extensions, such as JACC implementations, simpler. Patch provided by David Jencks.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50016 Re-factor isUserInRole() and login() / logout() methods to support JACC implementations and to improve encapsulation. Patch provided by David Jencks. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50017 Code clean-up. No functional change. Patch provided by sebb
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50059 Always make JAR resources available
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50027 Avoid NPE on start when a Context is defined in server.xml with one or more JNDI resources.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50063 Fix apps with meta-data complete returning 404s
Improve error handling in TLD processing and handle the case when there is no web.xml
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50066 Fix building of recursive tag files when the file depends on a JAR file. Patch provided by Sylvain Laurent.
Only call asyncPostProcess for async requests
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50044 for APR connector
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50044 for NIO connector
Stop async requests hanging - side effect of r1006358
Restore credits removed by r1003846
Better fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49922 Revert my approach and go with patch suggested by heyoulin. Extend test cases
Revert r964780 that was a fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49428  See Re:r964780 thread on dev@ or TC 6.0 STATUS file.
Re-implement the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49428
Typo
Ensure work dir attribute is made read-only CVE-2010-3718
Add changelog entry for r1022120
Fix reading the request line via NIO for slow clients (such as me typing via telnet). Need to treat each section of the request line (text or space) as a separate phase.
Update change-log
Better clean-up.
Testing in 6.0.x confirmed this is the same issue.
Fix warnings
Followup to r1022303 I think that releasing the socket should be done before passing it away to a poller.
Followup to r946230 Do not fine-format integer values in debug output.
Improve recycling of processors in Http11NioProtocol
Add some more info on CSRF protection for the manager and host manager applications
Typo
Avoid NPE triggered when running TCK tests
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50087 Catch ClassFormatErrors when scanning for annotations.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50078 Thread safety in EL caches. Patch provided by  Takayoshi Kimura
Enhance fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=50078 Make cache sizes configurable
Update
Bump version
Fix Javadoc warnings
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49426 Messages displayed to the user in the Manager (text and HTML) should be based on the Locale of the user, not the server
Update
Messages displayed to the user in the Host Manager (text and HTML) should be based on the Locale of the user, not the server
Update
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=22965 Typos, formatting, etc Based on a patch by Yann Cbron
Comment typo
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50105 Use Enum.name() rather than Enum.toString() in composite expressions
Remove unused imports
Make private
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50107 When removing a Host via JMX, do not attempt to destroy the host's pipeline twice. Patch provided by Eiji Takahashi.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49297 Enforce the rules in the JSP specification for parsing the attributes of custom and standard actions that require that the attribute names are unique within an element and that there is whitespace before the attribute name. The whitespace test can be disabled by setting the system property <code>org.apache.jasper.compiler.Parser.STRICT_WHITESPACE</code> to <code>false</code>
Fix indents
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50084 Handle the case where the PID file is readable/writeable but the directory is not
Minor clean-up
Re-factor ServletRequestListener events with an eye to https://issues.apache.org/bugzilla/show_bug.cgi?id=49991 and any possible future changes in the Servlet spec
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49991 Ensure servlet request listeners are fired for the login and error pages during FORM authentication.
Clean-up
Clean-up
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=3839 Provide a mechanism to gracefully handle the case where users book-mark the form login page or otherwise abuse the FORM authentication process. Based on a suggestion by Mark Morris.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=4227 Update comments to indicate this is no longer an issue
Add support for maxActiveSessions attributes to BackupManager.
Improve sending an access message in DeltaManager. maxInactiveInterval of not Manager but the session is used.  If maxInactiveInterval is negative, an access message is not sending. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50138 Fix threading issues
Remove unused imports from webapps
Allow Checkstyle's unused imports test to be used with the unit testcode
Allow Checkstyle's unused imports test to be used with the api classes
Allow Checkstyle's unused imports test to be used with the o.a.tomcat.util classes
Allow Checkstyle's unused imports test to be used with this class Fix Eclipse warnings
Allow Checkstyle's unused imports test to be used with this class Fix Eclipse warnings
Fix Eclipse warnings
Allow Checkstyle's unused imports test to be used with this class Fix Eclipse warnings Align modifyAttributes() with WARDirContext
Clean-up
Allow Checkstyle's unused imports test to be used with this class Fix Eclipse warnings
Fix Eclipse warnings
Allow Checkstyle's unused imports test to be used with this class Fix Eclipse warnings
Allow Checkstyle's unused imports test to be used with this class Fix some Eclipse warnings
Add release date
correct typos
Revert part of r1026157  Removing "throwa NamingException" from parseName() methods as was done in r1026157 changed their API, so that derived classes won't be able to throw that exception anymore.  I do not know the full story behind these two parseName() methods, but if they were supposed be overwritten it seems likely that they may throw a NamingException.
Fix Eclipse nags
Allow Checkstyle's unused imports test to be used with the o.a.el package Fix Eclipse warnings 
Allow Checkstyle's unused imports test to be used with the o.a.catalina.valves package Fix some Eclipse warnings 
Allow Checkstyle's unused imports test to be used with the o.a.catalina package Fix Eclipse warnings 
Fix Eclipse warnings
Allow Checkstyle's unused imports test to be used with this class Fix Eclipse warnings 
Allow Checkstyle's unused imports test to be used with the o.a.catalina.session package Fix some Eclipse warnings 
Avoid NPE Don't use exception.printStackTrace()
Allow Checkstyle's unused imports test to be used with the o.a.catalina.realm package Fix some Eclipse warnings 
Allow Checkstyle's unused imports test to be used with the o.a.catalina.startup package 
Allow Checkstyle's unused imports test to be used with the o.a.catalina.mbeans package 
Allow Checkstyle's unused imports test to be used with the o.a.catalina.loader package 
Allow Checkstyle's unused imports test to be used with the o.a.catalina.ha.authenticator package Fix Eclipse warnings 
Allow Checkstyle's unused imports test to be used with the o.a.catalina.ha package Fix some Eclipse warnings 
Code clean-up
Allow Checkstyle's unused imports test to be used with the o.a.catalina.authenticator package 
Allow Checkstyle's unused imports test to be used with the o.a.catalina.core package (partial) Fix some Eclipse warnings
Allow Checkstyle's unused imports test to be used with the o.a.catalina.core package (partial) Fix some Eclipse warnings
Allow Checkstyle's unused imports test to be used with the o.a.catalina.core package (remainder) Fix some Eclipse warnings
Enable Checkstyle import checks
Update changelog
Fair amount of clean-up. Add it to the changelog.
Re-factor to avoid IDE warnings re possible nulls. Includes a fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=50129
Fix Javadoc warnings reported by Buildbot
Remove unused DummyRequest Move DummyResponse to tests where it is used
Fix the Eclipse warnings
Followup to r1026784 Print a stacktrace if an exception (e.g. IOException) happens when calling store.keys() and running under a security manager.
Improve exception handling in PersistentManagerBase.
Fix numerous typos. Patch provide by Luke Meyer.
Fix a couple of other typos
Staled is not a word
Trivial typo
Align default with Context default
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50140 Don't ignore a user specified install directory on 64-bit platforms Allow 32-bit or 64-bit JVMs to be selected when installing on a 64-bit platform
Update ready for next release
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50157 Ensure MapperListener is only added to a container object once. Also  - Improve debug logging for MapperListener registration.  - Expose names of LifecycleListeners and ContainerListers for StandardContext via JMX.
Fix the javadoc and Eclipse warnings
Upgrade to latest released Daemon 1.0.4
Add changelog entry for r1027893
Remove unused code
Overhaul JspQueue, no functional change for Jasper.  - Rename class to FastRemovalDequeue, because   it can be used gnerally. Nothing jsp related in it.  - Rename "head" to "first" as a better match for the   existing "last"  - Switch previous and next: "previous" was   pointing from first to last, "next" from   last to first. Mind-bending.  - Add a bit to the description. Remove "ticket"   language.  - Use more standard terminology "push" to   insert in front and "pop" to remove from last  - Add methods shift and unshift for the operations   at the other ends. Not used yet.  - Add remove() method (not used yet).  - Rename makeYoungest() to moveFirst() and add   moveLast() (not used yet). This data structure   doesn't actually know about young or old.  Add "Entry-" prefix to Entry.toString().  Rename makeFirst() in JspRuntimeContext to makeYoungest(), because there we actually are using timestamp information. 
Reduce visibility. All those are only needed by the Queue implementation, not by the consumer of the collection. 
Move Entry to an inner class of FastRemovalDequeue.  All implementation details of Entry are now opaque to the consumer of the FastRemovalDequeue.  Remove double generification when using the inner class. 
Provide configuration option to work around new welcome file mapping requirements of section 10.10 Servlet 3.0 that break a lot of existing apps. The default configuration retains the current Tomcat 6.0.x behaviour. Enabling STRICT_SERVLET_COMPLILANCE enforces the new requirements by default. Includes test cases.
Add new feature
Missing closing tag
Use correct arguments for an error message in TagLibraryInfoImpl. It is a followup to r937791
Add changelog entry for r1005802 Also corrected a typo
for resourceOnlyServlets allow whitespace in the comma seperated list.  
Improve Jsp limiter:  - Under high load entries removed from the jspQueue   were already re-added via moveFirst by some other   concurrent request, before the JspWrapper was   unregistered. Add "valid" field to the Entry   object to mark as invalid during removal.  - Improve comment about thread-safetyness and add   comment about the new "valid" field.  - Add new getSize(). Will be used soon.  - Reorder getters and setters of Entry. 
Rearrange placement of JSP limter code in JSP servlet wrapper. Do everything in one place:  - add to the queue if this is the first time   and only then check for the size and shrink   if necessary  - move to the front of the queue otherwise  Move this in front of the actual servlet service. 
Simplify JSP limiter:  - inline getJspForUnload   It is only used privately and only in one place   plus the code gets easier to understand.  - remove compilation interval check from   background method checkUnload(). Better to run   on every iteration of the background job.  - Do not check JSP count against the size of   the wrapper list (jsps). Instead check against   the queue length. 
Changes to FastRemovalDequeue: - Make queue thread safe and remove external synchronisation - Provide maximal size to queue - Include size checking when adding entries - Return handle to displaced entries when queue overflows   while adding a new entry - Explicitely invalidate queue entries on removal by using   new field "valid"  Changes to JspRuntimeContext: - Initialize FastRemovalDequeue with correct size - No more external synchronisation for FastRemovalDequeue - Private utility method to unload a wrapper - Check for displaced wrapper when adding a new wrapper   to the queue and unload it  Changes to JspServletWrapper: - No more explicit overflow check for the queue. It's now   done implicitely when adding to the queue. 
We will no longer continuously update the jspQueue order. Instead only update each JSP once between background task runs.  Changes to JspRuntimeContext: - Rename "ticket" to "unloadHandle" - Rename "lastCheck" to "lastCompileCheck" to clarify purpose - Add lastJspQueueUpdate which contains the time of   the last run of checkUnload() - Add getter for lastJspQueueUpdate - Background task checkUnload() now only tracks the time   of its last execution.  Changes to JspServletWrapper: - Rename "ticket" to "unloadHandle" - Replace options.getMaxLoadedJsps() with final field "unloadByCount" - Do no longer move wrapper in jspQueue on each access.   Only move once after each run of the background task checkUnload(). 
Add new JSP init parameter "jspIdleTimeout".  If set > 0 (default -1), a background task will unload all JSPs being idle longer than this time in seconds. 
Document jspIdleTimeout. 
Make sure, we mention the unit "seconds" for jspIdleTimeout everywhere. 
Parallel deployment Start to separate context.name and context.path Currently name==path but eventually name may include a version element but path will not.
Remove space char from the end of a line
Parallel deployment - More work separating Context.name & Context.path - Review use of Context.getName() and Context.getPath() and use the correct one - Start to add webappVersion property to Context (many components not version aware - e.g. Manager app) - Set version when deploying apps if version is specified - Include version in Context.name if version is specified - New ContextName util class to handle all path/name/version etc translations  In most cases the behaviour is unchanged if the version is not specified. The one exception is JMX ObjectNames that used to contain a key value pair "path=...". Since context path is no longer unique when using versions, this has been changed to "context=..." and the context name used which is unique. 
Parallel deployment Fix regression that broke WAR deployments
redesign of home page by Pid (pidster at apache )  
bug 49180  Add option to disable log rotation in FileHandler credit: Pid (pidster at apache )  
changelog update 
Make Tomcat more tolerant of nulls when generating JMX names for Valves.
Review comment from kkolinko Make sure we initialize StandardEngine.accessLog
The jspFile attribute is no longer available in the StandardWrapper as of r1003589. 
Fix MBean description. 
Fix some MBean descriptors: - "asyncSupported" needs is="true" for Valves - "containerName" is gone in valves since r940802 - "enabled" uses "get" instead of "is" 
Add logging and JMX support to JSP unloading.  Also need to make getContent() public in FastRemovalDequeue to support logging. 
Log the right JSP. 
Improve handling of nulls in StandardEngine.logAccess()  This takes care of the case when findChild(getDefaultHost()) returns null.
Typos
Typos
Ensure embedded jars contain all the necessary classes Re-order things so it is easier to check all are present
Allow for configest  Now one may type in bin/configtest.sh and then check the  exit code.  This will try to use the default loggers so it may spew  "a lot" to stdout/err so as to avoid clobbering existing log files in use.  Potential future todo  - Making the parsing of server.xml more finicky as to avoid   bad values being ignored (example - use 'x8005' as the   shutdown port - and tomcat still starts up fine )   
List bugs in numerical order
https://issues.apache.org/bugzilla/show_bug.cgi?id=50159 Add a new attribute for <Resource> elements, singleton that controls whether or not a new object is created every time a JNDI lookup is performed to obtain the resource. The default value is true, which will return the same instance of the resource in every JNDI lookup.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50127 Also fix all the other Eclipse warnings
Typos.
Use the local copy of the docs
https://issues.apache.org/bugzilla/show_bug.cgi?id=50168 Add a DESTROYING state and associated events and use them to ensure Contexts are only destroyed once.
BZ50219: Fix typo in jndi-resources-howto.xml. 
Make attribute enabled changeable via JMX at AccessLogValve
Remove unused method
Parallel deployment Additional Context.get[Name|Path]() clean up
Parallel deployment Additional Context.get[Name|Path]() clean up
Parallel deployment Re-order postParseRequest in preparation for patch that does the real parallel deployment work The order may look a little odd now, all will be clear with the patch
Parallel deployment Additional Context.get[Name|Path]() clean up
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50228 Clear the reference to a writer when BodyContentImpl is recycled.  By the way, this calls BodyContentImpl.clear() which recycles the buffer if it is grown too big. Recycling it early is good.
changelog for r1032232
Align documents list with the menu. Two of them were missing from the list, but present on the menu.
Remove obsolete link
Write attribute names in bold.
Link to the local copy of documentatin (as in other places on the page).
Fix infinite loop reported on users list
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50232 Remove dependency between StoreBase and PersistentManager and associated code clean-up. Patch provided by Tiago Batista. 
Suppress warnings
Fix warnings
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50184 Add an option to the RpcChannel to enable the Channel send options to be set for the reply message. Based on a patch by Ariel.
kkolinko's additional test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=49860 Test for correct handling if read buffer is filled and then re-used
Additional fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49860 Need to store headers in a separate buffer - the contents of the read buffer may not be static for the life of the request
Fix Eclipse warnings
Update
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50242 Provide sample log4j config that is a closer match to the default config
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50222 Pin the system rather than the common class loader in memory which will work better in an embedded environment.
Followup to implementation of https://issues.apache.org/bugzilla/show_bug.cgi?id=49860 Use local variable instead of array access.
Folloup to 1027504: NSIS docs say that using relative offset in Goto does not play well with macros, because those may be expanded into several lines. Use a label instead.
Fix Eclipse warnings
Simpler code / fix Eclipse warnings
Typo / line-length
Improvement for r1027504 Read PE header from jvm.dll to autodetect the target CPU architecture  Note: function findCpuType is no more used. Should I delete it?
Remove unused function. Update changelog for r1027504, r1033856, r1033882.
Restore the ability (via an option) to edit the contents of WEB-INF and META-INF via WebDAV
Update changelog
Consistency.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50169 Ensure that when a Container is started that it doesn't try and register with the mapper unless its parent has already started. Patch provided by Eiji Takahashi.
Clean-up
Clean-up
Clean-up
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50183 BIO sender was not scheduling tasks to the executor during normal operation. Patch provided by Ariel.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50252 Prevent ClassCastException when using a <ResourceLink>. Patch provided by Eiji Takahashi.
Fix broken links
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50230 Add new DistributedManager interface that is implemented by the Backup Manager to remove circular dependency between tomcat-catalina-ha and tomcat-catalina modules. Also allows third-party distributed Manager implementations to report full session information through the HTML Manager.
Organise
Re-organise tests for bugs 49nnn
Additional tests and fixes for https://issues.apache.org/bugzilla/show_bug.cgi?id=49297 Duplicate attribute rules for the page directive are slightly different. Based on a patch by genspring
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50192 Improve performance for EL when running under a security manager. Based on a patch by Robert Goff.
Revert r1031709 Parallel deployment implementation is changing as a result of discussion on the dev list and this re-ordering was specific to the previous implementation.
Reimplemented the Windows installer GUI using nsDialogs and MUI2 libraries, instead of deprecated InstallOptions. The *.ini files are no more used. All is specified in the nsi script.  Migration was straightforward, except for a DirRequest field (the field on the JVM selection page that displays path to JRE): I had to create the Browse button explicitly and implement an OnClick handler. It is not spelled in the docs, but is discussed a lot on forums.  Other improvements: - Added a textfield to display/edit the roles for the user that we add to tomcat-user.xml - The roles are calculated depending on what webapps are installed (manager, host-manager, or both). - I do not display "username", "password", "roles" fields when neither manager nor host-manager are selected. In the previous version we showed them as disabled. Now I do not show them on screen.  - Implemented creating Windows Shortcuts for the Manager, Host Manager apps and Documentation. There was implementation for that already (Manager and Docs shortcut only), but it was not working: it used IfFileExist check that always evaluated to false, because shortcuts were created before those files were installed. - Added support for the '/?' command line option. It displays a message box with some short text about the /S and /D options. See .onInit function in tomcat.nsi for details. - Using LogicLib.nsh for logic. I hope that the script became more easily readable.
When installing on Windows, do not leave undeleted stale files in $TEMP/src/res/confinstall/  The cause is that there are two confinstall folders in $dist: '/confinstall' and '/src/res/confinstall' The 'File /r confinstall' directive was selecting both paths (like issues fixed in r611660), but subsequent 'RMDir /r "$TEMP\confinstall"' removed only one of them.  New implementaion selects only one copy of the files, and places them into $PLUGINSDIR.  Also, added DetailPrint statements for operations that take noticeable time (file copying and spawning external programs).
Move server.xml and tomcat-users.xml to the top of the installer archive (aka reserving them).  Those were installed among the first files ('configure' was called from Core section), but this code is near the end of the script and thus the files were packed near the end of the archive. The delay while extracting server.xml was noticeable. With this fix that step completes nearly instantly.
Rename 'Service' section -> 'Service Startup' in the installer, to make its intent more clear. It is port of r451508 from TC 5.5
- Move SecMenu section back to its place, but extract its code into a separate method. (The "components" page of the installer lists sections in the order they apprear in the script file). - Fix processing of tomcat-user.xml, server.xml broken by r1034926. Using 'ReserveFile' was not enough. A 'File' statement must be used as well. - Fix control type for the "password" field. - Simplify several logical expressions.
- SetOutPath creates the empty folders for us. Thus 'File /nonfatal' trick is not needed. - Simplify deletion patterns in the Uninstall section
Simplify logic
Define a variable to hold a handle to the service-install.log file. Using $R7 was not clean, because it can be reused in different methods along the way. Append to the file, instead of overwriting it.
Move 'FileOpen' command outside from the InstallRetry loop.
Remove "modern.exe" reference from Uninstall section. There is no such file. It was just part of an old example. E.g. mentioned here: http://forums.winamp.com/showthread.php?t=150064
Do not remove HKCR key "JSPFile", because we do not create it.  (Why was it there? Was somebody configuring Tomcat as the app that runs "*.jsp" files on Windows?)
Fix wrong path in the "Tomcat Documentation" shortcut. The webapp is called "docs". ("tomcat-docs" was in TC5.5)
Align default with Context Javadoc.
Parallel deployment Add a version column to the HTML Manager output.
Opps. Encoded display text rather than link.
Remove unused methods Reduce visibility of methods where possible
Reformat the document. Print default values on separate lines, for better readability. Correctly document the default value of org.apache.jasper.Constants.PRECOMPILE property. The value is "jsp_precompile".
Move <source> block outside of <ol> list to avoid indent, and thus reduce horizontal scrolling. Do not nest lists into <p>.
Wrap long lines in a properties file example.
Improve logging documentation. I completely rewrote the "Introduction" section of the page, to provide a lot more of details.
Avoid NPE when removing sessions
Add some benchmark code for session creation. A performance presentation at JavaOne 2010 highlighted Tomcat's session creation as a synchronisation bottleneck for multiple production apps Some optimisations will follow.
Session manager performance Narrow sync - few % improvement
Session manager performance Switch to a queue of message digests rather than a single sync'd digest Small improvement but is part of removing the sync completely that should result in larger improvements
Session manager performance Big performance improvement for Windows. Don't try to create randomIS on every single session creation call 
Update the metrics - looking a lot better on Windows
Session manager performance Move sync. No performance change but sync requirements for sub-classes are clearer. Still looking to remove sync completely.
Additional results for reference
CoyoteAdapter.parsePathParameters: - do not reevaluate start/end, because we already have them in local variables - move warnedEncoding flag outside the loop, because otherwise it was always false and thus useless
Add some test code I used to check thread-safety of FileInputStream on various platforms
Session manager performance Focused on Windows. No need for DataInputStream, so remove it. Ensure randomIS is consistent with devRandomSource including when devRandomSource is changed whilst Manager is started Further reduce scope of syncs
Session manager performance Focused on Windows. Use a queue of Random's to generate session ID to remove sync bottleneck on random.nextBytes(bytes) Timings suggest some bottlenecks still present in default Windows code path
Increase length of tests to a) reduce impact of start-up overhead b) make it easier to profile
Update figures
Reduce code duplication Initialise the random number generator once in ManagerBase
Rename attributes to align with getter/setter to make code easier to read
Tab police - sorry rebuilt my laptop and forgot to configure Eclipse for spaces
Session manager performance Switch to only allowing changes to randomFile to take effect when the Manager next starts. This will simplify replacing RandomIS with a queue which is the next step in improving Manager performance on non-Windows platforms
Session manager performance Switch to a queue of randomInputStreams Significant performance improvement on multi-core non-Windows platforms
Add recent performance improvements to changelog
Refactor the calculation of session manager statistics to the session manager as suggested by kkolinko
Narrow the manager-wide sync
Fix issues with tribes docs reported on users list.
Comment out release notes link since tribes has not been released separately
Some additional statistics prompted by Remy's questions in the dev list
Fix expiration statistics broken by r1036281 Add session creation and expiration rate statistics based on the 100 most recently created/expired sessions Modify average session alive time to also use 100 most recently expired sessions Update benchmarks - new statistics add overhead but not significant in overall processing chain
Add displayName to ContextName Fix some bugs in ContextName constructors Add a test case for ContextName
Changes to Manager and HTML Manager to support parallel deployment
Parallel deployment One more place where contexy.getPath() needs to be replaced with context.getName()
The 60s timeout waiting for session info from other nodes will block processing of all cluster messages. As well as lost session updates, this can result in lost sessions if a fail-over occurs while the messages are being blocked.
Add the final component of parallel deployment
Additional fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49297 Handle tag directives in a similar manner to page directives
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50293 Increase default resolver array size. (Jasper adds 5 resolvers.)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50303 Update JavaMail download location JAF is included in Java SE 6
Add tm to logo
Add tm
Add tm powered by logo
Images are not executable
Use image with tm (the same as tomcat.gif logo)
Revert r1032232 It broke evaluation of <c:set var="v">value<c:set> https://issues.apache.org/bugzilla/show_bug.cgi?id=50228#c3
Fix ordering functionality for Manager app
Simplify escapeXml(Object)
Fix primary sessions not always treated as such by Manager app.
Fix manager app - attribute removed message was not being displayed
Add recent HTML manager app fixes
Ensure MBean names are correct generated for version ROOT web applications. Fix ContextResource case that was using old path=... rather than new context=...
Use correct MBean name for Mangers Fix Eclipse niggle
Update docs to new MBean names
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50310 Ensure Servlet info is displayed in Manager application
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50273 Provide a workaround for an HP-UX issue that can result in large numbers of SEVERE log messages appearing in the logs as a result of normal operation. 
Additional info for https://issues.apache.org/bugzilla/show_bug.cgi?id=50273 Add the error number to the message 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50308 Allow asynchronous request processing to call AsyncContext.dispatch() once the asynchronous request has timed out. 
Fix CVE-2010-4172. Multiple XSS in Manager web application
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50228 Improve recycling of BodyContentImpl.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50316 Fix display of negative values
Impose a limit on the total length of the trailing headers. Otherwise the ByteChunk buffer in the ChunkedInputFilter might grow unlimitedly.  Implemented as a system property. It might be better to implement it as an attribute of a connector (like maxPostSize and maxSavePostSize attributes are), but I am not sure that it is worth the effort.
Remove border-radius.htc until issue with this file is clarified.
Make memory leak prevention code that clears ThreadLocal instances more robust against objects with toString() methods that throw exceptions.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50207
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50318 Avoid NPE when viewing session detail for expired sessions
Roles are supported
Add a test case for bug50015
Move configuration of trailer header size limit to the connector
NoOp logger is only used in StandardEngine so move it there Only log to containers that are available
Don't swallow error
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50201 Track changes that require an update to the default access log. It isn't perfect but should cover normal usage
host.removeChild() already calls context.destroy(). Don't call it twice.
Increment version number ready for next release
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50294 Add more information to documentation regarding format of configuration files. Patch provided by Luke Meyer.
Add additional trace level logging to Tribes to assist with fault diagnosis. Based on a patch by Ariel. Fix Eclipse warnings in file
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50108 Add get/set methods for Connector property minSpareThreads. Patch provided by Eiji Takahashi.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49650 Remove unnecessary entries package.access property defined in catalina.properties. Patch provided by Owen Farrell.
https://issues.apache.org/bugzilla/show_bug.cgi?id=50106 Correct several MBean descriptors. Patch provided by Eiji Takahashi.
Move to Catalina section
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48837 Extend thread local memory leak detection to include classes loaded by subordinate class loaders to the web application's class loader such as the Jasper class loader. Based on a patch by Sylvain Laurent.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49142 Add missing serialVersionUIDs using Eclipse's auto correct and a little manual formatting
Don't use pid file. It is not removed on service stop and prevents the next service start. https://issues.apache.org/jira/browse/DAEMON-188 has been raised for this issue.
Update changelog
Correctly validate context path so sessions can be viewed for ROOT webapp
Fix a couple of clustering issues:  - Don't try and obtain session data from the cluster if the current node is the only node in the cluster.  - Log requesting session data as INFO rather than WARNING.
Make method name consistent with class name
Using SecureRandom makes digesting the ID unnecessary. Dropping the digest gives ~20% performance gain on ID generation.
Drop the entropy attribute. SecureRandom has a sufficiently secure self-seeding mechanism.
Remove attributes from PersistentManager too
Update so this will run
Add a /dev/urandom vs SecureRandom benchmark
Make SecureRandom the fall-back and use SecureRandom throughout rather than Random
SecureRandom is self-seeding
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50358 Set correct state when stopping
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50351 Fix the regression that broke BeanFactory resources caused by the previous fix for 50159
Add a test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=50351
Correct method name in log message
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50352 Ensure that AsyncListener.onComplete() is fired when AsyncContext.complete() is called.
Test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=50352
Correct method names in log messages
Set svn properties. 
Add css to text file list. 
Fix Javadoc warnings
Need required attribute or docs don't display correctly
randomClass -> secureRandomClass Align (and tidy up) mbean descriptor
SecureRandom implementations are self-seeding so simplify code. 
Updated Windows results (removal of digest)
Remove direct support for reading random bytes from a file Add support for specifying SecureRandom algorithm and provider
Align tests with new ManagerBase code Update OSX figures - now comparable
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50383 Comment typo
Fix typo in script comment. BZ 50383, addition to r1040546. 
Switch MapperListener to the new Lifecycle
Context name rather than Context path is passed in so construct ContextName object correctly.
Don't set property that doesn't exist on any ProtocolHandler or Endpoint
Update release dates
Don't put anything in current dev since it will be picked up in the tag and could cause confusion
Fix typo (syntax error) in changelog. Should also fix recent buildbot failure. 
Tab police
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Bind/release socket on start()/stop() Register/deregister MBeans on init()/destroy()
Revert part of r1039051 Current node is not included in cluster.getMmebers() so previous test was correct
Move changelog comment for BZ 50228 from Catalina to Jasper.
Make constants static
HostConfig passed a context name to ContextName(String) - ensure that this is correctly parsed. ContextName(String) now accepts all variations of Context name.
Fix error in r1041356
Better test case
Correct removal of LifeCycleListenters from Containers via JMX. Found with FindBugs
Protect against unlikely NPE
Don't pass null to log messages. Found by FindBugs
Remove unnecessary code Identified by FindBugs
Replace use of inefficient constructors Reported by FindBugs. Not all fixed.
Fix Javadoc warning
Add an embedded distribution to the release build
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=8705 org.apache.catalina.SessionListener should extend java.util.EventListener
Bump versions ready for next release
Fixed bug 48692: Provide option to parse application/x-www-form-urlencoded PUT requests 
Revert r1041120 but disable rather than delete new test
Need at least one test per class dummy test for unit tests to pass
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50408 Fix <code>NoSuchMethodException</code> when using scoped variables with EL method invocation.
bug 48973 (enhancement): Don't create SESSIONS.ser when no session exists  https://issues.apache.org/bugzilla/show_bug.cgi?id=48973
bug 50282 : Load javax.security.auth.login.Configuration with JreMemoryLeakPreventionListener to avoid memory leak when stopping a webapp that would use JAAS.
Remove file accidentally added in r1042029
Ignore all .* files rather than adding them one by one as they appear
Mark 'basePackage' as final, to allow string concatenation to be done at compile time.
Address some review comments: 1. Avoid possible NPEs by using a local variable for the newDefaultAccessLog 2. PropertyChangeListener should be added to the Engine 3. Add the listener when the Noop logger is used so changes can be detected that could cause a different logger to be used.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50411 Ensure sessions are removed from the Store associated with a PersistentManager.
bug 50282 / fixed some typos in documentation
sort entries by ascending BZ number
bug 50282 / fixed line length
Additional fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=50411
bug 49159: Improve ThreadLocal memory leak clean-up  https://issues.apache.org/bugzilla/show_bug.cgi?id=49159 Renewing threads of the pool when a webapp is stopped
Fix typo
Line-length
Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Implement a common base class for ProtocolHandler implementations that will handle life-cycle/mbean issues (once more re-factoring has been completed)
Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Start to pull stuff up into the base class
Remove unused code
Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Start to pull more getters/setters and the generic attribute handling. Note that the comments around generic attribute handling are aspirational in some cases but subsequent commits should align the behaviour to the comments.
Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Pull up more getters/setters.
Remove unused code
Fix mix-up of connectionUploadTimeout and connectionTimeout Use connectionUploadTimeout consistently as attribute name Document connectionUploadTimeout
Revert svn-ignore property changes made in r1042482
Fix another mix-up of connectionUploadTimeout and connectionTimeout 
Since the address is exposed to sub-components, expose the port as well.
Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Pull up timeout getters/setters. Use -1 consistently for the default value of keepAliveTimeout
Get the tests running again on the command line
Correct a typo
bug 49159: Improve ThreadLocal memory leak clean-up  https://issues.apache.org/bugzilla/show_bug.cgi?id=49159  Various fixes after review by markt : formatting, use string manager, svn props...
Include root cause in LifecycleException stack traces
Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Pull up JMX related methods Tidy up the remaining protocol specific methods
Fix auto-completion snafu
Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Add the necessary plumbing for the AbstractProtocolHandler to perform the JMX registration
Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Pull up the concrete destroy() method - required a fair bit of refactoring Pull up the abstract init() method()
Typo
Another day, another check
Fix modifier order in javax.*
Fix modifier order in org.apache.el.*
Fix modifier order in org.apache.jasper.*
Fix modifier order in org.apache.tomcat.*
Fix modifier order in org.apache.naming.*
Fix modifier order in org.apache.catalina.*
Add checkstyle rule for modifier order and fix remaining issues in current code base
Fix a couple of 'high priority' FindBugs warnings
Fix some FindBugs warnings - all unclosed streams. These could potentially lead to locked files and maybe memory leaks. Fix some other simple FindBugs/Eclipse warnings in affected files.
Another Findbugs niggle
Jasper should not depend on Catalina Re-use constants where possible Fix a FindBugs niggle
Remove unused code. Make spacing consistent.
Remove unused code
Remove unused code
Remove unused welcome file handling code
Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Pull up pause() and resume() methods
Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Pull up stop()
Nice idea, but need i18n for the actions so each needs its own string
Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Align the init() methods (JSSE still to go)
JSSE will always be available in Tomcat 7
Fix indents
Align BIO+JSSE with NIO+JSSE
Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Pull up init()
Fix copy/paste error
Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Move MBean registration from start() to init(). More MBean refactoring expected
Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Pull up start()
Remove some unused code Fix some FindBugs niggles
Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 ProtocolHandler should register itself with MBean server rather than have the connector do it.
Removed a little more unused code
- Fixed brace and paren placement - Changed Connector.isParseBodyMethod from public -> protected - Relaxed language claiming that use of parseBodyMethods may "violate" the servlet spec - Moved error message to LocalStrings.properties (Translations requested) 
Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Move ad-hoc attribute handling from the ProtocolHandler to the Endpoint and expose the Endpoint to ServerSocketFactory objects so they can retrieve additional configuration if required. All default components now use explicit configuration rather than relying on the ad-hoc mechanism. Ensure the hooks for alternative SSL implementations are in place (were partially removed). Remove the hooks for alternative ServerSocketFactory implementations (had been hard-coded / half implemented for some time). Make the sslEnabledProtocols attribute work with BIO as well.
bug 49159: Improve ThreadLocal memory leak clean-up  https://issues.apache.org/bugzilla/show_bug.cgi?id=49159  some formatting after discussion over the list (operator at the end of line, unnecessary cast)
ignore work and logs directories as discussed on dev list
Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Log the right message at the right point
mserver != null will never be true if the mbean was registered. Drop the check since the unregister method will handle things correctly anyway
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Add an option to control when the socket is bound
Register the correct object after the refactoring
bug 49159: Improve ThreadLocal memory leak clean-up  https://issues.apache.org/bugzilla/show_bug.cgi?id=49159  Use a dedicated thread when calling web application code when it is started and stopped (calls to Listeners, Filters, Servlets).
Fix missing @Override markers in Jasper and remove an unnecessary null check
Grrr. Missed a couple of @Override markers
Remove redundant interface definitions and fix other warnings (missing @Overrides) in same files
Fix Eclipse warnings in package
Fix Eclipse warnings in package
Fix FindBugs / unused code warnings
Missed file in r1044255
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50413 Ensure 304s are not returned when using static files as error pages
Avoid duplicate constant definition. Use Constants defined by the Servlet/JSP specs where appropriate Use Constants in preference to local Strings
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50448 Regression caused by http://svn.apache.org/viewvc?view=revision&revision=1036281
Coyote should not depend on Catalina
javax.el should not depend on javax.servlet.jsp.el
Add import-control checks to Checkstyle (these found the recent dependency issues) Move checkstyle config to res/checkstyle to stop it cluttering up the root
Get the checkstyle configs to play nicely with Ant and the Eclipse plug-in
o.a.tomcat.util.net should not depend on o.a.catalina
o.a.tomcat.util.net should not depend on o.a.coyote
o.a.tomcat.jni should not have any external dependencies OK for o.a.naming to have dependencies
Tribes should only depend on JULI
TRy and sync up the deps in the POMs with what Checkstyle validates
bug 50459: StandardContext.bindThread() and unbindThread() are not symmetrical and not limited to current thread  https://issues.apache.org/bugzilla/show_bug.cgi?id=50459  This fixes the bug that was introduced by http://svn.apache.org/viewvc?rev=1044145&view=rev (introduced a dedicated thread when starting and stopping web applications to avoid mem leak)
bug 50459: StandardContext.bindThread() and unbindThread() are not symmetrical and not limited to current thread  https://issues.apache.org/bugzilla/show_bug.cgi?id=50459  Fixed incorrect comment in code
Fix FindBugs issues in this class
Re-factor session ID generation into a separate class so it can be re-used for SSO (patch for that to follow)
Use the newly refactored session id generator when generating sso session IDs
i18n changes for r1044874
Fix FindBugs issues in this class
Fix FindBugs issues in this class
Add some tests for bug50449 but haven't reproduced it yet
Use i18n for the messages It is followup to r1042022 which was a fix for BZ 48973 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50460 Avoid leak caused by using a cached exception instance
changelog for r1044987
Improve the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=50201 - Use AtomicReference to guard against possible duplicate registration of   listeners when logAccess() is called by several threads at the same time. - Added install() and uninstall() method to AccessLogListener   to help register/unregister the listeners. - When defaultAccessLog is nulled, always unregister the listener as well.   The listener does not need to be reused, because now we do create a listener   when there is no log and it will take care of things.
Using abstract classes means impl isn't clear in the startup log. Modify name so it is clear.
Fix various FindBugs and Eclipse warnings
Aliases were broken if the context was reloaded
Log mis-configuration in context.xml
Fixed bug #49125: toString on byte[] array probably is not correct - Added HexUtils.toHexString method - Wrapped output of byte[] objects with a call to HexUtils.toHexString 
Added documentation to parseBodyMethods and parseBodyMethodSet members. 
Fix a typo
Fix my stupid mistake.
Remove unnecessary override
Fix another FindBugs niggle
Fix various warnings (FindBugs, Eclipse etc.)
Add a FindBugs filter config for known false positives
Whilst I am thinking about excluding stuff from FindBugs - add some exceptions for the generated code with issues and fix the remaining issues in the same package
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=10526 Add alwaysUseSession option to authenticators
https://issues.apache.org/bugzilla/show_bug.cgi?id=10972 Improve error message if the className attribute is missing on an element in server.xml where it is required.
Fix a FindBugs nag in the unit tests
Fix Findbugs issues / Eclipse warnings. Some genuine issues Some changes to make code easier to read (for humans and analysis tools)
bug 48822: Include contest name in reload and stop log statements  https://issues.apache.org/bugzilla/show_bug.cgi?id=48822
bug 48822: Include contest name in reload and stop log statements  https://issues.apache.org/bugzilla/show_bug.cgi?id=48822  changelog + proposed for tomcat 6
Starting to work on maxConnections attribute for BIO/NIO connectors to allow administrators to throttle how accepting connections is handled. Implement a CounterLatch to keep track of the  connection count while also allowing the acceptor  thread block while the max has been reached 
https://issues.apache.org/bugzilla/show_bug.cgi?id=13731 Make variables in <code>_jspService()</code> method final where possible.
Fix massive memory leak in NIO connector. Http11NioProcessor objects were not being recycled.
Avoid a possible NPE that in turn was masking the root cause from JspC
Document the Eclipse compiler errors/warnings settings I am using
Fix remaining warnings in javax package (with recently documented settings)
Fix remaining warnings in webapps (with recently documented settings)
Fix remaining warnings in unit tests (with recently documented settings)
Fix remaining Eclipse warnings in o.a.coyote
Fix remaining Eclipse warnings in o.a.juli
Fix Eclipse warnings
Fix most of the Java, Findbugs and unused code warnings in this package
Fix remaining warning in o.a.el.lang package
Typos. Sorry for the noise
Simplify based on StringManager changes
Remove unused code
Fix unlikely FindBugs warning
Version numbers are defined in the properties file
Implement a maxConnection threshold for the JIoEndpoint, to be able to constraint how many connections the connector will accept 
Implement maxConnections for NIO connector 
Test can piggy back on the 'ant test' auto switch between connectors  
Add in a default that doesnt throw a ClassNotFoundException that is simply ignored, and allow a fast way to change the console formatter through a system property when no config file is used.  
Fix Checkstyle / Eclipse nags
Restore file accidently removed in r1044731
Fix Checkstyle / Eclipse nags
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50503. When web application has a version, Engine level Clustering works correctly.
Fix webappClassLoader.clearJbdc message key and message in LocalStrings.properties. Jbdc is corrected to jdbc.
make shared variable volatile 
Allow to specify the test on the command line ant -Dtest.name=**/TestMax** test Without the parameter, the default is all tests as specified before  
Allow to set log formatter when running Junit tests 
Fix classpath 
refactor latch usage, since its shared by all connectors 
bug 49159: Improve ThreadLocal memory leak clean-up  https://issues.apache.org/bugzilla/show_bug.cgi?id=49159  - merged LocalStrings.properties file from package o.a.t.u.threads to o.a.t.u.threads.res - removed 3 i18n keys that are no longer used by tc7. They were used by the old ThreadPool implementation of tc6
Improve documentation of database connection factory. 
Update Copyright year. 
update link 
better count check 
add in ability to pass through credentials https://issues.apache.org/bugzilla/show_bug.cgi?id=50025  
Increment version number 
version
Up the number of iterations the test runs 
one 0 too many on username test make sure the driver correctly checks url 
Remove unused imports
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50500 Use correct coercions (as per the EL spec) for arithmetic operations involving string values containing '.', 'e' or 'E'. Based on a patch by Brian Weisleder.
Add a test case of no user name change 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50488 Update classpath required when using jsvc and add a note regarding server VMs.
Fix typo
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50541 Add support for sizeLimit and timeLimit on the JNDIRealm
Re-fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49372 Don't throw an LifecycleException for an invalid transition if a connector fails to start.
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49000 Consistently handle name only cookies (which are not spec complaint)
No need to instantiate a new driver instance each time, simply reuse the one we got 
Grr. Remove comment markers.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49000 Make accepting name only cookies configurable, defaulting to disabled.
Doh. Forgot to update the change log.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50527 Improve error message
getContentCount() may return -1 so use getContentCountLong()
Remove unused code
Fix required after removing unused code
Remove unused method
Remove unused constants (follow up to r1055377)
Remove unused methods
Remove unused code
Simplify getContentCount. Prep for fixing bug 50496
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50467 Protect against NPE that will cause Poller to fail
Remove unnecessary code. Valves in this package can use the StringManager defined in ValveBase
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50453 Correctly handle multiple X-Forwarded-For headers
allow system to start 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50547. Add time stamp for CHANGE_SESSION_ID and SESSION_EXPIRED message.
Switch all configuration options that use regular expression to require a single regular expression (using java.util.regex<) rather than a list of comma-separated or semi-colon-separated expressions. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47319 Don't return null for getRemoteHost() if the IP address cannot be resolved.
Fix a couple of FindBugs niggles
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50550 Make sure PROPFIND,MKCOL,PROPFIND returns 404,201,207 rather than 404,201,404
https://issues.apache.org/bugzilla/show_bug.cgi?id=49543 Add the ability to specify a data source link, to use a shared datasource with per application credentials 
Followup to r1055989 Do not use $Id if svn:keywords property is not set.  BTW, @author tags are deprecated, aren't they?
Fix bug https://issues.apache.org/bugzilla/show_bug.cgi?id=50477  
Fix various warnings
Numerical order, fix indenting
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50554 Various FindBugs / Eclipse warnings Silence the false positives
Fix some simple FindBugs issues
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50552 Avoid NPE that hides error when using Ant tasks (schultz)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50496 Differentiate between content written (what the app writes to the output stream) and bytes written (what Tomcat writes to the socket) and use bytes for the access logs
Put sleep in right place for test to pass. With acceptCount of 1 need a short delay else connections get rejected as Tomcat doesn't process incoming connections fast enough (on 8-core machine)
Fix tests after regex changes
Update tests now name only cookies are not accepted by default
Update daemon to 1.0.5
Fix security exception when running Servlet TCK
bug 50556: improve JreMemoryLeakPreventionListener against leak caused by LdapPoolManager  https://issues.apache.org/bugzilla/show_bug.cgi?id=50556
Provide two alternative locations for the libraries downloaded from the ASF web site at build time. Use the main distribution site as default and the archive one as fallback.
Folloup to r1055989 Add qualifiers to the fields of DataSourceLinkFactory.DataSourceHandler class.
Followup to r1056553 There should not be "import com.sun.jndi.ldap.LdapPoolManager;" as we must not depend on that class at build time. Actually the import was used by JavaDoc comments only.
Correct typo in the method names in a test case, so that they match to what method is actually being tested.
StringBuffer -> StringBuilder for consistency
Followup to r1056386. Add a changelog entry.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=21157 Write cookie before response might be committed
Followup to r1055975 Move string calculation out of synchronized block
The TestMapper.performanceTest() takes 3250 msecs to rn for me. I am increasing the timeout to be 4s. Also printing the actual value in case the test fails.
Added tests for https://issues.apache.org/bugzilla/show_bug.cgi?id=50413 The test that is currently failing is commented out and marked with a "FIXME" comment.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50413#c6 Serve the error page regardless of "Range" header in the original request.
Enable testcase for 50413#c6, now that the issue is fixed with r1056889. Update changelog.
Fix a handful of warnings
Fix checkstyle warnings
Configure Checkstyle to allow limited static imports and revert most of r1056947
Document a couple of long standing system properties
Fix FindBugs warnings in StandardHost
Remove Host.liveDeploy that just duplicates Host.autoDeploy
Remove override annotations to compile with JDK 1.5 
https://issues.apache.org/bugzilla/show_bug.cgi?id=49953  
https://issues.apache.org/bugzilla/show_bug.cgi?id=50333 dont allow 0 or negative max active values 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50205 Add deployIgnore to Host Based on a patch by Jim Riggs
Prevent XSS in Manager application This addresses CVE-2011-0013 
Correction
Prep for next release
Missing eol style property
Correctly acquire the getConnection method for the right number of arguments 
Followup to r1050117 Use StringBuilder to concatenate strings
Fix formating so Checkstyle header chekc will pass
$Id:$ does not belong in license header
Add missing line to license header
Add missing line to license header
$Id:$ does not belong in license header
Use standard ASF license header
Use standard layout ASF license header
Add missing license headers
Use standard layout ASF license header
Remove first blank line. REmove $Id:$
Get checkstyle to check Java files for AL2 headers
Add missing license header
Add missing license header
Use standard layout ASF license header
License should be first thing in file unless file format prohibits it
Expand checkstyle license checks
Re-build tomcat-dbcp on release so the manifest picks up the new Tomcat version
Better handling of special case of  javax.servlet.jsp.el.ScopedAttributeELResolver
Mask the password through all the JMX operations 
typo-fix
Action review comments Store deployIgnore as a Pattern in the Host
Bring up to date
Typos
Additional improvements for https://issues.apache.org/bugzilla/show_bug.cgi?id=50205 Followup to r1057788 1) Simplify check for absence of value 2) Reuse Matcher instance across iterations
Fix odd line wrapping
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=15688 Use fully qualified class names to avoid possible naming conflicts JSP 2.2 TCK passes with these changes
Findbugs
Better class loader control when embedding
fix warnings
reset state when the connection is closed 
Fix Javadoc warnings
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=18462 Don't merge stdout and stderr internally
Remove unused code
Refactor to simplify code and avoid a Findbugs warning
Fix FindBugs warning Remove unnecessary code Better error handling
Remove unused/unnecessary code
Fix FindBugs warnings
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=18797 Provide null/zero-length protection
Remove unused files
Typo
Remove unused files
i18n
Fix Findbugs warnings
Correct a typo
Fix FindBugs and unused code warnings
Add comments explaining false +ve
Fix FindBugs and Eclipse warnings
Fix FindBugs and unused code warnings
Additional docs on version ordering Add 7.0.6 release date
Remove unused code Fix FindBugs and Eclipse warnings Correct typos
Fix FindBugs and Eclipse warnings
Fix FindBugs warnings
Fix FindBugs and Eclipse warnings Remove out-dated comments
Fix broken cluster membership recovery
Refactor to make clearer what is going on
Update changelog
Updated ReplicationValve examples in the docs with the new regexp syntax. Added *.jpeg pattern to the list, as inspired by the comment in BZ 31912 https://issues.apache.org/bugzilla/show_bug.cgi?id=31912#c2
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50591 Do not throw NullPointerException when ReplicationValve#filter is not set.
Fix FindBugs warnings
Update examples for RemoveAddrValve, RemoteHostValve in the docs
Update JMX descriptions, tests, documentation and examples in documentation for using a single regex for attributes in RemoteIpFilter, RemoteIpValve.
Update documentation for restrictedUserAgents, noCompressionUserAgents attributes of HTTP connectors, because they now use a single regex.
Correct a typo in RequestFilter, that would lead to an NPE in RemoteAddrFilter, RemoteHostFilter when "allow" attribute is empty. The RequestFilterValve class is not affected by this issue.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50582 Refactor access logging so chunked encoding is not forced if bytes sent is logged
Fix FindBugs warnings
Fix FindBugs warnings
Fix FindBugs warnings Remove unused i18n strings
Rename variables to start with lower case letter to make code easier to read
Avoid NPEs Remove FindBugs warning
Avoid deprecation warning without disabling warnings for the whole class
Remove unused code
Add a new filter for fixes that require an API breaking change that need to wait until post 7.0.x
Fix FindBugs warnings
Fix FindBugs warnings
Fix FindBugs warnings
Fix FindBugs warnings
New classes need to be in bootstrap.jar
Clarify web application version ordering rules when both versioned and non-versioned instances of the application are running in parallel.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50600 Prevent ConcurrentModificationException when removing WAR via FarmWarDeployer 
Document the conflict between compression and sendfile, as was discussed on users@ http://markmail.org/thread/bp46zusxjsqqxydr
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50597 Don't instantiate a new instance of a Filter if an instance was provided via the ServletContext.addFilter(String, Filter) method. Patch provided by Ismael Juma.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50598 Correct URL for manager text interface
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50599 Use correct names of security roles for Manager app
Correct a pair of typos in documentation
Documentation fixes: 1) role name: s/manager/manager-script/ (BZ 50599), s/manager-script/admin-script/ on 401/403 pages of host-manager webapp (a typo) 2) there is no property "debug" on the Context, nor on several other classes (realms, authenticators)
Correct a typo in documentation
Fix the last of the high priority FindBugs warnings
Fix Findbugs and Eclipse warnings
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=22278 Add a commented out RemoteAddrValve that limits access to the Manager and Host Manager applications to localhost. Based on a patch by Yann Cbron.
Expand the non-Tomcat settings section
Findbugs
Remove reflection part of stack trace when Catalina throws an Exception - makes it easier to see what went wrong
Update the ipv4 loopback regex to cover 127.0.0.1/8. Fortunately, ipv6 only has a single explicit loopback address.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50601 Code clean-up Patch provided by sebb
Rename in preparation for https://issues.apache.org/bugzilla/show_bug.cgi?id=50535
https://issues.apache.org/bugzilla/show_bug.cgi?id=50613 Fix concurrency bug around size calculation for the pool 
doco update 
update version 
Revert r1060927. It changed the API (which would have been fine if it the eventual solution needed it but it doesn't)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50535 Provid an option (disabled by default) to serve resources from /WEB-INF/classes/META-INF/resources
Use the new release(s,p) method introduced in r1050249
Fix http://issues.apache.org/bugzilla/show_bug.cgi?id=50606 Improve CGIServlet: Provide support for specifying empty value for the executable init-param. Provide support for explicit additional arguments for the executable. Those were broken when implementing fix for bug 49657
Update info - should probably just delete all these
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50620 Exceptions calling session.endAccess should not prevent recycle() from completing normally
Fix copy/paste snafu
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50526 Additional JavaMail docs
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50441 Clarify when docBase can be set
Add textual description to the attributes supported by DataSourceLinkFactory Correct a typo
Add missing entry
Improve error message & use i18n
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50629 Make StandardContext.bindThread() and StandardContext.unbindThread() protected to allow use by sub-classes.
Fix possible thread exhaustion With a breakpoint in the servlet handling the timeout event, I was seeing a new thread being allocated from the poll every second or so
Fixed bug #49711: HttpServletRequest#getParts() does not work in a Filter - Added <Connector> attribute allowCasualMultipartParsing (default false) - Requests that contain multipart/form-data will be parsed in the absence of @MultipartConfig when the above attribute is set to "true"  
Reverted inadvertently-committed files from r1061929. 
Re-fixed bug #49711: HttpServletRequest#getParts() does not work in a Filter - Moved allowCasualMultipartParsing setting from <Connector> to <Context>  
Removed debug logging added with r1061929. 
Fixed typo. 
Be consistent with locks on sessionCreationTiming, sessionExpirationTiming in DeltaManager.resetStatistics(): use the same lock as elsewhere. Corrected a pair of typos in changelog as well.
Formatting - followup to r1061953
Use getName() instead of logName() in error messages in StandardContext.  Hex sequences in LocalStrings_es.properties are converted to lowercase. Sorry for the noise.
Remove unused import
Small simplification
Remove old, commented out code
Clarify what the units are when setting sessionIdLength property of a Manager. It was asked on users@ CTR: docs
Prevent multiple Comet END events
Ensure correct cycling if input filters
Fix various odd behaviours seen with a debugger. Observed both multiple and zero (rather than 1) selection events for a single data receive event
This change also fixed an open bug
Don't assume servlet 3+ async when processing long poll connections (it might be comet) Use socket rather than socket wrapper as key in connection list else comet sockets may be lost
Correct some old typo in context docs: move comment about docBase bahaviour with symlinks to where it belongs. No need to update 5.5 ones: they are OK already. CTR: docs
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50648 Correctly set the interrupt status if a thread using RpcChannel is interrupted waiting for a message reply. Based on a patch by Olivier Costet.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50646 Ensure larger Tribes messages are fully read. Patch provided by Olivier Costet.
Typo
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50642 Better fix for HttpClient keep-alive thread triggered memory leaks
Not sure which recent Comet change fixed this but one of them did.
Don't need an INFO log message every 30s when the FarmWarDeployer is running
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50679 Update the FarmWarDeployer to support parallel deployment. This deliberately breaks the API since the meaning of a number of method parameters has changed (context path -> context name).
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50680 Prevent an NPE when using tag files from an exploded JAR file, e.g. from within an IDE. Patch provided by Larry Isaacs.
Remove whitespace
Remove unused file
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46819 Remove redundant object instantiations in JspRuntimeLibrary. Patch provided by Anthony Whitford.
Re-fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49978 Pre-existing dir should not break deployment
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50683 Scan annotations when unpackWars=false
When running the tests use log configuration specified by conf/logging.properties
Implement debug logging in InternalNioInputBuffer. Log what we got with the first read.
Fix breaking tests after recent comet fixes
Add bug number to an already fixed issue. Arrange issues in ascending numeric order.
Followup to r1065089. Make the field final.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50325 Use JVM provided solutions to CVE-2009-3555 if available (i.e. RFC 5746 support)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50631 InternalNioInputBuffer should honor maxHttpHeadSize This addresses CVE-2011-0534
Improve HTTP specification compliance This works-around the Oracle JVM bug that triggers a DoS. CVE-2010-4476.
Fix http://issues.apache.org/bugzilla/show_bug.cgi?id=50673 Improve Catalina shutdown when running as a service. Do not call System.exit().
Followup to r1066310. Simplify.
Followup to r1066310. Simplify: call stopAwait() unconditionally.
Correct documentation for the PersistentManager class: there is no "randomClass" attribute, but several others were added. Move attributes defined in the Manager interface into the Common Attributes section.
r1057694 broke display of ROOT/index.jsp in MSIE. Use JSP comments in the license instead of HTML comments, like we already do elsewhere.
Clarify
Missed one place where socket needed to replace socket wrapper in r1063774
Fix javadoc niggle
Fix Eclipse warnings
Move/rename to better location
Factor out support code prior to splitting up the TestSsl class
Hmm. Can't see a way (without changing the connector code) to test SSL renegotiation failure if the JVM supports RFC5746. Need to think about this some more. In the meantime, get the tests working.
Make sure flush packet is not send after END_RESPONSE packet. Should handle BZ49929
Bump version number
Reduce severity level. The ASF Jira instance logs were filling with these
Fix NPE in CoyoteAdapter when postParseRequest() call fails.  That was caused by mappingData.context being null. This NPE occurence in 7.0.7 was reported on the users list.
Align server.xml installed by the Windows installer with the one bundled in zip/tar.gz files.
Update changelog
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50709 Make ApplicationContextFacade non-final to enable extension.
Follow up to r1067039
Fix security exception when running under a SecurityManager
Do not send flush packet if explicit is false
Fix hanging Servlet 3 asynchronous requests when using the APR based AJP connector.
Bump version
Initial attempt to fix RemoteIp issues observed with ASF Jira Docs, filter and changelog commits to follow once it works
Move attribute name definitions to AccessLog interface AccessLog implementations need to be aware of attributes since they aren't always set (e.g. if request is rejected early in the connector)
Tweak defaults. Document.
First attempt at a valve to limit session creation by web crawlers. Docs etc to follow once it is confirmed working.
Fix the expiration logic
It isn't working. Add some debug logging.
Review from kkolinko 1. Matcher not thread safe 2. >1 UA header -> not a bot
Test a quick hack to get this working with Jira
Remove for now since I can't get it working with Jira (my primary motivation for writing it) It will return once I find the time to do the detailed debugging with Jira to figure out why it doesn't work.
Improve comments
Make NamingResources implement MBeanLifecycle Environments, Resources and ResourceLinks are once again available via JMX
Remove ServerLifecycleListener
Fix typo - thanks Konstantin
https://issues.apache.org/bugzilla/show_bug.cgi?id=50667 Allow a replier to get confirmation if the reply message was sent successfully or if it failed  
Update changelog with latest tribes fixes 
Start a new version, place fix in correct version 
Add release date. Move recent changes into the new version.
Followup to r1068549 - add annotations.  I thought about moving ErrorHandler instance creation outside the retry loop, but actually that is not needed: looping happens only when asyncReply==false and ErrorHandler is created only when asyncReply==true. Thus it is created only once.
Prevent duplicate event messages
https://issues.apache.org/bugzilla/show_bug.cgi?id=50667 Move the callback outside try/catch to avoid duplicate callbacks 
remove loop that should not be used at all. 
Better comments
add some arrows to the diagram
Add further checks that LifecycleBase sub-classes are correctly changing state.
Correct the package name
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50747 Allow the content length header to be set up to the point the response is committed when a writer is used.
The bug number changed
Ensure NamingResources follows correct lifecycle
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50721 Correctly handle URL decoding where the URL ends in %nn. Patch (for fix) provided by Christof Marti. Additional test cases added.
remove unused import
Fix Javadoc warnings
remove retry from the API.  
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50720 Ensure that the use of non-ISO-8859-1 character sets for web.xml does not trigger an error when Jasper parses the web.xml file.
Add a test case (already passes) for bug50753
Add unit test that demonstrates use of a custom SSL implementation that extends the default JSSE implementation.
Fix Eclipse warnings
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50752 Correct typo
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50751 Don't try to retrieve attributes if we don't need to. If anonymous bind is not allowed, the login will always fail.
Add additional information to assist with tracking down the root cause of https://issues.apache.org/bugzilla/show_bug.cgi?id=50737
Remove unused deprecated method
Remove deprecated code
Remove deprecated code
https://issues.apache.org/bugzilla/show_bug.cgi?id=50759 Update validation timestamp if using an external validator.  
doco and version update 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50726 Ensure that the use of the genStringAsCharArray does not result in String constants that are too long for valid Java code.
Followup to r1069836 Remove unused managerClassName attribute from mbeans-descriptors.xml.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50771 Ensure HttpServletRequest#getAuthType() returns the name of the authentication scheme  if request has already been authenticated.
Correctly test for no attributes
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50700 Ensure that the override attribute of context parameters is correctly followed.
Fix Eclipse warnings
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50713 Remove roles command from Manager application
Move test outside the loop
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50793 Correctly fire request init/destroy events for astnc requests
Prep for next release
Prevent NPE in unit tests as a result of r1067718
Fix test failure now r1069056 has added stricter checks for state transitions
Prevent NPE in unit tests as a result of r1067718
Remove duplicate code.  The implementation in the base class is identical and all other http11 implementations also inherit it from there.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50790 Improve method resolution in EL expressions Add test cases for this bug
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50789 Provide an option to enable ServletRequestListeners for forwards as required by some CDI frameworks.
Fix typo
Typo? Copy and paste error?
Fix NPEs on shutdown. Loop is prevented above when the child is removed.
Remove unnecessary code. I don't see a code path that could result in the socket being in the map at this point
Remove unnecessary code. I don't see a code path that could result in the socket being in the map at this point
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50780 Fix memory leak in APR implementation of AJP connector introduced by the refactoring for bug 49884
Correctly use the readFully method. Add a utility method to sort absolute order 
Update version numbers  
ignore list 
Update ignore list with the full set  
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50802 Ensure that ServletContext.getResourcePaths() includes static resources packaged in JAR files in its output. 
line length
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50189 Once the application has finished writing to the response, prevent further reads from the request since this causes various problems in the connectors which do not expect this.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50743 Cache CheckStyle results between builds to speed up validation. Patch provided by Oliver.
Remove unnecessary code, fix a Findbugs warning
Remove unnecessary code, fix a Findbugs warning
Remove unnecessary code, fix a Findbugs warning
Exclude a check
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48863 Better logging when specifying an invalid directory for a class loader. Based on a patch by Ralf Hauser.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48870 Re-factor to remove parallel arrays. Modify fix for 48863 to remove use of StringManager as it is not available in Bootstrap
Fix indentation
Fix javadoc
Servletapi-2.3 appears to have disappeared from the maven1 repo. Switch everything to maven2 repo
Smarter solution for bug 48863
Convert to Javadoc comment and add some additional info
Refactoring to remove duplicate code
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=19444 Add an option to the JNDI realm to allow role searches to be performed by the authenticated user.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=21669 Add the ability to specify the roleBase for the JNDI Realm as relative to the users DN. Based on a patch by Art W.
Remove unused code, fix FindBugs warning
Test before generating debug log messages Fix FindBugs issues for File.delete() return value
https://issues.apache.org/bugzilla/show_bug.cgi?id=50805 Make sure we only call borrowConnection once per connection per checkout  
doco update bug 50805 
Better handling in acceptor threads if server hits ulimit for open files
Add the SecurityListener (disabled by default) that prevents Tomcat from starting if configured insecurely.
Add security listener
Restore the CrawlerSessionManagerValve Local testing with Jira 4.2.4 shows it works.
Avoid NPE if no u-a header
Fix comment typo
Add documentation for the Crawler Session Manager Valve.
Don't start NamingResources multiple times
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50826 Avoid IAE when Tomcat instance is destroyed without every being started. Add a test case for this.
Avoid NPEs trying to re-negotiate with NIO
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49284 Support SSL re-negotiation in the HTTP NIO connector There is a fair amount of renaming in this patch. The real work is in the new rehandshake() method in the SecureNioChannel.
Fix FindBugs warning
Ensure a web application is taken out of service if the web.xml file is not valid.
No need to call stop if the app didn't start
Fix what looks like a copy/paste error
Fix FindBugs identified error in Servlet 2.2 jspFile handling
Another false positive
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50836 Better documentation of the meaning of Lifecycle.isAvailable() and correct a couple of cases where this could incorrectly return true. 
Block whilst waiting for data from client in NIO SSL-rehandshake rather than spinning the CPU
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=31027 Trim whitespace from names and values obtained from $CATALINA_BASE/conf/catalina.properties to avoid hard to diagnose errors on startup.
Revert r1075050
Remove unused code
Misc clean-up  - Suppress Eclipse warnings  - Remove unused code  - Correct Javadoc
Couple more false positives
Another false positive
Misc clean-up - remove unused code - suppress FindBugs false positives - add javadoc
Clear remaining FindBugs issues from javax.*
Fix Eclipse warnings Remove unused code
Improve fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48863 - consistently pass absolute paths to validateFile() - handle non-absolute catalina home/base
Prep for next release
Clarify auth process for CLIENT-CERT
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=28852 Add URL encoding where missing to parameters in URLs presented by Ant tasks to the Manager application. Based on a patch by Stephane Bailliez.
Fix an Eclipse nag
Should have moved the keys when I moved the SSL tests
Start of an SSL re-negotiation test. Need to expand it to handle request bodies and the other issues highlighted by Filip. Switch to using a CA since it makes the code cleaner and it is easier to get CLIENT-CERT working than will all self-signed certs.
Revert SSL renegotiation for NIO - implementation is broken Reverts r1074675 and r1075030
Comment tweaks
FindBugs fixes - make constants static
More explicit failure message - fixed FindBugs nags
Fix FindBugs warning 
Better fix, we actually need to read 20 byres for the test to pass
Grr. This worked if 20 bytes were read in one go
Fix Findbugs nag Reduce visibility
Remove unused code
More entries
Clear remainder of current FindBugs issues in unit tests
Extract the client-cert tests into a separate test Check maxPostSize works as expected with client-cert
Remove the init from references to handshake since the same fields/methods will be used for renegotiation
Improve handling of SSL renegotiation by failing earlier when the request body contains more bytes than maxSavePostSize.
Fix bug in unit test due to some Lifecycle refactoring
Missed a keystore in the refactoring
Move outside of loop as per kkolinko's review
Simple implementation of a forced and blocking renegotiation with a SSL client 
propagate all exceptions through IOExceptions 
Correctly determine if a buffer has data or not 
Implement renegotiation for SSL cert authentication 
Make sure we also validate the content that is sent and received 
Correct several typos
Improve the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48863 1) Be more strict when ignoring the warning: ignore only when it is the "lib" directory and when it does not exist 2) Warn about JARs created from expanding the GLOB pattern as well 3) s/new File(f.getCanonicalPath())/f.getCanonicalFile()/ for efficiency
Save a few cycles
Correct issues in the SSL renegotiation tests
Better test for APR
Update change log
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=27988 Improve reporting of missing files
Fix Javadoc
Remove unused code
Speed up shut down when ThreadLocalLeakPreventionListener is enabled
https://issues.apache.org/bugzilla/show_bug.cgi?id=50857 Timeouts have to be trapped, and properly handled 
Doco update 
CVE-2011-1088 Start of fix for issue reported on users list that @ServletSecurity annotations were ignored. This fix is not yet complete. This first part: - Triggers the loading of the Wrapper before the constraints are processed to ensure that any @ServletSecurity annotations are taken account of - Makes sure the constraints collection is thread-safe given new usage - Adds scanning for @ServletSecurity when a Servlet is loaded - Ensure there is always an authenticator when using the embedded Tomcat class so that @ServletSecurity will have an effect - Adds a simple unit test to check @ServletSecurity annotations are processed Further commits will add additional test cases and any changes required for those test cases to pass
CVE-2011-1088 Fix typo
@ServletSecurity support Add tests for subclasses
@ServletSecurity Refactor to reduce duplication in test code Add tests for method constraints
Test that individual roles are correctly handled
Add missing files and license header Add NOTICE/LICENSE to all JAR files 
Check web.xml takes precedence over @ServletSecurity
Check metadata-complete=true leads to @ServletSecurity being ignored
CVE-2011-1088 @ServletSecurity Servlets added via addServlet() should not be processed unless created via craeteServlet. Need to delay scanning until urlPatterns are known
Avoid npe
Code clean-up  - fix FindBugs warnings  - remove unused code
Now there is always an authenticator, need to allow for the extra MBean
Code clean-up  - fix FindBugs warnings  - remove unused code
Add missing entry.
Prep for next release
Fix threading issue reported on dev list
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50855 Fix NPE on HttpServletRequest.logout() when debug logging is enabled.
Update comments/test case name
Refactoring for re-use
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48208 Add custom trust manager support
Make more efficient / fix FindBugs nag
Remove unused code
Clean-up, mainly unused code
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=26701 Provide a mechanism for users to register their own URLStreamHandlerFactory objects.
Another FindBugs false positive
Fix Eclipse warnings
Code cleanup - remove unused code - fix FindBugs warnings - fix Eclipse warnings
Fix Eclipse and FindBugs warnings Removed unused code
Fix some warnings
Remove unused code
Restore the ability to register the Tomcat jndi URL handler via the java.protocol.handler.pkgs system property.
Refactor to address https://issues.apache.org/bugzilla/show_bug.cgi?id=48208#c13 Don't configure a TrustManagerFactory instance if it isn't going to be used.
Add missing message
Don't swallow exceptions when they are not expected
Remove JSSEFactory. Now we no longer need to support older JSSE versions, this layer of abstraction is not required.
Better Javadoc
Fix build failure and don't tie NIO connector to a single SSL implementation
Add the hooks (no implementation yet) for BIO and NIO to share the code that is currently in JSSESocketFactory
Remove some unused code
Align SSL init for BIO and NIO. Fixes https://issues.apache.org/bugzilla/show_bug.cgi?id=48208 for NIO. Adds support for keyPass, truststoreProvider & keystoreProvider
Add the CVE info for 7.0.10
Add release dates
Expose the global naming context for all Server implementations
New context attribute "swallowAbortedUploads" allows to make request data swallowing configurable for requests that are too large.
r1079367 was a little too enthusiastic. The "if (!initialized)" tests weren't required by the init() call are
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=25060 When stopping naming resources look for DataSource resources with a zero-arg close() method and call it if one is found Works with Commons DBCP.
Reduce visibility of field with public getter and setter. 
Rename new method. 
Consistent Ordering. No functional change. 
Fix alphabetic order. 
Docs: Move "allowCasualMultipartParsing", "swallowAbortedUploads" and "swallowOutput" from StandardContext to Context. 
This was only a partial fix.
CVE-2011-1088 Complete the fix for this issue. The optimisation not to configure an authenticator of there were no security constraints meant that in that case @ServletSecurity annotations had no effect. The unit tests did not pick this up since they added an authenticator directly. Add an explicit unit test for this scenario. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50854 Add additional permissions required by the Manager application when running under a security Manager and support a shared Manager installation when $CATALINA_HOME != CATALINA_BASE.
CVE-2011-1088 Fix unit test failures
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50893 Additional information for extras package
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50895 Don't initialize classes during compilation
Add forgotten attribute "sessionCookieName" to context config docs.
Fix some test failures. Don't use load() since that creates a whole bunch of edge cases that need to be handled.
Fix TCK test failure under a security Manager
Better overriding support
Fix some unit test failures
Session attributes were only partially changed from Hashtable to ConcurrentHashMap.
Speed up unit tests on Linux
Try and make test pass more reliably. This works an 8-core Windows box and a 1-core Linux VM
Fix exception destroying a stopped connector.
Fix typo
Fix Async with APR and TCP_DEFER_ACCEPT
correct message key
Correct a typo
status is always null, so simplify
Ready for next release
svn:eol-style, as noted by sebb
A pair of typos
Followup to r1079781 s/&/&amp;/ in HTML files  HTML allows both variants, but let's be more strict.
Will be released later today
Library updates
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50911 Reduce noise generated during the build of the Windows installer so warnings are more obvious. Patch provided by sebb
Better handling for invalid context paths in server.xml
Don't unpack WAR files if they are not located in the Host's appBase.
Prep for next release
Align code and comments - no functional change
Align code and comments - no functional change
Fix typo
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50887 Add support for configuring the JSSE provider used to convert client certificates. Based on a patch by pknopp.
Don't log to standard out
Fix typo
Some bots (Google) send an invalid session ID
Update to the current ASF bot pattern
Couple of updates
Remove whitespace
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50924 Clean-up HTTP comparison table
Fix typos, remove whitespace
Fix typo
The name for the default host does not have to be resolvable in DNS.
Add recent change
Better comment
Remove unused code Fix some Eclipse warnings
Fix a couple of FindBBugs warnings
Fix FindBugs nag
More FindBugs warnings
Include clean-up under a single entry
Followup to markt's r1081239: update the doc for CrawlerSessionManagerValve
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50903 If a connector is stopped, not not process any keep-alive connections. The exact behaviours are: - HTTP BIO - blocks until request line is read and then returns 503 - HTTP NIO - uses polling, so returns 503 immediately connector is stopped - HTTP APR - blocks until request line is read and then returns 503 - AJP BIO - blocks until request packet is received and then returns 503 - subsequent requests will timeout - AJP APR - no change - subsequent requests will timeout
Correct a typo in changelog for 7.0.9
Handle the scenario where the client sends multiple JSESSIONID cookies. This patch trades a little duplication for simpler code. The duplication only occurs when the client sends multiple cookies and the request is to a context that currently has multiple versions. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50928 Don't ignore keyPass attribute
Chain exception
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50925 Update docs for keyPass attribute
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50929 When wrapping an exception, set the root cause
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50927 Better error message if SSLCertificateFile not set
Remove random "
Improve the logging documentation
Improve the logging documentation
Sync with implementation
Remove unused code
Further additions to mbeans and docs for authentication valves
Add a recent change
Make the CSRF nonce cache serializable to fix an issue reported on the users list. Custom serialization code could shave ~20% but the code isn't as clean.
Remove unnecessary code that makes switching to other authentication methods difficult.
Prevent the custom error pages for the Manager and Host Manager applications from being accessed directly.
Use standard approach for pre-loading classes
Fix an Eclipse warning
Add another false positive
Remove unused code
Tweak wording, try to make clearer
Remove unnecessary casts
Rename, no functional change
Rename, no functional change
Rename, no functional change
Updates based on recent user list questions
Resolve some TODOs for "swallowAbortedUploads"
Remove unused code
Fix the main interfaces now Tomcat 7 is  stable.
Add recent changes
Re-flow. Add a note about failed requests
Fix string comparison - reported by Veracode
Remove call to System.exit() reported by Veracode and related code clean-up
Include the seed time when calculating the time taken to create SecureRandom instances for session ID generation, report excessive times (greater than 100ms) at INFO level and provide a value for the message key so a meaningful message appears in the logs.
No need to specify a default
No need to specify a default
Securely seed the SecureRandom instance used for UUID generation and report excessive creation time (greater than 100ms) at INFO level.
Add another non-Java J2SE package. This is required for SPNEGO support.
Don't register Contexts that fail to start with the Mapper.
Add some Windows authentication notes to the docs
Update the docs regarding the shutdown port number. It is a followup to r938430. As Steven Schlansker noted on the users list, disabling the port affects un*x systems, as kill -9 is not a clean shutdown.
Followup to r1085764 Add the pages to the index page as well.
Update based on feedback Fix typos
Remove constant only used by tests
Remove unused code
Always recycle unless it is an async request. Possible contributing factor to https://issues.apache.org/bugzilla/show_bug.cgi?id=50957 ?
Move the processor.recycle calls to just before the point where the processor is returned to the pool. This ensures returned processors are recycled (this could have been skipped on some exception paths) Possible contributing factor to https://issues.apache.org/bugzilla/show_bug.cgi?id=50957 ? This is part of the fix for CVE-2011-1475
Protect against things going wrong during access logging. An un-handled exception here could trigger some unexpected code paths. Possible contributing factor to https://issues.apache.org/bugzilla/show_bug.cgi?id=50957 ? This is part of the fix for CVE-2011-1475
Add domain configuration that is known to work
Part 1 of SPNEGO/Windows authentication support. This adds authentication support but not authorisation. Some Realm refactoring is required to get authorisation working. SPNEGO is tricky to configure correctly. Some things I know will break it, some I suspect might. There is a long list of questions in the Javadoc that need to be tested. This authenticator started off as a patch by Michael Osipov.
Part 2 of SPNEGO/Windows authentication support. Authorisation support. Works essentially the same way as CLIENT-CERT, i.e. the Realm doesn't actually authenticate the user but it does create the Principal and add the roles.
Fix some TODOs
Update changelog for SPNEGO. Add note to docs about major todo areas.
HTTP range requests cannot be reliably served when a Writer is in use so prevent the DefaultServlet from attempting to do so. This is kkolinko's patch that stemmed from a private discussion about a TCK test.
Correct fix for http://issues.apache.org/bugzilla/show_bug.cgi?id=50928 Default for keyPass is keystorePass
Protect the DefaultServlet against Filters etc writing to the response which will a) break partial get support and b) mean setting on content length will result in a truncated response. This also fixers some TCK failures since the TCK sometimes writes to the response with a filter.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50991 Stop the resources after they have been unbound rather than before
Correct fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50991 Stop resource after app has finished with them but before they are unbound
Implment Filip's idea for a configurable close method
Correctly track changes to context.xml files and trigger redeployment when copyXML is set to false
Correct a typo
Followup to r1086950: Simplify code
Fix Eclipse/FindBugs warnings apart from those that trigger bug 50984
Fix reversed condition in r1086918
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50984 When using the Manager application ensure that undeployment is reported as failed if a file cannot be deleted.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50997 Relax the requirement that directories must have a name ending in .jar to be treated as an expanded JAR file by the default JarScanner. Based on patch by Rodion Zhitomirsky.
Requests after the connector has been stopped may time out or return 503s - varies by connector. Make sure the test passes with either.
Add in ability to build with Maven 
delete eclipse files, these can be generated 
add in plugin to package 
Add in parent reference Thanks to Sebb http://markmail.org/message/nb652iryypigjfso  
Don't append the jvmRoute to a session ID if the jvmRoute is a zero length string.
remove repo inherited from parent 
Improve the logging documentation
Follow up to http://svn.apache.org/viewvc?rev=1086969&view=rev Ensure that when copyXML=false: - removing context.xml triggers a redploy but does not remove any other files - removing context.xml triggers a redploy and the context.xml is re-copied from the WAR  This should be consistent with behaviour when copyXML=true
Feedback on https://issues.apache.org/bugzilla/show_bug.cgi?id=50991 Change the default
Feedback on https://issues.apache.org/bugzilla/show_bug.cgi?id=50991 No point trying to close a non-singleton resource
Only register a DataSource with JMX if it is a singleton
Switch SPNEGO authenticator to use file based JAAS config as this provides greater flexibility including making it easier to work with non-Oracle JVMs. Clean up the code, add debug logging and improve error handling.
SPNEGO support part 2 Expose the users delegated credentials through a request attribute so applications can make use of it
Fix NPE that can happen during concurrency (connection being abandoned, misconfiguration in abandon timeout or lack of ResetAbandonedTimer interceptor) http://markmail.org/message/yhshyvyunddb5ngt  
Implement exception traps as suggested by Eiji Takahashi http://markmail.org/message/c7hrhky4jtgcto76 
SPNEGP part 3 - the final part for 7.0.12 Integrate with JNDI realm so delegated credentials are used by default.
Add credit
Another context.xml tracking issue. This time if using just dir deployment. A changes in context.xml now triggers a redeploy rather than a reload (so the context.xml is re-read)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=12428 Add optional support for preemptive authentication on a per context basis Based on a patch suggested by Werner Donn This includes the fix for CVE-2011-1183
Removed unused code
Consistent naming
Better name
Add additional configuration options to the DIGEST authenticator This is the fix for CVE-2011-1184
Workaround shutdown issue in unit tests
Correct typos in description of NIO connector in config/http.html, especially in TC6. An attribute is called "processorCache", not "processCache".
Update the realm-howto: In TC7 the tomcat-util.jar is also needed on the classpath to call the o.a.c.realm.RealmBase class.
Bump version ready for next release
Correct a Javadoc mix-up
Improve the logging documentation
Configure Security Manager How-To to include a copy of the actual conf/catalina.policy file when the documentation is built, rather than maintaining a copy of its content.
Update a comment, for clarity
Clarify error messages in *.sh files to mention that if a script is not found it might be that it does exist but does not have the execute permission. http://markmail.org/message/k2ynjwbqjcver6ka
Update download links in the appdev tutorial. Replaced direct links to the "download" pages with ones to the main pages of Tomcat and Ant. Download links should be easy to find from there.
Correct a typo and some formatting as a followup to r1087524
Followup to r1087416: Correct typos in messages and remove one e.printStackTrace() call.
Followup to r1087392: correct text of a debug message
Change resource key name for a debug message in CombinedRealm
Fix display of response headers in AccessLogValve: 1. When no headers are there, display "-" instead of empty string 2. Do not forget "," between multiple values TC6 already does that but it was broken here in r767956
Implement display of multiple request headers in AccessLogValve: print not just the value of the first header, but of the all of them, separated by commas.
Try a workaround against TC7 tests running too slow on Gump: a workaround against Oracle JVM bug 6202721
incorporate feedback based on  http://markmail.org/message/gz7lm5dpdpdgcdzq  
Clarifying that pollTime parameter is in microseconds, and correcting the ms equivalent for HTTP connector use of it.
Will announce release later today
Fix "bad character" complaints by modern XSLT processors https://issues.apache.org/bugzilla/show_bug.cgi?id=51028
Refactor to (hopefully) allow unit testing of pipelining support
Need option to use content length for correct processing of pipelined requests.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50957 Fix regression in processing of pipe-lined requests.
Fix broken stylesheet URL in XML based manager status output.  The URLs of the status base pages have a varying number of path segments, so a relativ URL to the stylesheet does no longer work. 
https://issues.apache.org/bugzilla/show_bug.cgi?id=50306 StuckThreadDetectionValve, based on code proposed by TomLu
Added warning messages when an exception is thrown while trying to delete files. Replaced duplicate code in removeGeneratedFiles with a call to removeGeneratedClassFiles. 
Do not depend on system encoding settings when running Tomcat tests.
changelog for r1090003 / StuckThreadDetectionValve
bug 50306: Detect stuck threads  complement to changelog
Consistent format.
Improve error reporting by labeling line/column numbers
Check tag file attribute names are valid Java identifiers
Revert fix https://issues.apache.org/bugzilla/show_bug.cgi?id=36362 JSP.8.3 does not limit the name of attributes defined in tag files
No longer used
Needs re-thinking
Fix comment typo
Better comment
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51038 Ensure async requests are included in access logs.
Additional test case to check access log and return code when error servlet does not flush the response.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51042 Don't trigger session creation listeners when changing the session ID during authentication.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51050 Add additional common but non-standard file extension to MIME type mappings for MPEG 4 files. Based on a patch by Cdrik Lime. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50158 Ensure the asynchronous requests never timeout if the timeout is set to zero or less. Based on a patch provided by Chris. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50173 Throw an exception and do not start the APR connector if it is configured for SSL and an invalid value is provided for SSLProtocol. 
Fix various timing issues with the access log aspects of the test. This fixes: - numerous failures on my desktop - Gump (hopefully) Given the wide range of responses on different machines, more changes may be required.
Stop trying to check for >0ms processing time in access log. There are other tests that check for correct operation so no need for this.  Hopefully address last remaining Gump failure
Add note that antiJARLocking and antiResourceLocking should not be used together. Line length
Correct a regression in the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49916 that resulted in JSPs being compiled twice rather than just once.
Add missing whitespace
Align connector implementations with documented default for processorCache
Add missing @Override
Log JARs scanned for TLDs where no TLD is found.
Add some common JARs to the list of JARs to skip
Use a single TLD location cache for a web application rather than one per JSP compilation to speed up JSP compilation.
Minor optimisation reported by FindBugs
Make use of commons-dbcp.version
Parameterise commons-pool version
Update commons pool to 1.5.6
Add some more JARs to skip (spotted via logging in unit tests)
Set jarsToSkip when running unit tests a) for speed and b) to reduce noise in the logs
Move the unit test JARs to the end. Add a couple of JARs when running via the command line rather than Eclipse
Switch JAR scanning to use JarInputStream rather JarFile for significant startup performance improvements
Fix infinite loop in r1095367
Fix some unused code warnings
Fix typo
bindOnInit is supported for AJP too.
Fix some Findbugs warnings
i18n for r1090763
Move the maxConnections description to the correct part of the HTTP doc. Add it to the AJP doc.
Update summary for maxConnections
Fix TODO - take account of time waiting for a thread when calculating timeouts.
Correct typo in an example in context.html Reported by Michael Jay on the users list
Ensure response is committed when AsyncContext#complete() is called.
Misc code clean-up  - Eclipse warnings  - Remove unused code
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51095 Don't trigger a NullPointerException when the SSL handshake fails with the HTTP-APR connector. Patch provided by Mike Glazer.
https://issues.apache.org/bugzilla/show_bug.cgi?id=48817 Add in setValidator to support dependency injection frameworks like Spring etc 
Expose a container event for changing the session ID
Line length.
Fix bug https://issues.apache.org/bugzilla/show_bug.cgi?id=48817  
MIME types update (consistency with mime.types from httpd) - Part 1     Move comment, so that file is easier to parse automatically. 
MIME types update (consistency with mime.types from httpd) - Part 2     Remove duplicate definition for hqx. 
MIME types update (consistency with mime.types from httpd) - Part 3     Fix suffix for compiled WML Script (wmlscriptc -> wmlsc). 
MIME types update (consistency with mime.types from httpd) - Part 4     Existing mapping with inconsistencies between Tomcat and httpd     where the definitions for httpd seem better. 
MIME types update (consistency with mime.types from httpd) - Part 5     Sort alphabetically. 
MIME types update (consistency with mime.types from httpd) - Part 6     Add mapping existing in httpd but not in Tomcat. 
Add a script to check web.xml and httpd mime.types for differences. 
Update changelog. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51136 Provide methods that enable the name of a Context on Context creation when using Tomcat in an embedded scenario. Based on a patch provided by David Calavera.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51135 Fix auto-detection of JAVA_HOME for 64-bit Windows platforms that only have a 32-bit JVM installed.
Blet and braces - make sure $1 is ""
Note that there is a minimum value for packetSize
Make access logging more robust for 400 responses.
Improve handling of too large packets in AJP connectors - Explicitly check the packet size rather than waiting to see if it fails - Provide a better debug message when it does fail - Once we know we have a bad request, don't try to process it
Re-factor to try and determine if the root cause of https://issues.apache.org/bugzilla/show_bug.cgi?id=51124 is an OOME or something else.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51119 Add JAAS authentication support to the JmxRemoteLifecycleListener Patch provided by Neil Laurance
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51099 Get loginConfigName working with non-default values Patch by fhanik (plus some minor code clean-up)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50950 Correct possible NotSerializableException for an authenticated session when running with a security manager.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47371 Correctly coerce the empty string to zero when used as an operand in EL arithmetic. Patch provided by gbt.
Fix typo
Revert r830965 and restore the automatic disabling of HTTP keep-alive once 75% of the threads are in use.
Ensure keepAliveLeft count is maintained with pipelined requests
Add disableKeepAlivePercentage attribute to the HTTP-BIO connector
Simplify the keep-alive tracking and fix a couple of issues with the keep-alive disable code
Merge maxConnections and pollerSize for the APR connectors.
Use maxThreads value as the default for maxConnections with the BIO connector.
Update changelog
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51154 Remove duplicate @deprecated tags Patch provided by sebb
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51155 Add missing comments to @deprecated code Patch provided by sebb
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51156 Expose session expiration option for apps defined in server.xml 
Update for next release
Add .pl (Perl script) to text file suffixes. Needed for correct line end handling when packaging. 
Stylistic improvements to MIME type sync script. Based on a patch provided by Felix Schumacher. 
Fix TCK failure with mod_proxy_http and HTTP-BIO connector as SSL key size is not readable
Fix Servlet TCK failures with using the RemoteIpValve
Improve robustness. Custom components may use their own strings for event type.
The 7.0.13 release was cancelled.
Use the correct classloader This is the fix for CVE-2011-1582
Followup to r1100829 It's better to have constants at the left side of ".equals" call.
Followup to r1095686: add missing colon in the message text
Add additional configuration options to the RemoteIpValve to control ports. These are required by my TCK test environment since I have multiple connectors (with different ports) configured all using the one Valve. If this has the desired effect, I'll port the changes to the RemoteIpFilter.
Allow the localPort to be overridden for a request
Port RemoteIpValve changes to RemoteIpFilter
Ensure session cookie paths end in / so that session cookies created for a context with a path of /foo do not get returned with requests mapped to a context with a path of /foobar
Fix typo
Review from kkolinko
Make adding the trailing slash to the session cookie path configurable
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51177 MapElResolver should always return Object.class for getType()
Additional fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=51177 ListElResolver should also return Object.class for getType()
Prep for next release
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46451 Configure svn:bugtraq properties for Tomcat trunk Based on a patch provided by Marc Guillemot
Add release date
Avoid NPE is lastWrite is not being used
Refactor keepAliveTimeout to abstract AJP processor
Initial AJP-NIO implementation. Docs to follow once more testing has been completed.
Additional tests for coercing of strings in EL arithmetic for https://issues.apache.org/bugzilla/show_bug.cgi?id=47371 All of them pass successfully.
Don't recycle the buffers at start of process() - this will break non-blocking reads (when implemented)
Fix trivial docs tpyos. 
Make AJP-NIO actually use non-blocking reads. Only the first read of a request is is non-blocking. Any additional reads will block. The first read of the first request on a new connection will also block.
Get Servlet 3.0 async requests working with new AJP-NIo connector
Add new AJP-NIo connector to the changelog. It is working well enough to be classed as experimental. I'll remove that label once all the TCK tests pass.
Add docs for experimental AJP-NIO connector. 
Minor enhancement and fix for NIO AJP documentation. 
Minor clarification in http connector comparison table. 
Improve handling for reading request bodies. More testing still required.
Prevent infinite loop when readTimeout = 0
Remove unused code
SHARED_SELECTOR is used with double checked locking so it needs to be volatile
Tweak processor blocking so that it is non-blocking while no message is being processed and blocking during the processing of a message Align ajp nio protocol implementation with http nio Still some TCK failures to resolve
Fix Security Exceptions when running Servlet TCK with experimental nio-apr connector
Add Filip's additional patch to correctly handle infinite read timeouts
https://issues.apache.org/bugzilla/show_bug.cgi?id=51208  
webapps is relative to base not home
Better align AJP connector code Fix some copy/paste errors
Add remaining attributes to documentation AJP-NIO now passes Servlet TCK - remove experimental label
Add missing @since comment.
Add @deprecation comments
If an error status is set during async processing, don't drop the connection and let the async processing handle it
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51197 Fix possible dropped connection when sendError or sendRedirst are used during async processing.
make fields volatile https://issues.apache.org/bugzilla/show_bug.cgi?id=51212 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51230 Add missing attributes to JMX for ReplicationValve and JvmRouteBinderValve. Patch provided by Eiji Takahashi.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51229 Fix bugs in the Servlet 3.0 asynchronous examples. Patch provided by Eiji Takahashi.
Fix broken documentation links for non-English locales in the HTML Manager application. Patch provided by Eiji Takahashi.
MOve to correct version
grr
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51221 Correct Spanish translation of text used in a 302 response. Patch provided by Paco Sobern.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51182 Better organisation of listeners doc Add JAAS/JMX listener info Patch provided by Neil Laurance
Ordering
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51220 Add a system property to enable tag pooling with JSPs that use a custom base class. Based on a patch by Dan Mikusa.
Remove unused code. Made unnecessary by r618481
Remove unused attribute
Remove unused isErrPage attribute
Fix copy/paste error
Refactoring in preparation for a fix for BZ 33453
More prep for BZ 33453. Include a comment header in generated Java files
Minor clean-up
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=35054 Check that a file is not specified for a Host's appBase and log an error if it is.
https://issues.apache.org/bugzilla/show_bug.cgi?id=51185  
Remove out of date status file. Remainign todos are in bugzilla
Remove 6.1.x wish list If there is any interest in these, they can be added as enhancement requests in Bugzilla
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=27122 Remove a workaround for a very old and since fixed Mozilla bug and change the default value of the securePagesWithPragma attribute of the Authenticator Valves to false to reduce the likelihood of issues when downloading files with IE.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51226 Add a findleaks Ant task for the Manager app. Based on a patch by Eiji Takahashi
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51240 Replace the more generic CounterLatch (that has concurrency issues) with a more specific LimitLatch that (mostly) only provides the functionality required by the connectors to implement maxConnections. It also adds support for dynamically modifying maxConnections.
Adding code signing keys.
Fix NPE triggered by r1127962
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51274 Add missing i18n strings in PersistentManagerBase. Patch provided by Eiji Takahashi.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51277 Improve error message if an application is deployed with an incomplete FORM authentication configuration.
Added 'layout' configuration for log4j loggers. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51276 Provide an abstraction for accessing content in JARs so the most efficient method can be selected depending on the type of URL used to identify the JAR. This improves startup time when JARs are located in $CATALINA_BASE/lib.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51294 Clarify docs for unpackWAR attribute of StandardContext
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51310 When stopping the Server object on shutdown call destroy() after calling stop().
Fix typo
Correctly cast to the right PooledConnection 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51278 Allow ServletContainerInitializers to override settings in the global default web.xml and the host web.xml. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51249 Correct system property replacement code so properties of the form ${...}${...} can be used without error.
More detailed information when waiting for a connection has timed out 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51309 Correct logic in catalina.sh stop when using a PID file to ensure the correct message is shown. Patch provided by Caio Cezar.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51278 Changes required to original fix identified by TCK tests Need to merge defaults before JSP->Servlet conversion since defaults define JSP servlet.
Fix TCK failure exposed by the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=51278 A previous change to ensure web.xml had precedence over fragments and annotations was not complete. It handled filter definitions and servlet definitions but not servlet mappings.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51264 Allow the JDBC persistent session store to use a JNDI datasource to define the database in which sessions are persisted. Patch provided by Felix Schumacher.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51251 Add web application version support to the Ant tasks. Based on a patch provided by Eiji Takahashi.
Update for next release
Javadoc fixes
Create an AbstractProcessor. Start to pull common code from AJP and HTTP processors to this abstract class.
Pull up common getExecutor code
Start to align the parseHost method across the Http11 processors
Fully align parseHost  - remove unnecessary code from BIO  - improve comment for all
Removed ssl attribute from NIO and APR to align with BIO
Align ssl test in parseHost in BIO and NIO & APR
Pull up parseHost
Reformat - no functional change. Just to aid comparison
Correctly handle range requests when using sendfile and the APR/native HTTP connector.
Remove duplicated code
Consistent visibility with BIO
Align some of the code between the connection handlers.
Rename for consistency
Pull up the request and response objects since they are common between AJP and HTTP
Create an AbstactConnectionHandler and pull up the common JMX code from the AJP and HTTP connectors
Fix Javadoc. 
Create a new RecycledProcessors inner class and use it in the Processor implementations rather than redefining the same thing 6 times.
Parse port as base10, not hex
Set svn:eol-style=native Fixes bug 51323 reported by sebb
Revert r1132487 and use Konstantin's suggested fix.
Only need 1 HexUtils class
Correct doc error reported on users list
Revert r1132367. There is no issue. I got confused between AprEndpoint.SendfileData and NioEndpoint.SendfileData
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51324 Improve handling of exceptions when flushing the response buffer to ensure that the doFlush flag does not get stuck in the enabled state. Patch provided by Jeremy Norris.
Add a few more exclusions
Don't overwhelm logs with TLD scanning messages but make users aware there is room for improvement and tell them how to get at the detail.
Prep for 7.0.16 tag
7.0.15 was broken
Don't use a single quote in the message
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51264 Improve fix to return connections to the pool when not in use. Patch provided by Felix Schumacher.
Followup to r1133122 if(flag) set flag:=false
Enable for async requests
Enable for async requests (invoke just passes the request through so no issues with async)
Enable for async requests Only look for a change on non-async requests. There will always be one of these before any async processing on a request so no need to check if the current request is in the middle of async processing
Align log4j configuration example with log4j documentation: start property names with an uppercase character. It is just a question of style: it should work either way.
Simplify markup: remove <br/>s from the end of lines. They are not needed inside the <source> tag.
Enable for async requests Don't persist the session if processing an async request. Note: There may be some async states where the session could be safely persisted.
Enable for async requests. Depending on how async is used, may see multiple replication requests for a single async request.
Enable for async requests. Async requests should appear as serial requests when requiring multiple internal requests so concurrency should behave as expected.
Enable for async requests. Looking for stuck threads - no special async support required here. When the asycn timeout is infinite requests may get stuck but that'll need a different detection mechanism.
Correct a regression in the fix for bug 51278 that prevented any web application from being marked as distributable. (kfujino)
Update changelog post valve changes
Simplify as per kkolinko's review
Fix regression in welcome file processing
Followup to r1133134. I think better not dataSource but dataSourceName.
Avoid possible NPE
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51340 Fix thread-safety issue when parsing multiple web.xml files in parallel. Apache Tomcat does not do this but products that embed it may.
Refactoring triggered security exception when running TCKs
typos
Tests for ClassLoaderLogManager#replace()
Followup to r1133816 Remove properties that TortoiseSVN added to the new subdirectory. It propagates those from the parent directory.
https://issues.apache.org/bugzilla/show_bug.cgi?id=51249 Reimplement system properties replacement code in ClassLoaderLogManager of JULI 1. Do not use recursion. 2. Do not stop on the first unrecognized property, but continue with the rest of the string. 3. Do not call System.getProperty() on an empty key, because it throws IllegalArgumentException. Threat "${}" as unrecognized property.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51344 Fix problem with Lifecycle re-factoring for deprecated embedded class that prevented events being triggered.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51348 Prevent possible NPE when processing WebDAV locks.
Fix Javadoc error
Document the state transition diagram
Add bug number for r1134048
Update ready for next release
Fix unit test for bindOnInit.  Test failed when Java was binding sockets using IPv4 and APR using IPv6. Since the connector uses APR, and the test socket Java, both could bind at the same time.  Observed on Solaris 10 Sparc.  Fixed by also uding APR to bind the test socket. 
Update the Maven repo info
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51306. Avoid NPE when handleSESSION_EXPIRED is processed while handleSESSION_CREATED is being processed. 
correct changelog.
Remove superfluous quotes from thread names for connection pools.  Example broken thread name: "http-apr-8001"-exec-2 (including leading and intermediate quotes).  Since we never use the names as a full ObjectName, only as a part of an ObjectName, it is safe to remove the surrounding quotes from the Protocol name. 
Fix copy&paste error in comment. 
Fix crash observed during pausing the connector when using APR.  Only add socket to poller if we are sure we don't close it later. 
Fix typo reported by @earthgecko
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51376 Dynamically added Servlet instances were ignoring setLoadOnStartup(), @ServletSecurity, etc.:  When adding a Servlet via ServletContext#addServlet(String, Servlet), the Servlet was not initialized when the web application started and a load on startup value  was set.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50677 Allow ANT style variables in the common.loader and other *.loader properties in conf/catalina.properties  I do not implement the substitution for any property as suggested by BZ 50677, but only for the class loader ones. I think this is sufficient for the use case and does not break backwards compatibility. Most of the code is copied from ClassLoaderLogManager.replace().
Add sunmscapi.jar to jarsToSkip I found it in version 6u25 of Oracle JDK and JRE on Windows 32-bit.
Add to the logging.properties file a sample configuration setting for enabling debug messages in TldLocationsCache. Slightly improve the messages printed by TldLocationsCache.
Align code between connectors in preparation for pulling code up to the superclass No need to pass the socket into the asyncDispatch() call. It will always have been set beforehand.
Align code between connectors in preparation for pulling code up to the superclass
Align code between connectors in preparation for pulling code up to the superclass When returning SocketState.CLOSED, recycle is always called
Align code between connectors in preparation for pulling code up to the superclass No need to close the AJP connection if there was no error
Pull up asyncDispatch()
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51376 Complete fix. Ensure Servlet.destroy() is only called if Servlet.init() was called.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=43538 Add host name and IP address to the HTML Manager application. Patch by Dennis Lundberg.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48956 Implement regular expression support for SSI
Add session="false" directive to the index page of the ROOT web application. There is no need to create a session when accessing this page.
Align SSI regexp handling with htttpd
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51386 Correct code for processing @HandlesTypes annotations so only types of interest are reported to a ServletContainerInitializer.
Release tomorrow. Mirrors should have sync'd by then.
Tomorrow is the 17th
Add missing transition
Aligning code between connectors Remove extra method from JIoEndpoint.Handler
Remove empty dir
Remove empty dir
Add a simple Comet test case
Ignore Eclipse files
Connector re-factoring No functional change
Connector refactoring No functional change
Connector refactoring No functional change
Connector re-factoring First step towards removing SocketState.ASYNC_END from the endpoint Also a few percent faster, at least running the Async unit tests
Connector re-factoring Align Ajp impl with Http impl for BIO
SocketState.ASYNC_END should no longer reach BIO endpoint
Connector re-factoring Remove the need to track isAsync in the SocketWrapper
Connector re-factoring Broadly align NIO Handler.process with BIO Handler.process Remove event() method from NIO handler
Speed up test
Gump is failing. Re-order tests to try and figure out why.
Connector re-factoring Start to align APR with BIO/NIO
Connector re-factoring Align APR with BIO/NIO
Don't use println to write output since os differences will result in different numbers of bytes output
Use static final instead of volatile in AccessLogValve. 
More refactoring since last release
Pull up definition of standard messages
Start to pull up common code from constructors
BZ 49165 and more: - Allow any time stamp formats supported   by SimpleDateFormat in AccessLogValve. - Support logging begin and/or end of request.  Docs to follow. 
Add new timestamp formatting info to AccessLogValve docs. 
No need to for addToPoller in APR HTTP.  When returning SocketState.OPEN the socket is always added to the poller.  Fixes some crashes due to putting the same socket twice in the poller. 
Pull up common endpoint code in Processor constructors
Pull up more common code in Processor constructors
Pull up common code
Pull up getBody message
Align with JIoEndpoint
Add missing sync that triggered test failures on Linux VM post re-factoring
Add an additional error margin to avoid false test failures
Extend margin lese tests fail on Linux VM
Reset sendfile data in recycle method so prepareRequest can be pulled up
Add flags that indicate optional feature support
Align with BIO (add debug log messages) Prepare for pulling up (add tests around adverts for comet support)
Pull up prepareRequest()
Method is identical to method in superclass so remove it
Add the Tomcat extras JARs to the list of JARs to skip when scanning for TLDs and web fragments. 
Make Unix shell scripts for individual commands consistent. 
Make Windows shell scripts for individual commands consistent. 
Add missing Windows configtest script. 
Make JRE / JDK detection on Windows work the same way as on Unix: - if "debug" is demanded, only use JAVA_HOME   and check for a JDK there - without "debug", either use JRE_HOME   or JAVA_HOME with precedence on JRE_HOME 
- Clarify JRE_HOME in catalina.sh - sort OS detection by OS name 
Make tool-wrapper.sh consistent with catalina.sh. 
Make variable explanations for catalina.bat and tool-wrapper.bat consistent with their Unix counterparts. 
Slight improvement of configtest handling in Unix shell script:  - add to usage - don't use CATALINA_OPTS (think memory size etc.) - log a message if status != 0 
Add configtest to Windows catalina.bat.  Not yet complete:  - No error code escalation - No log message 
Remove unnecessary code.
Packaged tag files have jndi URLs not file URLs
Add note about script changes. 
The fix for bug 51310 caused a regression that re-introduced bug 49957 and deleted the contents of the work directory when Tomcat was shutdown. This fix ensures that that work directory for an application is not deleted when Tomcat is shutdown.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=33453 Recompile JSPs if last modified time of the source or any of its dependencies changes either forwards or backwards. Note that this introduces an incompatible change to the code generated for JSPs. Tomcat will automatically re-compile any JSPs and tag files found in the work directory when upgrading from 7.0.16 or earlier to 7.0.17 or later. If you later downgrade from 7.0.17 or later to 7.0.16 or earlier, you must empty the work directory as part of the downgrade process.
Address kkolinko's review comments
Remove unused code. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51395 Fix memory leak triggered when an application that includes a SAXParserFactory is the first web application to be loaded. Fix part 1 of 3 for CVE-2011-2481
More Jars to skip: ant-junit and Java Help. 
Let OneLineFormatter use DateFormatCache. 
Make sure we never use the DateFormatCache with millisecond patterns.  Tidy the format pattern like we do in the AccessLogValve. 
Fix odd looking code
Ordering
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51396 Correctly handle jsp-file entries in web.xml when the JSP servlet has been configured via code when embedding Tomcat.
Deprecated TagPool that may trigger memory leaks.
Auto format
Define CATALINA_BASE fallback earlier, so one can use CATALINA_BASE and CATALINA_HOME variables in setenv without knowing, whether the two have been split (i.e. CATALINA_BASE is set) or not. 
Clarify difference between CATALINA_OPTS and JAVA_OPTS in the scripts.  Feel free to improve wording and examples. 
Add an info about setenv.sh before listing the customizable variables. 
Fix typo and more clarification about CATALINA_OPTS vs. JAVA_OPTS.  Thanks to Rainer Frey. 
Add comment on item ordering, update one entry, add one entry. 
Fix typos in committer ids
Add @Override Use buf.add(char) when there is a single character string
Align tomcat.util.scan.DefaultJarScanner.jarsToSkip value in TomcatBaseTest. Add junit and ant-launcher to the value in catalina.properties
Add missing comma
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51401 Correctly initialise shared WebRuleSet instance used by the digesters that parse web.xml and prevent incorrect warnings about multiple occurrences of elements that are only allowed to appear once in web.xml and web-fragment.xml. Patch by kfujino
Avoid NullPointerException in JULI FileHandler if formatter is misconfigured Fixes https://issues.apache.org/bugzilla/show_bug.cgi?id=51403
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51400 Avoid known bottleneck in JVM when converting between Strings and bytes by always providing a Charset rather than an encoding name. Based on a patch by Dave Engberg.  Note: There are some Charsets that the JVM must support and in those cases Charset.forName(String) should not throw an exception.
Revert to previous, no need for Charset here.
Remove unused code
Fix warnings in SSI package
Another fp
Fix Eclipse warnings / remove unused code
Fix Eclipse warnings in Valves
Further improvements to startup performance. Use File URLs where they can be determined for speed.
No functional change. Refactoring so all attributes are handled the same way.
Fix copy/paste error that broke crl handling
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51418 Provide more control over Context creation when embedding Tomcat. Based on a patch by Benson Margulies.
Connector refactoring. Start moving the NIO connectors towards using SocketWrapper<NioChannel> rather than NioChannel to align them with BIO/APR and permit further refactoring. Do this in small steps since when I tried to do it in one hit, everything broke.
Connector refactoring Another small step towards SocketWrapper for NIO
Connector refactoring Another small step towards SocketWrapper for NIO
Connector refactoring Another small step towards SocketWrapper for NIO
Remove the local socket object
Connector refactoring Rename socketWrapper to socket to align with BIO/APR
Connector refactoring SocketWrapper changes for HTTP processor
Followup to r1138573 Improve support for embedding Tomcat 7.  Expose the string that was used to suppress loading default web.xml as a constant. Short-circuit the attempt to load the web.xml file when this magic value is used. Thus saving us from unneeded getResourceAsStream() call.
Connector refactoring SocketWrapper changes for AJP processor
Amend description for the fix applied in r1132700. The problem there was less severe than it sounds: The port number was not treated as hex. The arithmetics to summ up the digits has already been using base 10.
Revert r1137753 - I have a better soution in mind Fix part 2 of 3 for CVE-2011-2481
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51395 Better fix for memory leak that aligns ContextConfig with TldConfig Fix part 3 of 3 for CVE-2011-2481
Don't cache xml parsing config locally, get it from the Context
Remove unused code
Remove redundant copy of catalina.properties from o.a.c.startup. Generate this copy for inclusion in bin and src jars during the ant "compile" task. 
Use system properties loaded from catalina.properties via the class path in unit tests. 
Remove unnecessary variable BASEDIR from scripts. 
Move the statics out of the "instance variable" section
Follow-up to r1137925: Use buf.add(char) when there is a single character string. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51425 Update Spanish translations. Based on a patch provided by Jesus Marin.
Improve JMX unit test. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=36362 Handle the case where tag file attributes (which can use any valid XML name) have a name which is not a Java identifier.
Add important missing word
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=33262 Install monitor to auto-start for current user only rather than all users to be consistent with menu item creation.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=40510 Provide an option to install shortcuts for the current user or all users. Also ensure registry is correctly cleaned on uninstall for 64-bit platforms.
Remove inaccurate comment
Use a function to start the service so the service name can be changed during the install
Prep for fixing https://issues.apache.org/bugzilla/show_bug.cgi?id=50949 Use a variable for the service name and ensure the uninstaller still works 
Remove dead code and correct comment about thread-safetyness. 
Correctly support 'S' and 'SSS' in SimpleDateFormat timestamps for the AccessLogValve.  We prefer "msec_frac" as documented, but the common other cases should at least work.  Other multiples of the 'S' formatting character will produce bogus results (but don't make much sense either). 
Fix IllegalStateException for JavaScript files when switching from Writer to OutputStream.  The special handling of this case in the DefaultServlet was broken due to a MIME type change for JavaScript. 
Remove unused code
Disable the shutdown port when running as a service. One less port to conflict when installing multiple services.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50949 Provide the ability to specify the AJP port and service name when installing Tomcat using the Windows installer. This permits multiple instances of the same Tomcat version to be installed side-by-side.
Add an upgrade page to the documentation that can be used to determine the changes in any of the configuration files between two given versions.
Use "eval exec" instead of "eval" for "catalina.sh run".  Originally it was "exec" before we switched to "eval" which leaves an additional intermediate shell process hanging around. 
Fix CVE-2011-2204. Prevent user passwords appearing in log files if a runtime exception (e.g. OOME) occurs while creating a new user for a MemoryUserDatabase via JMX.
Fix typo
Prevent multiple variations of the same sncoding filling up the cache
Pre-populate Charset cache. Since cache is pre-populated, no need to look up non-matching values which effectively caches misses too.
Remove unused files
Remove upgrading info - it has been added to the site
Need to include aliases in charset cache
Simplify. Covert aliases to lower case too.
Use a more reliable method to expire sessions.
Update for recent changes
No need for a ConcurrentHashMap now pre-population is used.
Fix the remaining instances of new String(byte[] b, String enc) that can be fixed
Increase size of file the test tries to send since there is enough buffering on my system that 200k can hide in the buffers triggering a test failure (the limit works - it just fails in a way the test doesn't expect)
Increase size of file the test tries to send since there is enough buffering on my system that 200k can hide in the buffers triggering a test failure (the limit works - it just fails in a way the test doesn't expect)
Additional fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=36362 to address regression for attributes with names that include underscores
More https://issues.apache.org/bugzilla/show_bug.cgi?id=51400 related changes Based on a patch by Konstantin Preier
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51447 Viewing a back up session in the HTML Manager web application no longer changes the session to a primary session. Based on a patch provided by Eiji Takahashi.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50353 Rather than the eventual NPE, throw an ISE if an application attempts to access an AsyncContext after the request processing has ended.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51436 Send 100 (Continue) response earlier to enable ServletRequestListener implementations to read the request body. Based on a patch by Simon Olofsson.
Add a test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=51445
Added symmetric sslAvailable=false in terminateAPR. 
Notifications of changes in session ID to other nodes in the cluster should be controlled by notifySessionListenersOnReplication rather than notifyListenersOnReplication.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51443 Document the notifySessionListenersOnReplication attribute for the DeltaManager.
Fix what was originally a typo Similar to https://issues.apache.org/bugzilla/show_bug.cgi?id=50648
Fix what were originally typos Similar to https://issues.apache.org/bugzilla/show_bug.cgi?id=50648
If the socket is closed (i.e. due to an error) no need to postProcess
Ensure an access log entry is made if an error occurs during asynchronous request processing and the socket is immediately closed.
Ensure that if asyncDispatch() is called during an onTimeout event and the target Servlet does not call startAsync() or complete() that Tomcat calls complete() (or does the equivalent) once the target Servlet exits.
Better error handling that may help track down the cause of https://issues.apache.org/bugzilla/show_bug.cgi?id=51088
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51450 More Spanish translations. Based on a patch by Jesus Marin.
Fix bad logic. Need to postProcess if socket is *not* closed and it is an async request.
The change in session ID is notified to the container event listener.
Improve the handling for Servlets that implement the deprecated SingleThreadModel when embedding Tomcat.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51445 Correctly initialise all instances of Servlets that implement SingleThreadModel. Based on a patch by Felix Schumacher.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51453 Fix a regression in the preemptive authentication support (enhancement <bug>12428</bug>) that could trigger authentication even if preemptive authentication was disabled.
Seen on Windows too (less frequently)
Fix faulty test
If things go wrong, don't wait forever for the latch.
Fix possible NPE when serving STM servlets
Consistent reporting for the connectors
Use specified AJP port rather than always using default
Build server.xml for the installer by search and replace rather than combining fragments. No ore work to keep the original and the fragments in sync and esy to expand to add additional search/replace as well as insertions etc.
Add support for configuring the shutdown port
Followup to r1140693 Declare a separate public method for the new use case of makeJavaIdentifier(), instead of passing the "false" flag as an argument.
In Tomcat.initBaseDir(): set a value for catalina.home only if it has not been set previously.  Without this fix, I guess, you won't be able to run embedded Tomcat with separate catalina.base and catalina.home.
Read/write by multiple threads outside sync - needs to be volatile
Prevent test failures when two objects get generated with the same hashCode
When using Servlets that implement the SingleThreadModel interface, add the single instance created to the pool when it is determined that a pool of servlets is required rather than throwing it away.
Correct deadlock introduced in r1142112
Only add instance if it has just been created.
Update ready for for next release
Fix Javadoc warnings spotted in 7.0.17 build
Fix generics warnings
Remove dead code
Fix Eclipse warnings in the o.a.c.startup package
Start the 7.0.18 changelog
Fix possible NPE
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51466 Fix typos Patch by Felix Schumacher
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51467 start() not run() Patch provided by Felix Schumacher
Remove publicId field from SchemaResolver class, because is never read and is not cleared when digester is reused. If anyone needs this, this value is available by calling SchemaResolver.digester.getPublicId().
Add @Override annotation
Add @Override annotation
Fix a small number of warnings
Fix "potential null pointer access warning". As a bonus, it avoids allocating char[] buffer for an empty string. Add $FALL-THROUGH$ comment where we fall through to the next label in switch().
Fix "potential null pointer access warning".
Add @Override annotation
Add @Override annotation
Add @Override annotation
Add @Override annotation
Add @Override annotation
Add @Override annotation
Add @Override annotation
Add @Override annotation
Correct regression caused by connector re-factoring that made AJP APR/native connector very unstable on Windows platforms.
Validate Windows service name
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51473 Fix concatenation of values in SecurityConfig.setSecurityProperty() when the value provided by JRE is null.
Further improvements to the Windows installer 1. Install into "**/Tomcat7.0_servicename" when service name differs from default, but install into "**/Tomcat7.0" if the name is the default one. This is to be in line with 7.0.16 and earlier versions, but differs from 7.0.17 which used "**/Tomcat7.0/servicename". 2. Changed name of registry key for running of Tomcat Monitor 3. Do not forget to delete Tomcat Monitor running entry from HKCU in 32-bit part of registry
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51472 Correctly test modifiers when resolving bean methods with the BeanELResolver. Patch provided by Friedhelm Kuehn.
Fix response.encodeURL() for the special case of an absolute URL with no path segment (http://name). 
Revert r1142953. The analysis was incorrect.
Limit exclusion to 'old' tests so tests added to o.a.catalina.tribes will execute
Move working JUnit tests to align with package of class being tested.
Remove ununsed methods. Convert from using main() to a unit test Use valid test data
Remove main method
Based on current usage within Tomcat, message length of 0 should result in null. Populate the test for this and ensure the test passes.
Remove unused code
Update changelog
Prevent test failures on Linux
Extract test to a test case
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51475 Handle messages larger than the buffer size. Expand test cases to cover this. Based on a patch by Christian Stber.
Review comments
Javadoc fixes
Not just this test failing. Need a better solution. Revert r1143126.
Refactor the bind call to reduce the length of the stack traces when the unit tests fail. It probably won't fix the issue but it will make the logs easier to read.
Add sync to fix test failures on Linux. Should have minimal impact in normal Tomcat usage since each instance/JVM only opens a single socket.
Fix typo
Correct regression caused by connector re-factoring that meant that sendfile data was not reset between pipe-lined HTTP requests.
Refactor to avoid NPEs during test
Remove debug code
Update ready for next release
Use SecurityClassLoad to pre-load HexUtils to prevent a security exception
Already loaded via SecurityClassLoad
Add re-factoring to the changelog
Post refactoring, can't be processing a comet request in asyncDispatch
Collapse the multiple if statements
Remove unnecessary throws Move timeout lookups to where the timeouts are reset (in preparation for this being in a separate method)
Missed a reference to comet which will always be false in asyncDispatch
No functional change - make it the same as BIO & APR
Include jdbc-pool into tomcat release.  
Pull up asyncDispatch()
Remove pointless code (see finally block just above)
Pull up reset for remoteHost etc. to a common location
Fix indentation
Fix regression in connector re-factoring that was too aggressive cleaning up AJP/BIO between requests triggering 400 entries in the access log
Improve comments
Remove unnecessary call. Socket can't be in connections at this point. Leave currently unused socket parameter in method - plan to use it in later re-factoring
Align the process methods some more.
Align the process methods some more.
Completely align process methods
Bring the Http11 protocol implementations closer together.
Protocol will call recycle
More protocol alignment (with an eye to aligning with AJP)
Change eol-style and add link to jdbc-pool on the documentation home page 
Yet more protocol alignment (with an eye to aligning with AJP)
Pull up Handler.process for the Ajp Connectors. Note that this is an intermediate step. The aim is to pull this up to AbstractProtocol
Pull up Handler.process for the Http11 connectors. Note that this is an intermediate step. The aim is to pull this up to AbstractProtocol
Align AJP and HTTP prior to pulling up Handler.process
Pull up Handler.process
Fix Comet with HTTP/APR connector r1144391 switched the key for the processor map for this connector from the socket to the socket wrapper. That prevented Comet from being able to retrieve the processor from the map when processing a comet event. This commit changes all the connectors to map the socket (or rather whatever the SocketWrapper wraps) to the processor rather than the SocketWrapper.
Add regression fix to changelog
Remove some more unnecessary code
Update to Commons Daemon 1.0.6
Update to Eclipse JDT Compiler 3.7
Fix regression producing invalid MBean names when using IPV6 addresses for connectors.  - revert r1135088  - remove the surrounding quotes only when   passing the name to the endpoint, so they   don't end up in the middle of thread names.   The thread names are used as MBean attribute   values, but not in MBean names. 
Add option test.accesslog to activate AccessLog for unit tests. 
7.0.18 not released
7.0.18 not released
Remove unused code.
Another regression in 7.0.18: year number formatting in AccessLogValve is broken due to type "yyy" instead of "yyyy". 
Disable one test validation in TestAsyncContextImpl if an AccessLogValve has been activated.  The test relies on receiving data via StandardEngine.logAccess() which is already handled by the other AccessLog.  By default no AccessLogValve is activated, so the validation is still done. 
Add missing thread name in RequestProcessor when Servlet 3 Async is used.  Fixes null thread name in access log and probably JMX MBean. 
Make it easier for tests to override the protocol (e.g. to test AJP)
Move new changelog entries to correct subsection. 
Add changelog entry for Filip's inclusion of jdbc-pool in releases. 
Reorganize jdbc-pool inclusion in releases.  Split build (code and docs) from clean. 
Add jdbc-pool to jarsToSkip. 
Fix version pattern in jdbc-pool manifest. 
Set includeantruntime in jdbc-pool javac build tasks. 
Make it easier to test that the right response was returned
Add a simple AJP test.
Fix broken HTML
Ensure it is clear when tag isn't working
Reduce variable scope to reduce testing issues
Fix broken HTML
Fix broken HTML
Update changelog for bz51490 fixes
Replace <tt> by <code> in docs. The physical markup <tt> was only used in few places. Mostly we use the logical markup <code>. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51494 Prevent an NPE when a long running request completes if the associated web application was destroyed while the request was processing
Ignore doc copied in during build process
Allow choosing a locale for timestamp formatting in AccessLogValve. Only relevant to timestamps explicitely given by SimpleDateFormat syntax.  Also: use Locale.US for CLF and for timestamps that are part of the access log file name. 
Fix javadoc. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46252 Allow to specify character set to be used to write the access log in AccessLogValve.
BZ 51477: Support all SSL protocol combinations in the APR/native connector.  This only works when using the native library version 1.1.21 or later which is not yet released.  Older tcnative versions will use an unchanged config parser. Otherwise non-supported protocol combinations would be unnoticed.  For easier review of the changes in AprEndpoint use "svn -x -w" to ignore white space. 
Improve logging of error conditions
Revert unintended commit
* JULI FileHandler, AccessLogValve: Create a directory automatically when it is specified as a part of the file name, e.g. in the prefix attribute. Earlier this happened only if it was specified with the directory attribute. * AccessLogValve: Log a failure if access log file cannot be opened.
Always use en_US as locale for timestamps in ExtendedAccessLogValve.  The format is specified in  http://www.w3.org/TR/WD-logfile.html  and states that the supported timestamps "yyyy-MM-dd" and "HH:mm:ss" are defined with ascii digits and GMT. 
- Remove unused code:   Cookie dates are formatted elsewhere.   This class used a very strange format:   " EEEE, dd-MMM-yy kk:mm:ss zz" - Add log.isDebugEnabled() 
Expose recently added "encoding" and "locale" options of AccessLogValve through JMX.
Followup to r1145209 Do not expose TCN_FULL_VERSION as a public constant, but calculate it when needed. Using this way it will be easier to throw away the code in AprEndpoint when it becomes unneeded. I do not mind reintroducing the constant if it were used in two or more places.
Use en_US as locale for creationdate in WebdavServlet. 
Remove unused import
Remove unused attribute
A little bit of docs is better than nothing ... 
Protect against infinite loops in the HTTP NIO connector if sendfile is configured to send more data than is available in the file. (markt) Part of the fix for CVE-2011-2526
Never compare docs and code:  - enableLookups for connector was   "false" by default at least the last 5 years.  - resolveHosts for normal and extended   access log valve wasn't functional in   the last 4 years (see e.g. r494191) and   IMHO since noone complaint switching   enableLookups to "true" instead is an   appropriate alternative. So document   that "resolveHosts" is no longer supported. 
Maybe someone wants to realize that change. 
Correct a comment Part of the fix for CVE-2011-2526
Socket has been closed, return false so an attempt is not made to re-use the socket Part of the fix for CVE-2011-2526

Protect against crashes in the HTTP APR connector if sendfile is configured to send more data than is available in the file. Part of the fix for CVE-2011-2526
No need to include class in message, results in "classclass"
When running under a security manager and using sendfile, validate sendfile attributes to prevent sendfile being used to bypass the security manager. Part of the fix for CVE-2011-2526
Add CVE reference for sendfile issues
CATALINA_BASE is always set, so simplify
CATALINA_BASE is always set, so simplify
Update ready for next release
Corrected typo in the value of tomcat.util.scan.DefaultJarScanner.jarsToSkip property
Missing svn:eol-style.  Please fix your svn config. Thanks. 
Add some units info to the Javadocs
Minor improvement to javadoc
Modify the test to ensure that the default connection timeout (-1) is used and so that pipe-lining doesn't trigger false positive results
Only test for timeouts if timeout is greater than zero (aligns with BIO and APR)
Update to changelog
Cleaner code
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51503 Add additional validation to Windows installer and Tomcat start for connector port numbers
Fix for PR49595 
Add section title
Add test cases for syntax checking of jarsToSkip. 
Add release date for 7.0.19
Fix for PR50394 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51518 Correct error in web.xml parsing rules for the <others/> tag when using absolute ordering.
Add changelog for 1148254 and 1148216 
Add info on which connectors these fixes apply to. Correct order. Add periods to the end of the sentences.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51509 Fix potential concurrency issue in CSRF prevention filter that may lead to some requests failing that should not.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51531 Update for ecj 3.7
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51516 Correct property to change SSO session cookie name
Improve fix for PR50394 Requires native 1.1.21 
Remove unused code
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51532 JSP files with dependencies in JARs were recompiled on every access leading to poor performance. 
Fix for 51056. remove SSLv2 from all. Needs native 1.1.21. Now to allow SSLv2 you have to use: SSLProtocol="SSLv2+SSLv3" for example. 
Trivial improvements to access log valve docs. Fix typos noted by Andr Warnier.
Improve wording in a message and in one entry in changelog.
Promote the Set Character Encoding filter to the filters package so it is more widely available.
Improve i18n support.
AJP NIO is still experimental but is fully functional.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=41498 Add info for allRolesMode
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=41709 Provide exception messages for ISEs when response is already committed
Make rules on settng path clearer
Add tests for bug 51544 (note tests pass - can't reproduce error yet) Fix some find bugs issues
Add tests for bug 51544 (note tests pass - can't reproduce error yet)
Another test case for bug 51544
Update project to use JUnit 4 libraries.
Update checkstyle configuration to allow static imports of org.junit.Assert members. This is for JUnit 4.
Converted tests in org.apache.catalina.deploy to JUnit 4.  1) textXXX() -> @Test added 2) protected setUp() -> @Before public setUp() 3) in TestSecurityConstraint: There is no assertEquals(boolean, boolean) method in JUnit 4, so those calls were replaced with assertTrue() and assertFalse().
Update checkstyle rules to treat imports of "org.junit" as a separate group vs. "org".  Convert simple tests in the following packages to JUnit 4: org.apache.catalina.filters.* org.apache.catalina.ha.session.*
Converted the tests to JUnit 4.
Converted the tests to JUnit 4.
Converted the tests to JUnit 4.
Converted the tests to JUnit 4.  TomcatBaseTestJUnit4 is a copy of TomcatBaseTest converted to JUnit 4, to be used until conversion is completed.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51544 Correctly resolve bean methods in EL so accessible methods that are overridden by inaccessible methods do not cause an IllegalAccessException. Modify test case to catch this problem on Oracle and OpenJDK JREs.
Converted the tests to JUnit 4.
Converted the tests to JUnit 4.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51550 Stop the adaptor swallowing internal errors.
Converted the tests to JUnit 4.
Converted the tests to JUnit 4.
Converted the tests to JUnit 4.
Converted the tests to JUnit 4.
Converted the tests to JUnit 4.
Converted the tests to JUnit 4.
Conversion of TomcatBaseTest classes to JUnit 4 completed. Rename TomcatBaseTestJUnit4 -> TomcatBaseTest.
Converted tribes tests to JUnit 4.
Converting tribes tests to JUnit 4 - done. Update changelog.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51555 Permit an additional lifecycle transition. Allow destroy() to be called on components that are initialized. This can occur in some start failure scenarios.
https://issues.apache.org/bugzilla/show_bug.cgi?id=51545  Adding ability to log current request thread name in ExtendedAccessLogValve using Tomcat specific x-threadname pattern format token.
Update to checkstyle 5.4
Tests are run with all three HTTP connectors. No need for separate tests.
Fix SSL unit test failures with APR/native
This is now available
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51557 Ignore HTTP headers that do not comply with RFC 2616 and use header names that are not tokens.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51561 Recommend the use of digest.[bat|sh] to generate digests rather than calling RealmBase directly.
Correct LocalStrings.properties. Some invalid messagekeys are removed.  e.g.   remove AsyncSocketSender.XXX and FastAsyncSocketSender.XXX keys.   ReplicationValve.XXX and SimpleTcpCluster.XX are removed from org.apache.catalina.tribes.transport.LocalStrings.properties. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49122 Layout improvements and tweaks
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48997 Fixed some typos and correct cross-referencing to the HTTP Connector documentation with the SSL How-To page of the documentation web application.
Typo
Catch less specific exception to deal with intermittent failures with OpenJDK
Improve error handling for APR connector if sendfile fails
Ensure APR socket is not added to multiple pollers.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51567 Update the class loading page of the documentation web application to include information on the search order for the common class loader when separate values are used for $CATALINA_HOME and $CATALINA_BASE.
Add a unit test that confirms that comet sockets are closed when the connector is stopped.
Improve class loading documentation  Review existing documentation. Rephrase and reformat some statements.  Documented $CATALINA_BASE/bin/tomcat-juli.jar. Documented new JARs in $CATALINA_HOME/lib, that were not present in Tomcat 6.  More changes to this document are to follow.
Set "reuse" flag of final AJP "END_RESPONSE" packet to "0" if we plan to close the connection.  mod_jk will respect it and I just committed the same to mod_proxy_ajp in httpd trunk.  If the web server does not respect it, things do not get worse by nevertheless setting the flag, because the patch does not change whether we actually close the connection or not. 
Improve class loading documentation  Improve documentation about $CATALINA_HOME/endorsed. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51584 Ensure file paths are encoded/decoded when translated to/from URLs so special characters don't cause issues.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51586 Expand error handling to cover anything that is recoverable (or might be recoverable) when loading classes during HandlesTypes processing.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51588 Make it easier to extend the AccessLogValve to add support for custom elements.
Remove unnecessary call. Reduce timeout.
Ensure that calls to StandardWrapper methods() that may trigger creation of a Servlet instance always do so in way that correctly instantiates a Servlet instance.
Additional comments about resolveHosts attribute of AccessLogValve. - The resolveHosts attribute could be used to change the meaning of "common" and "combined" patterns (as it still does in JDBCAccessLogValve), so I mentioned in the docs what to do when that is what the admin wants. - Align Javadoc with Configuration Reference. - Mention the effect of enableLookups attribute of connector on ExtendedAccessLogValve.
Remove resolveHosts attribute from AccessLogValve configuration in the default server.xml.
Simplify mapping for jsp servlet in the default web.xml. Multiple url-pattern values in the same servlet-mapping are supported since Servlet 2.5.
Remove unused files
Correctly handle uninstall with the Windows installer of the service is installed with a name that contains a '-' character.
Quote the service name parameter in the registry as well as in the shortcut
Correct relative links. It is followup to r1151537. CTR: Docs  These pages are already inside "docs", so there should be no "docs/" in relative links.
Remove path attribute from examples of <Context> where this attribute is not needed.
Prevent direct invocation of the Windows uninstaller without a service name from executing since the uninstall will not be complete.
Committing connection if autoCommit is false. Make sure committed connection is returned to the pool if datasource is enabled.
Update to daemon 1.0.7 This fixes CVE-2011-2729
Add info on ciphers
Explicitly configure what icon is used with Tomcat in the list of uninstallable programs on Windows.  Before this it somehow used the icon from Tomcat<N>.exe (feather(, but when the service name contains "-" Windows somehow was not able to find the icon and displayed a default one. With this change the Tomcat (cat) icon will be used.
Update logging documentation 1. Place a better note that Log4J configuration is not needed if it is only osed by one's webapp. 2. Rearrange Log4J configuration section and document how configure it to be used by a single CATALINA_BASE only. 3. Add "productive usage considerations" subsection to JULI one.
Split "condition" attribute of AccessLogValve into two, "conditionIf" and "conditionUnless". Implement conditional logging that logs only if a request attribute is present. The old attribute "condition" is provided as well, for backwards compatibility, and is equal to "conditionUnless".
Allow to have several AccessLogValve instances in the same scope (e.g. in the same Context).
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51614 Avoid two times calls of store.load() and session.expire() in PersistentManager.
Expand description
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51610 Make lifecycle transitions more robust at handling unchecked exceptions
Prevent spurious log warnings on container stop if a child component has previously failed.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51615 Code clean-up.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51621 Add additional required JARs to the deployer distribution.
Remove error message since a) it is provides very little / no useful information and b) writing to stderr is just plain wrong.
Fix a small number of warnings reported by FindBugs.
Missing @Override markers
Fix some false npe warnings
Start to align process method
Align HTTP NIO with BIO and APR and hold a reference to the socket wrapper not the raw socket in the Processor.
Rename socket -> socketWrapper
Only try and create the dir if it doesn't already exist
Correctly nest locks and unlocks to resolve FindBugs warning
Correctly indicate if socket is closing when calling recycle for the AJP NIO processor. Note since the flag is unused in this case there were no bugs triggered by the re-factoring error. (rjung)
Add missing getter and setter for the alwaysUseSession attribute of the authenticators.
Upadte to 1.1.22 of the native connector
Update post tag
Update version numbers to 8.0.x
Remove some old info. Update the change log info.
Update Maven release versions
Update the same Eclipse files
Missed a version change
Prep the changelog
Ideas for Tomcat 8
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51641 Connections map uses NioChannel, not <SocketWrapper<NioChannel>
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51640 Improve memory leak protection for DriverManager
Remove unnecessary svn:mergeinfo properties
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51644 Annotation scanning was broken for contexts with a multi-level context path such as /a/b
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=41673 Use platform line endings when reporting error messages
Unregisters MBean of DataSource when web application stops.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=41718 RFC2616 says redirects should include a response body.
Follow up to r1156530. Filter URL (mainly in case of &).
Document two new compiler warnings added in Eclipse 3.7 Indigo. These could be Warnings, but more experience is needed first. "Ignore" are their default values.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51649 Document ThreadLocalLeakPreventionListener
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51650 Code clean-up
Push down inputStream as it is only used by BIO
remove file not needed anymore 
Align InputBuffer initialisation across the connectors Remove unused code Reduce visibility of properties and methods 
Align OutputBuffer initialisation across the connectors Reduce visibility of properties and methods 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51653 Move custom error handling from Host to Context.
Attempt to fix timing issues on Linux unit tests
Better fix for timing issues on Linux with unit tests
Also seeing similar failures with NIO & APR
Remove unused method
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51583 
Fix benchmark tests
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51654 Log an error message if an appBase is specified that is not a directory and disable automatic deployment to prevent subsequent errors.
Clean-up I do not intend to back-port (non-critical and changes the Host API)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51658 Fix copy/paste error that could trigger an NPE. Based on a suggestion by Felix Schumacher
BIO doesn't use comet but align code with NIO/APR.
nOnce -> nonce for consistency
No need for local variable, processor already has the keep-alive timeout
Fix generics warnings
Make handling of keep-alive timeout consistent No need for local variable, processor has the keep-alive timeout
Align keep-alive count tracking for HTTP
Align keep-alive disable capability across all HTTP processors
Remove unused method
Timeouts are ints
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49683 Use separate timeouts for socket  Timeout and keep-alive timeout
Comment typo
Correct comment
Ensure AjpMessage header is correct for the direction in which the message is being sent
Remove deprecated code for Tomcat 8
Remove unnecessary (duplicate) code
Organise code. No functional change.
Rename since this message is used for response headers and response body
Pull up AJP SocketOutputBuffer
Pull up flush() APR (like BIO and NIO) now writes each AJP packet to the socket as soon as it is ready
Pull up finish() so output() is used consistently to wrote closing message
Re-order. No functional change.
Pull up refillReadBuffer()
Rename
Add ability to track bytes read
Add the ability to swallow input by specifying a null chunk
Forward-port r1159673 and r1159680 from tc7.0.x Fixes http://issues.apache.org/bugzilla/show_bug.cgi?id=51688 JreMemoryLeakPreventionListener now protects against AWT thread creation. (schultz)
Fix two typos in tomcat.nsi (uppercase vs. lowercase in a macro call and in a message)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51713 Improve message that is logged if there is a typo in the value of protocol in a <Connector> element.
Followup to r1161322. Do not pass exception to message template, because exception itself is logged as well. Remove argument from message templates that is never passed.
Detect incomplete AJP messages and reject the associated request if one is found
Revert r1160772 & r1160774. These changes turned out to be unnecessary.
Correct message
Tweak the message validation. Body messages don't have terminators
Make the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=50394 done in r1148815 more explicit. No functional change. 
Followup for r1157874 which is a Fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=51583 Break loop immediately, because con is never set to null and you'll try releasing it twice.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51558 No need to force the use of the StandardManager with addWebapp() since StandardContext will add it if it is not set.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51704 Make calls to File.mkdirs() more robust and handle errors in a few places where they were ignored and should not have been.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51736. Make rpcTimeout configurable in BackupManager.
Followup to r1162721 Get list of members only once Improve message and code formatting
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51712 Ensure cache control headers are sent even if request is secure. Patch provided by Michael Zampani
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51739 Set the method when using a landing page
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51698 Fix CVE-2011-3190 Prevent AJP request forgery via unread request body packet
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51744 Don't allow user code to close the JNDI context while a web app is running
As per the comment, remove the deprecated code
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51741 bug 51741: Eclipse WTP "Serve modules without publishing" broken with tc7, needs patch in tomcat
bug 51741: Eclipse WTP "Serve modules without publishing" broken with tc7, needs patch in tomcat  https://issues.apache.org/bugzilla/show_bug.cgi?id=51741
Revert r1163807: Remove subclipse:tags property.
Avoid IllegalArgumentException when setting maxActive less than or equal to 0. ArrayBlockingQueue doesn't allow capacity of 0 or less.
Remove unused, undocumented configuration option
Correct connectionLinger documentation
Fix a regression with the fix for 51653 that broke custom error page handling for error status codes return by the authenticators. This moves error page handling back to the host valve and also moves request listener handling to the host valve. This ensures that everything at a context level happens inside the listeners and that custom error pages are available for all context errors.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51550 Use context error pages where possible e.g. for authenticator errors
Align logger name with class name.
Remove unnecessary code Timeout is set when socket is created and further changes are handled inside the while loop
Correct documentation of default connection timeout
Remove unnecessary try/catch The methods it contained were either simple setters or already provided exactly the same exception handling
Remove unnecessary try/catch that just wraps a simple setter
Start to align the request finish code
Move stage update to before point where we might break out of the keep-alive loop
Refactoring prep for extracting sendfile code to a separate method
Pull out implementation specific processing that determines if keep-alive should be broken into a separate method.
Complete alignment of process() for finishing requests
Align request processing between the connectors
Tab police (rebuilt laptop - need to fix Eclipse config)
Revert r1165237. Documented defaults are correct.
Start timing request processing after the request line has been read and before the request headers are read (aligns with other HTTP connectors)
Add debug log message to align HTTP connectors
Headers should be read with the standard connection timeout. The upload timeout should only be used for the request body.
Align while loop test
Add another 3.7+ note
Fix typo
Make keptAlive initialization common between the connectors
Clarify the default connectionTimeout. Add info on setting infinite timeouts.
Aligning the HTTP connectors. Handle request line timeouts consistently Handle upload timeouts more consistently
Connector alignment - request line reading
Connector alignment - this parameter is ignored with BIO
More connector alignment - request header parsing
Remove unnecessary setting of timeout (will have been correctly set in setRequestLineReadTimeout())
Align connectors - setting timeouts
Connector alignment - final tweaks to the process method
Fix keep-alive broken by refactoring
Fix timeouts broken by refactoring
Handle infinite timeouts for both soTimeout and keepAliveTimeout
Pull up the process() method
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51744 Use method Set rather than EnumSet since the method signature uses Set.
async more likely than comet
Make sure connections are only kept open for keep alive.
Add a simple annotation cache to improve performance for applications that use lots of non-poolable tags.
Reduce cache memory usage for classes with no annotations. Review comment from kkolinko.
validatorClassName and suspectTimeout are ignored.  In order to support them correctly, validatorClassName and suspectTimeout are added to  property list. 
Add caching of postConstruct and preDestroy annotations
Tomcat 6 introduced a custom attribute for SSL session ID. Servlet 3 introduced a standard attribute for this. Support both, deprecating the custom attribute.
Remove deprecated code
Remove unused import
Remove unused code
Fix Eclipse warnings
Fix Eclipse warnings
Test inrange rather than ignoring the value
Remove unnecessary casts
Fix Eclipse warnings
Fix remaining Eclipse warnings in jdbc-pool unit tests
Fix possible NPE if instances aren't created through the DefaultInstanceManager but are destroyed through it.
Fix Eclipse warnings in unit tests
Reviewing r1166576... Improve performance of Http11Processor.disableKeepAlive(): call getMaxThreads() first and do not call getCurrentThreadsBusy() twice, because ThreadPoolExecutor.getActiveCount() in JRE is implemented as a loop that counts threads and that should be expensive.
Followup to r1164567, because not all occurences have been replaced.  Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51758 Align the digester logger names with the class name else users will never be able to figure out how to stop it logging
The cache only gets populated if the context is not null. 
typo in decorator https://issues.apache.org/bugzilla/show_bug.cgi?id=48392  
Fix BZ51786. Discarded connection is not active in a pool any longer.  It removes from the active connection list. 
Additional fix for r1170479. Make sure calling disconnect() when only setDiscarded(true) is called and the real connection is not closed.
https://issues.apache.org/bugzilla/show_bug.cgi?id=51794 Fix race condition in selector potentially causing a delay in select operations 
Report tests failure only after all three variants (BIO,NIO,APR) have been run. Do not stop on 1/3 or 2/3.
Allow to overwrite check for distributability of session attributes by session implementations. 
Support a regexp based filter of attribute names in ClusterManagerBase and DeltaSession.  Only attributes whose names match will be distributed. An empty filter means all attributes will be distributed (unchanged default behaviour). 
Document new "sessionAttributeFilter" for cluster managers. 
BZ 51811: Fix typo in attribute name (sslImplementationName instead of  sslImplemenationName). 
Fix javadoc and comment typo. 
Add two new Java 7 Jars to jarsToSkip. 
Prevent NPE if JNDI is disabled.
Revert previous commit (r1172546). Need to fix cause rather than symptom.
Always process postConstruct / preDestroy annotations but only process resource annotations if JNDI is enabled. 
JSP unloading code was retaining a reference to the unloaded JSP preventing the associated class from being unloaded until the JSP that replaced it was unloaded.
Fix resource leak in annotations cache that prevented unloading of resources that used annotations
Fix threading issue with changing visibility of methods and fields
Don't add to Poller when socket is closing to prevent NPEs.
Better detection of thread termination at end of test Better failure messages so it is easier to see the cause of any failure immediately 
Remove debug use of System.out Add missing volatile
Remove empty comment
Pull up members "cluster" and "notifyListenersOnReplication" to common base class. 
- Pull up common clode code to base class. - Add sessionAttributeFilter to clone method - Reduce visibility of notifyListenersOnReplication 
Revert accidental commit
5s is plenty when things are working and 10s is too long when they aren't.
Ensure that when the connector is stopped that a Comet END event is processed to signal to the app and to close the socket
Modify test to account for behaviours of different platforms and different connectors.
Fixed bug #51687: Improve JreMemoryLeakPreventionListener against leak caused by sun.java2d.Disposer - Added (optional) protection against sun.java2d.Disposer thread pinning a WebappClassLoader into memory in the JreMemoryLeakPreventionListener.  
Fixed bug #51580: Severe error deploying WAR application (ExpandWar error) - Added error mesage when JarEntry InputStream cannot be found due to a broken WAR file 
followup r1173088 and r1173090.
Simplify code in NioEndpoint$Poller. The events.size() call is costly, because it is a loop that counts entries in a linked queue. Actually it is not needed here at all, because we iterate the queue by ourselves.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51852 Correct 2 issues in varargs handling  - Incorrectly constructed varargs arguments (resulting in ArrayIndexOutOfBoundsExceptions)  - Incorrectly detected matching varargs methods Patch (with a test case!) provided by Matt Benson
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51860 Fix issues when using NIO, SSL and a custom SSLImplementation. Based on a suggestion by Roman Tsirulnikov.
Followup to r1173630 Simplify code: methodName can be tested once per iteration
Replace explicit Tomcat version with a template - for Tomcat 8.
Fix running under a security manager
Fix docs typo. 
Fix Eclipse warning - unused throws
Fix a small number of Eclipse warnings.  - Unused code  - Unnecessary null checks
Revert r1174322 and apply the correct fix
Remove unnecessary code
Remove unused code
Remove unused code
Suppress warning that is hard (impossible?) to avoid
Remove some unused code
Fix Eclipse warnings
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51862 bug 51862: JreMemoryLeakPreventionListener enhancement to load configurable classes  https://issues.apache.org/bugzilla/show_bug.cgi?id=51862
Fix FindBugs warning
Use the StringManager for i18n
Fix SSL + BIO + Java 7 The implementation of InputStream.read(byte[0]) has changed so it always returns zero without checking for EOF. This broke the old way of doing things.
Add links to @SuppressWarnings documentation for Eclipse IDE.
Ignore warnings in classes generated with JavaCC/JJTree
Use setters when cloning attributes. Should be more safe in most cases.  Example: setting name directly was wrong, because name in base class was something else then in the sub classes.  Not using the setter for maxActiveSessions, because it will also call property change listeners. 
Add Override annotation to recently added methods. 
Do not try to delete the whole output/test-tmp subdirectory when running tests, because that wouldn't succeed (at least on Windows).
Break from AJP CPING handling if endpoint is already paused.  Experimenting shows, that we will otherwise loose the following request. TC will not answer it, but mod_jk doesn't resend if properly configured. CPING is meant to detect this.  Not 100% sure about the call to recycle(), but didn't find where else it would happen. 
Fix Javadoc typo. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51887 Use an insecure random source for session ID generation during tests for speed. Based on kkolinko's suggestion.
Correct a typo
Reduce visibility of static field ManagerBase.name and make it final. We already had a bug being introduced in r1174181 because of this field being assignable.
Cleanup temporary files created by tests: register them and delete them in tearDown(). In TestRegistration also aligned mkdir calls with their usage elsewhere.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51871 Wrong transitive dependency listed in tomcat-jdbc maven pom It should depend on tomcat-juli, not on itself.
Whitespace change to align with AjpAprProcessor. No functional change. 
Add 503 return in process() when endpoint is paused. This is consistent with BIO and NIO. Some more whitespace and other non-functional changes to align with AjpNioProcessor. 
Don't send 503 if endpoint is paused and we just answered an AJP CPING.  If CPING works, mod_jk expects the main request to work too. If we don't want to process the main request we need to fail the CPING received directly before. 
Update version number to Tomcat 8, where it was added by r962466
Remove unused webapps/docs/tribes/tomcat-docs.xsl  The build.xml that does "xslt basedir="webapps/docs/tribes"" uses the common webapps/docs/tomcat-docs.xsl instead.
Update version number for Tomcat 8.
Use slightly more correct markup: <h1> is block element, while <font> is inline element
There is a caveat when using RemoteAddrValve with IPv6 addresses - see thread "tomcat 7.0.21: bug in RemoteAddrValve?" of 2011-09-14 on users@ Document it and update configuration examples in manager and host-manager apps. Add usage examples to valve.html, filter.html.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50923 Use slightly different color for <code> tags
Add thread name to OneLineFormatter. 
Improve RUNNING.txt by adding the following: - Mention that CATALINA_HOME should have a correct value or be absent (BZ 51806) - Mention environment variables that are used by the scripts. - Document what is left in $CATALINA_HOME when $CATALINA_BASE is used. - Document setenv.* scripts.  Feedback and better wording are welcome.
Remove unused code
Fix some FindBugs warnings
Fix a FindBugs warning
Add to the Tomcat 8 TODOs
ContainerServlets are always restricted.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51872 Ensure access log always logs the correct remote IP. Ensure requests with multiple errors do not result in multiple access log entries. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51905 Skip attempt to shutdown AprEndpoint acceptor threads if the server socket has been already forcefully closed. Reduce waiting timeout from 30s to 10s. I think if things go wrong 10s is enough to wait.  If it were waiting 30s - the JVM itself might be forcefully closed by service wrapper as unresponsive. - it must print something to the logs, otherwise it looks odd.
In the examples application: Add links to the FORM Auth, Servlet 3.0 Async and Comet examples.
Improve TestGroupChannelMemberArrival 1. Add synchronization when accessing TestMbrListener.members. This should fix the failures observed by Gump. 2. Remove unused method #clear(). 3. Improve messages printed to System.out during the test: - Add timestamps - Add hash code of threads (because thread names are not unique: They all are either "Membership-MemberAdded." or "Membership-MemberDisappeared."). - Add current length of members list 4. Print messages when memberAdded()/memberDisappeared() performed no work. That is if notification arrives twice for the same Member. I have not observed such events when running the tests.
Improve TestNonBlockingCoordinator: - Format code for better readbility. - In testCoord1() change how equality is tested. Read expected value from 0th member, instead of (i-1)th. They all should be the same. - Remove unneeded main() method.
Improve MimeHeaders.toString() (is used only for debugging): if there are several headers with the same name, print all of them.
No functional change. Simplify code and add comments: - unwrapped nested if(). - s/while()/if()/ where it has only one iteration.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51912 Fix several small issues in Header processing in Nio HTTP connector: - Split HEADER_VALUE state into HEADER_VALUE_START and HEADER_VALUE. The first one skips leading whitespace, the second one - does not. - Trim trailing tabs as well as spaces. RFC-2616 Ch.4.2 says that both are LWS and both can be ignored. - Always trim whitespace from last line. - Fix initial value of lastSignificantChar when calling skipLine(). It fixes BZ 51912.
A bit more memory-efficient code.
Remove unused code. The code to close comet connections has changed over the years and this bit no longer does anything.
Remove duplicate wrong line that should have been deleted in r535325. See the same text in the JavaDoc of the CometEvent class. 
Remove one more unneeded line. Correct punctuation.
Merge branch 'bug51910' into trunk
Remove unnecessary throws
Fix consequences of removing throws
Remove unused throws declarations
Remove unused method
Remove unused parameter
Remove unused parameter
Remove unused parameter
Remove unused parameter
Remove unused method
Removed parameter from get()
Remove unused parameters
https://issues.apache.org/bugzilla/show_bug.cgi?id=50923 Use more distinct color for <code> and add small spacing around it. Do not color attribute names (the names in the first column in attribute lists in Configuration reference).  Commented-out unused xsl:variable.
Correct markup that looks odd with <code> formatting.
Javadoc for CometEvent: Add <br> tags to make it more readable.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51881 Don't mark processors handling comet requests as non-comet too early. Before this fix, finishing a comet request was processed as non-comet meaning the comet clean-up code was not executed which was likely to break processing of the next request on the connection.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51630 Correct bug in async examples. Remove unnecessary call to AsyncContext.complete() that triggered an ISE.
List jars in alphabetical order.
Do not sort lists that have only one element
rat-excludes.txt file for Buildbot INFRA-3948
Fixed bug #51956: RemoteAddrFilter uses remote host (not address) in doFilterEvent 
Resolve "Redundant null check: the variable cannot be null at this location" warning. The JspC constructor cannot throw a JasperException.
Resolve a warning about unboxing operation. Perform unboxing explicitly.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51952 Make inclusion of a response body for redirects optional as it may cause issues and is only SHOULD in RFC2616. See also https://issues.apache.org/bugzilla/show_bug.cgi?id=41718
ignore *.iml
Fix various IDE warings - add missing @Override - remove unused code - avoid auto-(un)boxing - fix some generics issues
Focus DIGEST auth performance test on authentication process.
Add initial implementation of a thread safe MessageDigest helper class
After some testing with DIGEST auth, this approach is slower
Add a performance test that demonstrates why using URI is currently poor for performance
Make protected to it is visible to unit tests
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51972 Add support for handling scheme/protocol relative URLs for redirects
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51940 Don't limit saving of request bodies during FORM authentication to POST requests since any HTTP method may include a body. Based on a patch by Nicholas Sushkin
Sync with Commons BCEL (moved from Jakarta)
Remove unused ConstantObject interface and associated references
Address review comments for r1181028
Minor clean-up
Simplify deployment code Use full paths in log messages to remove ambiguity
Fix copy paste error s/dir/war/
Re-factor merge code so it does not modify fragments to support caching of default web.xml settings
Add missing eol property
Fix git eol issues (should be no functional change) Sorry for the noise
Cache the result of parsing global and host defaults for web.xml to speed up web application start. This change reduces applciation start time by ~15% with trunk and the TCK web apps
https://issues.apache.org/bugzilla/show_bug.cgi?id=50923 Documentation: Use default color, but lightcyan background for code tags. Based on a suggestion by sebb. Properties table (e.g. config/systemprops.html) needs the same handling as attributes table.
Revert to previous approach to generating InputSource objects for web.xml files Obtain last modified times from the SystemID of the InputSource
Fix typo
Clean-up - remove trailing whitespace - add final where appropriate - add {...} where appropriate
Move the access log validation to the TesterAccessLogValve so that is is available to all tests that use the valve.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52009 Fix the NPE if an error occurs during comet processing Add test cases for errors during comet processing Ensure access log entries are made if an error occurs
Organize imports. Nagged by checkstyle.
No change
Fix typos.
Add additional information in light of https://issues.apache.org/bugzilla/show_bug.cgi?id=52025
Comment typo. 
Always format juli date and time stamps in US locale (currently the class is only used by the OneLineFormatter). 
Make differences between WEB-INF/lib and $CATALINA_BASE/lib clearer
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52045 Better document what "default" Manager implementation is. Also added a separate section about the pathname="" trick that is used to disable session persistence.
Replace links to Servlet and JSP specifications with a link to our wiki page. One link still remains in appdev/introduction.html.  Replace Standard Taglib link to point to http://tomcat.apache.org/taglibs/
Clean-up. No functional change.
Fix possible small memory leak when investigating https://issues.apache.org/bugzilla/show_bug.cgi?id=52042
Link to java.sql.DriverManager page, instead of the top frameset.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52042 Correct threading issue in annotation caching that could lead to an NPE if multiple threads were processing the same class hierarchy for annotations
Fix threading issue when setting accessibility
Prevent possible loss of cache entries due to GC by using strong rather than weak references for the cache entries. This means removing the use of Field and Method from the cache entry as they hold a strong reference to Class which would break the cache since Class is the key for the WeakHashMap that implements the cache.
Use correct attribute for method/field name
Rewrote the DriverManager section in jndi-datasource-examples-howto.xml. The point of view is that driverManagerProtection feature in leak prevention listener is enabled by default. The old warnings about how the things may break thus have much less value.
Correct the markup. s/db/database/
Rearranged the introductory section for DBCP pool. Removed mention of JVM 1.4.
Several additional occurrences of s/dB/database/
Code clean-up, no functional change.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52051 Return a 404 if an attempt is made to process a resource that does not exist
Code clean-up. No functional change.
Minor refactoring. No functional change.
Fix the regression caused by r987955
Code clean-up. No functional change.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52055 Buffers not correctly reset between keep-alive requests when using async
Avoid an unnecessary session ID change notice.  Notice of changed session ID by JvmRouteBinderValve is unnecessary to BackupManager.  In BackupManager, change of session ID is replicated by the call of a setId() method. 
Fix BZ52015. JdbcInterceptor passes not 'this' but 'proxy' to getNext().invoke. 
https://issues.apache.org/bugzilla/show_bug.cgi?id=51940#c9 Restore original method name when forward to the login page returns
in TestFormAuthenticator: Replaced string concatenation with StringBuilder. Autoformatted the code. No functional change.
Expand the test to cover regression fixed in 7.0.23: check that parameters in the original request have reached the protected page. https://issues.apache.org/bugzilla/show_bug.cgi?id=51940#c9
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52059 Delete Tomcat key from HKLM branch of Windows Registry on deinstallation. The bug affects 32-bit systems only. The code for 64-bit registry a few lines below is OK.
Clean-up. No functional change.
Remove unnecessary calls. Closing the socket recycles the processor which in turn recycles the buffers.
When a comet request ends and the socket is being kept alive, prepare the buffers for the next request.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52049 Improve setup instructions for running as a Windows service - remove references to specific Windows OSes - it easily gets dated - correct info on how a JRE is identified / selected
Clean-up. No functional change.
Thread safety
Remove Java 1.2 error handling
follow-up r1186631.
Re-order so context class loader is always reset for keep-alive timer thread even if the thread has stopped.
merge rev 1187571 add a simple .gitignore
Remove mereg info. Merging is from trunk to 7.0.x, not 7.0.x to trunk
Clean-up. No functional change.
Remove unused code. Move utility method that is only usedonce to where it is used.
Fix various Eclipse warnings
Remove info and getInfo() from the Valves Also includes automatic clean-up - mainly whitespace
Removing info part 2
info / getInfo() cleanup part 3
Remainder of info / getInfo() clean-up
Update to-do list
Update changelog
Whitespace removal from /conf
Whitespace removal from /java/javax
Whitespace removal from /java/org/apache/coyote
Whitespace removal from /java/org/apache/tomcat
Whitespace removal from /java/org/apache/naming
Whitespace removal from /java/org/apache/catalina/ant
Whitespace removal from /java/org/apache/catalina/authenticator
Whitespace removal from /java/org/apache/catalina/ha
Whitespace removal from /java/org/apache/catalina/core
Whitespace removal from /java/org/apache/catalina/tribes
Whitespace removal from /java/org/apache/catalina/deploy
Whitespace removal from /java/org/apache/catalina/startup
Whitespace removal from /java/org/apache/catalina/util
Whitespace removal from /java/org/apache/catalina/filters
Whitespace removal from /java/org/apache/catalina/manager
Whitespace removal from /java/org/apache/catalina/session
Whitespace removal from /java/org/apache/catalina/mbeans
Whitespace removal from /java/org/apache/catalina/realm
Whitespace removal from /java/org/apache/catalina/ssi
Whitespace removal from /java/org/apache/catalina/users
Whitespace removal from /java/org/apache/catalina/loader
Whitespace removal from remaining /java/org/apache/catalina
Whitespace removal from remaining /java/org/apache/el
Whitespace removal from remaining /java/org/apache/jasper
Whitespace removal from remaining /java/org/apache/juli
Whitespace removal from remaining /res
Whitespace removal from remaining /test
Trailing whitespace removal from /webapps
Trailing whitespace removal from /modules/bayeux
Trailing whitespace removal from /modules/jdbc-pool
Trailing whitespace removal from /modules/tomcat-lite
Trailing whitespace removal from /
Remove references to getInfo() methods that have been deleted
fileOwned is always false. Taking that into account allows some unused code to be identified and removed.
Fix some low-hanging FindBugs fruit
Fix remaining trailing white-space issues that were preventing the checkstyle build check from passing.
Ignore .git dir when building src distro
Correct parameter usage in messages.
Correct a property name
Add missing i18n lookups
Remove unused properties
Review javax.* and o.a.catalina.[ant-connectors] for unused code using UCDetector and mark unused code as deprecated.
Remove code that was deprecated in r1188399
Fix missing new line in r1188313
Remove unused code missed in earlier commit
Deprecate unused code in o.a.catalina.core
Clean-up. No functional change.
Remove deprecated code from o.a.catalina.core
Git ignores empty directories and the unit tests require this directory to be present for the welcome file tests to pass. The presence of this file doesn't break the unit tests.
Remove unnecessary code
Followup to r1188930 Add license header to .gitignore Added svn:eol-style=native
Correct a typo
Align two copies of Clock2.java /webapps/examples/jsp/plugin/applet/Clock2.java /webapps/examples/WEB-INF/jsp/applet/Clock2.java Just removes an empty line.  I am not sure that we need both, but let's make them equal.
Update logging documentation: group together the files that are put in lib/ when configuring log4j logging. Some users were confused and put one file into bin/.
Make configuration issues for security related valves and filters result in the failure of the valve or filter rather than just a warning message.
In DeltaSession.setId(String): fix duplicate resetDeltaRequest() call.  It occurred via super.setId(id) calling overridden DeltaSession.setId(id, true).
Fix typo
MBean deregistration should not be breaking the link between Connector and Service. Connector destroy is the right place for that.
Followup to r1189256 Correct typo in i18n message: RemoteIpValve is a different beast Add Javadoc for new fields in RequestFilterValve
Fix intermittent unit test failure for TestCometProcessor.testCometConnectorStop Previously either the running or close field could end the loop but only close performed the necessary clean-up. This patch removes the ability for running to end the loop.
Work around a known JVM bug that is fixed in 1.7.0_01 but still present in 1.6.0_29 and was triggering intermittent unit test failures for org.apache.catalina.tribes.group.TestGroupChannelMemberArrival.testMemberArrival
Add a test for parameter processing prior to some refactoring
Add missing property.
Refactor parameter parsing for performance.
Add missing property.
https://issues.apache.org/bugzilla/show_bug.cgi?id=51582 Fix NPE when the query is not available. This is a temporary work around until we know why SQL is null 
Deprecate unused code in o.a.catalina.deploy
Remove deprecated unused code
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46264 Implement threaded start/stop for containers
Revert accidental commit
Fix potential NPE
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51744 Throw the correct exception if an application attempts to modify the associated JNDI context. Add an option to the StandardContext that allows exception throwing when an application attempts to modify the associated JNDI context to be disabled.
Implement review comments from kkolinko
Add some tests used to help track down performance issues.
Review comments from kkolinko
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52091 Address performance issues related to log creation TagHandlerPool. Patch provided by Taiki Sugawara.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52091 Address performance issues related to lock contention in StandardWrapper Patch provided by Taiki Sugawara.
Line endings
This is not AJP specific
Fix NPE in parameter re-factoring identified by JSP TCK.
Review comments from kkolinko for parameter parsing improvements
Review from kkolinko Minor performance tweaks
Simplify addition of parameters
Remove deprecated method
When Context manager does not exist,  A no context manager message is replied in order to avoid timeout (default 60sec) of GET_ALL_SESSIONS sync phase. 
Correct JavaDoc.
Fix trailing whitespace
Replace Hashtable with HashMap in parameter processing. Improve paramsAsString() debug method by iterating over entries instead of keys.
Fix checkstyle validation for startup/catalina.properties: validation runs before compile and the file must be copied before validation runs. Reconfigured the build so that copying occurs before validation.
Followup to r1195531 Use standard Collections.enumeration() wrapper instead of our Enumerator class.
Followup to parameter parsing improvements. urlDecode() sets bc.charset. If decoding is skipped (because there is no '%' in the string) we shouldn't forget to set the charset.
Followup to r1195943 Simplify code. Move toString() call out of urlDecode() method. No functional change.
Deprecate o.a.catalina.util.Enumerator and switch to Collections.enumeration
Remove unused code
Deprecate o.a.jasper.util.Enumerator. Use Collections.enumeration()
Remove unused code
Clarify behaviour if limit is reached
Extend the parameter limits to multi-part processing
Make sure that ISE thrown by parseParts() or by addParameter() is remembered and rethrown when getParts() is called.
Add additional state in HTTP Nio connector non-blocking HTTP headers parsing as a self-guard against unexpected call to parseHeaders() after the parsing has already been completed without a prior call to recycle() or nextRequest(). One such occurrence was observed because of a bug that did not recycle the buffer and was fixed a while ago.  The request will be rejected with error 400. The message is visible only with debug logging in AbstractHttp11Processor.
Alternative implementation for r1196212 that covers all HTTP connectors. Self-guard against unexpected call to parseHeaders() after the parsing has already been completed without a prior call to recycle() or nextRequest().  There is already a flag variable (parsingHeader), so no need for additional state in InternalNioInputBuffer.
Clarify behaviour if limit is reached
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52113 Don't assume presence of context.xml file with JMX deployment
Further improve RUNNING.txt Better describe environment variables. Document setenv.sh. Provide examples of setenv files and of using a context that points to ${catalina.home}. Replace Netscape browser instructions with Firefox ones.
Wrap and format a long line. No functional change.
Wrap and format long lines. No functional change.
Add new attribute to AbstractEndpoint and use it to speed up Tomcat tests. If the attribute "fastShutdown" is set on the endpoint, the usual wait of 1 sec during pause() is skipped.  I think it needs to be added to http.xml/ajp.xml docs, but that will be a separate commit sometime later.
Introduce a new class LoggingBaseTest and move the following features from TomcatBaseTest there: setting up logging, creating temporary directory, deleting files on tear down. This allows to use the same logging configuration in tests that do not use Tomcat.
Clean up code and use logging framework instead of System.out.
Correct descriptions
Ensure that subsequent attempts to start the Valves will not succeed until valid configuration is provided.
Remove 15s wait after each test. I do not understand why that 15s wait with "inspect connections" message was there. Nothing was checked after the wait. Replaced it with a check of the count of received messages. Removed wait after sending the last message in the group of 3. This change saves (3 * 15 sec) + (1 sec + 2 sec) = 48 seconds.
Check cast is safe
Use Container interface rather than an implementation of it.
Test case for bug 52121
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52121 FlushableGZIPOutputStream produces corrupted output on some input sequences The fix is to do not restore compression level right before the end of the stream. Restore it only before writing the next portion of data.
Fixed a bug in the test case: it could not find the resources because they are not copied when tests are compiled.  Use a file stream, reading the resource from the sources like we do it with test webapps (webapp-2.3, webapp-2.4 etc.)
Explicitly mark the two test data files as binary, as a reminder that they should not be treated as mere text. Rename the test class so that it is included into test suite runs.
Extend test case
FlushableGZIPOutputStream: Reserve one byte of real data and perform standard write() call. This uses more standard code: deflate() is never called directly and empty byte array trick is not used.  TestFlushableGZIPOutputStream: Add a check that the decompressed stream equals to the original one.
Update to Checkstyle 5.5
svn:eol-style=native
Document fastShutdown attribute of AbstractEndpoint, that was added in r1197158
Add test for FlushableGZIPOutputStream.write(int). Remove unneeded &0xff in int->byte conversion from the method. According to JLS 3rd ed ch.5.1.3, narrowing of int to byte "simply discards all but the n lowest order bits".
Remove synchronization from write(byte[]), because it is not needed there, as write(byte[],int,int) that it delegates to is synchronized.
Add synchronization to close()
RequestFilterValve (RemoteAddrValve, RemoteHostValve): - Refactor process() method separating value testing logic into a new method, isAllowed(String) - Expose isAllowValid, isDenyValid properties and the new isAllowed(String) method through JXM
Restore handleQueryParameters() call that was lost in r1189882 This is not covered by our tests.
Add constants for the request attribute names used by Comet and Sendfile support.
Introduce new request attribute to be used to mark request if there was a failure during parameter parsing, and a Filter that triggers parameter parsing and rejects requests marked with that attribute.
Followup to r1198696: - Fix bug in Request#parseParameters(): Forgot to flag the main use case of parsing POST parameters as successful. - Update comment in FailedRequestFilter.
Correct parameter description
Fix typo
Fix typo
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52148 Ant tasks require tomcat-coyote.jar Patch provided by Volker Krebs
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52156 Need to use normalised path to look up resource in DirContext
Fixed bug #50570 - Allow explicit use of FIPS mode in APR lifecycle listener - Added "FIPSMode" attribute to AprLifecycleListener that causes OpenSSL to go into FIPS mode  
Followup to r1199980  Fix broken checkstyle validation (imports order) Format new code Cache result of i18n message lookup Add getter for the new FIPSMode property  Documentation in listeners.xml still needs updating.
Add constant for the "org.apache.tomcat." attribute name prefix. Move ASYNC_SUPPORTED_ATTR up to other *_ATTR constants.
Change implementation of PARAMETER_PARSE_FAILED_ATTR attribute, to align with other special attributes. It is now implemented in Request.getAttribute().
Refactor special attribute names handling, to use hash table lookup + adapter class, instead of series of name.equals() tests. Extracted add/change/remove notification delivery into separate methods.
Reformat and rearrange code samples to reduce the width of the document, for better readability.
Document FailedRequestFilter and add sample configuration to conf/web.xml.
Add links to FailedRequestFilter in several places and do other small documentation improvements.
Do not log invalid parameter value unless debug logging is enabled
Fix typo in message name
Correct comment
When deploying a specific named app, don't try and deploy it multiple ways.
Made FIPS-related errors fatal to AprLifecycleListener. 
Added documentation for "FIPSMode" attribute in AprLifecycleListener. 
Add more attributes to manager cloneing when initializing via a cluster configuration: - maxInactiveInterval - sessionIdLength - processExpiresFrequency 
Use setters when cloning cluster managers (at least in ClusterManagerBase).  Be consistent and don't be afraid of property change listeners.  The digester calls the setters as well when initializing the objects. 
Fix bug in FlushableGZIPOutputStream: - It could not flush the last byte, because it should have been done in finish(). Note that GzipOutputFilter.end() calls finish() explicitly before calling close(). The tests called close() only and it did not catch this use case. - Improve IOException handling in flushLastByte(), finish(), close().
If FIPSMode="on", treat its initialization failure as fatal, regardless of the cause, be it implementation failure or missing tc-native.  Implementation note: - Message should be logged before throwing. When Bootstrap terminates it does not print the error in the usual catalina log file. It must be written here. - Throwing an IllegalStateException is not fatal. Throwing an Error is fatal.  Tested with TCNative 1.1.22 that does not have FIPS support.
Remove round brackets from listener section titles. This improves readability of TOC on that page.
Unwrap subsection title
Improve multi-byte character handling in Coyote output for HTTP and AJP. 
Fix formatting, sorry for the noise. 
Check state and throw ISE only if the new value differs from the old one. Throws NPE for invalid null values.
Deprecate unused methods in IntrospectionUtils classes
Remove unused code from "tribes/demos" copy of IntrospectionUtils This can be backported
Remove unused deprecated methods from IntrospectionUtils
Simplify code: remove unneeded classcast.
Improve processing of errors that are wrapped into InvocationTargetException. TrapException interceptor: Rethrow them as an Error. Do not wrap them into RuntimeException.
Improve processing of errors that are wrapped into InvocationTargetException. Rethrow errors that must be rethrown.
When building jdbc-pool from within Tomcat, make it to use Tomcat's output directory. This allows it to respect redefined value of tomcat.output property, moving all output outside the source tree. The new subdirectory used for jdbc-pool build is "output/jdbc-pool".
javax.el: Improve processing of errors that are wrapped into InvocationTargetException. Rethrow errors that must be rethrown.
Improve processing of errors that are wrapped into InvocationTargetException. Rethrow errors that must be rethrown. Add helper methods to ExceptionUtils classes.
Improve processing of errors that are wrapped into InvocationTargetException. Rethrow errors that must be rethrown.
Improve processing of errors that are wrapped into InvocationTargetException. Rethrow errors that must be rethrown.
Improve processing of errors that are wrapped into InvocationTargetException. Rethrow errors that must be rethrown.
Improve processing of errors that are wrapped into InvocationTargetException. Rethrow errors that must be rethrown.
Improve processing of errors that are wrapped into InvocationTargetException. Rethrow errors that must be rethrown.
Unwrap InvocationTargetException if it is caught in ResultSetProxy, like we do it elsewhere.
Improve processing of errors that are wrapped into InvocationTargetException. Rethrow errors that must be rethrown.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52172 Make build instructions clearer about /usr/bin/java Based on the patch by bimargulies
Improve processing of errors that are wrapped into InvocationTargetException. Rethrow errors that must be rethrown: process exceptions thrown from Constructor.newInstance(). In DataSourceLinkFactory: unwrap exception from within InvocationTargetException.
Improve handling of failed deployments - Allow failed configurations to be fixed via JMX - Ensure once a deployment fails, the context is not deployed - Ensure changes to any context.xml file trigger redeployment rather than reloading - Tweak base lifecycle implementation to allow failed components to be restarted once they have been fixed
Fix line endings
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52173 Improve Javadoc for delgate attribute of WebappClassLoader Based on a patch by bmargulies
Correct typo in Javadoc. Add note to BUILDING.txt, that you do not need to build Tomcat if you just want to run it. Move warning earlier than note, so that it is more visible.
Correct wording. It is in the same section, not the next one.
Make sure .bat and .sh files have executable property set
Add Commons Daemon wrapper script
Make sure daemon.sh is included/excluded from the dist
Correct wording in build instructions Simplify instructions for downloading Tomcat source code 
Add "denyStatus" attribute to RequestFilterValve, RequestFilter. Add overridable denyRequest() method to RequestFilterValve. The denyStatus attribute is used to change HTTP status code that is used when rejecting denied request. E.g. to be 404 instead of default 403.
Followup to r1202565 Correct description for one of valves. (Already done for the second one).
Parameters.java: - Fix regression in urldecoding of parameters that contain spaces Patch by Willem Fibbe  TestParameters.java: - Improve the test to cover parameters that contain spaces
Increase time between PINGs in an attempt to reduce false test failures
Adjust timing limits for new PING delay
Rearrange code. No functional change.
Small optimization. Use findByte() instead of indexOf(). Implementation is the same, but it is more fair to its arguments. Limit second string scan using results from the first one.
Reduce overhead from exception handling, using ProxyDirContext.NOT_FOUND_EXCEPTION as an example.
Correct typo in a comment
- Align %2f handling (aka CVE-2007-0450 fix) between implementations of UDecoder.convert(). - Make convert(MessageBytes) to consistently throw an IOException, even if it calls convert(String).  convert(String) and convert(CharChunk) are rare cases with little impact (and inherent bug: hardcoded handling of %xx as ISO-8859-1).
Refactor acceptor pause and shutdown to remove need for 'random' waits in the shutdown code. Removes the need for the fastShutdown attribute
Reduce sleep in acceptor thread pause from 1000ms to 50ms. This significantly speeds up shutdown, particularly with testing, with no measurable increase in CPU usage while the acceptor is paused.
Remove unused code
svn:eol-style native. 
Add .gitginore to text.files list in build.xml which drives fixcrlf. 
1. Implement a query timeout intercept to allow for timeouts to be set when statemements are created 2. Implement rollbackOnReturn and commitOnReturn attributes for connections that have autocommit=false  
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52225 Fix ClassCastException in Alias added for existing host via JMX
Run Mapper performance test twice if it takes too long, to reject occasional failures observed by Gump/buildbot
Change pattern for maven-ant-tasks JAR. The latest version is 2.1.3.
Align .gitignore and build.xml with svn:ignore values. Remove .gitignore from defaultexcludes where it is since Ant 1.8.2.  Notes: - The filename filtering in build.xml uses Ant filename selectors. This is to simplify include of jdbc-pool module while all other modules are excluded. See the following page for a reference: http://ant.apache.org/manual/Types/selectors.html - The values of svn:ignore can be displayed recursively with "svn propget svn:ignore -R"
Ensure that jdbc-pool.xml is copied before checkstyle runs.
Followup to r1204203: fix trailing whitespaces in jdbc-pool.xml, as nagged by checkstyle
Add clarification to RemoteIpValve and RemoteIpValve that to use their IP/hostname/port/protocol values in access log you should properly configure your AccessLogValve.
Correct request attribute names mentioned in RemoteIpFilter/RemoteIpValve javadoc and mention them in documentation.
TestMaxConnections: improve log messages printed by this test. Do not use SEVERE level. Print introductory message about what logging output is expected. Use port number as configured by TomcatBaseTest (8001) instead of hardcoded 8080.
Correct typo in javadoc
Correct javadoc markup
Only apply the commitOnReturn and rollbackOnReturn if the default auto commit value is false. getAutoCommit is a call to the DB for many drivers and doesn't perform well 
Do not throw IllegalArgumentException from within parseParameters when chunked POST request is too large, but treat it like an IO error.
Remove unused code
Add missing @Override
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52028 Add support for automatic selection of a free port for a connector when the special value of zero is used
Conserve threads by allowing multiple pools in the same classloader to share a pool cleaner thread 
Update Daemon to the latest release
update propset, try 2 
Remove unnecessary external from trunk for jdbc-pool
Remove trailing whitespace
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52259 Regression caused by bug 46264. Prevent deadlock if no Realm is configured.
Fix copy paste error in BZ 52259 fix
Retain thread safety for ContainerBase.realm but don't try and start/stop it multiple times
Fix unlocking of the acceptor thread when a random port is used
Fix failing test for APR now random ports are used by default
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52237 Allow configuration of junit log output format. Defaults unchanged. Patch provided by M Hasko
Re-order the connector.destroy() call to (hopefully) avoid the Gump failures on this test. Of course, this is based on a guess that sometimes the 100ms wait isn't quite long enough.
Fix copy/paste error in comment
Simplify
synced svn ignores to git ignores
bug 51741: Eclipse WTP "Serve modules without publishing" broken with tc7, needs patch in tomcat  https://issues.apache.org/bugzilla/show_bug.cgi?id=51741
Fix checkstyle errors
bug 51741: Eclipse WTP "Serve modules without publishing" broken with tc7, needs patch in tomcat  https://issues.apache.org/bugzilla/show_bug.cgi?id=51741  fixed checkstyle problems + missing files in "target" directories because it was in gitignore
Remove emptySessionPath JMX attribute. This setting no longer exists. 
Clean-up in preparation for a fix for bug 52184
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52184 Add a helper class that provides options (via system properties) for controlling how errors triggered by invalid input data are handled. Currently only addresses invalid cookies but can be used elsewhere as the need arises.
New PING delays were previously revoked. Restore correct timing check.
Work around possible JVM bug (maybe Tomcat bug) that triggers regular unit test failures.
Fix line endings
Undo accidental commit of work-around. I'd prefer to keep trying to ID the root cause.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52208 Avoid possible NPEs if stopListening is called in a different thread
Remove unused code
Include new o.a.juli.logging.UserDataHelper in extras
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52321 Used LinkedHashSet rather than HashSet to preserve order
Fix copy/paste error
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52335 % is only escaped as <\%, not \%
Fix eol
Correct test
Extend the test case
Revert fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=52335
Better fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=52335
Servlet 3.1 generics additions
Fix cyclic JAR dependency and add check to ensure it doesn't return
Fix startup failure when running with a SecurityManager
Add properties required by new logging helper when running under a SecurityManager
BZ 52366: Fix typo in VirualWebappLoader documentation (configuration example). 
Add another entry
Ignore a couple of plug-in config files
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52293 Correctly handle Context.antiResourceLocking when HOst.unpackWARs=false
ROOT/index.jsp: Replace link to Bugzilla search with one to Tomcat's bug reporting page
Better document FailedRequestFilter and SetCharacterEncodingFilter filters. Change TOC list at the left margin of config pages: rename last section to "Other" and move Filters page there.
Get test working on Windows
Fix test & typo
Update AbstractReplicatedMap and sub-classes to use generics The key change is that it now implements Map<K,V> rather than extends ConcurrentMap. There are several reasons for this: - The interface is K,V but K,MapEntry<K,V> was placed in the extended ConcurrentMap so generics simply couldn't work. Hence the switch from extending ConcurrentMap to using a private ConcurrentMap instance - The API contract for ConcurrentMap can't be met as currently written (and without a lot of extra code) o switching to Map was the obvious approach.
Update
Remove unnecessary overridden method
Move accept() method from base class to one concrete class that needs it
REmove unnecessary methods from interface
Fix warning
Fix a couple of Eclipse warnings
Avoid deprecated code and provide consistent output regardless of platform
Fix last Eclipse warning in o.a.catalina package
Remove unused class
Remove commented out code
Remove unused class
Remove unused inner class
Remove unused class
Remove unused code. Make fields final where appropriate.
Simplify search since Tomcat only uses xml descriptors
Remove pointless private method
More unused code removal. A little refactoring to allow some methods to be removed to simplify later refactoring
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52213 enabled should be volatile
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52354 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52355 Make debug flags volatile as they are accessed by multiple threads
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52356 size needs to be volatile
Remove debug code that is no longer required
Clean-up. Remove methods that expose internals it would be better to hide and make lock field final.
Fix a few unused code warnings in Jasper reported by Eclipse
Improve manager-howto.xml: Document the list of roles that allow access to Manager webapp. The manager-script role is just one of them.
Correct description of roles
- UserDataHelper: 1) Fix bug in suppressionTime processing. The config value is in seconds, but time arithmetic needs msecs. Now multiplying the configured value by 1000L. 2) Change the API to allow to distinguish the case when next message will be printed at DEBUG level. 3) The private method logAtInfo() now always updates the time. Thus I removed its argument. - Cookies: 1) Add i18n and print special message when we fall from INFO to DEBUG logging.
Followup to r1224648 Fix my bug in property retrieval.
Correct message what US dictionary flags as a typo (but UK one does not)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52384 Do not fail in Parameter parsing when debug logging is enabled. Also do no flag extra '&' as errors.
Apply UserDataHelper to o.a.t.util.http.Parameters
Reduce log level for message for hitting parameter count limit from warn to info. I am not sure that UserDataHelper needs to be applied here. Maybe use a separate UserDataHelper instance?
Update to commons-pool 1.5.7. Fix build condition for tomcat-dbcp to always rebuild when a new version of pool or dbcp is downloaded.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52243 Clarify how to include # or ; in an environment value
Further fixing https://issues.apache.org/bugzilla/show_bug.cgi?id=52184 Apply a separate instance of UserDataHelper to the "maxParameterCount reached" message, so that its threshold is calculated independently of other parameter errors.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52303 Allow web applications that do not have a login configuration to participate in a SSO session. Patch provided by Brian Burch.
Review by kkolinko. - Remove FORM auth specific call. - Javadoc formatting. - Honour the cache attribute of the authenticator.
Resolve Eclipse warnings in o.a.tomcat.net package
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52316 Improve response length logging when sendfile is being used
Code clean-up. Run UCDetector over o.a.el
Fix import order
Code clean-up. Run UCDetector over o.a.juli
Clean-up. No functional change.
UCDetector changes
UCDetector changes. Make read-only fields final
UCDetector. Deprecate / add TODOs to currently unused code
Remove unused code
Make frequently failing test disabled by default until we can figure out what is going wrong
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52326 Log all classloading errors during HandlesTypes processing at debug
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52387 Silence logging for correct host Patch provided by David Calavera
https://issues.apache.org/bugzilla/show_bug.cgi?id=52405 Servlet 3.0 Rev A updates Item 3 of 20 maxActiveInterval <= 0 means never expire - previously 0 meant expire immediately
https://issues.apache.org/bugzilla/show_bug.cgi?id=52405 Servlet 3.0 Rev A updates Item 2 of 20 javax.servlet.annotation.MultipartConfig.location may be relative and if it is, it is relatve to TEMPDIR
Fix possible NPE
https://issues.apache.org/bugzilla/show_bug.cgi?id=52405 Servlet 3.0 Rev A updates Item 5 of 20 Tighter control of web.xml elements (name, ordering, absolute-ordering)
Add note about "Organize Imports" setting in Eclipse IDE
Apply "Organize Imports" to fix imports order that did not pass checkstyle validation
Add some debug that might explain why Gump runs are failing
Fix Javadoc warnings
Get tests working with Ant as well as IDEs
Make fields final
Remove unused constructor
Make read-only fields final
Add Eclipse generated equals() and hashCode() methods Required for BZ52405 fix
https://issues.apache.org/bugzilla/show_bug.cgi?id=52405 Servlet 3.0 Rev A updates Item 12 of 20 Identical resources in fragments are retained
https://issues.apache.org/bugzilla/show_bug.cgi?id=52405 Servlet 3.0 Rev A updates Item 13 of 20 Injection targets are now always merged
https://issues.apache.org/bugzilla/show_bug.cgi?id=52405 Servlet 3.0 Rev A updates Item 20 of 20 Ensure underlying collections are immutable
s/2011/2012/g 
Correct error in r1158426 "return true" was originally "continue" that would have continued the for loop and was, in fact, unnecessary since it was at the end of the loop.
Add sample configuration for SetCharacterEncodingFilter to the default web.xml
Remove some unnecessary code that may be a cause of fd leaks
Use port in JMX name if known.
Bind connectors to localhost for unit tests Improve format of JMX names that include an address Update unit tests so they pass with the above changes
Mark unused code as deprecated Based on the UCDector report
Removed deprecated and unused code
Add final where necessary. Remove some unused code.
Change TestCometProcessor#testCometConnectorStop() to test whether END event was processed by servlet and write other information as a log message. The old test was not 100% reliable and fails for me with APR. It needs more investigation.
Re-enable TestCometProcessor test. It reverts r1225632
Deprecate unused code
Remove unused code
Use final
Followup to Mark's r1228724 The ObjectName.quote() must always be called with address, because ip6 addresses have characters that are must be quoted in QName. The Connector.java changes in r1228724 bypassed that call. Update TestRegistration.java accordingly.
Update TestAsyncContextImpl: Always add a host-level AccessLogValve, so that the test logic does not need to change when the tests are run with "test.accesslog=true". The test is about error 500 for unhandled request. That access log entry is written into topmost AccessLogValve.
Further improve Fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=52237 Make "usefile" flag of junit formatter configurable as well. The default value is "true".
Remove some stale MBean attribute descriptions: - compilerClasspath - eventProvider - mappingObject - randomFile - randomFileCurrent - saveConfig - staticResources - statisticsProvider  Add is="true" to useContextClassLoader.  Remove attribute mapping from "randomFile" to "randomfile" in Connector. 
Add output of MBean details to TestRegistration in case unexpected MBeans were found. 
Reduce code duplication introduced in r1229536: Use common MBeanDumper class for JMXProxyServlet and Mean unit tests. 
Whitespace and Javadoc fixes. No functional change.
First pass at a fix for BZ 52328
Additional flush required.
Add a BufferedWriter to the Converter
Improve logging
Align spelling of message key
Add test case
BZ52450 Add setter for EntityResolver
Improve test case
Remove trailing spaces. 
Update to Eclipse JDT 3.7.1
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52440 Need to resolve EL variables when returning ValueReferences Includes a new test case.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52245 Don't allow webapps to package javax.el classes
Add some finals prompted by the UCDectector
Fix comment
Logger will not implement Lifecycle. This was a leftover from the pre-JULI logger implementation.
Move destruction of ContainerBase objects to ContainerBase to ensure that they are destroyed.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52443 Move the default Realm for the embedded case to the Engine
Add the new NullRealm
Switch to use the new NullRealm by default
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52445 Do not assume method expressions have exactly three elements Includes a test case
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52461 Don't assume file based URLs when checking last modified times for global and host level web.xml files Patch provided by violetagg
Improve rat-excludes pattern to cover subdirectories in documentation build.
svn:eol-style=native for file added in r1230955
Next attempt with rat-excludes. The ** pattern is not understood. I had to list folders explicitly.
Add missing license header for file added in r1204203
Add missing license headers
Exclude several md5 files.
Update rat-excludes to exclude manifest files.
Fix failing APR unit test since connectors were switched to bind to localhost for tests
Add non-SSO test cases for BASIC and non-Login authenticators Patch provided by Brian Burch
Fix unused code warnings
In TestNonLoginAndBasicAuthenticator: Reduce visibility of methods that are not called from outside. Fix javadoc formatting.
Add several other manifests paths to rat-excludes.txt
When building a Windows installer do not copy whole "res" folder to output/dist, but only the files that we need. I have noticed those unneeded files (manifest templates, checkstyle configuration etc.) when reviewing RAT report prepared by ASF Buildbot.
When building a Windows installer apply fixcrlf only after all files has been copied.  The difference is what line ends the INSTALLLICENSE and tomcat.nsi files will have. Some NSIS docs [1] mention that license file must have CRLF line ends.  [1] "4.8.1.26 LicenseData" in Scripting Reference, http://nsis.sourceforge.net/Docs/Chapter4.html#4.8.1.26
Remove Javadoc for removed method. (Fixes javadoc compiler warning) Fix Javadoc formatting. (Thought there is still more to fix there).
Remove res/License.rtf The file that is actually shown by the Windows installer in res/INSTALLLICENSE. We do not need two license files here.  The MUI_PAGE_LICENSE macro in tomcat.nsi file actually creates its own LicenseData statement, though not a global one but scoped to PageEx directive. The global LicenseData statement is not needed, because we have no other license pages besides the one created by this macro.  For reference - see: 1) ${base.path}/nsis-2.46/Contrib/Modern UI 2/Pages/License.nsh -> MUI_PAGE_LICENSE macro source code (line 50) 2) LicenseData + PageEx example in NSIS documentation, "4.5.2 Page Options" http://nsis.sourceforge.net/Docs/Chapter4.html#4.5.2 "4.5.6 PageEx" http://nsis.sourceforge.net/Docs/Chapter4.html#4.5.6
Update svn:ignore: - add Netbeans project folder "nbproject" - sort entries - ignore .* instead of individual files for   modules/jdbc-pool like in the main directory 
Add Netbeans project folder nbproject to .gitignore. 
Fix wrong TC deps version in eclipse path. 
Log full stack trace when there is an error - may provide more clues as to what is going on.
Ensure that connections from unlockAccept() do not get passed to a processor. Reduce differences between BIO, NIO and APR acceptor code.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=38216 Add the ability to invoke MBean operations through the JMXProxy Based on a patch by Christopher Hlubek Also improved error reporting to help debugging.
Fix typo
Fix svn:eol-style for three recent source files. 
Review comments from kkolinko
Automate OpenPGP signature generation for release process.
Make generation of OpenPGP signatures dependent on definition of valid GPG binary.
Build handling of "target" directories: - do no longer exclude from copying to dist/src - Add comment to .gitignore why we do not ignore "target"  Those directories are in use in test/webapp-3.0-virtual-library and test/webapp-3.0-virtual-webapp. 
Fix generation of OpenPGP signatures
Correct spelling of StandardHost's attribute copyXML
Improve BUILDING.txt. Especially: 1. Reformat the document. 2. Document creation of "build.properties" as an explicit step before building. 3. Document enabling GPG when doing a release. 4. Document enabling Checkstyle. 5. Document running the tests.
Correct typo
Correct typo in documentation
Add package-list files to rat-excludes.txt
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52480 When converting class path entries from URLs to files/directories, ensure that any URL encoded characters are converted. Fixes JSP compilation with javac when Tomcat is installed at a path that includes spaces.
Replace tab characters and remove trailing whitespaces in jdbc-pool, as advised by Checkstyle
Correct license header, as advised by Checkstyle
jdbc-pool: Applied "Organize imports" command to classes where imports order problems were reported by Checkstyle.  It reordered imports as necessary and removed one unneeded import (imported class is in the same package as the source).
Fix order of field modifiers, as suggested by Checkstyle s/final static/static final/  Now Checkstyle checks for jdbc-pool pass successfully.
Enable checkstyle checks for jdbc-pool
Provide easy access to the two most frequently used Charsets
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51408 Don't use Charset.defaultCharset(). Use ISO-8859-1 charset explicitly.
Update change log
Take advantage of newly exposed Charset constants
s/exipre/expire/g
Temporarily add a command to build.xml to fix tomcat-trunk-validate failures at Gump. I'll remove it tomorrow. Correct typo in the changelog.
Revert r1233428. The issue with tomcat-trunk-validate at Gump is fixed - it did run successfully.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52474 Ensure leading and trailing white space is removed from lister class names extracted from TLD files.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=38216 Better handling when MBean ops return null. Patch by kkolinko
Add SSO test. Patch provided by Brian Burch.
Remove deprecated code
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52511 Don't log an exception just because WEB-INF/classes does not exist
Revert change used for testing
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52515 Note that DIGEST auth requires MD5 digests
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52543 Provide a meaningful error message when writing more response headers than permitted
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52547 Ensure byteCount is reset at the end of a HTTP 1.0 request
Re-ordering. Align recycle() and nextRequest()
Refactor to reduce duplicate code
Restore some previously removed code that is required for fixing BZ52444. Need to be able to determine if a class is an annotation without loading the class.
No need to load class to determine if it is an annotation.
UCDetector. Add finals where appropriate
Deprecate unused/unnecessary code
Remove deprecated code
Deprecate code that is going to be removed
Remove deprecated code
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52444 Remove need to load classes unless they actually match an HandlesTypes entry
Deprecate
Removed unused code. Add final where appropriate.
Deprecate
Remove unused code. Use final where appropriate.
Remove deprecated code
Deprecate unused code
Removed unused code
Remove excessive whitespace
Use final where appropriate
Use final
Remove unused BCEL code
Use final
Remove MutableInteger that was unused since r1086203 removed the once place where it was read.
Mark deprecated method as deprecated
Remove deprecated method
Deprecated unused classes
Remove unused code
Remove references to MbeansDescriptorsDynamicMBeanSource that was removed in r415811
Deprecate unused code
Remove unused code
Deprecate unused code
Remove unused code
Deprecate unused code
Remove unused code
Reduce visibility
Use final. Reference array classes directly
Avoid NPE if class / interface is not present
Initial web socket implementation with example. See code for TODOs.
Fix eol style (still can't figure out why this doesn;t get picked up by git)
Refactor to remove the circular dependency between o.a.catalina and o.a.naming
Remove the deprecated code
Fix eol style again
Prep to remove a circular dependency
Remove deprecated code
Use interface rather than internal implementation
Remove dependency on StandardContext from WebappLoader
Deprecate unnecessary code that references StandardContext
Remove deprecated code
Remove deprecated Embedded class and the references to it
Deprecate unused constants
Remove deprecated code
Start to hook up unused constants
Fix CI build
Hook up a few more constants
Plumb in the remaining constants
Remove code that was added for handling the embedded case.
Deprecated code that is no longer used.
Remove deprecated methods.
Remove deprecated method
Add the plumbing to make a canonical CATALINA_BASE File available via every Container.
Start to pull out the various custom methods to obtain CATALINA_BASE and replace them with a call to the Container.
Obtain CATALINA_BASE in consistent way (though Container). Note: still some direct access to system property to review.
Couple more container based locations. Really need to move setting this to the server.
Extend clean-up to Server
Deprecate unused methods.
Remove unused code.
Remove dependency on Bootstrap
Remove duplicated code
Align the various parts of start-up code that read/set home/base in slightly different ways.
Update changelog
Add the all important '!' missed in r1239082
Remove unused code
Correct typo that broke nearly all the tests
Added support to the JMXProxyServlet for fetching a specific key from a CompositeData value. Added documentation for the entire 'get' command for the JMXProxyServlet, including the new optional 'key' parameter.  
New interface to remove dependency between valve and session packages
Review comments on r1239522 from kkolinko
Fix eol
Deprecate unused code
Remove unused code
Use final
Refactor to remove some circular dependencies
Deprecate
REmove deprecated code
Refactor to remove circular dependencies
Deprecate code to be removed
Remove deprecated code
More refactoring to remove some cyclic dependencies
Deprecate method that will be removed
Remove deprecated methods
Deprecate unused methods
More deprecation
Remove deprecated code
Deprecate unused code
Remove unused code
Deprecate unused code
Remove deprecated code
Restoring updating / setting of home/base system properties after they have been processed in case other components depend on the updated values.
Replace specific createXxx() methods with generic createValve. Has several benefits: Automatically supports new Valves as they are added, provides support for all current valves, removes some circular dependencies.
Add new interface to indicate JMX support and start to use it
No need to use ContainerBase internally
Use new interface where appropriate
Update descriptor
Remove whitespace
Fix EOL
MIME types update: sync with Apache webserver mime.types file using res/scripts/check-mime.pl. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52587 Ensure that if it is necessary to fall back to the default NullRealm, the NullRealm instance is created early enough for it to be correctly initialised.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52577 Only reset the encoder information when the 'has getWriter()' been called flag is reset. Includes a simple test case
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52586 Remove hack that changes path info when forwarding to an error page
Remove a package dependency
Use interface where possible
Remove a package dependency
Remove deprecated code
Fix eol
Remove two more package dependencies
Remove some unnecessary casts
eol
Use the interface rather than the default implementation
Fix millisecond handling in AccessLogValve when used with a general SimpleDateFormat time pattern.  We called tidyFormat() but never used the tidied format. 
Add some missing overrides
Remove a package dependency
Remove deprecated code. Simplify.
Remove commented out code
Add the new ssl methods from tomcat-native ( and few poll methods that seemed to be missing ).  APR connector will not work unless you recompile tomcat-native ! ( it is ok to use the current version of  openssl, but npn methods will not work )  
Fix EOL
Remove whitespace from the ends of the lines
Use a lighter weight processor for upgrades. Note that extending the Http11 processors is a hack that I think can be removed with some further refactoring of the connectors.
eol
Refactor the connectors to allow lighter weight UpgradeProcessor implementations that do not depend on Http11Processors. The main change is the expansion of the Processor interface and the use of that interface rather than the AbstractProcessor.
eol
Fix some generics warnings
Provide a hook to check the origin. Based on a patch by Johno Crawford.
Restore method required for JSR 77.
Add missing call to handleThrowable
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52591 Skip attributes where getters throw UnsupportedOperationException
Fix catalinaBase property
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52606 Ensure replayed POST bodies are available when using AJP
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52607 The ExtensionValidator needs to be aware of the classes in the shared and common loaders.
Deprecated the StandardClassLoader since it is just a normal URLClassLoader
Remove StandardClassLoader
Remove patterns that match files that no longer exist
Remove dependency on ValveBase
Remove another ValveBase reference
Use interface rather than standard implementation
Fix Javadoc warnings
Remove JMX registration of removed StandardClassLoader (note no attributes or methods were exposed anyway).
Fix a couple of issues with the UserDataHelper 1. Packaging. It should have been packaged with juli-adapters.jar. The class has been moved so this is no longer an issue. 2. The wrong class/method was reported if the extras were used. The logging code has been pushed back to the caller. In return for a small amount of code duplication, the caller class/method will now always be correct.
Fix comment
BZ 52634: Typos in Examples.  Patch provided by Felix Schumacher. 
Fix line ends in the files.  This is technical commit to recover from eoln brokeness from commits via svn-git intergration. See thread on dev@. This commit should not change anything besides the line ends.
Fix threading issue in initialization of standard authenticator list
BZ 52641: Remove mentioning of ldap.jar  JNDI and the LDAP service provider are documented to be part of JSE since 1.3. No need to document additional installation.  Patch provided by Felix Schumacher. 
Another antique: remove mentioning of Java 1.2 and installing jndi.jar. 
Fix for  https://issues.apache.org/bugzilla/show_bug.cgi?id=51582   
Fix validation errors and an Eclipse warning.= Add missing AL2 header
Implement check for correct end-of-line characters in the source files. I plan to add it as a separate task in Gump. Running it on Windows currently shows 11 problem files.
Update to Commons Daemon 1.0.9
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52666 Correct coercion order in EL for A {==,!=,eq,ne} B
Fix refactoring snafu
UCDetector warnings
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52669 Correct regression introduced by the invalid assumptions made in the hack for Eclipse to address  https://issues.apache.org/bugzilla/show_bug.cgi?id=51741
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52671 Log NPEs for attributes that are not set at debug.
Set svn:eol-style=native on 5 files, as detected by validate-eoln target run on Gump
Change svn:eol-style from LF to native
Set svn:eol-style=native on 10 files, as detected by validate-eoln target run on Windows
Implement sub-protocol selection
Rename
Slightly improve example
Skip debug call if debugging is not enabled.
Review of r1244737
Fix byte[] -> long conversion Extracted from a larger patch by Petr Praus, Jonathan Drake & Slvka
Add a unit test
Move the frame header processing into the WsInputStream since the fragmented frame processing will required header processing at this level.
Implement fragmentation support. Unfragmented messages still work correctly. Still trying to figure out how to test fragmented messages.
svn:eol-style=native
Simplify validate-eoln target so that it is independent of the compile target and can be run before compilation.
Expand the test case to cover called sendError() in the same thread and a separate thread.
Simple WebSocket test client that demonstrates that fragmentation support is working. There is lots of scope for refactoring this test client for reuse. The client makes lots of assumptions and does the bare minimum required to talk to the WebSocket Echo example.
Fix problem observed running Autobahn WebSocket test suite. If an error occurs, an UpgradeProcessor could be added to the HttpProcessor pool leading to the failure of the subsequent request.
Improve handling of larger messages
Buffers should be ready when passed in. App should call flip() as required. Need to support output of larger frames for message API.
Fix the other place where an UpgradeProcessor could end up in the processor cache
Process mask as unsigned int. Based on ideas in a larger patch by Petr Praus, Jonathan Drake & Slvka
Add close message support.
Remove the debug code I was using to figure out why the unmasking was going wrong.
Ping/pong support
Fix up logic Make behaviour clearer.
Ensure control frames are not fragmented
Mask is per fragment so track position against mask per fragment. Remove some completed TODOs.
Modify rsv handling and complain if it is non-zero (will need to handle non-zero values for extensions).
Remove unnecessary method. Better handling of unknown opcode.
Restore a TODO
Fix test case failure. flip Byte/Char buffers in the right places. Rename method since it ma be writing a binary or text message.
Reduce visibility
Add a hook to allow handling NPN extensions in the apr protocol ( the extension is not available in java ). I think this is the smallest change to allow plugging in spdy.  
First part of spdy support - the low-level protocol and a protocol implementation.   
Document that VirtualWebappLoader#virtualClasspath trims spaces from the values. Use this feature to make documentation examples more readable.
Explicitly ignore empty tokens in the value of VirtualWebappLoader#virtualClasspath
Fix nesting of <p> and <ul> elements. Wrap long line.
Split long lines
Review of r1291507 Fix one issue and add some comments to clarify why some odd looking things are indeed safe.
Further review of r1291507. Pass WsInputStream instead of InputStream and use actual payload lengths.
Check for unexpected EOS. Close the connection if one is seen.
Reduce visibility
Fix trailing whitespace and import order
Add missing license header
Keep checkstyle happy w.r.t. spdy
Fix silly error
Refactor
Refactor
Handle ping frames in the middle of fragmented messages
Tighten up UTF-8 handling
Add decompress support and the npn handler.   Assuming you compile the right jni library it should (basicaly) work with chrome and firefox. Lots of missing features: async/comet/websocket, recycle of various objects, etc.  
Handle close and pong control frames inside fragmented message.
Length not end
Improve the Javadoc
Formatting
More docs. Clean-up. Make some methods final.
Javadoc, whitespace, add final
More javadoc and cleanup
More javadoc
Trailing whitespace
Keep checkstyle happy
Fix BZ52750. Correctly parse command options Port of r1292878 from 7.0.x
Fix typo and make the file executable like resto of the .sh scripts
Review comments on r1292776 from kkolinko
Hooray for Apache Harmony. Copy Harmony's UTF-8 decoder, add the additional restriction expected by the WebSocket spec and start passing all the UTF-8 releated tests.
Validate any close payload is UTF-8
Fix NPE in tests
Doh
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52758 Implement additional method added to JDT interface but not yet released
Add eol config
New UTF-8 decoder fixed this
Use a StringManger for exception messages etc. for i18n support
Implement read(byte[],int,int) to improve performance. Store mask as a byte[] since that is how ost traffic will be processed.
Add the ability to write byte[] when using upgrade
svn:eol-style=native
svn:eol-style=native
Bring builtin mime types more in line with the ones defined in our default web.xml.  I have only made the existing builtin types consistent, not added new types. Note that the list in web.xml is several hundred types longer but I don't think it makes sense to define all of them as builtin. 
BZ 52760: Fix expires filter mime type in javascript examples.  We use the official mime type application/javascript instead of text/javascript in the respnse headers. 
Fix web socket for APR/native (actually a generic upgrade issue)
Refactor to reduce duplication
Add UTF-8 test case
Fix NIO upgrade single byte read
Don't read/write more data than the internal buffers can handle
Remove completed TODO
Re-factor to get NIO closer to working and with an eye on switching to non-blocking (where supported by the endpoint).
Get NIO working using blocking IO
svn:eol-style=native
Remove unnecessary comment post refactoring. Fix new lines.
Update the upgrade API to support non-blocking reads. Neither NIO nor APR implements them yet.
Better name for methods
Support non-blocking IO for WebSockets (between messages) if the endpoint supports it.
Add non-blocking support for APR.
Make the outbound buffer sizes configurable
Remove unnecessary check - all paths to this method already perform the check
Make writing thread safe
Use constants for close code and fix various typos. Patch provided by Johno Crawford.
Fix a TODO
Explicit handling for end of stream. Based on review input from kkolinko
Allow the examples to configure the buffer on the fly 
Remove trailing whitespace
Comment out AutoBahn required buffer increase by default
https://issues.apache.org/bugzilla/show_bug.cgi?id=52804 Implement useful interfaces for storing and copying the properties 
Fix WebSocket's non blocking call http://tomcat.markmail.org/thread/drj7zgq2csfdnvoh#query:+page:1+mid:y4dheqpm2wx5xzba+state:results  
Fix access to poller registration 
Remove unused imports
No need for an upgrade specific poll method. Delete some more code :)
Improve web front-end for the WebSocket examples. Patch provided by Johno Crawford.
Use simpler tomcat-native distribution which comes with 1.1.23+
Catch downloaded dist
Implement notification of open and close for WebSocket connections. Patch provided by Johno Crawford.
Ensure we try and send a close message on an IOE as well as triggering onClose()
Improve base test to return response body on an error response.
Improve comment
Further fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=51197 Allow the ErrorReportValve to write a response body if sendError() is called during an async request if it is being handled on a container thread. As per SRV 10.9.2, if an error occurs during an async request on an application thread, writing the response body - if any - is entirely an application responsibility.
Simplify
Fix some test failures now response bodies are available for error responses.
Fix an intermittent unit test failure. Runs fine in Eclipse but fails on the command line.
Fix remaining failing unit tests now error pages are available.
Code clean-up. Add some finally blocks to close resources. Not really necessary since JVM is shutting down. BZ 52724.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52725 Use constant rather than hard-coded package name since package name is meant to be configurable.
Add a multi-player snake example for WebSocket. Patch provide by Johno Crawford.
Code clean-up promoted by the UCDetector.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52726 Clean-up. Avoid unlikely fd leak.
https://issues.apache.org/bugzilla/show_bug.cgi?id=52727 Code clean-up
Code clean-up prompted by the UCDetector.
https://issues.apache.org/bugzilla/show_bug.cgi?id=52729 Even if the end event fails, try and perform the close.
Fix collision bug (steering into your own snake now kills the snake) Patch provided by Johno Crawford
Code clean-up prompted by the UCDetector.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52731 Clean-up code. Fixes potential resource leak although the problems that would trigger the leak are far more serious than the leak.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52732 Clean-up code. Fixes potential resource leak although the problems that would trigger the leak are far more serious than the leak.
BZ 52842: Exception in MBeanDumper.  StandardThreadExecutor attribute prestartminSpareThread uses "is". Fix MBean descriptor. 
Another StandardThreadExecutor attribute with "is" getter. Fix MBean descriptor. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52846.
Fix line-endings
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52767 Remoev reference to MySQL specific autoReconnect property
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52770 Fixes very rarely (if ever) used infinite timeouts on write
Code clean-up prompted by the UCDetector.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52772 Re-order checks for uriRoot validity and ensure that all the checks are completed before it is used.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52792 More informative error message when something in JNDI can't be found.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52719 Correct theoretical resource leak during Jar validation
Replicate Principal in ClusterSingleSignOn.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52500 Added configurable mechanism to retrieve user names from X509 client certificates. Based on a patch provided by Michael Furman.
Fixed eol-style.
Fixed two javadoc complaints.
Fix various Checkstyle / Eclipse warnings and failures
Fix the brackets
Add test case for BZ 52830
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52830 Align parseName(Name) with parseName(String) so both have the same behaviour
Use final where suggested by the UCDetector
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52776 Refactor the code so JspFragment.invoke cleans up after itself. Patch provided by Karl von Randow.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52850 Enable the memoey leak protection code to play nicely with IBM JVMs as well as Oracle JVMs. Extend test case coverage of memory leak protection. Patch provided by Rohit Kelapure.
Fix eol
Use final where suggested by the UCDectector
Filter an issue we can live with. Add comment to code explaining why.
Fix checkstyle warnings I missed earlier
Use final where suggested by the UCDectector
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52723 Clean-up
UCDetector. - use final where appropriate - deprecate unused code
Delete deprecated and unused code.
Based on AprEndpoint, an implmentation of non-blocking SSL sockets which is thread safe for read/write. It can be used for both client and server mode sockets, and it's independent of the rest of tomcat.  It is in a separate package because it's a bit higher level than the raw jni interfaces. Many settings are missing ( could be added if needed - most are related to setup, but they are not used in tomcat  spdy implementation ).  
Update the spdy implementation to use the non-blocking apr socket.  Fix various bugs found while stress testing.  
Code clean-up: - one missing license header - lots of trailing whitespace - some unused imports - an unnecessary cast - some unnecessary code  Still need to fix the import checks
Exclude Eclipse files if jdbc-pool has been opened in Eclipse as a separate module 
Update import control for latest spdy changes
Fix more Eclipse warnings: - generics - @Override - unnecessary casts - unnecessary code - static field access
Add an HTTP header parser. The driver for this was an attempt to fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52811  Parsing HTTP headers as per RFC2616 is not always as simple as it first appears. For headers that only use tokens the simple approach will normally be sufficient. However, for the other headers, while simple code meets 99.9% of cases, there are often some edge cases that make things far more complicated.  The purpose of this parser is to let the parser worry about the edge cases. It provides strict parsing of HTTP header values assuming that wrapped header lines have already been unwrapped. (The Tomcat header processing code does the unwrapping.)  The parser currently supports parsing of the following HTTP header values as per RFC 2616:  - Content-Type  Support for additional headers will be provided as required. A quick scan of the Tomcat code base suggested a couple of places where using this parser may be useful such as  Ranges in the default servlet but there was not - at this point - a compelling case for immediate replacement. The expectation is that as problems are identified in header parsing, the fix will typically extend this parser to support the problematic header and then use the parser rather than custom code.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52811 Make use of the newly added HttpParser to correctly process Content-Type headers As well as the problem identified in the bug report, this fixes a couple of related issues: - setting the content type via (set|add)Header bypassed some checks - avoids parsing the content-type header multiple times 
Fix spdy stream closing / removing from channels Fix/simplify draining. Use the java6 compression by default - not only avoids jzlib depenency, but it's also 20..30% faster. Refactor creation of sockets to allow Jetty-style java7 NPN.  
svn:eol-style=native
Update to JDT 3.7.2
Fix Javadoc warnings
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52858 Fix high CPU load caused by tight(ish) loop when client doesn't read any data
Document WebSocket support
Link to WebSocket doc
Implement chat example Plus some minor clean-up. Patch provided by Johno Crawford
Remove direct mailto: links to dev@. Rephrase full-docs reference.
Add missed file
Corrections
Correct some svn keyword placeholders
Revert r1302359. Problem was broken svn client at my end.
Explicitly remove children (Wrappers) so that they are unregistered from JMX.
Create some test support classes required by the memory leak tests that have to be outside of the org.apache.catalina package so they they are not treated as container servlets and loaded by the common class loader rather than the webapp class loader.
Refactor the ThreadLocal leak tests: - Use the supporting classes from the new package where they were copied to so they weren't treated as container Servlets - Ensure the supporting classes are loaded by the web application class loader - Break the direct and indirect leak tests into separate tests - Ensure JRE memory leaks do not interfere with the results of the test - Use a logging filter to ensure error messages are logged for the ThreadLocal leaks - Remove pointless sleep code - Add assertions to check a) a leak occurs and b) it is logged
Make implementation of getParentClassLoader() consistent with the other implementations across the code base.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52926 Protect against a NPE if the socket has been closed on another thread
easily readable, dont line break on paranthesis
fix bug https://issues.apache.org/bugzilla/show_bug.cgi?id=51237 align implementation with the documentation
https://issues.apache.org/bugzilla/show_bug.cgi?id=52002 add in ability to configure pool so that connections can not be reused
https://issues.apache.org/bugzilla/show_bug.cgi?id=52327
https://issues.apache.org/bugzilla/show_bug.cgi?id=52493 Add java7 support
tabs to spaces
https://issues.apache.org/bugzilla/show_bug.cgi?id=52654
https://issues.apache.org/bugzilla/show_bug.cgi?id=51893 add notification that the pool has been exhausted
https://issues.apache.org/bugzilla/show_bug.cgi?id=52518
https://issues.apache.org/bugzilla/show_bug.cgi?id=50860 add option to log validation errors
svn:eol-style = native
update documentation with new attributes 
svn:eol-style = native
Fix checkstyle issues with trailing spaces and imports formatting.
Deprecate ELResolverImpl since it supports the deprecated EL implementation Move the default EL resolver to the ELContextImpl so the deprecated code depends on undeprecated code rather than the other way around. Fixes a handful of deprecation warnings
Remove deprecated code
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52839 New unit test for DigestAuthenticator and SingleSignOn Patch provided by Brian Burch
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52953 When using DIGEST auth, digests are always represented using lower case hex characters
Some CI test failures show a cluster with 20 members when there should be 10. It looks like duplicates but those should be caught. Add some additional logging to try and figure out what is going on. 
First stab at keeping concurrent runs of the tribes unit tests from interfering.
Review of r1303587 by kkolinko. Ensure domain is set before channels are started.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52957 Ensure Valve implements Lifecycle before calling Lifecycle methods
Replace two examples links in ROOT/index.jsp with one. This is to make WebSocket examples more visible.
Still process events when closing to ensure that Comet connections that are in use when the poller is stopped are sent an end event.
Only try to stop children that are currently started. Prevents error messages appearing in logs.
Observed strange NPE while running tests. This isn't much more than a guess at what might have caused it.
In "echo" websocket example: Treat the text typed by user and echoed by server as plain text instead of HTML, effectively safe-guarding it.  Just noting that "chat" example is different and safe-guards at the server side.
Remove unused code after upgrade was refactored
kkolinko review of r1304011: Always close selector Additionally, ensure that an exception during the close does not prevent the poller loop from ending
Remove unused code after upgrade was refactored
kkolinko review of r1300154 Correctly parse quoted-pair 'charset' parameter name should be case insensitive
https://issues.apache.org/bugzilla/show_bug.cgi?id=52830#c6 Alternative implementation of the fix, which does not require that name were an instance of CompositeName.  (I am not sure that this change is worth it, but I think it is better this way).
Cleaner (kkolinko review)
Add test case for bug 52970. Need to apply coercion rules to method invocation
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52970 Take account of coercion rules when invoking methods
Correct test since null should be coerced to "" not "null"
Review of r1301269 1. Restore *.dll pattern. (Why was it changed? Both variants do work). 2. Let's reference the LICENSE file instead of VERSIONS one. It should always be there. I am not sure where VERSIONS file comes from, as I do not see how it is generated in tc-native 1.1.x sources. 
Fix warning
Account for known missing properties 
https://issues.apache.org/bugzilla/show_bug.cgi?id=52002 Improvements to the pool - the default should be that multi thread close should not affect the connection isValid should return false if a connection has been closed  
https://issues.apache.org/bugzilla/show_bug.cgi?id=52002 Documentation change to reflect the new default value 
simplify logic, less comparisons on each call 
https://issues.apache.org/bugzilla/show_bug.cgi?id=52066 Add in a configuration attribute to allow a thread interrupt state to be retained for the calling library to see  
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52833 Fix NPE in some embedded / osgi scenarios where the class loader my not have the system class loader as a parent.
Fix unused import
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52974 Fix NameNotFoundException when field/method is annotated with @Resource annotation Patch provided by Violet Agg. 
Whitespace police
Add support for multi-thread deployment in UserConfig.
Per http://markmail.org/message/nhfcvvyvvhtzvaxq Since the method that gets interrupted does something like         if (Thread.interrupted())             throw new InterruptedException(); The flag is actually cleared by the method itself. If we wish to propagate the interrupt we have to set the flag again   
When using automatic ports, include the port number in the name used in logging if we know it.
Fix intermittent JMX deregistration test failure.
Tweak the test so it can easily be run multiple times in a row without failing.
Add a hook for JIO, NIO, APR that allows SSL connections to negotiate an alternative protocol, if the SSL layer supports it. Updates/fixes/cleanups to the spdy implementation.  
Build the tomcat-jni and tomcat-spdy as separate jars, so they can be used independently.   Add a dependency to an apache-license optional interface to support TLS NPN on Java7.  If no objections I'll add the classes that use it.   
Per http://tomcat.markmail.org/thread/j7jk7xalhs7t7op7 Threads in the connection pool should not be created using the context loader, but rather the loader that loaded the pool  
Fix imports/licence.  
svn:eol-style = native
Whitespace / import police
Import / @Override police
Unnecessary code
@Override police
Fix a hanging test with APR. Connections using HTTP keep-alive were not closed on Endpoint.stop() so a stop() start() sequence meant they were kept open with any data sent being ignored until the connection timed out.
Return the port rather than always throwing an exception
Line length Remove unnecessary exception declaration Remove @author tag
Disable some warnings we can't do anything about
Fix a handful of Eclipse warnings
Re: r1306716 - Fix wrong download location of npn-boot.jar - Fix broken build.xml, as noted by Checkstyle.  I think whether we should use npn-boot.jar has to be discussed separately. I am just fixing a broken build.
Fix npn location, make it optional  
Space police...  
Refactoring. Move classname discovery into separate helper method.
Revert r758664 and the fix for bug 46915 since the bug is invalid since the EL specification requires the behaviour that bug objects to.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53001 Add a test case
Add new JARs to Maven build. Review dependencies and add a few new ones as well as some missing ones.
Remove static references to ExpressionFactory. These should be per web application.
Remainder of fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=52998 Cache ExpressionFactory class per class loader (kkolinko)
Followup to https://issues.apache.org/bugzilla/show_bug.cgi?id=51741 Remove wrong call. The tests pass for me with this call being removed. If allowLinking feature is really needed, it should be configured explicitly.
Add new attributes of enabled and disabled to UserConfig.
Change of an attribute name. enabled and disabled are changed into allow and deny. 
Correct websocket protocol detection
Fix whitespace
Don't use static imports
Revert 1310541 that removed static imports
Fix checkstyle complaints
Fix warning
Fix typo
Fix style
Fix potential bottleneck on accepting new WebSocket connections
Send header with uppercase names
Whitespace police
Followup to r1310392 Remove changelog entry for change that was ported to 7.0.x in r1310506
Fix comment
fix unit tests 
https://issues.apache.org/bugzilla/show_bug.cgi?id=50864 Add in the ability to configure most pool properties even while the pool is running 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53056 Add APR version number to tcnative version INFO log message
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53057 Add OpenSSL version number to INFO log message when initializing
Avoid NPE when reload if a state of a BackupManager is FAILED.
use StringManager.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53087. In order to avoid that a backup node expire a session, replicate session access time in BackupManager.
fix typo. objectMadePrimay was change to objectMadePrimary.
Reduce indent 8->4. No functional change. I thought I was looking at an inner class.
Save a bit of memory in annotations cache in DefaultInstanceManager occupied by unused entries in annotation lists.  I could do the same by calling ArrayList.trimToSize(), preserving the Lists abstraction, but 1). That involves the same array copying operation as toArray() call that I am using, 2). I do not see any benefits from using List here, as the only operation with annotations list after it has been created is iterating over it.  Thus I preferred to replace lists with explicit arrays.
Apply Konstantin's suggestion. "if (diff && (isDirty || complete))" block was executed regardless of the value of "complete".
For https://issues.apache.org/bugzilla/show_bug.cgi?id=53085 Implement ConcurrentHashMap with weak keys.
Make sure complete message takes priority over access message.
BZ 53158: Fix documented defaults for DBCP. Patch provided by ph.dezanneau at gmail.com. 
https://issues.apache.org/bugzilla/show_bug.cgi?id=53173 Properly handle count down of maxConnections latch when entering edge cases.  
Removing obsolete bug warning.  Jira says "fixed in commons daemon 1.0.2", which happended long ago. Hope that's right ... 
Fix trivial docs typo (missing ")"). 
Modify the default pollerThreadCount as processors go, it gets very polluting and resource wasting to have 24,48 or 64 and more poller threads Very hard for applications to see a performance benefit of more than 2 pollers  
Whitespace police
Use a proper URL else attempts to external entities will fail.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52055 Ensure input filters are recycled when the request is recycled for all connectors.
Make sure ContextMBean#findFilterDefs returns correct filter definitions. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52853 Clarify how JarScanner handles directories.
Deprecate unused code
Remove deprecated code
When a connection is disconnected, make sure we reset the cached values. This can happen during a failed validation when reconnect() is called.  
Fix typo
It appears that pausing requests for a Context during reload was relying on the mapper not being cleaned up correctly. The Lifecycle refactoring cleaned up the mapper registrations and broke the handling of paused requests. This commit restores that functionality and extends it. The key changes are: - Contexts are no longer from the mapper if they are stopped while they are paused - The CoyoteAdapter pauses for 1s if a request is mapped to a paused Context and then tries to re-map it. This replaces the reloading handling in the StandardContextValve - The reload handling has been removed from the StandardContextValve - Editing a watched resource now triggers a reload (that pauses requests received during the reload) rather than a stop/start which will return 404s for requests received while the context is stopping and starting  As with previous iterations of this feature it is impossible to completely eliminate the chances of a 404 without a fair amount of locking that would slow things down unnecessarily in production.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53034 Add project.url and project.licenses setions to all the POMs
Ensure maxParameterCount applies to multi-part requests handled via Servlet 3.0 upload
Add public method to retrieve the current connectionCount from an endpoint.  It will also show up in the ThreadPool MBean. 
https://issues.apache.org/bugzilla/show_bug.cgi?id=53061#c5 Fix a problem whereby if the poller was under low but consistent load (>1 request/per second and always less than 1s between requests) timeouts never took place. After the change, timeouts will be processed every X seconds where pollerTimeout <= X <= (timoutInterval + pollerTimeout + time taken to process timeouts) Note the default values for pollerTimeout and timeoutInterval are 1000ms
Fixed documentation for maxInactiveInterval: default is 30 minutes, not 60 seconds.
Fixed typo.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53062 Normalize redirect URLs constructed from relative paths
Add missing file from r1336864
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53063 When using an Executor with BIO, use the executor's maxThreads as the default for maxConnections
Correct typo in a link (followup to r1336889)
In TestCometProcessor: add diagnostic message that reports whether END event has ever been received.
Clarify the effect of maxActiveSessions attribute of a Manager.
https://issues.apache.org/bugzilla/show_bug.cgi?id=53203 Correct documentation of default value of connectionTimeout for AJP protocol. See org.apache.coyote.ajp.Constants.DEFAULT_CONNECTION_TIMEOUT  I am not sure though whether -1 is actually infinite and not some other (JVM? OS?) default. The timeout is implemented in Endpoint, and thus the implementation is shared with HTTP protocol, and HTTP connectors documentation already says that -1 means infinite. So it is likely that it is indeed "infinite".
Followup to r1336516 Add Javadoc (as asked by sebb) and avoid looking up a volatile field twice
Further clarify the value
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53067 Make sure request is unwrapped before we cast it to the internal Tomcat implementation
kkolinko review of r1337643
Fix several trivial HTML markup errors in example servlets e.g. duplicate <body> tag preceding <head> one.
Simplify code and correct HTML markup
Pass all string values through the filter in RequestInfoExample servlet.
Doh. Pass correct URL to encodeURL() call and safeguard it later.
Correct links to Java documentation Those are at docs.oracle.com now.
Correct links to Java documentation Those are at docs.oracle.com now.
Correct links to Java documentation Those are at docs.oracle.com now.
Correct one JavaSE documentation link
Add in ability to purge the pool https://issues.apache.org/bugzilla/show_bug.cgi?id=53254  
https://issues.apache.org/bugzilla/show_bug.cgi?id=52858 https://issues.apache.org/bugzilla/show_bug.cgi?id=53138 Fix broken NIO sendfile download Fix high CPU usage due to registered OP_READ for sendfile processes  
Fix unused imports to make checkstyle happy.
Enable host's xmlBase attribute in ContextConfig.
Add the new per socket timeout method to the Java API and increase the minimum version so that it is available.
Simplify the poller by using the new per socket timeout to differentiate between connection and keepalive timeouts without using two pollers.
Followup for r1340215 Move new log message below unreg() call and align it with similar debug messages, fixing a couple of typos.
Simplify. The "req" argument in processSendfile() is always true,  and it is no more used since r1340215
Fix documentation of default value of "xmlBase" attribute of Host.  The place where it is already documented correctly is Host.getXmlBase() and Host.setXmlBase(). The actual default value is calculated in HostConfig.configBase()
Correct typo
Documentation improvements: Add Table of Contents. Amend documentation of jdbcInterceptors attribute, especially that extra whitepaces are ignored. Use this feature to wrap long values. Lessen indent of code samples to reduce width of the document. Fix documentation of username and password attributes, mentioning alternateUsernameAllowed feature. Fix method name typo in InterruptedException handling example.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53289 Clarify ResourceLink example that uses getConnection(username, password)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53074 Make WebSocket connections use infinite read timeouts by default.
Further fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=52055. Ensure ChunkedInputFilter is correctly recycled.
BZ53034. Improve POM license info
Correct LICENSE: jsp_2_2.xsd uses CDDL 1.0 NOTICE: reorder file names to be closer to alphabetic order.
Correct license name and version
Add CDDL to INSTALLLICENSE file
fix for Konstantin's review. Add new calculation method of host's default config path to Host(StanderdHost).
Fix unused import identified by Checkstyle
Correct broken HTML in Javadoc comment. <engine> -> &lt;engine&gt;
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53090 Include superclasses when considering injection targets Patch provided by Borislav Kapukaranov
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53161 Better error message if a ClassFormatException is encountered during annotation scanning and do not fail to start the web app in that case.
Update BCEL fork to latest version from Commons (no changes required - just updates mergeinfo)
Fix typo
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53081 Do not always cache resources loaded by the web application class loader
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53180 Add additional checks when looking for a setter method. Patch provided by Violeta Georgieva.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53267 Stop the JreMemoryLeakPreventionListener triggering a full GC every hour
Followup to r1343718: tabs -> spaces.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53322 Follow JavaBeans specification when converting setter method name into property name for resource injection.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53119 Make sure the buffer is cleared on any error to prevent any possible overflow if it is written to again before the connection is closed. I can't reproduce the error with the provided test case but based on code inspection this should fix it.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53169 Allow servlets to opt to avoid chunked encoding with a response of unknown length by setting the Connection: close header. Based on a patch suggested by Philippe Marschall.
Organize imports to pass Checkstyle.
Note that Remote Host Valve|Filter needs enableLookups being enabled on a Connector.
Additional JARs to skip for annotations, initializers etc.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53225 Fix ISE "zip file closed" when urlCacheProtection="false" in the JreMemoryLeakPreventionListener
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53115 Allow "catalina.bat run" to work even if %TEMP% contains spaces. Note that - It affects "run" command only. For all other commands that code is skipped, thanks to [if not ""%1"" == ""run""] jump. - Single doublequotes are already used in "%TEMP%\%~nx0.run". The %TEMP% value cannot be quoted.
Add some tests inspired by BZ53257 that confirm that the ServletContext correctly handles getResource() calls for resources that used ';', '+', '&', and '#' in the file name
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53257 BZ 53257 is partially a regression caused by r1152593 (the fix for BZ 51584) and partially an existing issue that had always been present. This patch: - reverts r1152593 - extends the test cases to cover BZ 53257 & BZ 51584 - correctly fixes BZ 53257 & BZ 51584 - fixes the additional issues the unit tests uncovered
Add files missed in r1344890
Additional change should have been in r1344890
Additional fix missing from r1344890
Fix checkstyle warnings in Ant build
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53342 To avoid BindException, make startStopThreads into a demon thread.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53285 Modify how the digester processes security-role-ref since link is optional and null parameters are not handled by IntrospectionUtils
Remove unnecessary code
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53301 Prevent double initialisation of servlets when using existing servlet instances with embedded Tomcat
Remove trailing whitespace
One more test, to be sure https://issues.apache.org/bugzilla/show_bug.cgi?id=53257
Another missed file
Update exclude rules for RAT report
entries Map->Set since only the key was ever used
For https://issues.apache.org/bugzilla/show_bug.cgi?id=53257 Review of r1344902: Restore passing DirContextURLStreamHandler instance into the new URL.  Note that we use "new DirContextURLStreamHandler(DirContext)" and thus the handler will not need to call DirContextURLStreamHandler#get() to retrieve the context.
Refactor some duplicate code into an new utility class with an eye to the proposed patch for BZ 53333
Correct a typo
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53333 Validate JNDI resource types against injection target types and use target types when no type is specified for the resource. Based on a patch by Violeta Georgieva.
Opps. Undo rename used to check all calls to method had been removed.
Remove deprecated code
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53337 Fix RequestDispatcher.forward() to an async servlet
Fix typo
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53008 Extend test cases for BASIC auth and RFC2617 compliance
Refactor - no functional change
More refactoring - no functional change
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53339 Ensure WebSocket event calls are made using the web application's class loader. Includes a test case.
Add quotes that were missed - tests still pass
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53353 Make the HTTP header parser for ContentType tolerant of invalid parameters with names but no values. The invalid parameters are available in the collection of output nodes but skipped by the various toString() methods.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53353 Additional fix
Review of r1345737: Correct copy-pasted comments to match the method that is actually called there.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53354 Don't add empty filter mappings to the set of mappings - they'll fail validation
Code formatting (indents). No functional change.
Rework fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=53333
For https://issues.apache.org/bugzilla/show_bug.cgi?id=53119 Port r1344253 to AjpNioProcessor  Prevent possible overflow exception with buffer in AjpNioProcessor.output() if it is called again after the previous write failed with IOException.  This is based on review of the issue fixed by r1344253. I see several reasons why it is hard to observe in Nio, but it is easy to prevent this issue. An overflow exception is bad because it is RuntimeException and is generally unexpected. This change: - avoids writing to the buffer if att == null - always clears the buffer. Note that Buffer.clear() method is rather lightweight one.
Review r1345367. Rename new public API method added in r1345367 so that the name were less ambiguous.
Test for method CharChunk.indexOf() that was added in r1336870. The test passes successfully.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53356 Add support for an explicit mapping of a servlet to the context root
Fix eol
Review of r1298986 (r1298983) Update comments Update for one field name variant used by Apache Harmony. Maybe it will be relevant one day. Do not test Method and Field handles for null, as NoSuch(Method|Field)Exception is thrown instead of null value
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53356 Additional fix. Correct context & servlet paths
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53230 Changed exception type thrown when session manager exceeds active session limit.
Remove unused file
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53032 Modify JspC to extend o.a.tools.ant.Task so it works with name spaces The main change is that execute() no longer throws JasperException so it matches the signature for Task.execute(). This required a small change to main()
Clean-up: avoid NPE and immediate catch when init parameter does not exist. Also do not assign default value unless necessary.
https://issues.apache.org/bugzilla/show_bug.cgi?id=53367 Avoid pool hanging when database fails  
Add support for SecureRandom to cluster manager template.
Remove trailing whitespace, as nagged by Checkstyle.
https://issues.apache.org/bugzilla/show_bug.cgi?id=48097#c7 https://issues.apache.org/bugzilla/show_bug.cgi?id=53366#c1 If _jspService() cannot properly handle an exception because _jspx_page_context initialization failed, write it to the logs instead of silent swallowing.
Fix (hopefully) persistent failure of Comet unit test for connector stop when the END event is not received
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53366 New http header parser needs to be pre-loaded when running under a security manager
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53368 Make WebSocket play nicely with a security manager (kkolinko)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53373 Trim whitespace from around <Context> aliases delimiters (,=) to improve readability of many aliases.
Simplified test case for BaseDirContext.setAliases
Whitespace and curly-brace police.
Review of r1347108. Better cleanup if the test fails: schedule temporary directory for after-test cleanup immediately, instead of after successful test run. close output streams even if write fails.
For https://issues.apache.org/bugzilla/show_bug.cgi?id=53057 Better wording for OpenSSL version number message that was added in r1312006. This is because OpenSSL version number includes name of the library.  Sample message: Old: OpenSSL OpenSSL 1.0.0g 18 Jan 2012 successfully initialized New: OpenSSL successfully initialized (OpenSSL 1.0.0g 18 Jan 2012)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53374 Fix support for the following properties in DataSourceFactory: commitOnReturn rollbackOnReturn useDisposableConnectionFacade logValidationErrors propagateInterruptState  I compared fields in PoolProperties and properties processed by DataSourceFactory, and these 5 recently added ones were missing. Based on patch proposed by Suresh Avadhanula.
Documentation for property maxQueueSize that was added in r723889
Add dependencies and description to "validate" target in build.xml, so that it can be run separately. Improve documentation for running with Checkstyle. Add documentation for ends of lines check ("validate-eoln").
Review of r1345026, comparing it with proposed patch for BZ 52955: Add final modifiers to improve thread safety
Rephrase instructions for installing Tomcat. Improve description of environment variables. Mention CATALINA_OPTS.
Further improvement of RUNNING.txt. Mention CATALINA_PID, as it is another frequently used environment variable.
Further improvement of RUNNING.txt. Address Mark's review comments. Document Apache Tomcat Native and Apache Commons Daemon.
Review by native English speaker as requested. Mostly a/the changes and inserts Re-worded a few sentences that didn't scan cleanly Removed the section on Win 95/98/ME since they are all well past end of life.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53047 If the Realm is configured for an authentication only all roles mode and no role table or column is defined, don't populate the Principal's roles
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53071 Add a test case that confirms this issue does not occur in trunk
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53071 Stepping through the code, light dawns as to what the bug report was getting at. Use the message from the Throwable for the error report if none was specified via sendError()
Throwable.getMessage() might be null
Fix logic
Javadoc fixes
Additional Comet tests to confirm / deny the behaviour claimed in https://issues.apache.org/bugzilla/show_bug.cgi?id=53391 The bug report is incorrect
APR 1.1.24 is now required. Remove unnecessary code.
Revert accidental commit of local change
Update APR SSLProtocol defaults and configuration
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53398 recieved->received
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53266 Handle missing classes defined in @HandlesTypes more gracefully - the specification requires it should not stop the web application from loading
Deprecate pointless constant
Remove unused code
Remove unused code (FindBugs)
Refactoring has been completed in fix for BZ 48870
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52999 Remove synchronization bottleneck in container event handling
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52954 Be tolerant of slightly broken Android implementation of DIGEST auth. Security is not impacted.
Review of r1349300: Make ReadWriteLock fields final (the new one and an old private one as well).
Review of Context.getApplicationLifecycleListeners() calls: Do less work if there are no listeners or 'notify' flag is false. I do not expect much effect from this change, because implementation of Context.getApplicationLifecycleListeners() in StandardContext is lightweight: it returns a field value. Note that by default it returns an empty array, not null.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50182 Various improvements to the compression filter example. Patch by David Becker
Drop info
For https://issues.apache.org/bugzilla/show_bug.cgi?id=50182 Review of r1349477: use more simple code when converting a list of mime types into array and ignore empty strings.
Remove unused code
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53403 Correct specification version reference to include new specification versions
Update APR/native connector version
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53406 Fix possible stack overflow on connection close when using Comet (fhanik)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53173 Remove some duplicate calls to countDownConnection() While the connector is running, destroySocket() will call countDownConnection() Once the connector is stopped, the latch is removed so it does not matter that destroySocket() does not call countDownConnection() in that case
Add explanatory comment
Add some notes as I start to look at the 8.0.x refactorings
Another re-factoring to consider
Tweak ideas
Refactor to remove o.a.c -> o.a.c.util dependency
Remove some deprecation markers as the methods will remain on StandardContext
Remove deprecated code and o.a.c -> o.a.c.util dependency
Improve InternalNioInputBuffer#parseHeaders() Move the code and s/end/pos/
Implement maxHeaderCount attribute on Connector. It is equivalent of LimitRequestFields directive of Apache HTTPD
A testcase.
Simplify Maven publishing - Use Nexus throughout - Remove now unused scp related sections - Prompt for passwords rather than reading them from a file  Update version for Tomcat 8
Fix checking recommended tcnative version. 
Correct typos
Fix the WebSocket examples so the work with secure as well as non-secure connections.
tabs -> spaces, as reminded by Checkstyle
Correct reference to Apache Batik project It now lives in xmlgraphics.apache.org.
Properly close input streams in TestNamingContext.  This error was noticeable when running the test on Windows, because after-test cleanup (LoggingBaseTest.deleteOnTearDown) could not remove the files created by this testcase.
Exclude intermediate parser files
Exclude files from the source dist that are : - copied within the source tree during the build - IDE artifacts
Manifest files are text files.
Exclude manifest files from checkstyle
Fix Checkstyle exclusion pattern for MNIFEST file of jdbc-pool module. The file does not pass validation because of trailing space characters on two lines, which are required by manifest file format.
Change formatting of the Realm configuration reference. <h3> -> <subsection>, so that they are listed in Table of contents.
Replace brackets with a dash in titles, aligning with listeners.xml This improves readability of TOC (see r1200937).
For https://issues.apache.org/bugzilla/show_bug.cgi?id=50306 Improve StuckThreadDetectionValve: - Add getStuckThreadNames() method, callable through JMX - Add thread ids to the log messages  I also removed the @author tag, as that is against our policies.
For https://issues.apache.org/bugzilla/show_bug.cgi?id=50306 Followup to r1351991: Update Spanish LocalStrings file as well.
Correct description of UserDatabaseRealm
getURI() and getURL() do exactly the same thing. Further the encoded parameter of getURL() does not effect the output. Deprecate getURL() and use getURI() instead.
Remove deprecated code.
Better comment
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53450 Correct regression in fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=52999 that was likely to cause a deadlock when deploying a ROOT web application.
Fix typo
As per clarification from Servlet EG, version declared in web.xml does not control annotation scanning. I don't like it but the EG was very clear this was the intended behaviour.
metadata-complete does not control the processing of ServletContainerInitializers
Correct typo in a message
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53421 Provide more useful error message when bean property getter/setter cannot be found.
Revert r1346635 Restore deleted file
Align jmx/jmxaccessor.tasks and jmx/antlib.xml. Some tasks were missing from jmxaccessor.tasks even though they were documented in monitoring.html.  Align catalina.tasks and antlib.xml. Some tasks were missing from antlib.xml jkstatus task had a different name. I think jkupdate is a better name for it. (Neither one of jk* tasks is documented, and mod_jk has a different set of Ant tasks with it).  Correct typos in documentation.
Remove Ant task "jasper2".  catalina.tasks in Tomcat 5.5 defines only "jasper2" catalina.tasks in Tomcat 6 and later define both "jasper" and "jasper2" as synonyms. I think we can remove this old task name in Tomcat 8.
Remove jdbc-pool items from Tomcat 8 changelog. Those are already included with Tomcat 7.0.27.
Move changelog for r1353242 to different section.
s/taskdef/typedef/ in catalina-tasks.xml  1. For Catalina/Jasper tasks, the taskdef is no longer needed, as JspC now explicitly implements Task (BZ 53032) and so does not need a TaskAdapter, and all other tasks implement Task.  2. For JMX tasks using typedef here allows to load  jmxEquals and jmxCondition conditions from "jmxaccessor.tasks" file and remove explicit definitions from catalina-tasks.xml.
Remove jkstatus task in favor of jkupdate. Neither one is documented.
Update changelog
Revert most of changes in ant/antlib.xml per user's comment on dev@. http://markmail.org/message/izcghp5z6hv3dp6j
Deprecate unused code
Remove unused code
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53430 Fix problems with missing / wrong version of APR/native library when APR connector is explicitly configured. Protocol now declares if it needs the library and the connector ensures it is available if required.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53456 Minor fixes to the HTTP docs. Patch provided by sebb.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53459 Fix SSLVerifyClient option in APR SSL example and further clarify how to modify server.xml based on the desired connector implementation.
In preparation for next servlet revision Align with the servlet specification signatures as they are defined by the spec itself. These do not represent any functional changes Most of these are just ordering of methods, others are runtime exception that are defined differently in the method signatures  As an fyi, the easiest way to compare signatures between two libraries is to use javap and diff on the output, that's how I found these changes, verified them against the javadoc and implemented into tomcat   
Align protocol values with the surrounding text
Add in stub methods from servlet draft per  http://java.net/projects/servlet-spec/lists/jsr340-experts/archive/2012-06/message/9 Note this may change at which point we will change it accordingly  
Add missing classes 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53464 Correct file location (it was moved from Commons Daemon to bin/)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53445 by allowing  a) override the getObjectName method of the SlowQueryReportJmx class  b) specify the objectName=xxx attribute in the configuration  
Whitespace police
Add in test and examples to compile with 3.1 additions  
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53460 There are two parts to this fix: - don't swallow exceptions when the PageContext can't be created - if the PageContext is null when an error occurs (and therefore can't be used to handle the error) propagate the exception wrapped in a ServletException and let the container handle it. Note: This is the version of the fix for back-porting to 7.0.x. There is some obvious but API changing clean-up that can simplify this in trunk.
Simplify.
Revert r1354200. As much as I'd like to be able to unilaterally change the JSP API, I can't.
Clean up
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53465 Populate mapped-name property for resources defined in web.xml Based on a patch by Violeta Georgieva
Add file missed in r1354255
Add some finals
Make the request available when the WebSocket connection is being created
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53416 Make sure we retain the domain if the registration comes from Tomcat 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53467 Use more explicit URI constructor to ensure components are correctly encoded.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53473 Correct documentation and web.xml comments for SSI isVirtualWebappRelative option since the allowed values are true or false
Correct typos in recent commits
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53454 Return correct content-length header for HEAD requests when value is > 2GB
Servlet 3.1 - setContentLengthLong
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53454 Additional ways content length may be set
Remove fhanik's @author tags from new files added in r1354166. We should not use @author.
Add another method found in spec 
Remove unnecessary special case handling for 200 since we now only check status error pages is sendError has been used.
With more and more use of RFC 2307 http://tools.ietf.org/html/rfc2307 There is a new way to search for roles using the memberUid that can contain the value of another attribute within the users directory entry.  This may not be very specific to 2307, but that is where I see this combination of role searches occur the most.  Example: http://www.openldap.org/lists/openldap-technical/200904/msg00024.html    
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52135 Implement support for a default error page. It appears that this was meant to be in the 3.0 spec but got left out in error.
Set svn:eol-style = native
Provide more specific command example for running the "validate" target
Review of r1355615 Correct obvious typos Remove trailing whitespace as reminded by checkstyle
s/Catalina/Tomcat/ and several typos
Document roleNested property in JNDIRealm configuration reference. Better document its effect on roleSearch pattern. Rephrase descriptions of userRoleAttribute (was added in r1355615).
Fix typo
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45995 Align Tomcat with Apache httpd and perform MIME type mapping based on file extension in a case insensitive manner.
Remove unused code
Override annotations
Automatically delete temporary files created by Servlet 3.0 file upload when request is recycled.
Allow servlets to specify async support as annotation when added programatically 
With async and non block unit tests we need a way to stream data up to the client, byte streamer offers an easy way to do that 
Fix NPE triggered by r1356852
remove line not needed 
Fix where body can be null 
both timeout and complete, as with all container callbacks must be invoked with the right context 
First revision of an example non blocking read operation. The servlet specification, and discussions on the expert group are quite contradictory. According to the specification request response object can only live during service() or  when an AsyncContext is present. but the NIO api is written with examples of bypassing both.  So for this iteration, we are working with the assumption that  NIO is only allowed during async operations, otherwise there is no point to NIO. This is because 'polling' was not allowed, so there is no point to have NIO when the thread is present  
rename OPEN to OPEN_READ since we have two different types of operations  
Added information about and links to Manager's JMXProxyServlet. 
Tweak the async state diagram: - add method names - re-arrange some of the lines for clarity - document the new state
Whitespace police
Remove unused imports. Fix import order.
o.a.coyote now depends on javax.servlet
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53505 Update JSTL version info
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53498 Fix atomicity bugs in use of concurrent collections. Based on a patch by Yu Lin.
Move Resources and Loader from Container to Context
Move Manager from Container to Context
Refactor Manager to retain reference to Context rather than Container
Switch from deprecated Manager.getContainer() to Manager.getContext()
Add recent refactoring to changelog
implement rev 1 of async/non blocking writes  
Change the default connector for Tomcat 8 
Add in the ability to catch non blocking read and write errors and propagate that to the servlet 
Add in test for write error  
Fix checkstyle errors
Java 7 throws an exception when a socket option cannot be set. Move option setting to before connection is completed since at least one option (traffic class) can not be set after the connection is completed.  For NioReceiver, I don't see a way to set traffic class on an accepted connection so simply remove it (it is ignored when using Java 6)
Note soTrafficClass is ignored for nio
Further testing shows that this has no affect for BIO for a socket returned via accept()
Cannot set traffic class on a socket returned from accept(). On Java 6 it is always ignored. On Java 7 BIO ignores it, NIO throws an Exception
Revert accidental deletion
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53513. Fix race condition between the processing of session sync message and transfer complete message.
Fix NPE observed running unit tests with APR on Linux
Improve Connector.stop() handling and APR. This particularly affects Comet where a unit test failure was seen on some Linux platforms.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53062 Correctly handle case where redirect URL includes a query string (with test cases)
fix doc according to https://issues.apache.org/bugzilla/show_bug.cgi?id=53523 
https://issues.apache.org/bugzilla/show_bug.cgi?id=53526 Use proper comparison of objects 
Added check of return value for docBase.mkdir. 
Handle fragments as well as query strings in normalisation of redirects
Add a test file unit test case. This test case fails with both NIO and BIO on Windows 7 with JDK 1.7  
remove unused imports 
Clarify documentation around send file 
Cleanup and better file naming 
correct the sentence. chunked will not work, as the length is fixed and not encoding is added during send file 
Add IPv4Stack flag one can control from build.properties and build.properties.default default value is false but can be overridden even from command line default compile source/target is 1.7, but has to be changed in build.properties.default to take into effect  
fix sentence 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53524 Fix typo
Fix spelling
Simplify (this class dates from pre-Java 1.4)
Fix a few Eclipse warnings
Get jdbc-pool tests compiling with Java 7
Fix import order
Fix some generics warnings
Fix a handful of Eclipse warnings
Fix more warnings  - More generics for npn  - Use final where appropriate
Remove unused code
Clean up debug logging
Configure Tomcat trunk to build with Java 7. This includes adding a patch to the Commons-DBCP code from res/dbcp  
removed debug statement 
Remove level check
Whitespace police
Code clean-up for javax.el  - Add final prompted by UCDetector  - Java 7 use of <>
Code clean-up for javax.servlet  - Add final prompted by UCDetector  - Java 7 use of <>
Update
More work
Deprecate so they can be made private
Code clean-up for o.a.catalina.ant.jmx  - Add final prompted by UCDetector  - Java 7 use of <>
Code clean-up for o.a.catalina.ant  - Add final prompted by UCDetector  - Java 7 use of <>
Code clean-up for o.a.catalina.authenticator  - Add final prompted by UCDetector  - Java 7 use of <>
Deprecate unused protected field
Remove unused code
Code clean-up for o.a.catalina.connector  - Add final prompted by UCDetector  - Java 7 use of <>
Deprecate
Fix Java 7 warnings
Correct handling of timeout - negative or zero means no timeout but an instant  
Code clean-up  - Add final prompted by UCDetector  - Java 7 use of <>
Fix timeout according to Javadoc 
brain farts today. Must get the value of the keycount key 
Code clean-up for o.a.catalina.core  - Add final prompted by UCDetector  - Java 7 use of <>
Deprecate unused setters
Fix a FindBugs warning (increment of volatile not atomic)
Filter out a false positive
Fix FindBugs issues (sync on mutated object)
Code clean-up for o.a.catalina.deploy  - Add final prompted by UCDetector  - Java 7 use of <>
Fix FindBugs warnings (Serializable classes with non-serializabe fields)
Fix Findbugs warnings. Sync only on setter. Use ReadWriteLock instead.
Progress update
Update list of HTTP status codes.  Current list taken from http://www.iana.org/assignments/http-status-codes/http-status-codes.xml.  Only change of existing entries is code 302 message text changed from "Moved Temporarily" to "Found" as per RFC 2616. 
Code clean-up for o.a.catalina.filters  - Add final prompted by UCDetector  - Java 7 use of <>
UCDetector clean-up  - Remove unused code  - Use final where appropriate
UCDetector clean-up  - Remove unused code  - Use final where appropriate
UCDetector clean-up  - Remove unused code  - Use final where appropriate
UCDetector clean-up  - Remove unused code  - Use final where appropriate
Add another false positive
FindBugs. Rename some methods to avoid confusion.
Code clean-up for o.a.catalina.ha.tcp  - Add final prompted by UCDetector  - Java 7 use of <>
UCDetector clean-up  - Remove unused code
UCDetector clean-up  - Remove unused code  - Use final where appropriate
Progress update
Code clean-up for o.a.catalina.loader  - Add final prompted by UCDetector  - Java 7 use of <>
Deprecated unused code (for porting to 7.0.x)
Remove unused code
FindBugs. Fix some possible NPEs.
Code clean-up for o.a.catalina.manager  - Add final prompted by UCDetector  - Java 7 use of <>
Deprecate unused code
Deprecate unused code
Remove unused code
Compare integers as integers not Dates.
Code clean-up for o.a.catalina.mbeans  - Add final prompted by UCDetector  - Java 7 use of <>
Deprecate unused code
Remove unused code
Code clean-up for o.a.catalina.realm  - Add final prompted by UCDetector  - Java 7 use of <>
Deprecate unused code Remove deprecation markers from JAASReam#setAppName
Remove deprecated code
Add getter/setter for roleSearchAsUser
Code clean-up for o.a.catalina.security  - Add final prompted by UCDetector  - Java 7 use of <>
Code clean-up for o.a.catalina.servlets  - Add final prompted by UCDetector  - Java 7 use of <>
Fix Find Bugs warnings - thread safety of data formatting
Code clean-up for o.a.catalina.session  - Add final prompted by UCDetector  - Java 7 use of <>
Clean-up: UCDetector
Clean-up: UCDetector
Clean-up: UCDetector
Code clean-up for o.a.catalina.ssi  - Add final prompted by UCDetector  - Java 7 use of <>
Remove redundant Japanese message texts.  Since they were all english they can be found in LocalString.properties.  Keep Japanese file because of the information contained in the comments. 
Revert r1361432: method is not unused. WebappLoader uses it via reflection.  Note: the spurious remove of svn:mergeinfo from jdbc doesn't harm, it was empty. 
Revert r1361430: the method can not be deprecated, because it is still used by WebappLoader via reflection. 
Add javadoc to clarify method use. 
Remove redundant output of error message from error report.  See: https://issues.apache.org/bugzilla/show_bug.cgi?id=53071#c9 
Code clean-up  - Java 7 use of <>
Deprecate unused / unnecessary code
Remove deprecated code
Code clean-up for o.a.catalina.startup  - Add final prompted by UCDetector  - Java 7 use of <>
Deprecate unused / unnecessary code
Remove deprecated code
FindBugs - Possible NPE Use consistent approach to exception handling and the creation of the FailedContext instance context cannot be null
Suppress incorrect warning
Add explanatory comment
More false positives
Update progress
Partial code clean-up for o.a.catalina.tribes  - Add final prompted by UCDetector  - Java 7 use of <>
Deprecate unused code
Remove unused code
Partial code clean-up for o.a.catalina.tribes  - Add final prompted by UCDetector  - Java 7 use of <>
Fingbugs: Fix possible NPE
Make utility method static and save a few object instances
Remove deprecated code
Fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=53529 Improve the handling of InterruptedException - Provide a specific message if thread was interrupted rather than the wait timing out - Remove unnecessary code - Remove unnecessary attemps to clear the interrupt flag
Fix (normally unused) DIGEST performance test. Failing to clear the cached principal meant that the DIGEST auth was only performed once per thread
No need to parse user name twice with different methods
Remove unnecessary code
Clean-up. Refactor to avoid unnecessary object creation when not using default constructor
Partial code clean-up for o.a.catalina.tribes  - Add final prompted by UCDetector  - Java 7 use of <>
Deprecate unused code
Remove unused code
Deprecate unused parameter
Remove deprecated code
Partial code clean-up for o.a.catalina.tribes  - Add final prompted by UCDetector  - Java 7 use of <>
Remove deprecated code
Simplify since minimum Java version is now >= 1.5
FindBugs: Fix potential NPE
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=53469 If the relative URL can't be made absolute, do not encode it and return it as is
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53535 Reduce memory footprint when performing class scanning on Context start. Patch provided by Cedomir Igaly
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53606 Fix possible NPE when sending pings between cluster nodes Based on a patch by F.Arnoud
Remove deprecated, unused code
Fix unused StringManager`. i18n for all log messages
Deprecate unused code
Remove unused code
Partial code clean-up for o.a.catalina.tribes  - Add final prompted by UCDetector  - Java 7 use of <>
Refactoring. Move Mapper. Preparation for further mapper related refactoring to follow.
Update progress
Move Mapper from Connector to Service removing potential duplication.
Avoid unlikely NPE
More progress
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53607. To avoid NPE, set TCP PING data to ChannelMessage.
https://issues.apache.org/bugzilla/show_bug.cgi?id=53649 fix compiler warnings
Implement equals/hashCode so that they survive connection closure  
cleanup 
Deprecate unused code
Remove unused code
Partial code clean-up for o.a.catalina.tribes  - Add final prompted by UCDetector  - Java 7 use of <>
Deprecate unused code
Remove unused code
Deprecate unused code
Remove unused code
FindBugs: Thread-safe update
Partial code clean-up for o.a.catalina.tribes  - Add final prompted by UCDetector  - Java 7 use of <>
Partial code clean-up for o.a.catalina.tribes  - Add final prompted by UCDetector  - Java 7 use of <>
Deprecate unused code
Remove unused code
Partial code clean-up for o.a.catalina.tribes  - Add final prompted by UCDetector  - Java 7 use of <>
i18n and fix unused StringManager instance
FindBugs: Ignore exceptions We are ignoring them and this is fine. Stop FindBugs complaining (a comment is sufficient)
FindBugs: Sync mis-match Reduce size of sync block and make current volatile so updates are seen consistently
Deprecate unused code
Remove unused code
Remove unused code
i18n and fix unused StringManager instance
Remove unused code
Partial code clean-up for o.a.catalina.tribes  - Add final prompted by UCDetector  - Java 7 use of <>
Another false positive
Partial code clean-up for o.a.catalina.tribes  - Add final prompted by UCDetector  - Java 7 use of <>
Partial code clean-up for o.a.catalina.tribes  - Add final prompted by UCDetector  - Java 7 use of <>
Deprecate unused code
Remove unused code
Code clean-up for o.a.catalina.users  - Add final prompted by UCDetector  - Java 7 use of <>
More Mapper clean-up. Remove the per Context Mappers
Progress update
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53584 Ignore path parameters when comparing URIs for FORM authentication. This prevents users being prompted twice for passwords when logging in when session IDs are being encoded as path parameters.
Updating JDK version. Add reference to OpenJDK
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53641 Correct name of HTTP header used in WebSocket handshake for listing the preferred protocols
Java 7 <> updates 
Code clean-up for o.a.catalina.util  - Add final prompted by UCDetector  - Java 7 use of <>
Version update
Deprecate DateTool since it is largely unused. Replacement to follow shortly.
Document the constants that were added to the RequestDispatcher interface in Tomcat 7. Mark them as "@since Servlet 3.0". 
Replace Hashtable with a HashMap. The maps are in static fields and do not change with time, so no synchronization is needed. Noted when reviewing r1370569
Remove DateTool
Replace specific class with an interface in declaration of a protected field. Noted when reviewing r1370569
Clarify comment
Only used by WebDAV. Deprecate the unused parts.
Remove unused / unnecessary code
Deprecate code that will be removed in 8.0.x
Remove unused code
Fix layout - no functional change
Deprecate code that will be removed in 8.0.x
Remove unused code
Deprecate code that will be removed in 8.0.x
Remove unused code
Remove "and later" part from JDK version in BUILDING.txt Describe the issue with Apache Commons DBCP.  Align HTML building instructions with TXT ones.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53481 Added support for SSL_OP_CIPHER_SERVER_PREFERENCE / SSLHonorCipherOrder.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53653 Allow for wrapped source code example in config/context.html
Code clean-up for o.a.catalina.valves  - Add final prompted by UCDetector  - Java 7 use of <>
Update progess
Tab police
ConnectionState must supported with short name too.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53541 Fix JAR scanning when WEB-INF/lib is provided via VirtualDirContext Patch provided by Philip Zuev
Need to reset content length as well to ensure custom error page is not truncated.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53545 Ensure buffered data is cleared when using a jsp:forward action to a static resource inside classic a custom tag
Rephrase. It is followup to my r1371017.
Adjust wording. Followup to r1371017.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53574 Ensure Servlets defined using jsp-file are available when metadata-complete is true.
Update comments after confirmation from EG
Set svn:eol-style=native
Additional fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=53071 Trim long exception messages
Java 7 changes
Add additional check on current behaviour to try and catch any regressions in the fix for 53623
Deprecate duplicated constants
Remove deprecated code
Additional fix for http://issues.apache.org/bugzilla/show_bug.cgi?id=53584 Store decoded and original request URI. Restore both. Use decoded for matching.
Fix indent
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53700 Remove unused code that also broke some Javadoc
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53701 Javadoc fixes provided by Sebb.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53623 Async dispatches require similar handling to RequestDispatcher.include() hence the implementation of async dispatch uses RequestDispatcher.include() However, since RequestDispatcher provides no API for differentiating between and INCLUDE and DISPATCH some form of trickery has to be used. The previous implementation worked in most cases but failed in some cases (multiple forwards prior to dispatch, wrapping the request). This alternative implementation calls a specific method on the RequestDispatcher implementation (we have to access the implementation class since we can't modify the servlet API) which removes any ambiguity and allows the correct handling in all cases.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53624 Remove some include specific code from dispatch, copied when the doDispatch() method was created. Note that this bug report pre-dates that copy. At the time of the bug report dispatch was implemented by calling include()
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53654 Support file:// URLs for JSP dependencies
Clean-up: final markers (UCDetector)
Clean-up l12n messages
Fix unused StringManager by using it.
Java 7 <>
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53702 <jsp-property-group> may contain multiple <url-pattern>
Always make the final webl.xml file available
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53697 Fix a regression in the fix for BZ 51881 that mean that in some circumstances the isComet flag was not reset on the HttpAprProcessor. This caused problems when the Processor was re-used for a new connection.
UCDectector  - Use unused constants where appropriate  - Deprecate unused code 
Remove unused code
UCDectector  - Deprecate unused code 
Remove unused code
UCDectector  - Deprecate unused code 
Remove unused code
Standardise
UCDectector  - Use of final 
UCDectector  - Deprecate unused code 
Remove unused code
Code clean-up  - Remove unnecessary warnings  - Java 7 <>  - UCDetector use of final
UCDectector  - Deprecate unused code 
Remove unused code
Code clean-up  - UCDetector use of final  - Reduce visibility
Code clean-up  - Java 7 <>  - UCDetector use of final  - Make use of unused fields where appropriate
Use the getter
Use the getter
UCDectector  - Use of final 
Code clean-up for o.a.el  - Remove unnecessary warnings  - Java 7 <>
Update progress
FindBugs: Fix unused code by implementing the TODO associated with it
Update progress
Code clean-up  - Java 7 <>  - UCDetector use of final
Deprecate debug code
Move debug util to test tree
Code clean-up  - Java 7 <>  - UCDetector use of final
Breakdown of resource handling issue. Maybe it is not the best place to write it here, but it is better to write it down somewhere.
Correct typo. I meant the WARs that have not been unpacked.
Use a LinkedHashSet to preserve ordering
Remove special handling when setting HTTP content-language header
Fix comment typo
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53714 Provide a means of excluding JARs from pluggability scans, TLD scans or all scans.
Add two files to the value of tomcat.util.scan.DefaultJarScanner.jarsToSkip property.  These are from OpenJDK 6 on Fedora Linux (java-1.6.0-openjdk-1.6.0.0-65.1.10.8) They are audio library PulseAudio and GNOME Java Access Bridge.
Mention the %{xxx}t pattern in AccessLogValve javadoc. Correct markup in valve.xml. (<ul> cannot be nested in <p>)
A little Java 7 / UCDetector clean-up
Simplify and silence a FindBugs report (Note: there would not have been a problem if an increment has been lost)
Java 7 <>
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53725 Fix corruption in some GZIP'd content
Fix typos etc. in code that prints "merged" web.xml  jsp-property-group elements were printed in the wrong order, so that XML validation against schema was failing for the merged web.xml of "examples" webapp.
For https://issues.apache.org/bugzilla/show_bug.cgi?id=53047 Update documentation. Thanks to the changes introduced by implementing BZ 53047, the roleNameCol and userRoleTable attributes in JDBCRealm and DataSourceRealm became optional ones.
Code clean-up  - Java 7 <>  - UCDetector use of final  - suppress invalid warning
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53737 Access JSP configuration information via the ServletContext rather than re-parsing web.xml
Remove unused class
Remove unused dump() method
Java 7 <>
Remove unused attributes
Remove unused dump() method
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51661 Merge updates from Commons BCEL that provide the limited Java 7 support required for Tomcat's cut-down BCEL fork.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53758 Fix Dynamic Filter Registration mapping logic inverted
Revert r1377512
Revert r1377509
don't hard code values, no need to https://issues.apache.org/bugzilla/show_bug.cgi?id=53267 
Per http://markmail.org/message/nqnogctvfuyzhtol  1. Already encountered two users that would like to set this value. There is never any need to hard code any value, regardless of its use  2. This turns it into a property on the listener   
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53783 Handle case where tool generating JARs does not generate entries for directories.
Digest improvements: - disable caching of authenticated user in session by default - track server rather than client nonces - better handling of stale nonce values
Add a MD5 digest method as it is the most commonly used.
Take advantage of new ConcurrentMessageDigest
Java 7 <>
Take advantage of new ConcurrentMessageDigest
Followup to r1377689 1. Cleanup removed property from systemprops.xml  2. Do not reference inaccessible class in Javadoc (With my setting of JRE="Execution environment JavaSE-1.7", Eclipse complained about this in red). 3. Perform boxing explicitly. 
Clean-up - Fix FindBugs NPE warnings - Java 7 <> - Remove static imports (auto completes are easier without them) 
Better handling of exception
Improve concurrency of DIGEST auth
document the new property 
Remove unneeded handling of FORM auth in RealmBase.  The login and error pages are handled via forward, so processing completes before this code is ever reached. The action page is handled elsewhere.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42181 Better handling of edge conditions in chunk header processing.
Update for new default
Remove fixed issue.
Trailing whitespace police
Alphabetical order
revert change. vetoed per http://tomcat.markmail.org/thread/6hmjgrzys5txekew 
remove as part of previous commit. 
No need to restore the URI or the query string. This has already been done when constructing the redirect that got us here in the first place.
Clean up for test tree - mainly Java 7 <> - fix remaining Eclipse warnings  FindBugs still TODO
Correct Javadoc for code added in r423453 (s/after trailer mark/before trailer mark/, and do not say 'trailer' as in the spec the term "trailer" has other meaning)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53793 Change webapp links in Manager to point to /appname/ instead of /appname
Remove FlushableGZIPOutputStream. The bugs it works around are fixed in Java 7 and Tomcat 8 requires Java 7.
Remove exclusions for files that were removed in r1378371
Follow up to r1372390. Since decoded URI is used for matching, make sure it is set for the landing page.
Resolve a FIXME and expand unit tests to cover CRLF vs LF checking.
Add some tests for Bug 53792
Refactor to silence some FindBugs warnings
Re-organise to silence some FindBugs warnings
Re-organise to silence some FindBugs warnings
Clean up - Java 7 <> - UCDetector
Re-organise to silence some FindBugs warnings
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53800 FileDirContext.list() did not provide correct paths for subdirectories. Patch provided by Kevin Wooten.
No need to return a boolean here
No need to return a boolean here
More chunked encoding improvements - Expand unit tests for chunked encoding - Fix a parsing error at eol when multiple headers are present (regression in r1378699) - Make parsing of terminating CRLF non-tolerant (RFC2616 only suggests to be tolerant of LF at the end of headers) - Revert previous unnecessary change to SimpleHttpClient
Implement fall-back for checking for failure when socket is closed before client can read response. Fixes intermittent issue on Windows.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53792 Support method expressions that include a method call that is not at the end of the expression
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53677 Ensure a 500 response of the HTTP headers exceed the size limit
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53801 Overlapping URL patterns were sometimes merged incorrectly in security constraints leading to incorrect 401 responses. Note: it was possible for access to be denied when it should have been granted but it was not possible for access to be granted when it should have been denied.
Javadoc fixes
Remove commented out code from a previous attempt to fix BZ53677
Yet another attempt to fix Comet test failures for Connector stop. If the endpoint is stopped - don't add sockets to the poller (it may have been stopped already) and process the STOP event directly. If the connector stop has completed then the executor may be null so protect against NPEs and log when a socket couldn't be processed.
Remove unnecessary method calls. The Resolvers manage this flag.
Remove completed FIXME
DeltaManager extends LifecycleMBeanBase so it registers itself
ClusterSingleSignOn extends LifecycleMBeanBase so it registers itself
Switch SimpleTcpCluster to JMX registration via LifecycleMBeanBase and add JMX support to the FarmWarDeployer. Deprecate the now unused cluster JMX helper.
Remove unused code
Revert r1379590, the property resolved flag does need to be reset for the resolvers to operate correctly.
Add a missing reset of the property resolved flag
Make Cluster member information available via JMX Restructure cluster MBean names to better group MBeans in JConsole UI.
Remove unnecessary section on java 1.4
Document additional MBeans
Clean-up - Java 7 <>
Clean-up - Java 7 <>
Clean-up - Java 7 <>
Clean-up - Java 7 <> - remove unnecessary warnings
Clean-up - Java 7 <>
Clean-up - Java 7 <> - unused code - autoboxing
Clean-up - fix false positive NPE warnings by removing redundant tests and suppressing remaining warnings
Clean-up - fix false positive NPE warnings by removing redundant code and suppressing remaining warning
reader can't be null here
Suppress some false positives
Clean-up - Java 7 <>
MBean definition of Mapper is moved to o.a.c.mapper from o.a.c.connector. 
Delete undefined operation element. 
Additional fix for r1380066. Add support for expose static members.
Add one library from JDK 7 to the value of jarsToSkip  access-bridge.jar is from 32-bit JDK 7u7 on Windows
Correct typos in cluster MBeans descriptions
Clean-up - UCDetector use of final
Clean-up: FindBugs warnings - use of Arrays.toString()
Remove unused code
Clean-up - UCDetector use of final
Clean-up  - fix indentation  - silence a handful of fairly pointless FindBugs warnings
Fix unused parameter warning. No functional change but does result in better comments in .java file created from JSP.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53828 Use the correct status code
Re-order. Do cheaper tests first. Makes small improvement to background thread processing time when lots of WARs are deployed.
Mapper MBean has moved
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53713 Performance improvement (up to four times faster parsing) for JSP processing. Patch provided by Sheldon Shao.
No functional change: a bit of clean-up before adding a new feature.
Added multi-op modes to JMXProxyServlet.
whitespace police
Clean-up Java 7 <>
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53843 request.isAsyncStarted() must continue to return true until the dispatch/complete actually happens (which at the earliest isn't until the thread where startAsync() was called returns to the container).
Clarify difference between tag and version in Manager app.
Re-order to match comments
Fix indent (4 spaces)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52777 Implement optional automatic removal of old applications where parallel deployment has been used.
Review comments from kkolinko
Simplify
Clean-up  - final markers from UCDetector  - refactor constructors to permit use of final
Make sessions in the session Store visible via the Manager web application if showProxySessions is enabled
Take account of clusters and persistent session managers when checking if all sessions have expired.
Clean-up Java 7 <>
Clean-up remove unnecessary code
Remove unnecessary throws declarations and a few catch blocks that are no longer required.
Clean-up - autoboxing
Clean-up: Remove unused code
Partial revert of r1383935. Some of this code is required. A closer review is required.
Remove unused code
Findbugs fixes to o.a.catalina
Remove unused toString() methods
Follow the trail of unused code identified by Eclipse and remove it.
Revert r1384055 & r1384051. While toString() isn't used, stringifyValue() is.
Remove unused toString() method along with utility method it accessed that was using a deprecated API.
Fix FindBugs warning - Tomcat doesn't need to Searilize this class
Clean-up: UCDetector - use of final
Code clean-up:  - Java 7 <>  - UCdetector - use of final
Clean-up: UCDetector - use of final
Start to expand the diagnostic information available from the Manager web application
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53863 Ensure implicit Servlets (JSP, default) are marked as override-able when using embedded mode.
Remove unnecessary properties
Code clean-up - suppress a FindBugs warning - suppress an Eclipse warning - add 'final' as prompted by the UCDetector
Fix a behavior of TcpPingInterceptor#useThread. If set to false, ping thread is never started. 
Code clean-up - add 'final' as prompted by the UCDetector
The "running" flag is moved out of "if" block. 
Correct fix for BZ 53843 that triggered a TCK failure
When the DefaultServlet is under high load, parsing the content-type header generates significant garbage and takes noticeable time. Add a simple cache to address these issues.
Minor performance tweak
Reduce GC when NIO connector is under load. Results in a small performance improvement. KeyReferences and finalizer references were accounting for 30%+ of the heap during my load tests before this patch.
Remove unnecessary wrap with ByteBuffer. Contributes ~4% of the garbage generated with a simple ab load test.
Use CharBuffer rather than StringBuilder to build the access log message to: - save a char[] to String conversion and the associated garbage - allow buffers to be recycled also saving garbage Reduces allocations due to the AccessLog from 43% to 27% of the overall allocations
More GC reduction in the AccessLog. Integer.toString(response.getStatus()) was responsible for ~4% of allocated objects under load
Remove unused code
A toLowerCase() on the provided encoding was responsible for ~8% of all allocated objects with a simple ab load test.
Review from rjung
Partially revert 1389023 after review from kkolinko
ConcurrentLinkedQueue is currently the biggest contributor to garbage in the load test so this is intended as a replacement.
Switch to ConcurrentStack removing 17% of object allocation during load test
Correct comment
Expand functionality of ConcurrentStack and then switch to ConcurrentStack removing ~25% of the remaining object allocation during load test. No noticeable performance hit.
Revert accidental commit. This may return later - it is part of an attempt to reduce object allocation when obtaining remote IP addresses - currently running at ~20% of the total allocation during my load testing.
Rename as per kkolinko's review
Switch to ConcurrentStack removing 4% of object allocation during load test (low hanging fruit)
Clean-up - UCDetector
Some more low(ish) hanging fruit from the allocation hit list. This accounts for ~8% due to the way Thread stores names.
Better solution to multiple calls to Thread.getName() - ThreadLocal is cleaner - ConcurrentWeakHashMap wasn't concurrent (as per kkolinko's review)
Creating the map entries for the special request attributes was generating ~11% of the garbage in the load test. Re-factor so these entries are not created.
Move the cache for the attributes listed below from the Processor to the SocketWrapper as they are fixed for the lifetime of the socket and the Processor gets recycled on every request - remote address - remote host name - remote port - local address - local host name - local port  This reduces object allocation during my load test by ~30% (the allocations were triggered by the AccessLogValve logging the remote IP)
Better comment
Additional name changes
Lower thread count by default
A slightly different alternative to ConcurrentLinkedQueue. This one is also largely GC free and has similar performance to the Stack version.
Switch to SynchronizedQueue for the event queues Switch to SynchronizedStack for the Processor cache These changes together reduce object allocation during my load test by ~22% compared to prior to these changes
No need to create runnable and wake up the selector if it isn't going to do anything.
Deprecate unnecessary code
Remove deprecated code
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53854 Get directory listings working with aliases
Fix a warning
Fix Javadoc errors
Fix Javadoc warnings
Another false positive
Reformat to clear a couple of FindBugs warnings
Fix some warnings: - Findbugs - not serializable - Eclipse - unchecked conversion
Remove TODO markers
False positives
Reverted r1381633 for further discussion. 
Improve session management in CsrfPreventionFilter
Update to Checkstyle 5.6
Fix typo
s/CharBuffer/CharArrayWriter/ since the latter is able to grow while the former isn't.
use super class method.
Avoid NPE.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53986 Ensure current and reset Mark are always separate objects. Corrects issue with parsing JSP comments that end with "---%>".
Fix imports
Correct Javadoc
Fix some Javadoc errors
Fix WebSocket + NIO + HTTPS. Utilise underlying read buffer rather than trying to read the exact number of bytes. This is more efficient for HTTP and required for HTTPS since it is not possible to unwrap a single byte.
Fill in some of the HTTP upgrade Javadoc
ServletInputStream.dataAvailable() was removed.
Fix Eclipse Javadoc warning
Clean-up  - Servlet 3.0 Javadoc  - line-length
Fix a long standing TODO so correct exceptions are thrown. Clean-up Javadoc.
Servlet 3.0 Javadoc improvements
Servlet 3.1 Javadoc improvements
Update strings missed in r1397466
Servlet 3.0 Javadoc improvements
Servlet 3.1 Javadoc improvements
Add @since tags.
Add JSR-356 (WebSocket) API. This is the Early Draft Review - version 6 I have tweaked a few things (mainly generics) to reduce the number of reported errors.
Update the build to include a JAR for the WebSocket API
Add some Javadoc for clarification as this is non-obvious.
Tab police
Fix my errors. Reviewed by kkolinko
A clean close by the server appears to result in a reset being seen by the client on Linux for this test case. A similar error is not seen on Windows (or when the test is simulated with a Linux server and a Windows client). Catch and swallow the exception to allow the test to pass.
Grr. Remove local env changes for testing
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53993 Avoid NPE when the session is invalidated
Fix some Eclipse / Javadoc warnings
Fill in some Servlet 3.0 Javadoc
Remove unused toString() methods and associated plumbing
Run the UCDetector and remove unused code Some follow-up remains.
Remove unused code identified by Eclipse
A couple of iterations of the UCDetector
Start to add comments identifying what is being read but not used (to aid debugging / future extension)
Complete adding comments identifying what is being read but not used (to aid debugging / future extension)
A couple more identifying comments
Restore incorrectly removed reads when parsing
Restore incorrectly removed reads when parsing
Use a single constructor
Line length
Update constants
Remove more unused code
UCDetector
Prevent a stack overflow when generating an error message if parsing fails and provide some useful information in error message.
Fix unused parameter warning
Comment out debug code
Only need FieldOrMethod, not individual classes
Remove unused copy() method
Start to strip out the unused classes
More unused classes
Remove unused dump() methods
Unused field identified by Eclipse
Remove unused AttributeReader
Expose the option to register an APR Socket for write as well as read events. This is currently unused but will be required by the Servlet 3.1 non-blocking IO code.
Reduce a circular package dependency (Structure 101)
Suppress some warnings
Silence a findbugs warning
FindBugs: Avoid possible NPE.
Remove unnecessary SuppressWarnings
Remove some out of date Javadoc and an unnecessary constructor.
Javadoc fixes
FindBugs: Protect against NPE
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54010 Remove some unnecessary code (duplicate calls to configure the scheme as https for AJP requests originally received over HTTPS).
Add getSessionIdsFull operation to mbeans-descriptor.  listSessionIdsFull no longer exist.
Fix NPE in unconfigured VirtualWebappLoader. StringTokenizer throws the NPE if the virtualClassPath wasn't explicitely configured (null by default).  This might not be observed in the wild because a VirtualWebappLoader without a configured virtualClassPath isn't expected. But if you extend the class and add features, then this might well happen. 
Merge new resources implementation from sandbox/trunk-resources
Remove uninformative Javadoc
Whitespace police - thanks Gump
Some leading '/' consistency
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=54011 Fix copy/paste error and use correct attribute name Based on a patch by Sheldon Shao
Remainder of fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=54011 Value is coerced to boolean in ctx.generateAttribute() so no need for additional conversion Based on a patch by Sheldon Shao
Test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=54011 Note: This uses the new Resources API so can't be directly back-ported to 7.0.x.
Follow up to https://issues.apache.org/bugzilla/show_bug.cgi?id=54011 Simplify code. Based on a patch by Sheldon Shao
Fix some Eclipse warnings
Fix Eclipse warnings in unit tests
Add support for LAST_ACCESS_AT_START system property to PersistentManager.
Test case for BZ54012
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54045. Make sure getMembers() returns available member when TcpFailureDetector works in static cluster. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54012 Enable the tag plug-in for c:set to work in tag files. Based on a patch by Sheldon Shao.
Enable test case for BZ54012 and refactor common code to base class.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54017 Simplify and reduce GC.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54022 Ensure Comet END event is triggered on client disconnect with APR/native on Windows Vista/2k8 or later. Patch provided by Douglas Beachy.
Expand test cases to cover BZ54025
MIME types update: sync with Apache webserver mime.types file using res/scripts/check-mime.pl.
Fix eol
Extend list of files to skip
svn:eol-style=native for recently added file
Needs to be protected so that unit tests can use the cache and validate its internals.
Fix an edge case just in case Tomcat happens to find itself back in the early 1970's.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54044 Fix off-by-one errors and ensure offset is set when requested value is within cacheSize of the current cache range.
Add test case for BZ 54044
Fix EOL for test case. Copy fix to similar code in JULI.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54054 Shell environment should not be static
Fix resource leak warnings reported by Eclipse
Java 7 <>
Fix resource leak warnings reported by Eclipse
Don't need 1.3 compatibility. Fix an Eclipse warning.
Don't need 1.3 compatibility. Fix a couple of Eclipse warnings.
use org.junit rather than the older junit.framework
Avoid deprecation warnings for classes we have to import because they are pat of the specification API by using fully qualified names when we use them.
No need for wrapper as functionMap extends java.el.FunctionMapper
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53960 Extensions to HttpClient test helper class Patch by Brian Burch
Use an optimised CompositeELResolver for Jasper that skips resolvers that are known to be unable to resolve the value. Patch by Jarek Gawor.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53867 Improve performance of XML escaping Based on a patch by Sheldon Shao
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54067 1xx response codes do not have an entity body. Prior to this fix 101 responses (HTTP upgrade) included "Transfer-encoding: chunked" which does not make much sense.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54068 Re-write the fragment ordering algorithm to over come multiple problems. Expand the unit tests to cover the identified issues.
Fix broken test by adding relative ordering to resources2.jar so it is processed after resources.jar
Handle case where relative ordering refers top fragments that are not present in the application
Restore ability for HTTP PUT to overwrite an existing resource
Initial implementation of a possible solution for BZ 54060. TODO before using this solution:  - lots more test cases  - check performance
Make the nonceCountWindowSize configurable else the performance test fails.
Improve EOF handling with some test cases
qop and nc are not quoted
Increase length of run so I have a chance to attach a profiler. Better use of constants to reduce GC and speed up test. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54060 Use new HTTP header parser to address issues in current regular expression based parser. This roughly twice as fast and generates about a third of the garbage (based on profiling the load unit test)
Refactor HttpParser2 not to throw exceptions on invalid input
Fix broken test (qop and nc are *not* quoted)
Fix broken test (qop and nc are *not* quoted)
First cut at a replacement for HttpParser. Includes a work-around for the Adode Reader 9 on IE bug. Currently untested.
Rename to have one test case per header
Move media-type parsing to the new parser and drop the JJTree based parser.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54076 Work-around that enables HTTP keep-alive to be deisabled for specified user agents using SPNEGO.
Silence a couple of false positives
Follow-up to HTTP parser changes
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54086 Ensure only a single thread tries to close the selector. Prior to this change both the NioReceiverThread and the thread that stops it called closeSelector() I also reviewed all other accesses to this.selector and fixed a handful of other potential threading issues.
Fix a handful of Eclipse warnings
Fix where possible and silence where not possible some deprecation warnings
Silence some more deprecation warnings we can't avoid
Remove unnecessary casts and comment that does not make sense
Add Eclipse generate hashCode() to fix a warning
Refactor to avoid Eclipse warning
Progress update
Fix some more warnings
Fix warnings in IntrospectionUtils. One functional change to replace a debug message and a subsequent NPE with an IAE
Sync to Commons IO 2.2 Fixes Eclipse warnings in this file.
Move JAR Scanning-related properties into separate section. Correct a typo: the file is conf/catalina.properties.
* globalresources.xml: Document the "closeMethod" and "singleton" attributes of a Resource element. The text is copied from context.xml.  * systemprops.xml: Add spaces and breaks to reduce horizontal scrolling.
Fix remaining Eclipse warnings in jdbc-pool
Silence the remaining Eclipse warnings in Jasper
Silence remaining eclipse warnings
FindBugs issues
Fix broken Javadoc links
Really fix the Findbugs issue this time
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54096 env-entry can use any type that has a String or char constructor
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54127 Add support for sending a WebSocket ping Patch provided by Sean Winterberger
In FormAuthenticator: If it is configured to change Session IDs, do the change before displaying the login form.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54123 There are two things going on here: 1. The reported bug. If there is a async timeout and no async listeners, trigger a 500 response. 2. Implement "error dispatch". This is used a couple of times in the spec without any definition. The implication from the part of the spec quoted in the bug report is:    - The standard error page mechanism should be used to identify the page    - An async request that has been started should be left in async mode when forwarding to the error page    - The error page may call complete() or dispatch() This commit hooks into the StandardHostValve to access the error page mechanism. I could have copied and pasted but I preferred the dependency on StandardHostValve Because the error page may do a dispatch(), need to ensure that when running the dispatch(), the error page mechanism is not triggered a second time. Depending on what emerges running the full unit tests and the TCK, I mat still decide to copy the error page code to AsyncContextImpl
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54124 Correct ASYNC_REQUEST_URI. Addition of query string appears to be left over debug code Add missing ASYNC_PATH_INFO which appears to be an oversight.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54115 Minor enhancements to HttpClient test helper class Patch by Brian Burch
Update docs after r1407595
Prevent NPEs with background processing and a failed deployment.
Fix memory leak that prevents context.xml files associated with failed deployments from being deleted.
Prevent ClassCastException when undeploying a FailedContext
If a component is FAILED it will remain in the FAILED state while stop() is called Better logging for Lifecycle issues for FailedContext
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54087 Ignore invalid If-Modified-Since header as per RFC2616-14.25.a
For https://issues.apache.org/bugzilla/show_bug.cgi?id=54044 Add test for org.apache.juli.DateFormatCache. It is port of the test of AccessLogValve.DateFormatCache. I am using reflection to get interesting fields, so no need to change field visibilities.
Allow to customize the HTTP status code used for denied requests in CsrfPreventionFilter.
Correct typo in a field name. (Review of r1408157 )
For https://issues.apache.org/bugzilla/show_bug.cgi?id=53960 Review of r1402846: If someone needs the extractUriElements() method, one has to call it explicitly. So that a) we do not waste time in 90% of tests where this info is not needed, b) we do not waste time if the response is not HTML.
Fix an NPE caused by r1408517
Fix trailing whitespace, as nagged by Checkstyle
Increase error margin to 100ms after observing some test failures.
Ensure onComplete() is called with the correct context. Review from kkolinko
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54141 Increase the maximum number of supported nested realm levels from 2 to 3 and make the maximum configurable via a system property.
Make parameter names in MediaType case-insensitive. Based on review by kkolinko
Optimisation suggested by kkolinko and a test case to make sure it does what it is meant to. The test case is obvious but I missed something in my first look at the code so wrote the test case which may as well be kept.
Fix unit test failures after case-insensitivity changes
Use explicit locale in toLowerCase().
Use explicit locale in toUpperCase().
Use explicit locale in toLowerCase(). Here it is one method among similar ~four. The locale was forgotten here.
Use 'final' for the field initialized in constructor.
Align warning message with the code. It calls AsyncListener.onError() here.
Review of r1389005 - GC optimization of statusCode display in AccessLogValve Simplify code and do not expose public char[] arrays.
Reduce visibility
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54143 Add display of memory pools usage (including PermGen) to the Status page of the Manager web application.
More updates to the async error handling triggered by kkolinko's review - simplify check to see if listeners changed async state during onTimeout - add option to control if onError fires during error handling (it doesn't if called from the timeout code since that has its own event) - add check to see if listeners changed state during onError - add check to see if state changed during "error dispatch" - remove AsyncState.ERROR as a valid start state for asyncPostProcess() - aligned the unit tests (one change) with the new behaviour  Not tested with the TCK.
Validate that the path to the file is correct.
Make sure onComplete() works when running with a security manager
Fix some security exceptions when running with a security manager
Follow up on the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=54011 Need to use the body as the default if no default attribute is defined
Missing file from r1410609
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54144 Add required behaviour for Reader objects when used with c:out
Follow up to r140632 Fix test failure
Fix a FindBugs issue (incorrect synchronization)
Silence another false positive
Fix a FindBugs issue (incorrect synchronization)
Refactor since returning -1 makes no sense with chars. The old code worked but it was a little odd (and FindBugs didn't like it).
Type-Safety for the Mapper - Part 1.  Rename inner classes Host, Context and Wrapper to MappedHost, MappedContext and MappedWrapper. 
Fix time zone formatting in ALV test. Test failed in non-GMT time zone. 
Update JDT complier to 4.2.1 Fixes Findbugs warning
Sorry, committed debug code in r1410763. 
Type-safety for the Mapper - Part 2/2  Use generics for MapElement and specialize MappedHost, MapedContext and MappedWrapper to host, Context and Wrapper.  Remove unneeded casts in all code using the Mapper.  Use real Host, Context and Wrapper objects in TestMapper.  Future possible work: restrict Context parents to Host. Otherwise MapperListener can't register a new Context. 
Add Mapper type-safety to changelog. I don't expect this to get backported to TC 7. 
Update the Eclipse version in the pom
Silence a FindBugs false positive
Followup to r1411587 Update JDT complier to 4.2.1 in classpath file sample for Eclipse IDE
Update to latest WebSocket API proposal Checked against reference implementation with javap
Fix location of websocket classes after API update
Another fix for the websocket classes after API update
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54170 Ensure correct registration of Filters and Servlets in the JMX registry if the Filter or Servlet name includes a character that must be quoted if used in an ObjectName value.
Change Request API to use Servlet 3.1 API for HTTP Upgrade - WebSocket is now broken - Upgrade process is broken / incomplete
Switch the Processors to use the Servlet 3.1 upgrade objects - Upgrade process still broken
Update HttpProtocol implementations to the Servlet 3.1 upgrade API
First cut of HTTP Upgrade for BIO with blocking - NIO, APR still broken - Non-blocking IO not implemented for Upgrade - WebSocket still broken
First cut HTTP upgrade for NIO/APR - Non-blocking not supported - WebSocket broken
First cut for WebSockets (untested)
Fix compilation error in unit test
Rename for consistency. No functional change. Simple testing of WebSocket (the examples) works for BIO, NIO and APR
upgradeDispatch() needs socket status to differentiate between read and write
Add a simple test of the HTTP upgrade process
Fix javadoc
Re-write reading from upgraded connection to use non-blocking IO. NIO tested for basic operations BIO untested APR not written
Rename
Will need separate tests for blocking and non-blcoking upgrade IO
Re-factoring - Make sure all read() methods work correctly when using non-blocking - Pull up special handling of single byte read since it is required by multiple protocols and by multiple overridden methods
First pass at re-factoring based on UpgradeServletInputStream
Fix test
Refactor ServletOutputStream - BIO untested - NIO untested - APR not implemented
Rename as test goes beyond just the input stream
Expand the tests to cover blocking and non-blocking
Fix NPE when in blocking mode
Simplify as there are some things that can't happen with HTTP upgrade than can with a normal HTTP connection (because the protocol tells you where the end of the request is).
Add missing state checks Fix i18n TODOs
Additional checks when in non-blocking mode i18n messages
Remove close() - it just triggers errors
Rename. Drop Upgrade - it is in the package name
Prep for new WebSocket implementation
WebSocket 1.0 implementation part 1 of many. Implement the the bootstrap code for Endpoints defined both using POJOS+annotations and programmatically. At this stage the ServerContainer just dumps relevant info to stdout. Add initial an implementation of the Echo example for each of the approaches.
Fix copy/paste
Remove duplicate line. (It compares a String with a String. The result does not depend on whether it is called once or twice).
svn:eol-style = native
Add missing comma
Re-package as per kkolinko's review
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54198 Clarify that sendError(int) results in an HTML response.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54207 Correct package name in Javadoc
Follow up to r1413556
Fill in some Javadoc. Address a TODO
Add a web-fragment.xml to tomcat-websocket.jar so it has a standard name.
Populate the SCI Javadoc
Add some Javadoc
More Javadoc
Improve wording
FRom kkolinko: A ReadWriteLock cannot be used to guard a WeakHashMap.  The WeakHashMap may modify itself on get(), as it processes the reference queue of items removed by GC.  Either a plain old lock / synchronization is needed, or some other solution (e.g.  org.apache.tomcat.util.collections.ManagedConcurrentWeakHashMap )
Tweak the comments. No functional change.
Use StringManager to provide i18n support
A little more Javadoc
WebSocket 1.0 implementation part 2 of many Create the WebSocket servlet and ensure it responds to requests to WebSocket endpoints 
Another false positive
WebSocket 1.0 implementation part 3 of many Complete the WsServlet implementation Now gets as far as Endpoint.onOpen() and then immediately closes Add the new programmatic echo endpoint to the examples web app for testing
Add new ALV attribute "renameOnRotate" (Default:false).  If set to "true", the "fileDateFormat" will not be part of the current log file. Only at the time of log rotation the file is renamed to the final name including the "fileDateFormat".  This mimics the behavior e.g. of Log4J and similar frameworks, where the active file does not have the timestamp in the file name.  Pro: current file has stable name, all files with      timestamp in name are old. Con: Slightly more complex impl. 
WebSocket 1.0 implementation part4 of many Start to think about POJO handling. This is roughly what needs to be done but is certainly incomplete and probably in the wrong place.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54190 Improve unit tests. Patch by Brian Burch.
Fix ~40 Eclipse warnings
Removed unused code
Fix javadoc. 
WebSocket 1.0 implementation part 5 of many Extract the POJO method mapping. Cache it and start to think about caching the path parameter mapping too.
Fix eol
Generate the servlet mapping a little later as we need the published path for the POJO method mapping
WebSocket 1.0 implementation part 6 of many Path parameter processing for POJOs Clearer differentiation between endpoint path, servlet mapping path and path info
WebSocket 1.0 implementation part 7 of many Complete path parameter passing for POJOs
Fix typo
Add some Javadoc
Correct a typo
Use Pattern.quote() as suggested by kkolinko Tighten up implementation. WS spec (draft 8, section 3.1.1.) states "if the relative path is a URI template (level-1) the request URI matches if and only if the request URI is an expanded version of the URI-template" so every path segment must be present - none can be optional
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54217 Prevent PoolCleaner instances retaining references to the ConnectionPool which  may result in a memory leak.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54190 Speed up unit test. Patch provided by Brian Burch.
Fix indent
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53871 Improve error message for StackOverflowError
Only rename AccessLogValve file with renameOnrotate=true if target file does not already exist.  We don't want to overwrite existing files. Prefer not to rotate.  Typical case would be several ALV instances configured to use the same file name. Only the first one should rename on rotate. 
If the status code is an error but there was no response body, the error input stream will be null. Handle this.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54220 The ErrorReportValve should only generate an error response if the error flag on the response is true.
Fix a bunch of failing unit tests.
Simplify the TimeZone handling in the AccessLogValve and correct a few edge cases. The previous code did not handle edge cases - for example (and what ID'd this issue) the UK was at +01:00 from Oct 1968 to Oct 1971. It is far better to let the formatted handle the TimeZone directly as it will handle all the edge cases.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54150 Make sure that SlowQueryReportJmx mbean deregistered during webapp shutdown.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54194 Make sure that connection pool mbean is not registered when jmxEnabled is false. 
WebSocket 1.0 implementation part 8 of many Start to join up the upgrade ProtocolHandler, the WebSocket session and the Echo end point implementation
Review of r1416258 '&&' has higher priority than '||', so the brackets are needed.
Simplify a loop
Fix trailing whitespace as reported by Checkstyle.
Address Mark's comment to r1413324. Check that two messages were echoed back.
Followup to r1414046. Mark tomcat-websocket.jar fragment as metadata-complete. It initializes itself through a ServletContainerInitializer. There is no need for Tomcat to scan this jar for servlets, filters or listeners.
Fix comment typo
Replicate the equals() and hashCode() strategy from MessageBytes to silence some FindBugs warnings
Fix FindBugs warnings volatile int -> AtomicIntger so operations are actually atomic
Fix FindBugs warning Avoid NPE (although given an OOME has occurred I'm not sure it matters)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54245 Keep git happy about a currently empty directory
Review of r1412576, which was a fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=54170 Reduce GC. There is no need to copy characters into a new char[] array here.
svn:eol-style = native
Clarify the docs that the thread priority value is a number and not some weird string value. A thread on users@ from Dec 02 2012: http://tomcat.markmail.org/thread/iud2m7j743qwx4ui
Style. 
Fix javadoc. 
Move trailing dot in default ALV prefix to leading dot in fileDateFormat.  This gives better behavior over a broader range of config combinations. 
- Move default setting to the right place.  - Don't overwrite fileDateFormat=""   configuration by hard code default.  - remove obsolete comment warning. 
Clarify ALV docs (log file name stuff). 
Log sooner as suggested by kkolinko
Remove redudant but incompletely maintained attribute documentation form Extended ALV. Instead refer to the docs for the base clas and clarify the differences. 
Oups. 
Logically reorder attribute docs for ALV. It was neither alphabetical nor especially logical before. Hope this one is better. 
Document error/warnings settings for Eclipse 4.2.1.  I am not sure that my settings of the following are the same as Mark's. Reviews are welcome. a) "Resource not managed via try-with-resource" in "Code style" section b) "switch" checks in "Potential programming errors" section c) the checks in "Null analysis" section
Make docs menues consistent in the various levels. 
Pass some more context information to style sheet which generates docs. Will be used when embedding the docs comments feature. 
Add a CSS style "notice". Will be used for the docs comments feature. 
Fix sitedir. 
Add user comments system to docs. 
WebSocket 1.0 implementation part 9 of many Now able to receive short payloads. Lots of hacks in this code that need to be addressed.
Copy the fixed UTF-8 decoder as it will be required soon.
Fix package
Sync with latest API from EG
Update implementation for API changes
Update Echo example for API changes
Fix eol
Correct typo
WebSocket 1.0 implementation part 10 of many WsSession only needs to support one message handler of each type so store each individually rather than in a HashSet. Add the handling for Ping and Close control messages to WsFrame. 
WebSocket 1.0 implementation part 11 of many Fix s/ping/pong/ in the API. pings are automatically responded to with pongs. Apps send ping and receive pongs. (Sending unsolicited pong is also possible.) Handle incoming messages (at the frame, still need to map WebSocketMessage annotations) Add some debug to the examples to check messages are received
WebSocket 1.0 implementation part 12 of many Start to add the plumbing for @WebSocketMessage annotation handling
Experiment with Eclipse's code formatter
WebSocket 1.0 implementation part 13 of many Complete first draft of @WebSocketMessage annotation handling
WebSocket 1.0 implementation part 14 of many Add a RemoteEndpoint implementation (just stubs) Add the plumbing between the WsProtocolHandler and the RemoteEndpoint implementation.
WebSocket 1.0 implementation part 15 of many Implement enough of the send message code that that WebSocket example works again using the new annotation endpoint
WebSocket 1.0 implementation part 16 of many Re-write the code that identifies the type that a MessaheHandler is associated with. Doing it correctly is non-trivial. Includes a test case.
Re-order so RemoteEndpoint is in place before onOpen is called as onOpen may create MessageHandlers that call getRemote()
Avoid NPE
Update the echo WebSocket example to use the new APIs.
Update the location of the echo WebSocket end point (one test still fails - need to improve continuation frame handling)
WebSocket 1.0 implementation part 17 of many Improve the handling of fragmented messages
Move the WebSocket unit tests to the new package location.
onDataAvailable() can't throw an IOE (and the user may swallow it anyway) so ensure that when the connection needs to be closed it really is closed.
More NPE avoidance
If the client drops the connection, tell the server the connection is closed.
Switch the chat WebSocket example to the new API.
Switch the snake WebSocket example to the new API.
Correct a pair of typos
Use interface
Need to be able to close the upgraded input/output streams
int -> CloseCode
Echo binary messages as well as text messages.
Avoid NPE
Improve close behaviour - fixes various issues highlighted by the Autobahn WebSocket test suite
Send a close frame telling the client why the connection is being closed if the server buffers can't cope.
Make sure buffer is flipped before sending
Update the WebSocket API to v011 of the JSR 356 draft
WebSocket 1.0 implementation part 18 of many Sync the implementation to the latest draft of the spec API
Update the examples to use the v011 API
Clean-up
Clean-up
Make fields private
Remove naked notify (resolving a FindBugs issue) as I can't find any locations where wait() is called with the Poller as the monitor.
Simplify. The Poller event queue always only contains PollerEvents.
Simplify
May be multiple threads accessing the buffer
Add a debug message I found useful when trying to track down a WebSocket issue
Only fire the writeListener if canWrite() has been called. Note: onWritePossible() will be called in the background until the buffer is empty.
Consistency
Refactor connections as upgraded connections will need to support multiple threads processing the same connection
Add an upgraded flag to the socket wrapper and set it for connections where an HTTP upgrade has been completed.
Allow multiple threads to process an upgraded connection at the same time. This is required to support blocking reads/writes. The Servlet[Input|Output]Streams do not expose an API for a blocking [read|write]. Therefore to block a thread has to wait until [onDataAvailable()|onWritePossible()] is called. The problem is that the waiting thread holds a lock on the socket and there is no way through the Servlet 3.1 API to release that lock. Until the lock is released the thread that will eventually call [onDataAvailable()|onWritePossible()] is blocked. So a form of deadlock occurs. To overcome this without requiring libraries such as WebSocket implementations to access container specific APIs, Tomcat has to allow multiple threads to process a upgraded connection at the same time.
Need to register socket with Poller for write if some data remains to be written
Make the read buffer size configurable
Add NO-OP for pong messages (to handle unsolicited pongs)
Fix Ping/Pong issues identified by Autobahn
Add some Javadoc
More Autobahn inspired fixes. Setting reserved bits when not expected should trigger an error.
Unsupported opCode should trigger a protocol error.
Fix failures in Autobahn fragmentation tests - control messages must be sent as a single frame - control messages may appear between the frames of non-control messages
Text messages are always UTF8 (Note that even with this fix Autobahn identifies a lot of UTF-8 handling issues. The quick and dirty new String() approach needs a more robust replacement.)
Fix the Autobahn UTF-8 test failures except those that test for fail-fast on invalid UTF-8. Failing fast will require some further refactoring.
Test UTF-8 decoder in the right package
Prep for a second set of invalid bytes from the Autobahn test suite that is not correctly handled.
More refactoring prior to added new tests
Decode bytes to text sooner so UTF-8 encoding issues are caught early.
Need to add an additional test. Also add extra tests when buffers not backed by arrays. Expand the test cases to cover the Autobahn failures
Later Autobahn tests need a bigger buffer
Fix various failures when running the Autobahn close tests - some close codes are not meant to be used on the wire - properly decode UTF-8 close reasons - single byte close codes are invalid
Make sure reason phrases will fit into a control frame payload
Clean up old dirs
Don't swallow nested exception
Fix swapped parameters
Correctly set isText flag for text messages
Can't use opCodes to determine message types because of continuation frames.
Remove unnecessary code
Make the annotation based echo example support partial data so huge buffers aren't required to pass the Autobahn tests Simplify WsFrame by replacing frameStart and headerLength with readPos. When the frame is bigger than the input buffer the former didn't make much sense anyway. Re-write the processing of text data to make it easier to follow. Make the application responsible for thread-safety of Servlet[Input|Output]Stream 
Don't assume frame starts at the start of the input buffer
Formatting, javadoc and the remaining TODO
Javadoc and remove unnecessary code
Fill in some Javadoc. Rename various fields/methods/parameters for consistency Remove unnecessary code
Correct a typo (followup to r1426279 )
Javadoc
Spotted a couple of threads hanging waiting on this barrier after an aborted Autobahn test. Try and stop that from happening.
Add early detection of invalid sequences - Autobahn tests now pass in full.
Correct a typo (followup to r1425648 )
Fix typos
Fix logic thanks to review by kkolinko
Consistency - use WsIOException
Add warning about message length
Remove a new String() that should have been removed when the decoder was added.
Make distinction between wrapper and socket clearer It is the socket that is the key for the connections map, not the processor
Remove this line. In all possible call paths, the attachment has been obtained from the selection key so there is no point re-adding it.
Fix indents
Trivial whitspace fix
Deprecate unnecessary code
Remove deprecated code
r1427014 missed a few lines
Put all JSPs for bugs 50000-59999 in a sub-directory. Should be no functional change.
Whoops. This isn't the main test webapp. No need to change this path.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54241 Revert the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=35410 as it is not specification compliant Remove the remainder of the write(String) method as well as it serves no purpose since it is identical to the method it overrides. Add some test cases to confirm the expected/correct behaviour Note: BZ 35410 claims there is no requirement for Object.toString() to be non-null. Many have argued (and I agree) that null is not a String representation and therefore not a valid return value for Object.toString().
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54242 Fix NPE in tagPlugins:ForEach when iteration is null. JSTL spec says it should be treated like an empty iteration.
Test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=54242
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54247 Prevent ClassNotFoundExceptions on stop when running as a service
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54256 Give the developer a hint as to which JAR file has the broken manifest
Line endings
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54260 Avoid NPE when using JSP unloading and tag files.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54370 Improve handling of nulls when trying to match sets of parameters to a method in EL.
Stop broken filters breaking things on application stop.
Fix line endings
s/2012/2013/g
Review of r1428643 Align implememntation between IS_SECURITY_ENABLED true and false branches (essentially add i18n to the IS_SECURITY_ENABLED==true branch).  Add the same fix to setFilterDef(null), though I think nobody passes null filterDef to that method.
Make HTTP DIGEST authentication header parsing tolerant of known buggy clients.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54338 Correctly coerce the value to the expected type when using the tag plug-in for the JSTL set tag
Test case for bug 54338
Further review of ApplicationFilterConfig. Inline the setFilterDef() method. In the constructor the filterDef is never null and there is no need to care about destroying a filter. Thus the code is simplier. The method was package-visible, thus there should not be any 3rd party callers.
When running with a SecurityManager, make sure that reference to a Servlet instance is removed from a static cache when its init() or destroy() methods fail.
Simplify, as the method names are case-sensitive.
Simplify. We are returning "null" on failure, so there is no need to check whether it is not-null before returning it.
Fix wrong argument of StandardWrapper.remove() in case when singleThreadModel and instancePool are used.
Comment
Add comments and a pair of additional checks. Correct a typo.
Update the powered by header
Amend the test for bug 46243: Test that a context can be started again after a failed start. There is no need to redeploy it.
Make non-JSR356 WebSocket implementation non-blocking between HTTP upgrade and first message.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54361 Include the binary distributions when uploading artifacts to Maven repos
Tweak the pom so we don't get a copy of the pom with a .jar extension
Build the missing jni and spdy source JARs
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54262 An empty <absolute-ordering /> should turn off all web-fragments. Based on a patch by  Violeta Georgieva.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54284 As per clarification from the Servlet EG, anonymous Filters and Servlets are not permitted. Patch by Violeta Georgieva.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54248 Need to reset the decoder when the N2C converter is recycled to ensure BOMs are correctly handled for those encodings that require them.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54380 - In MapperListener.lifecycleEvent(): call registerWrapper(), registerContext() only if the parent component has already been started.
Fix NPE in WebappLoader that happens when stop() is called after a failed start. Add tests that a context can be started again after a failure.
Improve consistency within new resources implementation. s/webAppPath/webAppMount/ Place same requirements on webAppMount as for path (although internal representation is different). Add necessary plumbing to do the same for internalPath
Improve consistency within new resources implementation. Place same requirements on internalPath as for path (although internal representation is different).
Adds support for Virtual resources to the FileResourceSet (it still needs to be added for the DirResourceSet). This will allow an application to full traverse the resource hierarchy including any non-main resources mounted under a directory structure that does not exist in the main resources.
Don't hard code mount path
Running Tomcat 8 needs Java 7
Correct version
Adds support for Virtual resources to the DirResourceSet and JarResourceSet. This will allow an application to full traverse the resource hierarchy including any non-main resources mounted under a directory structure that does not exist in the main resources.
Review the section on setting the environment variables.
Need to follow new rules on paths
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54377 Correctly set request attributes for AccessLog in RemoteIpFilter Patch by Violeta Georgieva
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54381 Add support for receiving pong messages.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54382 Avoid NPE with an empty SSI directive
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54390 Use /usr/libexec/java_home to determine JAVA_HOME on Mac OS X if it is available.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54330 Refactor Member interface to reduce dependency on concrete implementation. Based on a patch by Greg Turnquist.
This dir is created by the prepare target
Reduce the dependencies for building the source JARs
Tab police
Reduce visibility.
Tab police
Avoid ArrayIndexOutOfBoundsException in HttpParser on incorrect input. Inspired by o.a.t.util.buf.HexUtils.getDec()
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54391 Provide a value for the javax.servlet.context.orderedLibs attribute 
Followup to r1430799: Fix trailing whitespace
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54244 Clarify documentation for BIO/NIO SSL config attributes sslEnabledProtocols and sslProtocol
Fix whitespace
A pair of typos
Fix release of processors in AjpNioProtocol. Wrong object was used as a key in the connections map.  "connections" is "Map<S,Processor<S>>", so the key in the map is socket, not its wrapper. Found this in a review inspired by a similar fix in r1426662.
Tweak wording of the notice in the "comments" section.
Add support for auto-detection and configuration of JARs on the classpath that provide Tag Plugin implementations. Based on a patch by Sheldon Shao.
Adding test/webapp-3.0/WEB-INF/classes means there are 3 resources not 2 in this test.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54379 Implement support for post-construct and pre-destroy elements in web.xml Patch by  Violeta Georgieva.
Remove unnecessary warnings
Add name of JSP file to an error message in JspServlet. Fix misconfiguration that caused  org.apache.catalina.core.TestStandardContextResources test to log this message, javax.servlet.ServletException: missing jspFile 	at org.apache.jasper.servlet.JspServlet.init(JspServlet.java:123) 	at org.apache.catalina.core.StandardWrapper.initServlet(StandardWrapper.java:1228) 	at org.apache.catalina.core.StandardWrapper.loadServlet(StandardWrapper.java:1141) 	at org.apache.catalina.core.StandardWrapper.load(StandardWrapper.java:1037) 	at org.apache.catalina.core.StandardContext.loadOnStartup(StandardContext.java:4851)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54387 Multiple servlets may not be mapped to the same url-pattern
Tests for https://issues.apache.org/bugzilla/show_bug.cgi?id=54391
Follow-up to r1431293. Fix error on reload when postConstruct and preDestroy entries are present in weeb.xml
Turn off "Potential resource leak" warning, as it gives too many false positives
Fix resource leak that led to locked files.
Invalidate the cache entry if a previously missing resource is now present.
False positive
Another false positive
Remove unused code identified by FindBugs
- Add the ability to invoke the main service method as an API call, without having to fallback to bytes. - Add some utility get/set (one of which got removed after deprecation but is not necessarily that useless). - Both changes to make using the rewrite valve possible.
Clarify that when using an API call to process a "virtual" request, the URL should not be used to pass parameters.
Relax the test. Relative ordering can pick more JARs than those two that belong to the web application.  E.g., Tomcat 8 has npn-8.1.2.v20120308.jar (Jetty NPN). Running with other JDKs may pick other JARs that are not on our jarsToSkip list.
Followup to r1431556 - remove trailing whitespace, as reminded by Checkstyle
Correct version of Eclipse Java Compiler dependency
Remove svn:executable property from Tester.java. 
Remove unnecessary method call.
Remove unused code reported by FindBugs
Fix threading issue reported by FindBugs
Another false positive
Fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=54406.  Make NIO connector use the same logic as BIO connector to prune specified ciphers and sslEnableProtocols to supported options. Fix option pruning to not silently use defaults when no specified options are supported by SSL implementation.
Add my new signing key. Old one has exipred
Whitespace police Fix Java 7 <> related warnings
Simplify locking code. Mark remaining issues as false positives
Simplify locking code. Mark remaining issues as false positives
Fix various issues highlighted when running the Autobahn test suite on Linux. - Don't register the socket for a read when a write event completes (may lead to thread starvation) - Use a dedicated lock rather than the ServletOutputStream to protect the writing of a WebSocket message - Add a lock to protect the write buffer from concurrent calls to writeInternal() - Add a lock to ensure a consistent view of buffer and fireListenerLock
Switch the AJP connector to NIO by default too
Expand the scope of the lock to prevent concurrent blocking and non-blocking writes
First pass at getting HTTP upgrade working for APR/native. I'm testing this with WebSocket. Autobahn doesn't trigger a crash :) but there are a number of failures I still need to investigate :(
Trivial comment corrections
Re-order
APR/native refactoring - Switch to Remy's updated Poller/Sendfile implementation that uses a single Poller and multiple Pollsets rather than multiple Pollers each with a single Pollset  The updated implementation is from JBoss's web container and is provided under Remy's (remm) iCLA.  This is untested (I don't have an OSX build of the native lib handy right now). I'll test later today.
Ensure sockets are always destroyed via destroySocket(). A single place for actions on socket destroy will make later changes simpler.
APR/native refactoring - Remove SocketEventProcessor - Align code with JIO connector (with a view to further refactoring)
APR/native refactoring - Clean-up
Ensure maxKeepAliveRequests is honoured by the APR/native connector.
APR/native refactoring - Pull up comet flag to SocketWrappoer - Remove dedicated Comet Poller
APR/native refactoring - Add an endpoint implementation specific SocketWrapper - Track poller flags in new wrapper
Final parts of the puzzle to get APR/native to support the JSR356 WebSocket. There are a small number of Autobahn failures still. I'll look at those next.
Remove unused attributes
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54440 Fix a regression caused by the changes for https://issues.apache.org/bugzilla/show_bug.cgi?id=54240 that broke compilation with JspC
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54438 Fix a regression in the fix for BZ 52953 that triggered an NPE when digested passwords were used and an authentication attempt was made for a user that did not exist in the realm.
Fix remaining Autobahn test failures with APR/native. Once a close message has been received do not process any more messages from that connection.
Remove unnecessary sync identified by FindBugs
Suppress a couple of false positives
Remove unnecessary sync identified by FindBugs
socket can't be null here
More FindBugs false positives
FindBugs - avoid NPEs
FindBugs false positive. It may not be immediately clear why this is a false positive so add a comment to explain it.
Silence a valid FindBugs warning about a problem we have chosen to accept
Fix FindBugs warning: Incorrect lazy initialization of static field
Make sure changes to result are visible to all threads currently calling get()
One final FindBugs false positive
FindBugs warnings all resolved :)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54324  Allow APR connector to disable TLS compression if OpenSSL supports it.  
Rename
Create new package for holding POJO plumbing classes
In case there is more refactoring
Align test classes with name changes
Trailing whitespace police
Remove old file
Move POJO related classes to separate package
Consistent naming
WebSocket Add the plumbing to obtain references to the WebSocketContainer Includes a test case to make sure there are no mempry leaks
Make sure JUnit 4 imports are used
Convert to JUnit 4
Convert to JUnit 4
Revert changes from r1435126  I do not object the changes. This is a temporal measure until remaining issues are resolved. Without this I cannot build Tomcat with Ant with Checkstyle being enabled.  The checks do not pass because there is a number of test cases in Tomcat-JDBC-pool that have not been converted to JUnit4 yet. Those are org.apache.tomcat.jdbc.test.DefaultTestCase class and its children.
Correct links to specifications and correct chapter numbers mentioned in the text. This is in response to a comment posted on the web site.  I removed a link to "J2EE Blueprints", as that page is gone and it seems wrong to recommend outdated documents that I never used.
Add link to RUNNING.txt and refer to it as the main documentation on this topic.
Reformat
Correct broken sentence. There are no loggers in Tomcat 7. An XML parser is not bundled, as it is now provided by JRE.
Convert to JUnit 4
Fix broken test (it has been broken for a long time) The timeout needs to be shorter than the sleep time so the connection is abandoned
Restore checkstyle check for Junit 3 style tests
Fix broken Javadoc
Move server side specific code to separate package. Further refactoring is likely to be required as client side code is developed.
Disable test. The client implementation is not ready for this yet.
Add a little more client plumbing
Remove remaining reference to Servlet classes to server web socket package
Add <distributable/> to web-fragment.xml in tomcat-websocket.jar.  Servlet Spec says: The web.xml resulting from the merge is considered <distributable> only if all its web fragments are marked as <distributable> as well.  Therefore, in order to user deploy distributable web application, tomcat-websocket's web-fragment.xml should contain the <distributable/>. Otherwise, users are forced to set metadata-complete="true" in their web.xml or add <distributable/> to  web-fragment.xml inside the tomcat-websocket.jar.
Fix incorrect increment of counterSend_EVT_SESSION_EXPIRED and counterSend_EVT_CHANGE_SESSION_ID. These values are not incremented if no members active in cluster group. 
Fix Eclipse warning
Turn on some more tests, disable the resulting false positives
Import the rewrite valve in trunk, after fixing issues based on the feedback.
Update after package moves
Text type
Fix some immediate Eclipse/Checkstyle issues - add missing license header - remove stray author tag - remove trailing whitespace - add @Override - Java 7 <> operator  Still a few to investigate including the deprecation as I removed the class level suppression to look at the individual issues more closely
Avoid deprecation warnings
Refactor to avoid potential null warning
is can't be null here due to check a few lines above
Trailing whitespace
Add license tabs -> spaces remove trailing whitespace
Populate some Javadoc
Add some constants and make use of them
onWritePossible() is a server specific method
onWritePossible() is a server specific method
Like the other send methods, these methods need to be able to indicate to the caller that the send failed. Deviation from the current specification draft http://java.net/jira/browse/WEBSOCKET_SPEC-121
Added clearOptions native method.
Add a couple of utility methods
Refactor so client and server can share common code for WsFrame and WsRemoteEndpoint. Provide a first draft implementation of a WebSocket client. (A simple test with an echo style endpoint works.)  - Message sending is now based around sending an async message with a completion handler. All other message sending types wrap this core type.  - Implemented Session.isOpen()  - First draft of WebSocketContainer.connectToServer()  - Fixed various issues with the tests for WebSocketContainer.connectToServer()  - Masking / no masking now depends on direction.  - Lots of TODOs throughout the new code. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54448 Correctly handle @Resource annotations on primitives. Includes test case. Patch provided by Violeta Georgieva.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54450 Correctly handle resource injection when part of the servlet properties uses @Resource and the other uses 'injection-target' Includes test case Patch provided by  Violeta Georgieva.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54458 Include exception in error log message Patch provided by Violeta Georgieva
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54461 Improve the documentation for the compiler attribute in the Jasper how-to
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54466 Improve error message by including the name of the file when the java file generated from a tag file cannot be compiled. Based on a patch by Sheldon Shao.
Fix a few logging TODOs Cleanup
Refactor character encoding and decoding using NIO.
Fix B2C test ooops, plus some warnings from that blamethingie.
Trailing whitespace police
Fix Eclipse unused code warnings A handful of trivial whitespace changes for consistency
Update to Commons Daemon 1.0.12
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54476 Fix Javadoc. destination has minimum length of 1, not 2
Address some TODOs
Make sure changes to messages are visible to all threads.
Refactor session creation and endpoint event firing
Fix some exception handling TODOs
Implement configurable buffer sizes. Also addresses: - Pass copies rather than original byte buffers to application code - Implement user properties for sessions - Ensure sessions are only closed once - Make calling of onClose() consistent  
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54483 Fix translation s/recycling/reloading/
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53869 Performance improvement for pages with lots of heavily nested tags. Retain a reference to the root JSP context rather than traversing the hierarchy on every call. Based on a patch suggested by Sheldon Shao.
Fix an i18n TODO
Implement Session#getContainer() for client and server
Fix a handful of i18n TODOs
Make the messages list synchronized as a whole, instead of just using a volatile reference to it. I am still observing random failures with TestWsWebSocketContainer, so an issue is not here.
Close parentheses on docs page. Noted on comments.a.o. 
Add Jespa
Drop 10 10s. 100s was a local change while I was debugging so I had more time.
Same ends, different means.
Add no-follow as suggested by kkolinko
Follow-up to https://issues.apache.org/bugzilla/show_bug.cgi?id=54060 More buggy client implementations of DIGEST auth. This time it is the JDK (Oracle 6.x, Oracle 7.x, OpenJDK 7.*)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54496 Don't use hard-coded class name in toString()
Correct a glitch in r1439445. Remove duplicate "append(getName())" that was copied from the next line.
Handle session close higher up the call stack
Look to see if a CloseReason is available before generating one.
Prevent the SSO deregister when web application is stopped or reloaded. When StandardManager(pathname="") or DeltaManager stops normally, all sessions in the context are expired. In this case, because most sessions is not time-out, SSO deregister was triggered.
Additional fix for r1439757. Prevent SSO deregister when node shutdown normally in cluster environment. 
Fix one cause of WebSocket unit test failures. There may be others.
Make sure buffer sizes are picked up from the servlet context initialisation parameters
Failure to send the close message should not stop the rest of the close processing.
Currently no extension support (and none planned)
Clean-up line length
Remove a TODO
Include the exception in the error message
Implement client and server async timeout Note this doesn't work for BIO as it always blocks and only pretends to do async writes.
Check cluster member before sending replicate message in ClusterSingleSignOn.
Align NIO with BIO and APR and include leading blank lines when counting input for HTTP header size limit
Update WebSocket API to latest EG version (between v011 and v012)
More consistent names
REmove debug code. Improve comment.
Fix logic error if timeout < 1 (i.e.disabled/infinite)
Tweak the buffering so the limits apply to the buffers passed to the client and have no impact on internal processing
Fix typos spotted by kkolinko
Rename and expand the header buffer to make it an output buffer prior to implementing masking and batching
Review of r1440096 (r1440095) Include the exception in the error message if the parsing fails. digester.parse() is called several times in HostConfig.java, so I am fixing the rest of those calls.
Correct typo, reported at comments.a.o
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54507 Don't start expiring sessions until the web application is fully started. Stop expiring sessions as soon as the web application is stopped.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54507 Don't run background processing if the context isn't started.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54497 Make error handling more robust so an error in the leak detection code doesn't prevent the Context from stopping unless the error is fatal to the JVM
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54513 Multiple bugs in the new Poller implementation (r1433976) when the endpoint is stopped and then started  - Ensure old Poller thread stops  - Ensure old AsyncTimeout thread stops  - Ensure old sendfile thread stops  - Ensure sockets in keep-alive are closed
Make the test more robust. The socket may get closed before the client has a chance to send all the data.
Simplify. Have a single method adding sockets to the Poller's addList
Make sure a socket doesn't get left in limbo if it is passed to Poller.add() after the Poller has stopped (which may happen with a long running request thread).
Port storeconfig functionality to trunk (with a FIXME about the new resources configuration which will need some gets to be able to be persisted).
Copy classes from tcnative.  Next is removing al jni from tcnative and link to TC trunk using an svn external. 
Fix typo
Move triggering of listener outside the sync block else users of the API (WebSocket in this case) can end up in deadlock through no fault of their own.
Add a utility method for generating secure masks for client data.
Refactor the RemoteEndpoint implementation. - Add support for masking client data - Add support batching (a.k.a. buffering) messages - Provide building blocks for Stream, Writer, etc. support
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54534 Ensure that when loading Servlet instances the correct class loader is used.
Add support for CombinedRealm in Storeconfig.
Improve support for resources.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54521 Ensure concurrent requests that require DIGEST auth receive unique nonces.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54456 If the client aborts the request, make sure this is communicated to the application reading the request body.
Debug CI failure before deciding how to address it.
Add Javadoc for the implemented methods
Low hanging fruit
Don't use a hard-coded domain name.
Improve ContextSF description. Remove unused attributes engineName and saveConfig. Add effectiveMajorVersion and effectiveMinorVersion to TransientAttribute.
revert r1443872.
Fix trailing whitespaces in java and xml files Fix tab characters in xml files
Add missing @Override annotations
Remove unnecessary casts
Remove unnecessary cast
Allow high availability and tribes imports in o.a.c.storeconfig.
Extract Echo endpoints for use in other tests
More refactoring for re-use
Fix various Eclipse warnings
Fix copy and paste error highlighted by Eclipse NPE warnings
s/childs/children/
Fix typo
Correct a typo
OutputStream and Writer support
Make the requestURI string is also reset. 
Fix a handful of Javadoc warnings
Implement new approach to locking
Add Writer test
Update to draft v12 of WebSocket API Align current implementation with draft
Rename ProtocolHandler to HttpUpgradeHandler
Rename canWrite() -> isReady()
Improve support for Parallel deployment.
Improve support for metadata-complete.
ServiceLoader implementation
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54505 Clearer links to Tomcat specific options for JNDI resources
Document possible value for closeMethod attribute
Make fields private
UCDetector: Reduce visibility
Add a reasonable error margin to the test.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54239 Enable applications to use a custom EL interpreter. Based on a patch by Sheldon Shao.
Base the examples WsConfigListener on the generic WsListener so it calls general startup and shutdown code. Otherwise e.g. the websocket timeout thread is not getting stopped. 
Update to APR/native 1.1.27 and make it the recommended minimum
Update to Commons Daemon 1.0.13
Stop ServerContainerImpl in contextDestroyed by basing the test listeners on WsListener.  ServerContainerImpl.stop() is protected so not directly accessable.  stop() needs to be called in order to stop websocket timeout threads. 
Simplify. 
Fix validation - two unused imports due to recent code change - trailing whitespace in one docs page 
Call super() for consistency even if it is not strictly necessary.  Currently the call is idempotent. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54536 If a custom error status is used and a message is provided, display that message via the default error page.
Increase time allowed for test in an effort to reduce false test failures.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54552 Servlet 3.1 Implement HttpSessionIdListener and HttpServletRequest#changeSessionId() Patch provided by Nick Williams. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54203 Complete Part javadoc. Content copied from Commons FileUpload with minor changes as necessary.
Implement per session message buffer size limits and check them on every new message.
Implement getOpenSessions
Implement getters and setters for session idle timeout. The actual timeout mechanism is still TODO
UCdetector Reduce visibility, make fields final, remove unused code.
UCdetector Reduce visibility, make fields final, remove unused code.
Remove duplicate code on ManagerBase and DeltaManager. Introduce following interfaces.   Manager#changeSessionId(Session, String)   Session#tellChangedSessionId(String, String, boolean, boolean)
Remove unused import.
Use Manager#changeSessionId method to change session ID.
JvmRouteSessionIDBinderListener that is no longer being used is removed from the default cluster configuration.
Fix trailing whitespace
Remove unused import
Implement missing method
No extensions supported at this point.
Ensure request start time for HTTO NIO connector is measured correctly.
Follow on to r1446108 Since -1 is used to indicate the start time has not been set, make sure that is what is used for the initial value
Prevent infinite loop on test failure
Rename
Implement session timeouts Use a single background thread for session timeouts and server side async writes
Make the HTTP request information available via the session
UCDetector - use final - remove unused code
Add access-bridge-32.jar to jarsToSkip property This library is in JDK 7u13 32-bit on Windows
Escape slash consistently. 
Remove stray '-->' in a configuration sample
Correct typos in configuration samples: XML comments start with '<!--'.
setBatchingAllowed() will throw IOE in next spec iteration
TODO: IOE on sending close message Solution: Rethrow
Expose negotiated subProtocol to the Session Add some plumbing for exposing path parameters
Rename. All endpoints, not just Pojos will need this.
Complete the plumbing for pathParameters Reduce repeated parsing of the parameters by calculating them early and passing the parameters around rather than the UriTemplate
Move UriTemplate to server package since that is where it is used.
UCDetector  - use of final  - reduce visibility
UCDetector  - use of final  - reduce visibility
Whitespace police
Fix Findbugs warnings
Fix Findbugs warning
Suppress false positive
Fix a couple of logging TODOs
Remove incomplete comment
juli was reviewed with UCDetector in r1225467
naming was reviewed with UCDetector in r1225625
UCDetector  - use final  - reduce visibility  - remove unused code
Typo
UCDetector  - use final  - reduce visibility
Fix a couple of TODOs
UCDetector  - reduce visibility  - remove unused code
fAllowJavaEncodings is never set so is always false
mayReadChunks is always false
literal is never set so is always false
UCDetector  - use final  - reduce visibility  - remove unused code
UCDetector  - use final  - reduce visibility  - remove unused code
Remove unused constants
UCDetector  - reduce visibility
Correct definition of a term. Reported via comments.a.o.
UCDetector  - use final  - reduce visibility
UCDetector: Jasper complete
UCDetector  - use final  - reduce visibility  - remove unused code
UCDetector  - use final
Correct inner class name typo noted in r1444684
Some trivial improvements of Cluster Store Config. -clusterName define as TransientAttribute. -org.apache.catalina.cluster.tcp.ReplicationTransmitter never used.
Enable ReplicationValve and JvmRouteBinderValve in StoreConfig. These Component are configurable in cluster configuration.
Avoid duplicated store of ClusterDeployer. FarmWarDeployer extends ClusterListener and implements ClusterDeployer.
Fix checkstyle warnings (sorry new laptop - need to configure it properly)
Fix checkstyle warnings (sorry new laptop)
Consistent naming
Need to lock on read too
Improve Javadoc. Clarify difference between spec minimum behaviour and what Tomcat does.
UCdetector: Add final
Use final. Use imports. Don't make log static
Server side wss support
Fix Konstantin's comments. more generic.
Improve support for Engine level cluster. Excludes ClusterValve from Engine Valves. 
Improvements of InterceptorSF. - Add support for static membership. - Interceptor except StaticMembershipInterceptor has no child elements.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53871 Add the class hierarchy that triggered the StackOverflowError to the error message to aid debugging.
Remove unused class
UCDetector  - use final  - reduce visibility  - remove unused code  Not all warnings were addressed as this code is a work in progress
Deprecate prior to reducing visibility
UCDetector  - use final  - reduce visibility
Deprecate prior to reducing visibility
UCDetector: Reduce visibility of inner classes
UCDetector  - use final  - reduce visibility
UCDetector  - use final
UCDetector: Remove unused classes
Remove unused stacksByName
Remove unused constructors and default constructor that adds nothing
UCDetector: Remove unused methods
Fix imports
UCDetector: Remove unused methods
UCDetector: Remove unused methods
UCDetector: Remove unused classes
UCDetector: Remove unused constructors
UCDetector: Remove unused constructors
Remove unused code
Remove unused code
UCDetector  - use final  - reduce visibility  - remove unused code
UCDetector  - use final  - reduce visibility  - remove unused code
Tomcat doesn't use .ser files for MBeans
UCDetector: Remove unused code
Deprecate prior to removal
UCDetector: Remove unused code
Deprecate prior to removal
Remove unused code
Remove unused code
UCDetector: Use some unused code so log messages can report the acceptor thread name
Remove unused method. Add Javadoc to the meothd that is used.
Fix modifier order
UCDetector
UCDetector: use final
UCDetector: use final
UCDetector pass of trunk complete
Make parameter name consistent
First step in refactoring as it isn't just message handlers we need to determine the generic types for
Complete generic type ID refactoring
Add tests for Encoders
Remove old comment
Make the list of encoders available where they are needed
First draft (untested) of sendObject implementation
Re-reading the spec, this is not required.
String unescaping modifies the buffer used for the cookie, and will corrupt the original cookie header [visible when displaying them using getHeader]. Experiment with an option to preserve them. I don't think this should be the default, as it is almost never useful, and can be a bit wasteful.
whitespace
Update Javadoc after recent pruning of unused code.
Disable scanning of the bootstrap classpath by default and remove the jarsToSkip entries that were added to achieve the same objective
I forgot to port a portion of my patch, that 54602 had me look at what called recycle.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54601 Pass LOGGING_MANAGER value as is, do not modify JAVA_OPTS variable.
Fragment names are meant to be valid java identifiers
Checkstyle: remove nested blocks (Testing git-svn setup on new machine)
First stage of updating to WebSocket draft 13 - Some new TODOs to complete - Configuration changes not made - Compiles but not tested
Fix a couple of TODOs
Rename prior to some refactoring
Pull up duplicate code to new abstract base class
Complete update of WebSocket to latest draft of spec
Move towards new programmatic API
Align to proposed method signatures
Add more status data to the webapp MBean.  Like for processingTime retrieve it by iterating over the children. 
Refactor to make the fix for BZ54585 cleaner
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54585 Take account of setting of delegate when building the class path that is passed to Jasper
New certs. Same DNs. Same CNs. Expiry in ~2 years
Add test for size of leftover buffer and increase buffer size to support more character sets
Add option to converter so client can indicate no more input is available Add some more tests for BZ54602 TODO: Review the use of the now deprecated code
Disable comments section for the "Changelog" page. This fixes JavaScript errors when viewing changelog as XML file in a browser. (I suspect that is because you cannot use document.write() with XML)
Better alignment to maker table easier to follow
11000000 10xxxxxx is invalid as it can be encoded in a single byte as 00xxxxxx
Expand UTF-8 tests based on a test case written by Joe Orton for CVE-2008-2938 Note the additional failures this generates are not exploitable. They are invalid only because they encode a valid code point in too many bytes.
Include invalid main resource location in error message
Fix deprecation warning
Fix Javadoc warnings
Fix Javadoc
When decoding URIs we always have the full input available. Ensure partial / invalid bytes at the end of the URI trigger an error.
Remove fall back to 'ASCII' (really ISO-8859-1) Replace partial / invalid byte sequences rather than trigger an error (allows application to handle the resulting 404)
Check to see if JVM's UTF-8 decoder handles invalid sequences better if endOfInput is true (it does).
Add test case that highlights need to switch to Harmony decoder
Remove a copy/paste comment used to construct a test
Move the Apache Harmony based UTF-8 decoder from the JSR356 web socket implementation to the util package. Point the pre-JSR356 web socket implementation to use the newly copied UTF-8 decoder in the util package.
Structure 101. Reduce a circular package dependency.
Move the unit test to the same package as the class it is testing
Start of a new framework for UTF-8 testing. I have discovered that the correct replacement behaviour (that we want to use for URIs) has many, many edge cases. This class should make it easier to construct additional tests.
Add a reference to the relevant specification. Add some more UTF-8 tests along with a few associated fixes to my tweaks to the Harmony UTF-8 decoder on replace. Move a test from the old to the new test framework. Still lots more tests required.
Add final zero padding test Associated fix to my tweaks to Harmony's decoder
Reduce what is skipped. Make flags more easily extensible.
Move the single byte tests to the new framework Expand the single byte test cases Add leading and trailing valid bytes to invalid sequences to check the valid bytes are not replaced Improve handling for when JVM decoder spots error later than the earliest point Add handling for when the JVM decoder swallows the trailing valid byte Add malformed replacement checking to the old framework Update Tomcat's UTF-8 decoder to use rules from unicode 6.2, chapter 3, table 3-7 for valid byte sequences Update test cases for these stricter tests 
Add test from unicode 6.2, chapter 3, table 3-8 Tomcat's decoder needs to check bytes in the range 80..BF start 10xx xxxx rather than 1xxx xxxx
Remove comments used to debug
Review current code with respect to original Harmony code. - Revert a couple of incorrect changes made along the way. - Fix formatting for cleaner diff - Adjust comments ready for wider use
Switch B2CConverter to use Tomcat's Harmony based UTF-8 decoder
Add some tests for truncated valid values
Make UTF-8 test cases public so they can be used for other tests. Add tests for request bodies using UTF-8. Fix failures for UTF-8 request bodies where incomplete sequences at the end of the stream were ignored. They now throw an exception as they do if they appear in the middle of the stream.
Port the 2-byte UTF-8 unit tests to new framework
Remove debug code
Move remaining tests to new framework. Remove old tests.
Rename now this is the only UTF-8 test
Update for rename
Remove one deprecated and one unused method
Correct comment.
Refactoring towards v014 API (not yet complete)
Refactoring towards v014 API (not yet complete)
Refactoring towards v014 API (not yet complete)
Refactoring towards v014 API (not yet complete)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54638 The status page of manager webapp was reporting wrong value for "Used" memory in XML mode.
Fix several issues with the schema, aligning it with actual output generated by StatusTransformer class. 1. Add memorypool element to status.xsd schema. 2. There is no minSpareThreads attribute on threadInfo. Removed it from xsl file as well. 3. There can be 0..many workers 4. There can be 1..many connectors  To test, one can save output of /manager/status?XML=true command and add the following attributes to the root <status> element: xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="status.xsd"
Refactoring towards v014 API (not yet complete)
Refactoring towards v014 API (not yet complete)
Refactoring towards v014 API (not yet complete)
Complete update to v014 API plus some minor proposed tweaks
Control messages can be sent in the middle of a fragmented message.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54612 Check if socket is closed before trying to write a message to it. Also, flush any partial buffered data before closing the socket.
Clarify how context paths are derived.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54624 Read request body before content length header is restored for the old request as AJP connector uses this to determine how many bytes to read (and it will block until they are read)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54628 Only write data from start position in array rather than start of array. Patch provide by blee.
Allow membership longer to establish
Javadoc updates
Align implementation with spec
Remove unnecessary TODOs
Address some low hanging TODOs
More low-hanging TODO fruit
Don't always create a new POJO instance for a Server endpoint.
More low-hanging TODO fruit
Fix infinite loop
Add missing defaults
Client side POJO support with a simple test case
Align pojo package with async->partial and basic->whole renaming in API
Align pojo package with String->Text renaming in API
Better unwrapping of messages Start to add plumbing for decoding
More decoder plumbing
More plumbing for Decoders. Still more work to do to get this working end to end.
Get encoding and decoding working end to end with an associated unit test
Fix external javadoc URL for commons-io.  - Add correct "proper/commons-io" prefix to no   longer rely on legacy link redirects - Add new needed path segment "/javadocs/"  See: https://issues.apache.org/jira/browse/IO-369 http://svn.apache.org/r1451593 
Add info about failing charset to unit test. 
Fix failing unit tests
Log message on SCI error
Update file name for ServiceLoader
Prevent errors if Jar scanning is a too keen
Add the websocket JARa to the Maven publishing process
Update method name in comment
Fix upgraded connections (i.e. WebSocket) and SSL for the NIO connector
Fix concurrency issue. doWrite() add the socket to the poller if there are bytes left to wrote. The may poller fire and execution could reach onWritePossible() before the remaining bytes have been copied to the buffer thereby triggering an NPE.
APR read/write need to use the same locks for changing the blocking status of the socket
Fix comment typo
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54671 Align implementation with spec
Test case that attempts to replicate the problem I am seeing with WebSocket and APR. The test case currently passes. The major differences are that the test case doesn't use a poller and doesn't use SSL. I'll add those next.
Comment in/out the right bits.
Add poller to test (still passes)
Add SSL. Test still passes.
Make SSL optional Try to write data in one large chunk. Unexpected values for written are now observable.
Problem now reproducible (need to drop chucksize to 2)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54684 Added 'javax.naming.spi' to the header 'Import-Package'
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52318 The version for imported package 'org.apache.juli.logging' is extended to include 7.0.x versions. Patch provided by Martin Lichtin.
Better comments after previous changes.
Check that the loader is not null. There are use cases where the loader does not have parent.
Check this in before I start to work on the APR/native SSL issue
Initial fix for APR/native + SSL issues.
Fix publishing to Maven for 8.0.x
Fix the recycling of the o.a.t.u.buf.UEncoder.output field.  Fix javadoc.  Add a test case.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54690 Use server defaults not client defaults for SSL protocols and ciphers if none are defined for the connector.
Fix Findbugs warning
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54660 Allow the AccessLogValve file data format to be changed via JMX. The change takes effect as soon as the next message is logged.
Fix import order (checkstyle)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54658 Servlet 3.1: Implement getSubmittedFileName() Patch provided by Nick Williams
Remove deprecated code
Correct typo reported via comments.a.o
Correct typo reported on the users list http://tomcat.markmail.org/thread/xnxj7whkh6hnsd3t
Extract some reuseable code
Wrap long lines, remove indent from <pre> (<source>) blocks to reduce horizontal scrolling.
Better introduction of the Manager web application. Added mention of Tomcat Maven Plugin project.
s/7.0/8.0/
Context descriptors are not created for deployed apps in Tomcat 7. Minor tweaks.
Correct example. (The manager webapp was in server/webapps in TC 5.5, but not now.) Add RemoteAddrValve to Manager configuration examples.
Rephrase the context naming rules.
Clarify
Correct a typo
Correct merge info
Merge upadtes from Commons FileUpload prior to code re-org
Javadoc tweaks
Merge updates from Commons FileUpload to r1453029
Merge updates from Commons FileUpload to r1453202
Merge updates from Commons FileUpload to r1453230

Merge updates from Commons FileUpload to r1453285
Merge updates from Commons FileUpload to r1453817
Merge updates from Commons FileUpload to r1453844
Merge updates from Commons FileUpload to r1455031
Merge updates from Commons FileUpload to r1456912
Merge updates from Commons FileUpload to r1456918
Re-remove deprecated code that sneaked back in during a merge
Review the diff to FileUpload trunk and better our fork
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54702 Close the stream at the end of the parse operation.
Update to Commons IO 2.4 and run UCDetector over the copied classes
Expose new rotate method via JMX
Need to check all types for OnParam and if one is found, move on to the next parameter
Correctly handle two stage close process.
Add a test that confirms BZ 54631 is not an issue. An added bonus was that this test found the close process was not correct. That has now been fixed.
Update comment. Make state volatile
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54707 Relax parsing of LHEX and <">LHEX<"> to allow either whenever one is expected Additionally:  - improve comments  - move back one char when parsing in a consistent manner  - fix edge case bug if first character of quoted token was not valid (it was incorrectly accepted)  
Additional test cases
https://issues.apache.org/bugzilla/show_bug.cgi?id=54707 Review of r1457303: 1) Correct comments. 2) In readLhex(..): Document lowercase conversion. It was documented before r1457303 and I think it is in line with support for incorrect values implemented in response to BZ 54707. Convert digits to lowercase on the fly, instead of relying on String.toLowerCase() call. This should generate less garbage for GC.
Remove stray message key that has no value. It was added by r1433976 and is not used there.
Document the command to quickly build documentation, without using a "deploy" build.
There was a reason mark/reset was used here. Restore use of mark/reset and add a comment.
Add/improve Javadoc
Renames to make code clearer Fix a bug - only look for a Throwable for onError methods
Provide some meaningful error messages for the exceptions
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54712 Code clean-up. Use Locale.ENGLISH consistently for upper/lower case conversions.
Change the name of the working directory for the ROOT application (located under $CATALINA_BASE/work by default) from _ to ROOT.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54709 http  -> ws https -> wss
Don't re-throw exception if we can't send the close message. Use onError.
Follow up to r1457515
Fix parsing of HTTP headers. The parser was reading beyond the end of the HTTP response and swallowing and pipe-lined WebSocket messages.
Need to pass query string to server too.
Review of r1457429: Make logic more clear. No functional change.
Remove resolveHosts attribute from MBean descriptor. resolveHosts attribute is no longer supported.
Enable support for overloaded methods
- The listener field didn't seem to be recycled anywhere. - Throw an ISE if already set (the spec says that).
Don't look for mask if it isn't there. (Processing of short frames was broken on the client.)
Correct typo reported via comments.a.o
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54609 Update to Commons Daemon 1.0.14 (Already done in TC7 with r1457889 )
Don't try to write zero bytes if the buffer is emoty when flushed.
A test client for running the autobahn tests as a client.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54711 Part of https://issues.apache.org/bugzilla/show_bug.cgi?id=54711 Use timeout value to ensure infinite write timeouts are supported for clients.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54711 Fix multiple issues with OutputStream and Writer Based on a patch by Nick Williams
Update changelog to add WebSocket. As it is a new spec I added it to the beginning of the changelog. I'll so the same for Servlet 3.1, EL 3.0 and JSP 2.3 when they are implemented.
Add new messages
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54710 Add support for InputStream and Reader to OnMessage Add support for CloseReason to OnClose Based on a patch by Nick Williams
Change class name so it isn't included in unit tests
Syncing with Commons Fileupload trunk
Syncing with Commons Fileupload trunk
Updates after reviewing diff between Tomcat and Commons versions of Fileupload
Remove matchesURI as per EG discussion
FindBugs: There needs to be the same number of place-holders as there are replacements.
Implement modifyHandshake() call Based on a patch by Nick Williams
Fix failing unit tests. Add missing call to mark the Handshake request as finished.
Refactor
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54716 Make Calling on POJO method more robust if those methods throw an exception.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54721 RemoteEndpoint blocks indefinitely if sendObject called with BinaryStream of TextStream encoders Patch provided by Nick Williams.
Fix regression. Always add method handlers whether there is an onOpen method or not.
Whitespace police
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54724 Session should throw IllegalStateException if closed when methods on it are called
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54716 Additional fix. Avoid NPE on session de-registration. Based on a patch by Nick Williams.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54726 Include WebSocket META-INF files in core embedded JAR
A RuntimeException in one test shouldn't stop the test run.
Once a close frame has been received, don't process any more frames.
Tab police
Fix typo
As highlighted by the Autobahn tests, a protocol error needs to force an immediate close. The server can't wait for a echoed close frame from a connection that is in an unknown state.
Update to Commons Logging 1.1.2
Update Commons Fileupload to r1458500
Whitespace police after merge
Correct typo reported via mailing list
Drop the tests for the non-JSR356 WebSocket implementation
Drop the non-JSR356 WebSocket implementation
Align implementation with new name in spec WsProtocolHandler -> WsHttpUpgradeHanlder Align implementation with new HttpServletRequest.upgrade() method
The JRE (since Java 6) ships with a perfectly good Base64 Encoder/Decoder. Use it.
Replace Tomcat's own base64 encoder with the one from the JRE.
Add note on removal
Remove deprecated code
Add test case used to investigate Base64 decoder performance
- I am pretty sure the point of the upgrade(Class) method is to be able to inject, so the instance manager has to be used. - Add InstanceManager on Context, and also add newInstance(Class) - not really needed, but it probably doesn't hurt.
Deprecate Base64 and switch to DatatypeConverter
Remove Base64 and the associated test case
Add new methods
Fix some Eclipse nags
Switching to the new Decoder has fixed a couple of TODOs. Update the comments and tests accordingly.
Keep auth headers out of the StringCache
Buidlbot needs a little longer
Ensure HEAD requests return the correct content length when the requested resource uses a Writer. Patch by Nick Williams.
New file for keeping track of svn merges etc
Tweak wording
Import a package renamed copy of Commons Codec with just those bits required for Base64 encoding/decoding
Add the ability to decode a subset of a byte array as this will enable Tomcat to use the decoder more efficiently.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54734 Partial fix javax.servlet.http.WebConnection needs to extend AutoCloseable Based on a patch by Nick Williams
Switch to Base64 encoder/decoder from Commons Codec
Increase socket timeout in an effort to reduce false failures on buildbot
Improve performance for typical use cases by roughly an order of magnitude
Fix a JVM crash with the unit tests on Windows. Only add the socket back to the poller if the poller did not report an error in the previous poll.
Default poller size always needs to be equal to maxConnections
Fix constant
Use constant
jdbc-pool tests need JUnit 4. Use the same version of junit as used by Tomcat.
Add NPE protection and add missing filtering of POJOs.
Make error messages rather more useful
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54599 jdbc-pool: Do not expose connection password via DataSource.toString(). Based on a patch by Daniel Mikusa
Remove stray obsolete comment. This method has been already implemented.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54732 Fix leak of statements in StatementCache interceptor.
Client needs to send request sub-protocols
Add support for primitive messages (and their object equivalents)
Documentation for StatementCache interceptor.
Hack to get the TCK to work
Automatically encode primitives and their object equivalents.
Need to generate a MessageHandler for primitives
Need to set indexPrimitive for MessageHandler to be picked up
Need additional packages to be in util JAR for websocket
More plumbing for handling primitives. Still some bits missing.
Add 'final'
Remove UserDataHelper properties read permissions from "tomcat-juli.jar" section of catalina.policy The class using them was moved to o.a.t.util.log package and is now in tomcat-coyote.jar.
Update the doc, as Apache Commons Codec classes were added in r1459218
Remove unneeded ';'
No need to create a new String if data length is 0.
Fix NPE in TestSlowQueryReport test  The TestSlowQueryReport L107 calls "new SlowQueryReportJmx().getObjectName(..)", and thus properties field in new SlowQueryReportJmx is never set and accessing it caused NPE in getObjectName(..).
Change wording of the comments section notice. I hope this one is more clear.
Change sample jsvc run command to a) include proper configuration for logging b) explicitly use CATALINA_HOME and CATALINA_BASE variables, as it is more guaranteed to work (as suggested by a comment via comments.a.o)
Fix visibility. Thanks to kkolinko.
Better @PathParam handling - null can be coerced to some types (e.g. boolean) - if decoding fails, need to throw DecodeException from onMessage
Once we have all of a partial message send it on if we can. Don't buffer it as we have no idea if/when the next part of the message might arrive.
Once we have all of a partial message send it on if we can. Don't buffer it unless we have to as we have no idea if/when the next part of the message might arrive.
Use URI not URL
Need to flip the buffer before converting it
Types won't be exact matches. Use isAssignableFrom
Use StringBuilder, followup to r1460477
Correct typo reported via comments.a.o
Types won't always be exact matches. Use isAssignableFrom
Return once a match has been found else an error will occur.
Mention that revision number is mentioned in package-info.java
Add a comment
Followup to r1454962 Simplify code, move prefix string outside the loop  I have not profiled this, but looking at source code Class.getPackage() relies on Class.getName() and ClassLoader.getPackage(name), and thus have to be slower than just calling getName().
Test for the issue fixed by r1457403
Javadoc says use empty string not null for no agreed sub-protocol
Partial fox for https://issues.apache.org/bugzilla/show_bug.cgi?id=54734 Add new throws Based on a patch by Nick Williams
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=54734 Implement new method ServletContext#getgetVirtualServerName()
Deprecate old method that was used to build JMX names
Remove deprecated code
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54740 Update SCI scan to reflect changes in spec
Fix. Thanks to kkolinko
Code review while looking at https://issues.apache.org/bugzilla/show_bug.cgi?id=54746 Prevent recursive close calls.
Code review while looking at https://issues.apache.org/bugzilla/show_bug.cgi?id=54746 No need for this. The container handles it (and now protects against recursive calls if an endpoint does do this).
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54740 Fix @HandlesTypes
Fix extras logging build broken by upgrade to CL 1.1.2. The change of source path needed to replicated in more places.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54748 Don't generate an error during a normal close that there is more data to read when there isn't.
Add some plumbing in preparation for wss support on the client side
Add some comments
Remove unused method. -setProperty -getProperty -getPropertyNames -removeProperty -transferProperty These methods for configuring the cluster manager property is not being used.
Fix a typo
Update to Eclipse JDT Compiler 4.2.2
First cut of an SSL client implementation for WebSocket and a simple test case to demonstrate that it works.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54755 Endpoint instantiation should be via Configurator Patch provided by rstoyanchev
Add Rossen
Fix Javadoc errors
Speed up test, reduce errors reported in logs
Followup to r1461318. Use the value that has already been read into a local variable.
Update Commons FileUpload 1.3 
Remove unused property.
Followup to r1446077. Remove unused method.
Remove unused class. JvmRouteSessionIDBinderListener and SessionIDMessage are no longer used.
Followup to r1462408. fix docs.
Switch to a Filter based rather than Servlet based implementation and fully implement the mapping rules for WebSocket requests.
Add changelog entry for remove of JvmRouteSessionIDBinderListener and SessionIDMessage.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54802 Provide location information for exceptions thrown by JspDocumentParser
"Monitoring and Managing Tomcat" Corrected text for link to Java documentation. It is Java 6, not 5. Mentioned that for local monitoring no special configuration is required. Clarified the "set CATALINA_OPTS" command which was a mix of Windows and Unix syntax. Mentioned JmxRemoteLifecycleListener. Reduced indents and wrapped the text in several places. The document was unreadable due to horizontal scrolling. Cleared the list of authors. This document is a collective effort.
Change order of arguments in preparation for a better API (I mean varargs).
Remove deprecated methods
Simplify API of ErrorDispatcher class by using varargs. Localizer will now treat zero-length array of arguments in the same way as null.
Change spelling
Correct indents
Remove "encoding" field of Mark. It was assigned, but never read.  Make Mark.IncludeState class static. It did not have "encoding" field, so its constructor was overwriting the one in Mark class.
Followup to r1465810 Convert two more methods to varargs form
For https://issues.apache.org/bugzilla/show_bug.cgi?id=54802 Provide location information for exceptions thrown by JspDocumentParser
Two minor optimizations in JspDocumentParser.processChars(): a) Replace repeated getter calls with a local variable. b) No need to reallocate CharArrayWriter to clear it. You can call reset().
Minor optimization in Parser.parseXMLTemplateText(): No need to reallocate CharArrayWriter to clear it. You can call reset().
Correct typo, s/Xml/XML/
Add document for Cluster Deployer.
remove invalid comment.
Remove unnecessary method call. There is no need to send the UndeployMessage when updating WAR.
Add support for specifying a pathname that is relative to the $CATALINA_BASE directory.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54851 Directories without any web.xml fragments should not impact the status of distributable. Patch provided by Trask Stalnaker.
Make sure that war is installed on the local container before installed on other cluster nodes.
Add support for Host#xmlBase.
trivial improvement. -check cluster members before sending replicate message. -avoid unnecessary calculating of Iteration count for background processing. 
Expose processDeployFrequency via JMX. 
Trailing white-space police.
Remove reference to (removed) unnecessary listener
Remove Javadoc for non-existent parameter
Bracket police
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54822 Fix handling of query strings with SPDY. Based on a patch by Sheldon Shao.
No longer using Servlet mappings
Simplify
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54807 Forgot to create TreeSet with correct Comparator. Add a test case that checks the context starts correctly.  Also, TemplatePathMatchComparator is thread-safe so use a single instance rather than creating multiple instances.
Align API with spec. Update tests for new API.
Remove ServerContainerProvider. Should be the last of the API changes.
Set ServletContext attribute to expose the ServerContainer. Refactor the ServerContainer bootstrap.
Whitespace police
Use the ServletContext attribute in unit tests. Remove unnecessary double init() of ServerContainer
kkolinko review Query string starts at first ?
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54872 https://issues.apache.org/bugzilla/show_bug.cgi?id=54872 Correct the range for the bindPort of the cluster receiver object. Correct the example.
Clean-up: Remove unnecessary code.
ignore idea files
fix maven build for jdbc-pool
Avoid redeploying war during master node restarts.
Follow-up for r1469138. In HostConfig#check(String), if redeploy resources are updated, ensure that the application is deployed immediately.
Avoid a memory leak with the background processing thread
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54800 Fix memory leaks when using WebSocket client triggered by JVM created threads not having the correct context class loader set.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54792 Application shouldn't be trying to close the session in an @onClose method.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54781 Fix NPE if no matching Endpoint is found. Handle forwarded requests as well.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54708 Handle ROOT##version as well Suggestion by kkolinko
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54178 Protect against AsyncListeners that throw RuntimeExceptions (they should normally only throw IOExceptions). Includes a test case.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54791 Restore tools.jar entry in jarsToSkip
Fix BZ54890. Update daemon to latest release
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54801 and https://issues.apache.org/bugzilla/show_bug.cgi?id=54821 Don'try to parse EL expressions if EL is disabled or inside scriptlets. Based on patches by kkolinko
Fix failing unit test now that a RuntimeException in an AsyncListener is caught and logged.
Fix a handful of unit test failures triggered by WebSocket init changes.
Fix some more unit test failures triggered by WebSocket init changes.
Fix some NPEs observed while investigating some unit test failures.
Fix failing WebSocket unit tests after session closure refactoring
Seeing some failures in 7.0.x. Reduce timeout to make them easier to repeat.
Don't use port 8080 for unit tests
Another NPE in the WebSocket tests.
Fix double start of Resources noticed while investigating CI unit test failures
Improve logging by naming the Servlet that hasn't stopped.
Extend read timeout to 30s for this test as JSP initialisation seems to take longer than 3s.
Slightly shorter timeout. Add a note.
First draft of Diagnostics class. 
Wire Diagnostics to manager webapp text interface. Not yet documented. Wiring for html interface still missing. 
Explicitly restrict HTTP upgraded connections to a max of one thread for read and another for write.
Fix some ISEs that were appearing in the logs.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54888 Support a csv list with the ForEach tag plugin Based on a patch provided by Sheldon Shao
Clarify the diagram
Remove unused ActionCode
Better Javadoc
Remove unnecessary ActionCode.SET_READ_LISTENER Add missing tests when setting a non-blocking ReadListener and use i18n for all exception messages if a test fails
Remove completed TODO
Simplify ActionCode.SET_READ_LISTENER Add missing tests when setting a non-blocking ReadListener and use i18n for all exception messages if a test fails
Better Javadoc
No need to retain reference to ReadListener in InputBuffer
Restore accidentally removed call
No need to retain reference to WriteListener in OutputBuffer
Remove unused code. Ensure WriteListener is recycled.
Refactor methods that call read/write listeners out of AsyncContext as CoyoteAdapter has all the information it needs to call them itself.
Remove copy/paste comment and trivial clean-up
Remove the request.isAsyncOperation() method and the associated plumbing as res.getWriteListener() != null does the same thing with less code. Add a (currently unimplemented) dispatch() line from READ_WRITE_OP to the state diagram.
Add a simple unit test for async writes. This (unexpectedly) passes on all three connectors.
Refactor canWrite -> isReady to align with changes made to Servlet spec
Servlet 3.1 Default Servlet async timeout is 30s.
Take the PrintWriter out of the test - it adds too much buffering which makes figuring out what the non-blocking API is meant to be doing harder than it needs to be. Increase the timeouts to allow debugging.
Limit to one non-blocking write at a time.
Typo, line length
Flush also needs the non-blocking test
Refactor to simplify support for non-blocking IO across all HTTP connectors
Simplify
Better comment
Make inner class static
Pull up NB_WRITE_INTEREST
Better comments. Move inner classes to end
Wire in flushBuffer()
Align flush() implementations
Pull-up flush()
Align endRequest() implementations and pull-up changes in over-riding methods
Implment a standard isBlocking() method for output
Rename for clarity
Remove unused code
Pull up the buffer that holds non-blocking writes. This allows setBlocking() to be pulled up and given a common implementation.
Pull up hasDataToWrite()
Copy buffering for non-blocking writes from NIO to APR and align code
Fix test. Can't continue writing to output after an async complete
Minor tweaks
Refactor in preparation to pull-up non-blocking functionality
More refactoring
A little more refactoring to make pulling code up easier
Pull up changes to process()
Servlet 3.1 non-blocking refactoring Pull up InputBuffer to AbstractHttp11Processor
Pull-up non-blocking code for asyncDispatch from NioHttp11Processor to AbstractHttp11Processor
Update non-blocking test so it passes with current code.
Pull up read event registration
Fix a TODO in passing
Remove unused code
Another TODO. Inputs are never null.
Another TODO Add an error message
Another small TODO.
Faking of non-blocking reads for BIO. Tweak test case so it relies more on the Servlet API and less on the implementation details of the test so BIO's fake blocking passes.
Filip's changes fixed non-blocking writes
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54926 Re-order the validation checks. Order is now: - Is this a WebSocket upgrade? - Is there a matching endpoint? - Validate remaining headers
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54906 Better error message for ConcurrentModificationException when checking for memory leaks and continue with remaining checks. Based on a patch by NateC.
204 responses are permitted entity headers
Remove accidental commit. No convinced this helps yet.
Silence some Eclipse warnings about unused code
i18n
i18n for diagnostics using the user's Locale
Deal properly with 204 responses
Set svn:eol-style native. 
Avoid FileMessageFactory leak. FileMessageFactory will be removed immediately after receiving the complete WAR file but when failing to receive a FileMessage which was sent dividing, FileMessageFactory will leak without being removed. Add a newly maxValidTime attribute to prevent the leak of FileMessageFactory. FileMessageFactory that is leaking will be automatically removed after maxValidTime.
Fix copy/paste error - thanks kkolinko
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54703 Be tolerant of applications that pass CR or LF in setHeader() values. Fix some whitespace parsing issues idnetifed by the extended test cases in readTokenOrQuotedString()
Typo
Fix the last access time TODOs (we'll need the wrapper for the non-blocking changes anyway).
Add support for using non cluster manager in cluster environment.
Rename in order to prevent execution errors in via JMX. addLifeCycleListener -> addLifecycleListener removeLifeCycleListener -> removeLifecycleListener
Comment typo
Refactoring to remove unnecessary SET_WRITE_LISTENER action
Missed a few things with the refactoring to remove SET_WRITE_LISTENER
Stop tests failing because nbRead isn't implemented.
Implement non-blocking write for APR. Add some trace level debug code to AprEndpoint that was useful in getting this working.
Non-blocking write has been implemented
Non-blocking Servlet 3.1 reads for APR
Tomcat 8 implements Servlet 3.1
Add the Java EE 7 XSDs. The changes from the originals are: - addition of a notice electing to license only under CDDL - removal of trailing whitespace - removal / replacement (which spaces) of tabs
Update deployment descriptors to Servlet 3.1
Rename webapp-3.0 test webapp to webapp. Tests that are not explicitly designed for a specific web application version will remain in this new location. Tests that require an specific web application version to be declared in web.xml will be moved back to the (soon to be re-created) webapp-3.0 location
Add the new 3.0 and 3.1 specific test web applications
Move the 3.0 specific tests from webapp to wepapp-3.0. Copy the tests to 3.1 (tests and results should be the same).
Fix overly enthusiastic copy/paste.
Fix broken test after re-org Add test for servlet 3.1
More license updates for new XSDs
Another Java EE 7 XSD license update
Add constants for new XSDs Ensure new XSDs are registered as local schema Add 3.1 version check to web.xml parsing with the associated unit test
Tweak the debug code. Use debug to show method calls and other key events. Use trace to add stack traces.
Only register for write when using non-blocking and there is more data to write. This fixes various crashes in APR due to trying to add the same socket to the poller twice.
Fix missing message
Review of r1481005 1) correct typo in the path to javaee schema file. It is "javaee_7.xsd", not "javaee_6.xsd" one. 2) make line indents consistent with adjacent lines
Diagnostics vmInfo: - sort logger names and system properties - add info about memory and GC 
Make remaining MXBean methods that trigger an action or change data available in Diagnostics API. 
Followup to r1480964 Two other places to return "1" from ServletContext.getMinorVersion() in Tomcat 8
- reduce visibility or one internal method - reorder some methods - Fix JavaDocs - add missing StringManager entries 
Replace unusual timestamp format with a more common and useful one. 
Fix Javadoc fixes. 
Start to write test cases for automatic deployment
Use session cookie name as a marker to identify which context.xml was deployed in those scenarios where multiple context.xml files are present
Prevent file locking on context stop
Simplify. Review by kkolinko
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51294 This is an initial implementation that includes some but not all the anticipated test cases. It is expected that as the test cases are expanded, further changes will required. Remove the comments from the context.xml files that have been replaced by using the sessionCookieName.
Format police
Prevent possible WAR file locking when reading context.xml from WAR
Ensure HostConfig has the latest settings of copyXML, deployXML and unpackWARs before performing automatic deployment.
Add tests for WAR+XML based deployments.
Complete the implementation of the deployment tests
Java 7 <> police
Refactor handling of JAR resources so that JAR files containing resources (including WARs) are not permanently locked.
Add the first part of the deletion tests for the auto-deployer. Note: These tests identified another JAR locking issue (fixed in r1482590)
Avoid NPEs when attempting to destroy contexts that failed to start.
ReplicationValve is instance of ClusterValve. Rather than get cluster instance from container on every request, use instance variable.
Reduce nest.
Cluster instance is not necessary to argument of the method.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54974 SessionCookieConfig.setXXX methods will throw IllegalStateException if the ServletContext from which this SessionCookieConfig was acquired has already been initialized.
More deployment tests
Return the correct version number (2.3) of the JSP specification that is supported by the JSP engine when javax.servlet.jsp.JspEngineInfo#getSpecificationVersion() is invoked.
Fix indentation (with Eclipse tooling)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54932 Fixed a broken link to Tribes documentation.
Change auto-deployment behaviour on deletion. Redeploy order is now always (not all entries will be present) - XML - WAR (appBase or external) - DIR (appBase or external) - global resources  When a resource is deleted, all resources below it in the above list are also deleted except external and global resources
MOre deletion tests for auto deployment
Complete the deletion tests
Start the modification tests
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54981 ServletContext.getJspConfigDescriptor() must return NULL when there is no jsp configuration
Add another test
Revert r1482834
Reload rather than redeploy a web application when XML and external WAR are present and the WAR is updated. No need to redeploy since the XML won't change.
Update tests after reverting r1462824 Add more modification tests
Refactor (no functional change) so it is easier to change the behaviour when modified resources are detected
Refactor to enabling reloading rather than redploying of a context when a WAR file changes and there is an XML file present in the Host's configBase. In this scenario, the context object doesn't need to be re-created because it's config won't change - it is defined by the unchanged XML file in the HOst's configBase.
Remaining tests for modification
Update expected behaviour comment
Add warning about 'hidden' DIRs in the appBase
Start the addition tests
Add redeployResources entries for files that don't exist with a last modified time of zero to detect the addition a WAR or XML when just a DIR exists
More addition test cases
Add dummy reload resources to trigger a reload if a WAR or DIR is added to an XML Add dummy redploy resources to trigger a redeploy if an XML is added to a WAR
More addition test cases
Add the remaining addition tests and refactor some duplicate code.
Add test cases for setting unpackWAR on the context
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54899 Provide an initial implementation of NetBeans support. Patch provided by Brian Burch.
Correct product names
Followup for Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54899 Rename the file, so that it is picked by "text.files" pattern in build.xml. As such its end-of-lines would be properly converted when packing the sources.
Further followup for Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54899 Correct product names
Remove unnecessary and potentially mis-leading notices that were added by the original author.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54955 During reloading the application, the context root Wrapper is not removed correctly. This causes 404 to be returned later on when the context root is requested.
Check for EOF in case the server hangs up unexpectedly.
flushRequired applies to final write only
Hnadle partial writes
Enable remaining tests Fix failures
Main test webapp should be same version as container
Add a web app that fails to start for use in deployment testing
Make WAR break later in the deployment process
Make deletion of the copied WARs used for anti-resource locking more robust if the context fails to start (there were some circumstances where the original WAR could get deleted). Add some test cases to check this.
Fix test failures when the file timestamp hadn't moved far enough for the OS to report it as changed.
Clean-up / simplify based on review by kkolinko.
Cleaner handling of errors Session may have been closed after an error so get the latch before it closes.
Revert r1485458. Right idea but that isn't how to do it.
Revert r1485458. Right idea but that isn't how to do it.
Revert r1485489 - wrong file commited
Refactor passing of the latch to improve robustness on test failure. Once the session is closed, user properties are no longer accessible.
Sometimes need a little more time for the cluster to establish
-1 means infinite timeout, not use socket timeout
Be smarter about when we remove a socket from the Poller.
Add missing message
Better error message
Only try a non-blocking read if non-blocking is being used
Correctly init WebSocket to avoid NPE
Add some NPE protection
Trivial formatting
Remove duplicate code
Make this public to expand how the class can be used for unit tests.
Trivial formatting
Improve Javadoc
Marginally more efficient
Implement new isFinished() method that identifies when a request body has been fully read. Required since available()==0 != isFinished()
Use new isFinished() method rather than available==0 Check if body has been read in non-blocking mode when exiting service method
Add a test case for bug 54928
Modify test to check onAllDataRead() is called correctly
Non-blocking ends when async ends so ensure listeners are cleared
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54984 Ensure that the correct encoding will be used when processing the multipart data.
Trigger non-blocking error handling if the client hangs up while an APR socket is in the Poller.
Temporary disable the test check.
Remove some debug hacks accidently included in previous commit
Enable the test check again. Now it is also passing on OS different than Windows.
Typo - it should be 'finally' and not 'catch'
https://issues.apache.org/bugzilla/show_bug.cgi?id=55019 Preload the Constants class during connector init.
Revert: the issue is not reproduceable on trunk (or 7) without the fix, although I am not sure where the Constants class is actually loaded.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54931 Add information on creating multiple services. Based on a patch by Chris Derham
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54944 Enhancements to TestFormAuthenticator. Patch by Brian Burch
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54947 NIO connector incorrectly rejects a request if the CRLF terminating the request line is split across multiple packets. Patch for the fix by Konstantin Preier. I added a test case.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54961 Make "compress" configurable in SpdyProxyProtocol. Patch by Sheldon Shao
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54963 Fix concurrent issue of Spdy/NetSupportSocket Patch provided by Sheldon Shao
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54964 Enable tag plug-ins to be packaged with a web application. Patch by Sheldon Shao.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54971 Pass the calculated location to AplicationPart rather than it having to recalculate it every time. Now correctly handles relative locations.
Correct typo in method name. (Noted when reviewing r1486884 ).  Though I think it might be clearer to split this method into two separate setters, setTls() and setCompression().
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54997 Handle BUFFER_UNDERFLOW during SSL handshake.
Align onWritePossible behaviour with the spec. This passes the unit tests on Windows. Still some TODOs to resolve once I have checked this passes the tests on other platforms (including the CI system)
Fix logic error
Simplify. Buffered data left over after a non-blcoking write is written in the processor
Remove some accidentally committed test code
Simplify
More test code - sorry for the noise
Remove test code
Refactor write event registration for non-blocking IO. Unit tests pass on Windows. Need to check other platforms.
Make test a little more robust
Remove this unnecessary test. The root cause of the APR/WebSocket problem was not repeating an incomplete write with exactly the same buffer.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54999 Fix JSESSIONIDSSO not recreated when a logout and login occur in the same request. Patch provided by Keith Mashinter
Remove unnecessary code
Get these tests passing on my Mac
Add a cut down, simple to debug, multicast tester than can be used to determine if multicast cluster membership is going to work in a given environment.
Finally figured out how t get multicast working locally on my mac. Document it.
Add note on testing multicast
Routing table doesn't show it but it looks like firewall was the only issue.
Fix typos
(Reviewing r1485114) Make antiLockingDocBase an absolute path. It is very unlikely that java.io.tmpdir is not an absolute path. For consistency, convert it to the absolute form just once, so the path used when starting and stopping the webapp is certainly the same.
Fix typo
Remove unnecessary Javadoc
Ensure consistent view of flipped and bbuf when doing non-blocking writes
Typo
Better handling of socket close as there might be multiple threads working with the socket
Add document for o.a.c.tribes.group.interceptors.TcpFailureDetector.
Add maxWait attribute that the senderPool will wait when there are no available senders.
Improve error message by including specified timeout if failed to retrieve a data sender. 
Match after to allow app filters to examine / modify the request.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55035 Add support for the version parameter to the deploy Ant task. Patch provided by Sergey Tcherednichenko.
Clean-up
Clean-up (prior to merging in changes for CORS patch)
Clean-up (prior to merging in changes for CORS patch)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55046 Add a Filter that implements CORS (http://www.w3.org/TR/cors/) Based on a patch by Mohit Soni.
Review comments from kkolinko
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55052 Fall back to un-prefixed property if a prefixed one is not present
Some more unused code clean-up.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54939 Log errors parsing HTTP request headers. 
IllegalStateException will be thrown if more than one asynchronous dispatch operation is started within the same asynchronous cycle.
Update to Apache Commons Logging 1.1.3  If you svn diff 1_1_2 and 1_1_3 tags of commons-logging, the differences are - Documentation - Manifest and POM files (fix for LOGGING-151), irrelevant to us - Removal of some JARs from build.xml (r1483534), which we do not build either. - Versions of dependencies  There have been no changes to the java code.
Trivial clean-up
Restore Javadoc to the getCoyoteResponse() method which has been deprecated, removed (r1188402) and resurrected (r1358055).  This method is currently used by RewriteValve.  BTW, one place where I see that getCoyoteResponse() method would be useful is to access response.getCoyoteResponse().getMimeHeaders(), e.g. to call removeHeader(String) which is not exposed via Servlet API.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54939 Follow-up to r1489444: Update description of UserDataHelper uses in documentation. Corrected a typo s/to/too/.  
Refactor WAR deployment to make a per Context copyXML attribute possible
Add the ability for a context.xml file in a webapp to override the default value of copyXML on the host. There are some 'interesting' edge cases here. Test cases to follow.
Documentation tweaks for CORS filter. Patch provided by Mohit Soni.
Add removeSuspectsTimeout attribute in order to dispel remove suspect. The removeSuspects members never be removed until disappeared really. Remove members that worked properly specified time by removeSuspectsTimeout from removeSuspects.
Add test cases for context level copyXML and fix bug they identified.
Try and clarify the rules for context names when using automatic deployment
Delete leftover of war file from tempDir when removing invalid FileMessageFactory. 
Change Maven Central repository location to be repo.maven.apache.org
Try and simplify description of automatic deployment. Remove duplicate information and add new space that more clearly defines the expected behaviour (the new page is not yet complete)
Ensure that the keepAlive of NioSender works correctly when keepAliveCount/keepAliveTime is set to a value greater than 0.
Complete the automatic deployment docs
Trim trailing whitespace, as reminded by checkstyle
Trim trailing whitespace, as reminded by checkstyle
Update junit to version 4.9 Download it from Maven Central instead of GitHub
Followup to r1491596 Restore omitted attribute name.
Servlet 3.1 requires an ISE if getRequest() or getResponse() are called after complete() or dispatch()
Add a comment as the default is not set where one might expect.
Fix typo spotted by kkolinko
No need to use fully-qualified name now that it has been renamed from ProtocolHandler (that clashed with an internal Tomcat class)
Servlet 3.1 section 2.3.3.5 states that the application prepares the response (which may include setting headers) after the call to upgrade()
Fix test broken by r1491940
Servlet 3.1 expands the list of reserved names.
Re-write client to provide greater insight into why an invalid chunk is invalid. This helped track down the non-blocking write issues with the APR/native connector.
Fix javadoc. - spec reserves java.* and java.* - needed to update getAttribute() too - add missing '>'
Add some Javadoc for non-blocking IO on the request.
Fix autoboxing warning
With clarification from the EG for Servlet 3.1 section 4.4 finally makes sense. Implement the necessary restriction and add a test case.
Better name
Implemented
Align name with logic
Add additional listener type for 3.1
Various version updates: Servlet 3.0 -> 3.1 JSP 2.2 -> 2.3 EL 2.2 -> 3.0
Javadoc SE and EE version updates
Add stub for WebSocket Javadoc (it is already in the full Javadoc build)
Speed up failure. 300s was for debugging.
r1491962 broke HTTP upgrade on some platforms (including the CI). Ensure that HTTP upgrade responses are flushed as the normal code path for this is bypassed when using HTTP upgrade.
Update Tomcat and JDBC-Pool to JUnit 4.11. Download Hamcrest 1.3 core library and add it to testing classpath.  As junit.jar no longer includes Hamcrest classes, the library has to be downloaded separately.
Fix copy/paste error in r1492307
Replace anchor links that use spaces with underscore ones.
Fix typo
Servlet 3.1 Javadoc updates
More Servlet 3.1 Javadoc
Improve Javadoc
Review Structure 101 output. Reduce package tangles a little.
Update JAR lists to add recent (and not so recent) additions
Junit dependency was updated
Update JUnit version in NetBeans files. Hamcrest library is now in its own jar.
Correct a pair of typos in r1492645
Remove class loader from the scan method as class loader is accessible from ServletContext.
Already skipped WEB-INF/lib so no need to skip those JARs again
Enable client of JarScanner to determine if JAR is part of a web application or provided by the container.
Add a comment on TLD JARs since no distinction is made between TLDs provided by an application and by the container.
Shared loader should be treated as a source of application JARs Commons and Server loaders should be treated as a source of container JARs
Add the type of scan to the JarScanner API This is preparation for changing how jarsToSkip are handled.
Get JarScanFilter working with default values
Add getter/setter for JarScanFilter to JarScanner Enable JarScanFilter to be configured via a context.xml file (and server.xml)
Add some Javadoc
Add some documentation
Make flag that indicates if JAR is from webapp or container visible to fragment processing code.
Fix line endings
Improve comments. Rename local variable for clarity.
More clarity
Further restriction as per Servlet 3.1 section 4.4
Container provided JARs should not be scanned for deployment annotations nor should they be checked for web-fragment.xml files.
Whoops. Better comment.
Container provided JARs should not be scanned for deployment annotations.
Rename string and update text
Always process container JARs for SCIs Order of SCI processing for container JARs compared to web application JARs should be the same as class loading order.
Followup to r1493073: correct a typo.
Special handling for isUserInRole("*")
Special handling for isUserInRole("**")
Fix typos
Method doesn't throw an exception
Fix a TODO.
Pull up common constructor code
Fix FindBugs warnings in test code
Fix FindBugs warnings. params is never null so no need to test for null
Fix a FindBugs warning. Correctly handle a timeout.
More false positives
Fix FindBugs warning - better debug message
FindBugs false positives
Any post-7.0.x issues can be fixed now in trunk
Servlet 3.1 - Switch to using 303 rather than 302 redirects for HTTP/1.1 requests
Fix indents
Servlet 3.1. If GET is not protected but other methods are, the redirect after authentication (that now always uses a GET) fails. Because it is unprotected it is not passed to the FORM authenticator for processing (where the original request would be restored).
Make base class abstract
Make addAuthRole() and removeAuthRole() consistent
Add logging of when a member is unable to join the cluster.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55110 Small performance improvements Patch provided by Adrian Nistor
remove unused property.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55109 Small performance improvement Patch provided by Adrian Nistor
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55108 Small performance improvement Patch provided by Adrian Nistor
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55073 Small performance improvement Patch provided by Adrian Nistor
Complete the document for MessageDispatch15Interceptor.
Small performance improvement
Refactor
Consistent naming
Add a simple realm test in preparation for additional tests for Servlet 3.1 changes
Expand the Realm tests to cover the special '*' all roles role.
Display hostname and port when failing to stop Tomcat via socket connection.
Servlet 3.1. Implement the special role "**" and extend the unit tests to cover it.
Extend the SecurityConstraint / Realm tests a little and add some plumbing for further extension.
Add tests for security constraint role combination
Make constants final
A unit test for handling the special case of an empty HttpConstraint that does not result in unauthenticated access for all.
Replace Tribes's TaskQueue as executor's workQueue in order to ensure that executor's maxThread works correctly.
Add test for additional language added to @HttpConstraint in section 13.4.1 in the 3.1 spec
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53987 Servlet 3.1. Log uncovered HTTP methods.
Servlet 3.1 Implement the new deny-uncovered-http-methods element in server.xml
The form needs a submit button
Fix some copy/paste errors
Explicitly deny the uncovered methods in the examples
Another copy/paste error Also need to protect any remaining patterns with only omitted methods.
Refactor with a view to adding some unit tests
Some simple unit tests
Prevent duplicate deny constraints
Some more unit tests
Servlet 3.1 implementation is complete
Fix whitespace
Make changes to global web.xml trigger reloads
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53665 Document when a javax.mail.Authenticator is configured.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54745 Fix JarScanning when Tomcat is started via Java WebStart. Patch provided by Nick Williams.
Fix indent
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55071 Remove unnecessary call to commit(). The rs.close() just above will commit anything that needs to be committed.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55101 Make BASIC auth parsing more tolerant of whitespace.
r1495154 incorrectly removed the commit Restore the commit and clean the code up a little.
Refactor in preparation for fixing BZ 55120
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55120 @OnOpen needs to support an optional EndpointConfig parameter. Based on a patch by Niki Dokovski.
Fix spacing
Fix indent
Refactor and address some TODOs. Should be no functional change. Make code easier to follow and more obviously aligned to the specification. Removing the to be overwritten patterns will result in all collections for the constraint being empty which will trigger the removal of the constraint (which is what the old code did more directly). The old code just looked as if it might be removing too much.
Add some more tests for denial of uncovered HTTP methods. Remove some duplicate code.
Read response bodies for error responses as well as non-error responses.
Expand test cases for servlet security annotations to include deny uncovered http methods. Fix the failure identified by violetagg
WebSocket 1.0. Section 2.1.5. Session expiry must be signalled to the local endpoint with a close code of 1006.
Fix broken test
Trailing whitespace
WebSocket 1.0. Section 2.1.5. The close message needs to be sent before Endpoint.onClose() is called.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55126 For methods annotated with @onMessage It is OK for multiple decoders to match a single message parameter It is not OK for multiple parameters within a method to be possible message parameters.
Fix failing test. Don't mark session as closed until Endpoint.onClose has completed. Reduce code duplication
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55127 Encoders have init() and destroy() methdos that need to be called. Based on a patch provided by Niki Dokovski.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55125 No point starting a process if the Server container fails to start.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55102 Add support for time to first byte to the AccessLog
Changes to java.beans.Introspector#flushCaches() mean that AppContext protection is not required from 1.7.0_02 onwards. Changes to AppContext meant the memory leak protection required a graphical environment from 1.7.0_25 onwards.
Tomcat 8 requires a minimum of Java 7 so simplify.
Additional unit tests based on spec examples
Rename to match test case name with tested class name
More matching tests based on spec examples.
Clients need to send extension information
Remove unused value
Fix an i18n TODO
Remove the TCK hack. I no longer have access to the preview of the WebSocket TCK.
Remaining i18n TODOs in WebSocket impl
WebSocket 1.0. Section 4.1.1 Improve path validation
WebSocket 1.0. Section 4.1.1 Deployment to duplicate paths is not permitted
Fix copy/paste error in i18n
Refactor to add some clarity
Typo
WebSocket 1.0. Section 4.1.2 Ensure encoders are valid at deployment time
Avoid Warning message at shutdown, if GlobalResourceLifecacleListener isn't configured
Fix failing tests
WebSocket 1.0. Section 4.1.[4-6] Duplicate on[Open|Close|Error] annotations should trigger a deployment failure
Fix failing tests. Duplicate annotation test was wrong.
Parameters using decoders can't use partial messages
When AsyncContext.dispatch(...) is invoked do not cast request and response to HttpServletRequest/HttpServletResponse. AsyncContext.startAsync(ServletRequest,ServletResponse) can be invoked with custom ServletRequest/ServletResponse.
Better response message in the tested servlet.
Refactoring in support of fixing BZ 55143
Further refactoring towards a fix for BZ 55143
Note expectations
Extract decoder use flag to a field (will use it later)
More work for BZ 55143 Add support for byte[], InopuStream and Reader message handlers
BZ 55143 Handle removal of listeners that might have been wrapped
Refactor - move DecoderEntry to new file
Reduce decoder scanning
Rename for consistency
Add message size limit support for message handlers
WebSocket 1.0, Section 4.3 Invalid use of @PathParam should trigger a deployment error
Fix indent / format
Fix wrong MessageHandler type for Reader Add support for message handlers for primitives
Rename prior to some more BZ 55143 related changes
Remove primitive support for MessageHandler - it is only required for @OnMessage
More changes for BZ 55143. @OnMessage may need multiple message handlers depending on the decoders present
Simplify a little
WebSocket 1.0, Section 4.8 Don't look for annotations on inherited methods.
WebSocket 1.0, Section 5.2.2 Container must log error if no error handling is configured.
Fix logic error that triggered an NPE and associated test failures
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55143 Add a test case. Patch provided by Niki Dokovski
Ensure methods with WebSocket annotations are public
When calculating the path in AsyncContext.dispatch(), methods ServletRequest.getRequestURI and ServletRequest.getContextPath cannot be used. That's because the first one returns a string that is not decoded and not normalized, but the second one returns decoded string. Instead of this methods ServletRequest.getServletPath and ServletRequest.getPathInfo will be used as requestURI = contextPath + servletPath + pathInfo.
Fix regression in r1459346 Thanks to Brian Burch for spotting this and kkolinko for the fix.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55151 Fix bugs in test
With an eye to the future, fix some thread-safety issues
Follow-up to r1497569. More thread-safety
Copy duplicate path checks for annotation deloyments.
Refactor to remove duplicate code
WebSocket 1.0, Section 6.4 Once an Endpoint has been used, no more Endpoints can be registered
WebSocket 1.0, section 8.2 There is an implied restriction that any initial upgrade request must use HTTP GET.
Fixed Export-Package header and the "uses" directives.  Import org.apache.juli.logging package with no version so that any version of a bundle that provides it can be used.
Add some plumbing to make the HTTP session ID available to the WeBSocket session. This will be required to implement WebSocket 1.0, section 7.2.
Refactor to register and unregister endpoint instances and session instances rather than endpoint classes and session instances. This is required to support implementation of WebSocket 1.0, section 7.2
Trivial whitespace
Clarify comment
WebSocket 1.0, section 7.2 Connections created under an authenticated HTTP session must be closed when the HTTP session ends.
Add TODOs for the EL 3.0 related changes in JSP 2.3
JSP 2.3, section JSP.11.1 Reduce supported verbs to GET, POST and HEAD
Re-order to make checking against EL Spec RI easier
Reduce visibility
Re-order to make checking against EL Spec RI easier
EL 3.0 New abstract class
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55017 Add the ability to configure the RMI bind address when using the JMX remote listener. Patch provided by Alexey Noskov.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54086 If stopListening is called while the thread is processing selector events it is possible for two threads to try to use the keys collection at the same time. Prevent the ConcurrentModificationException that can occur.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55159 Small performance improvement Patch provided by Adrian Nistor
Fix changelog
Use the right changelog
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55173 Fix typo
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55158 Small performance improvement Patch provided by Adrian Nistor
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55160 Retrieve timeout the same way it is set so that connectionUploadTimeout is applied if configured.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54013 Give forced stop a short period (5s) to complete before returning.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53777 Enable instances of the JAAS Realm to specify a dedicated configuration file. This is likely to be of particular use when the realm is specified at the Context level.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55177 Correctly handle infinite soTimeout for BIO HTTP connector. Based on a patch by Nick Bunn.
Add some basic SSI unit tests as preparation for some unit tests for bug 55176.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55176 SSI expression parser failed to correctly handle the use of an '=' character inside a regular expression. Includes a test case.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55179 Correct attribute name.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55174 WebSocket 1.0 Javadoc for Endpoint.onError states that it should be called for runtime errors in message handlers.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55180 Correctly handle infinite soTimeout when disableUploadTimeout is set to false. Patch provided by Nick Bunn.
Ensure the application will start even if replication map fails to start.
Fix indent.
Add new attribute terminateOnStartFailure.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55181 Protect against clients that ignore the limit of the byte buffer
Expose terminateOnStartFailure via JMX. 
Make sure that terminate replication map.
Add document of terminateOnStartFailure.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55162 Fix namespace Patch provided by Jeremy Boynes
Update
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55165 Ensure sub-protocols are processed for annotated endpoint. Patch provided by Niki Dokovski.
Line length
Upgraded connections need to be marked as upgraded earlier so any poller events triggered are passed to the upgrade processor. The call to WebConnection.init() needs to occur after the connection has been marked as upgraded to ensure that any events triggered by the init() code are processed as part of the upgraded connection.
Fix comment typo
Refactor
More refactoring
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55171 If the client closed the connection, the write of any remainign data in the buffer in AbstractServletOutputStream would fail but the remote endpoint was not notified. This meant that blocking writes would block for ever eventually locking up the entire server.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55183 Header names are case insensitive Based on a patch by Niki Dokovski.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55184 Avoid NPE. Patch provided by Niki Dokovski.
EL 3.0 New bean name resolver
@since markers for new EL classes
Re-order to simplify checking against EL spec
Re-order to simplify checking against EL spec
EL 3.0 New method
EL 3.0 Implement new method
EL 3.0 Implement new class
Re-order to simplify checking against EL spec
Make context optional when looking up messages
Switch to varargs for simpler code
EL 3.0 Implement new class
Add the i18n messages for the import handler
EL 3.0 Implement new EvaluationListener class Create new Util class Refactor i18n support
EL 3.0 Implement new method Creating ExpressionFactory instances is relatively expensive so they need to be cached but caching them is a potential memory leak since applications may ship their own implementations. Copy the caching approach from the ExpressionFactory implementation.
EL 3.0 Implement new methods
Re-order to simplify checking against EL spec
Noticed requirement for null values to trigger removal when reading the EL 3.0 spec.
Re-order to simplify checking against EL spec
Re-order to simplify checking against EL spec
EL 3.0 Implement new class Refactor common code to Util class
Needs to extend ELResolver
EL 3.0 Implement new abstract class
API has been fixed in EL 3.0
Re-order to simplify checking against EL spec Remove pointless javadoc
EL 3.0 Adsd new method that addresses typo
Avoid NPE when a background thread tries to expire the HTTP sessions.
EL 3.0 Replace runtime exception declarations with Javadoc to better document API and to align code with spec API to aid checking for binary compatibility
EL 3.0 More cosmetic changes to make API diff smaller
EL 3.0 Add new method
EL 3.0 Add new classes and methods
javax.servlet.http.HttpServletRequest.upgrade(Class<T>) and javax.servlet.http.HttpServletRequestWrapper.upgrade(Class<T>) must throw ServletException when the instantiation of the provided class fails.
EL 3.0 Impl Implement new method
Resolve deprecation warnings now implementation has new method
EL 3.0 Add new class Implementation not yet complete - need to do some more research
Match inconsistency in the spec API
EL 3.0 More cosmetic changes to make API diff smaller
EL 3.0 Add new class
EL 3.0 API Start unit tests for BeanNameELResolver
More unit tests for BeanNameELResolver and fix an exception handling problem identified by the new tests.
Add the first of the setValue tests and some plumbing that will be required by future tests.
Fix broken test
More unit tests for BeanNameELResolver
Fix copy/paste error
More unit tests for BeanNameELResolver and fix a missing exception when trying to write to a read-only bean
More unit tests for BeanNameELResolver and fix another exception handling problem identified by the new tests. Also fix a problem found with setValue where the context's isResolved property could be incorrectly set to true.
More unit tests for BeanNameELResolver and fix another exception handling problem identified by the new tests. Also fix a problem found with setType where it always returned null.
More unit tests for BeanNameELResolver Fix several bugs  - add missing exception handling to isReadOnly()  - correct exception handling in setValue()
More unit tests for BeanNameELResolver Add tests for remaining methods
Since EL 2.2 javadoc ELContext.getContext must throw NPE when the key that is provided in NULL.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55186 Ensure local name is recycled between requests so IP virtual hosting works correctly.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55198 ELInterpreter needs to know if page was originally in XML
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55200 It is possible that more than one write will be required to empty the buffer. 
Buffer overflow is fatal on read
Add unit tests for ELResolver.convertToType Fix a couple of bugs in ELContext.convertToType highlighted by / spotted while writing the unit tests Update the EL implementation to use convertToType
set eol-style
javax.el.StaticFieldELResolver: 1. isReadOnly - always return true 2. do not check constructor for static modifier 3. invoke - when searching for method/constructor use the class provided by ELClass 4. unit test 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55204 Fix namespace. Patch provided by Jeremy Boynes
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55205 Reorder web.xml elements so that it becomes valid against the schema. Patch is provided by Jeremy Boynes.
svn:eol-style=native
svn:eol-style=native
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55211 Fix namespace. Rename "tagclass" to "tag-class" in various tests tld files so that they become valid against the dtd/schema. Patch provided by Jeremy Boynes.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55210 When searching for ServletContainerInitializer, ignore comments in the provider-configuration file. Support multiple ServletContainerInitializer in the provider-configuration file. Patch is provided by Nick Williams.
Whitespace police
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55166 Move the JSP descriptor and tag library descriptor schema defintion files from jsp-api.jar to servlet-api.jar so relative includes between the J2EE, Servlet and JSP schemas are correctly resolved.
Remove unnecessary class
Silence some Eclipse warnings
Followup to r1500649 Correct typos
Provide test case for META-INF/services/javax.servlet.ServletContainerInitializer that contains multiple SCIs and comments.
Update paths to the tag library schema files
Add a unit test for ImportHandler and fix some bugs it idenfifed: - missing i18n message - importing a package that is not referenced elsewhere failed - ambiguous imports where not detected
Extend unit test for ImportHandler and fix some bugs identifed: - off-by-one error extracting class name - not limiting static imports to public static fields/methods - incorrectly flagging non-conflicting imports from classes with the same name as conflicting
Add a test case for EvaluationListener.propertyResolved() and update the various resolvers to call the new ELContext.setPropertyResolved(Object, Object) method
Add missing exception check
Create a new package for descriptor parsing that will be shared between Catalina and Jasper. There is currently a single sub-package (web) for web.xml parsing. It is expected that additional parsers will be added (e.g. for taglibs). The intended end point is for Jasper to depend only on the Servlet API and JspC to share web.xml processing with Catalina so it can handle web applications with fragments.
Unit tests for ELContext
Move URL decoding util methods to support upcoming refactoring of web.xml parsing.
NamingResources -> NamingResourcesImpl in preparation for new interface NamingResources
Switch to NamingResources interface in objects that represent JNDI entries in web.xml
Move the classes that represent the contents of web.xml and web-fragment.xml files to a new package visible to both Catalina and Jasper.
Add a Servlet 2.2 test web application. Extracted from a larger patch by Jeremy Boynes
Followup to r1500947: NamingResources -> NamingResourcesImpl 
Followup to r1500964: The new package in *RuleSet classes and in mbeans descriptors.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55217 Implement a common EntityResolver that can be used by Catalina and Jasper. Patch provided by Jeremy Boynes.
Consistency
Switch to using new LocalResolver. Based on a patch by Jeremy Boynes.
Move DigesterFactory to new o.a.t.u.descriptor package since JspC will eventually need to use it.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55218 and https://issues.apache.org/bugzilla/show_bug.cgi?id=55219 Upgrade digester to use DefaultHandler2 and use LexicalHandler to detect publicId. Simplify web application version detection in web.xml Extracted from a patch by Jeremy Boynes.
Removed unused constants.
Move WebRuleSet to new o.a.t.u.descriptor.web package
javax.el.MapELResolver: 1. According to javadoc when creating FeatureDescriptors - ShortDescription must be empty string - ELResolver.RESOLVABLE_AT_DESIGN_TIME must be TRUE 2. Unit tests are added
Refactor WebXml parsing to new package. Based on a patch by violetagg.
Change the default
Re-apply r1377509 - the fix for bug 53737 that did not account for JspC
Fix Eclipse warnings
Clean-up. Extracted from a patch by Jeremy Boynes.
Fully fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53737 Enable Jasper to use information from the ServletContext rather than having to re-parse web.xml This commit re-adds the ability to parse web.xml to JspC but now using the same parser as Catalina. Includes extracts from patches by Jeremy Boynes and violetagg. Note: Fragment support is still TODO       The need for annotation support still needs to be reviewed.
Simplify. Use DigesterFactory as base for loading resources for consistency with earlier versions. Patch provided by Jeremy Boynes.
Update default version in test.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55171 Add a default timeout of 5s to all blocking writes and make the timeout user configurable.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55221 Shorten message and make it more useful.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55221 Truncate excessively long clean reasons before sending as control messages are strictly limited in length.
javax.el.ResourceBundleELResolver: According to javadoc: 1. When creating FeatureDescriptors shortDescription must be empty string 2. isReadOnly returns true only if the base is instance of ResourceBundle Unit tests are added
Whoops. Fix JSPs for apps that don't have a JSP config descriptor element in their web.xml.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55215 Remove unnecessary period at the end of file names Use space around = in properties consistently. Based on a patch by Brian Burch.
Whoops. Fix JSPs with TLDs for apps that don't have a JSP config descriptor element in their web.xml.
There is a 2.2 webapp now as well. Based on a patch by Jermey Boynes.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55231 JSP capability should be based on effective version of webapp.
Increase default timeout to 20s
javax.el.ListELResolver: According to javadoc: 1. getFeatureDescriptors - always returns null 2. isReadOnly - when property cannot be coerced into an integer it is ignored by the resolver. Unit tests are added
javax.el.ArrayELResolver: According to javadoc: 1. getFeatureDescriptors - always returns null 2. isReadOnly - when property cannot be coerced into an integer it is ignored by the resolver. 3. getType - when property cannot be coerced into an integer it is ignored by the resolver. Unit tests are added
Further improvements to error message to aid debugging https://issues.apache.org/bugzilla/show_bug.cgi?id=55233
Another NPE fox after the switch to obtaining the JspConfigDescription from the ServletContext
Remove some debug code.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55207 Enforce requirement that <jsp:text> elements do not contain any other elements. Fix a test that this change found. Patch by Jeremy Boynes.
Ensure the log4j v2 jars are scanned Patch provided by Nick Williams.
Implement EL listener notifications for expression evaluations.
Don't swallow original exception
Avoid NPE when sending buffered data from the server (there is no mask in this case).
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55233 Fixed buffer overflow error when a client needs to unwrap more encrypted data than the read buffer has space for. The fix is to increase the read buffer to the current maximum size of output expected by the SSL engine.
svn:eol-style=native
Add a test case for bug 55233 that also uncovered a couple of bugs in the batching code.
Give test longer to complete as it appears to need more time on CI system.
Add some clarification
Add specification name to version number
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55228 Allow applications to set the Date header.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55238 Avoid possible NPE. Patch by Niki Dokovski. Also added a check to onTimeout() to save creating an Exception unnecessarily
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55240 Prevent looping after Poller stop and ensure that streams for upgraded connections are closed if possible.
Expose the current connection count over JMX
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55244 Fix ClassNotFoundException with JspC Patch provided by Jeremy Boynes
Worth a separate changelog entry.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55250 Fix JspC refactoring - tldLocationsCache not created Patch by Jeremy Boynes
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55245 Add JspC test cases. Patch by Jeremy Boynes.
Need Ant on class path to compile new JspC unit test.
Add unit tests for expression evaluation
Tweak tests
Add unit test for VariableMapper entry removal
More updates for the new method FunctionMapper#mapFunction - null method should remove an entry from the map - ensure implementations that need to override new method do so - fix concurrency issues in FunctionMapperImpl - align methods that add to the map to new signature
Flag a TODO
Add initial unit test for ELProcessor and handle the fact that expressions are defined without brackets.
Add some more unit tests for the EL processor and make sure it uses the import information it has to hand to resolve class names.
Cosmetic clean-up - line length - alignment
Add support for defining Sets, Lists and Maps to the parser. The new nodes (the Ast*.java files) are just the auto-generated skeletons and some - if not all - will need some work before these new expression elements are fully implemented.
Prevent possible test failure depending on which method gets selected.
native line endings
Add support for the assignment and semicolon operator to the parser. The new nodes (the Ast*.java files) are just the auto-generated skeletons and some - if not all - will need some work before these new expression elements are fully implemented.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55259 JspProperty is the same for all patterns so only create once. 
Add support for lambda expressions to the parser. The new nodes (the Ast*.java files) are just the auto-generated skeletons and some - if not all - will need some work before these new expression elements are fully implemented.
Avoid allocating unnecessary Vectors to store preludes and codas by using Collections returned from JspPropertyGroupDescriptor directly.
Simplify
Add support for the concatenation operator to the parser. The new nodes (the Ast*.java files) are just the auto-generated skeletons and some - if not all - will need some work before these new expression elements are fully implemented.
Implement concatenation operator (+=) and include some units tests
Make abstract nodes abstract
Implement the Set construction syntax. Includes the initial unit tests for this syntax.
Implement the List construction syntax. Includes the initial unit tests for this syntax.
Add comments about ambiguity of {} in EL 3.0 syntax.
Special handling to handle the ambiguity of {} which could be an empty Set or an empty Map
Implement the Map construction syntax. Includes the initial unit tests for this syntax.
Implement the semicolon syntax. Includes the initial unit tests for this syntax.
Need to be able to load web application classes. Review by kkolinko
Implement the assign syntax. Includes the initial unit tests for this syntax.
Start to implement the lambda expression syntax. Very basic expressions work. I expect further changes to be required for more complex expressions. Includes the initial unit tests for this syntax.
More lambda expression implementation. Handle the case of an expression without any formal parameters.
kkolinko review of r1503056
First of what I suspect will be many typos
More lambda expression implementation. Handle the case of an expression assigned to a variable.
Remove duplication
Recursive test
Stream resolver not required here - there will be one in the provided context.
Create placeholder for next part of EL work.
Use the correct method
Implement first collection operation for EL 3.0.
Support arrays as well as collections as the source for a Stream
EL 3.0 collections operations. Implement filter
EL 3.0 collections operations. Implement map
Refactor to reduce duplication
Additional test based on spec example
EL 3.0 collections operations. Implement flatMap and iterator
EL 3.0 collections operations. Implement distinct.
Fix infinite loop
EL 3.0 collections operations. Implement sorted.
EL 3.0 collections operations. Implement forEach.
EL 3.0 collections operations. Implement peek.
Minor corrections reviewing r1503386
EL 3.0 collections operations. Implement limit.
EL 3.0 collections operations. Implement substream and toArray. Refactor limit to reuse code from substream.
Followup to r1503469 Correct whitespaces. An integer comparison should be a bit cheaper that hasNext() call.
EL 3.0 collections operations. Implement reduce.
A LambdaExpression has zero or one rather than zero to many MethodParameters
EL 3.0 collections operations. Implement max and min.
EL 3.0 collections operations. Implement average, sum and count.
EL 3.0 collections operations. Implement anyMatch, allMatch noneMatch and findFirst.
Rever r1503672
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55268  Added optional --service-start-wait-time command-line option to change service start wait time from default of 10 seconds.  
Fix handling of nested lambda expressions with method parameters.
Use new API
whitespace police
Add some test cases for null handling
Unlikely but protect against the lambda expression returning null.
New tests to ensure changes in coercion rules for nulls don't break any code that uses coerceToBoolean internally
Implement non-backwards compatible change to the coercion rules.
Further improve handling of nested lambda expressions.
Whitespace police
Provide messages with exceptions
Add the two new resolver types (stream and static) to Jasper in the correct order and modify JasperELResolver so the correct resolvers are skipped.
Add unit tests that check (very basically) that the new EL syntax works in a JSP. There are single tests for lambda expressions, streams and imports. TODO: Figure out why the import test currently fails.
The specification does not appear to allow the use of imports in a JSP page.  EL 3.0 section 1.5.1 states that the ELResolvers process identifiers before the ImportHandler  JSP 2.3 section JSP.2.9 defines a set of ELResolvers that will always produce a result hence the resolution of identifiers never progress to imports.
Use the correct message key
More nested lambda expression fixes. Includes another test case and some simple debug code aimed at IDE debuggers.
More fun and games with nested lambda expressions. Each invocation of a nested expression consumes a set of method parameters. Therefore nested lambda expressions that are invoked immediately (because they have no formal parameetrs) need to inform the outer expression of the invocation so the next invocation uses the correct method parameters.
Add some basic import tests and fix a couple of identified issues.
Fix failing CI build. Another resolver was added.
Prep for an 8.0.0-alpha release Remove section on JNI. Not a frequent enough issue to mentioned in the release notes. Clean up the contents list.
Modify the grammar for function to permit multiple sets of parameters for lambda expressions. Implementing that handling is still a TODO.
Fix handling expressions of the form: v = (x->y->x-y); v(2)(1)  There is still some further clean-up that can be done.
Simplify. Update comments.
Filter out three false positives (the only warnings the trunk code base currently generates)
Yet more adventures with lambda expressions. I suspect - but haven't yet checked - that there is scope to make the code more efficient and/or reduce duplication.
Extract FragmentJarScannerCallback to descriptor package so it can be reused by Jasper
Check needs to happen after call to scan
Do the scanning to count nesting levels and presence of formal parameters just once. Simplify the checks during getValue() using the results of this new scan.
Fix passing lambda expressions as parameters.
Simplify parsing web.xml in JspC in preparation for handling fragments
Refactor construction of JspConfigDescriptor into WebXml and use from JspC
Add disabled testcase for #55285
Fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55285 Have JspConfigDescriptor related classes clone collections when returning them to application code. As ContextConfig can no longer mutate the config stored in StandardContext,  add a setter to Context to provide a fully configured JspConfigDescriptor
Fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55262 Duplicate prelude and coda entries in same <jsp-property-group> are preserved.
Have JspC recognize configuration from web fragments.
Provide messages for when pre-compilation aborts
Remove unused imports
Formatting to keep Checkstyle happy
Fix checkstyle import warnings
Review differences between Tomcat's grammar and spec's grammer. Fix a comment typo Correct entry for SKIP
Fix tests (still expected to fail until the parser is fixed)
Align grammar for function with that provided in the EL spec. Unit tests show no functional change.
Handle calls to Optional#orElseGet where the LambdaExpression has already been evaluated
Add a ServletContainerInitializer for Jasper. Does nothing yet except log that it is being executed. 
Avoid ConcurrentModificationException when sending a heartbeat.
Avoid NPE. If the channel fails to start, localMember is null.
Method name changed
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55291 Avoid NPE when registering a session. Patch provided by rstoyanchev.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55268 - Replace uses of "test -z" with "test ".$FOO" = ." for better shell compatibility 
Update last modified time in redeploy resource to avoid infinite reload of webapplication.
Context's copyXML should not affect copyXML of other contexts.
Avoid unnecessary redeployment of context descriptor. Use a local variable instead of an instance variable.
If Host is using default value of copyXML, use Context'copyXML.
Update last modified time in reload resources to avoid duplicate reload of webapplication.
Simplify WebSocket initialisation. Remove some features from  earlier versions of the specification.
Whitespace police
Clean-up - no functional change
Tweak visibility
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55267 Separate read and write timeout for NIO and ensure that the write timeout is always the connection timeout configured in the connector. This prevents long Comet timeouts (which are intended for read operations) being used for writes which - particularly in error conditions - can cause long delays. Since only NIO supports comet timeouts this change is only required in NIO.
If Host is using default value of copyXML, use Context'copyXML.
Fix IllegalArgumentException thrown by simple test for McastService.
In order to unpack a WAR, remove the directory before reload a WAR. In a deployment by context descriptor, WAR that registered to redeploy resources always trigger a reload. 
Merge latest changes from Commons BCEL
Mark early versions as merged
Update to latest Commons FileUpload trunk
Update codec (no changes required)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55297 Look in CATALINA_HOME for jsvc if it isn't specified and isn't found in CATALINA_BASE
Fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55287  Decouple service loading for ServletContainerInitializers from ContextConfig and  ensure services defined by the parent ClassLoader are discovered.
Fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55319  Set isWebapp and delegate for fragments scanned from File callbacks 
Ensure the JasperInitializer is used when running tests. This led to discovery of 55319 but otherwise has no impact at this time. However, when we handle TLD processing from the SCI then this will be needed. 
Test case should assert SCI is actually loaded
Remove duplicate tests. Add comment to explain where credential decoding is tested. Patch provided by Brian Burch.
Better documentation.
Remove unnecessary @SuppressWarnings
Remove unused code
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55309 Fix concurrency issue in TagPluginManager PageInfo should not be a field as it is per page and there will be conflicts with concurrent compilations. Patch provided by Sheldon Shao.
Java 7. Use StandardCharsets rather than existing constants or Charset.forName()
Reformat to 80 char line length.
Delete test case as it was not really testing what was intended anyway
Remove unused class. The name of Context configuration class is acquired from the Host.
NIO endpoint should not be swallowing Virtual machine errors
Make formatting more consistent
Make formatting more consistent
Ensure container JARs are processed for @HandlesTypes matches
Remove unused attribute from mbeans-descriptors.
The contextClass attribute of HostConfig refers to the value of the contextClass attribute of Host. 
Fix javadoc formatting typo
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55312 Ensure that class path entries representing directories are always scanned for matches to @HandlesTypes
Update docs
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55314 Provide a configuration option to bypass the specification restriction on not being able to add endpoints prgrammatically once the first endpoint has started a handshake.
whitespace
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55316 Log IO errors with client at debug. Client may simply have gone away.
Delete ineffectual test
Refactor test with a view to extending it to cover bug 55331. No functional change to this point.
Fix NPE in FileMessageFactory.main when specify empty file as arguments.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55331 A disatch to an async servlet during the onTimeout method of an async listener should not trigger an ISE.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55333 Correct regression in fix for bug 55071. Don't commit the connection until after the ResultSet has been used.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55336 Correctly quote parameters passed to eval
Update Tomcat 8 to the latest DBCP2 snapshot
Update pool2 & dbcp2 versions
Ensure we pick up the latest versions when using the snapshots
Fix dependencies
Fix copy/paste error
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55345 Handle ServletContext.getRealPath("") in the same way for tc8 as for earlier versions.
Use the same Map implementation for user properties to prevent implementation conflicts
Fix javadoc. 
Fix some unchecked conversion warnings.
Treat javax.servlet.ServletContainerInitializer files as text in source
Improve error message
Remove redundant check. 
Better handling on test failure trying to debug failures on OSX with NIO.
Add test dependency on EasyMock, cglib and objenesis
Tests for WebappServiceLoader (requires EasyMock) 
Fix checkstyle
Copy test file needed for TestWebappServiceLoader
Remove obsolete JMX attributes. 
More refactoring of validation trying to debug failures on OSX with NIO.
Fix failing test.
Remove experimental label from AJP NIO connector.
Update NamingResources MBean description for new class name
Correct title. Servlet 3.0 -> Servlet 3.1
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55372 Listen on localhost only be default when enabling jpda.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55372 Make listening on localhost only be the default when enabling jpda.
No functional change. Move some longer lines around prior to some functional changes.
When using a security manager always use the same method inside the doPrivileged call as triggered the call. This fixes an startup failure when running 8.0.x under a security manager as it uses a listener that does not have a zero arg constructor.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45428 Trigger a thread dump to aid diagnostics if Tomcat fails to stop in a timely manner.
Part of fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48550 Change the default URIEncoding for all connectors to UTF-8.
Part of fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48550 Enable the character encoding filter for the examples web-app with UTF-8.
Part of fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48550 Make sure JSPs that could output UTF-8 mark the content as UTF-8. I think I found all the places where this needed to be changed.
Part of fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48550 Make sure Servlets that could output UTF-8 mark the content as UTF-8. I think I found all the places where this needed to be changed. The other possible places involve HTTP headers so must be ISO-8859-1.
Update changelog
Improve the one line formatter so it outputs the correct thread ID even when using the async log writer.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52092 Switch to the AsyncLogWriter and OneLineFormatter by default
Correct typos. (Followup to r1511469)
Duplicate path parameters are invalid
Update unit tests to use DBCP2
Switch from ignoring unavoidable generics warnings in Eclipse to explicitly using @SuppressWarnings
Fix comment typos
Switch the logic around in preparation for a fix for BZ 55381
Pull up SocketWrapper
Fix refactoring in r1512034 that broke HTTP BIO and APR
Start adding model for loading complete TLDs using Digester. This will unify Jasper's model, which is mostly complete but uses a separate DOM model,  and Catalina's, which is Digester based but only handles listener entries.  Basic top-level entries are handled but not child elements for tags etc
Refactor Catalina's TLD processing into Jasper's ServletContainerInitializer. Replaces the TldConfig lifecycle listener with code the SCI to scan for TLDs and register listeners dynamically. Removes the "processTld" property from StandardContext and deprecates other TLD related properties on Context Does not yet address refactoring Jasper's own TLD processing into the SCI. 
Remove old TldConfig related message
Remove references to TldConfig.jarsToSkip system properties that were not copied over using JarScanner refactoring
Refactor TLD scanning and parsing around the notion of a TLD resource path as defined by the JSP specification.
Have JspC initialize its ClassLoader before the ServletContext. This avoids the need to re-initialize the ClassLoader for every JSP being pre-compiled. It also allows the ServletContext to be used before starting a compilation run, e.g. to scan for TLDs
Refactor TldLocationsCache to use scan results from the initializer. This means we only scan the application and classpath once to locate TLDs and eliminates duplicate code that needed to be kept in sync between Catalina's TldConfig and Jasper's TldLocationsCache. Deprecate TldLocation to be replaced with TldResourcePath once TagLibraryInfo and dependency management can be decoupled.
Pass validateXml config setting to TldScanner Although this enables XSD validation during the TLD scan it remains unsupported for all other descriptors (including TLDs loaded by taglib directives).
Update changelog for TLD scan changes.
Update Pool2 and DBCP2 versions to latest CI builds. This picks up some API clean-up. There are no new features.
Additional permissions required by the now default AsyncLogWriter and OneLineFormatter
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55404 Log warnings as warnings
Follow-up to r1513148. Update i18n messages.
Fix some code warnings
Allow whitespace between elements which allows wrapping of lone lines in the config files.
Add catalina-storeconfig.jar to default skip list Move websocket-api.jar to other API jars
Add a JarScanFilter configuration to skip the JARs that contain SCIs but no TLDs
Fix the logic for the "Scanned one or more JARs for TLDs without finding a TLD" warning.
Can't switch to Writer once getOutputStream() has been called.
Remove some unused code and simplify the test.
Fix trace level logging. Log messages were using a message key that did not exist.
Poller may return an error value with or without a value that matches a registered event. Use i18n for debug messages. Make debug messages consistent. Add new debug message to show what events poller returned. Improvements while working on a fix for BZ 55381.
Remove TLD-related properties from Context since processing has been moved to Jasper.  
Provide a request processing time for an error response if possible.
Async read/write errors need to trigger error responses so the socket is closed.
Remove unused code.
Remove reference to attributes that no longer exist.
Remove reference to attributes that no longer exist.
Add an access log check to the write error test case
Reformat excessively long lines (> 200 chars). Also reformatted long lines > 100 chars.
Reformat excessively long lines (> 200 chars). Also reformatted long lines > 100 chars.
Reformat excessively long lines (> 200 chars). Also reformatted long lines > 100 chars.
Tomcat 8 requires Java 7 so simplify code.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55400 WsFilter needs to be marked as supporting async else it prevents apps from using async requests.
Use logger rather than System.out primarily to get datestamps for messages.
Add some timing information
Work-around CI build failures
Fix non-blocking test failures on OSX.
The container is responsible for the first call to each of onWritePossible() and onDataAvailable() once a listener has been set. Main component is the addition to the SocketWrapper of a list of dispatch types that need to be made. "Dispatch type" in this case meaning "process the socket using the specified SocketStatus". This is used to register trigger the first call to each of onWritePossible() and onDataAvailable() for which the container is responsible. Fix some additional issues identified in the test case. 
Partial fix for BZ 55381 and OSX
Fix non-blocking test failures on OSX when using APR.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55357 Set the web app classloader as a context classloader before reading the object data.
Refactor to reduce code duplication
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55399 Base i18n of error reports on request locale rather than default server local.
Fix issue reported on users list. Because the default bundle reports as the ROOT locale rather than as ENGLISH, the request locale to resource bundle mapping failed.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55314 Provide a container specific extension to the WsServerContainer to allow frameworks to more easily diaptch requests to WebSocket endpoints.
Follow-up to r1514447. Need to invert the test after the refactoring.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55354 Restore the context environment parameters after associating the Principle with the given user. Based on patch provided by Richard Begg.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55399 Have the message in the response line use the locale set for the response.
Have error page status message language consistent with content.
Fix ordering. Remove deleted package.
Finish converting TLD parsing to using Digester.  TldParser now handles all TLD content required by Jasper rather than the minimum needed for listener scanning. Added test TLD files outside the test webapps to test edge cases.
Remove unused value
@since on class, no need to have it on methods as well
Move method location in file for consistency
Be a little more precise in the use of generics. Porting this to Tomcat 7 where <> is not allowed highlighted an issue.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55434 Ensure only duplicate parameters rather than duplicate segements trigger an error.
Remove dependency on Tomcat internals from examples.
Fix typos
Remove unused string
Simplify
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55438 Don't call onAllDataRead() twice for an empty request body. Make the non-blocking test more robust as on client disconnect the error may occur in the read or the write listener. Unit test provided by Daniel Mikusa.
Fix typo
Don't try and register a WebSocket session that we know to be closed.
Correct comment
Rework r1515612 Avoid ISE when session is closed.
Fix unit test failure observed on command line on Windows. SecureRandom took took long to initialise causing test to fail. Initialize a SecureRandom instance before running the test.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55442 Handle calls to a constructor of an imported class or to a static method, imported statically. Unit test based on a patch provided by Daniel Mikusa.
Reduce a potential timing sensitivity
Further reduce a potential timing sensitivity
Add the rather crucial missing i++ in the wait loop
Fix a couple of Eclipse warnings
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55454 Fixed NPE thrown when parsing an invalid content type.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55439 Don't try a forced stop (kill -9 $PID) if Tomcat has already been stopped and the PID file cleared else a bunch of errors will result. Additionally, improve handling in a forced stop of situation when the PID file can be written to  but not deleted.
Fix Gump failure as java.io.tmpdir directory isn't writable.
Fix Gump errors with WebSocket and trunk
Use a common wait time on the server and the client. This fixes an exception observed on some platforms with 7.0.x that distracted from the root cause of the test failure.
Fix NPE observed in testing logs

Have the WsListener check for a WebSocket Server Container before it triggers initialization of the WsSCI in case the SCI has been detected by the container.
Restore line incorrectly removed in r1516416 Thanks due to rjung for spotting my error
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55469 tr and td tags for UPLOAD_SECTION where not properly closed
Fix resolving relative to a JAR location. Based on r1103295 from webservices. This fixes the Gump failures for the LocalResolver test that execute with JARs rather than classes.
Ensure that there is only ever one recovery thread running at a time. It was pretty much impossible for this to happen with the previous code but there was a very small window where two threads could have been started. This change guarantees there is only ever one recovery thread.
Make test more resilient against timing differences on different platforms. Hopefully this fixes the failure current seen on Gump runs.
Remove old debug code
Reviewing NIO vs APR investigating unit test failure on Linux and OSX Align code. Consistently generate an error message if a write of a 100 continue response fails
Refactor transfer method so data is not duplicated.
Hopefully fix some intermittent unit test failures in buildbot
Fix infinite loop breaking Gump test
Two of us have got this wrong so separate the tests to make the logic clearer and increase the timeout to 10s.
javax.el.BeanELResolver: - getFeatureDescriptors, getCommonPropertyType do not throw NPE when the supplied context is null. - setValue will throw PropertyNotWritableException instead of PropertyNotFoundException when there is no setter for the property. - unit test is added
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 Improve markup and design of the Tomcat 8 documentation webapp. Patch provided by Konstantin Preier.
Add a unit test for chunked encoding
Extend the AJP test client to support methods other than GET and implement a simple POST test.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51526 o.a.catalina.startup.Tomcat.addWebapp(...) will process web application's context.xml when it is presented in the provided baseDir.
Content length is managed internally as a long. Fix a few places that were unnecessarily restricting it to an int.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 Set the mime-type to prevent an error when viewing the changelog directly.
Fix comment
Fix typo
Simplify.
Remove code that duplicates code in super.available() which is called immediately before the duplicate code.
Rename loal variable prior to some refactoring.
Refactoring. Make the log instance available to the super class. Use imports rather than fully-qualified names.
Refactoring. Pull up code from NIO that also does a non-blocking read in the available() call. This makes NIO and APR consistent. BIO is unaffected as it overrides available() and always returns 1.
Remove unnecessary code. inputBuffer.avaiable() now includes a call to nbRead() to check for available data if the buffer is empty.
Fix some broken exception messages.
Handle non-standard OSX behaviour on non-blocking reads that return no data in fill() as well as nbRead()
Simplify nested if statements
Handle EAGAIN return code (expected for non-blocking reads when no data is available)
Remove nbRead(). Calls to available() now trigger a call of fill(false) (i.e. non-blocking). This avoids a problem observed on the users list where repeated calls to available() in turn triggered calls to nbRead() that resulted in the buffer being expanded as nbRead() didn't reset pos and lastValid when adding data to what was essentially an empty buffer.
Better comment
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55453 Do not return a response body for those status codes and request methods that do not permit one.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55494 Reduce log level of exception messages that are logged for re-tries. Make clear in the message that a retry is taking place.
Add new resolvers to default resolver (bug spotted by remm)
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55483 This fixes calling overloaded methods and aligns the method matching code in the API and the implementation. Unfortunately, this has required a fair amount of duplication. I don't see a way to avoid this, short of an el-util JAR that both depend on.
Remainder of fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55483 Handle overloaded consructors. As far as the constructor matching code is concerned, constructors can be treated as methods with a special name. Therefore, refactor the newly enhanced method matching code to handle methods or constructors and then use it to replace the current simplistic constructor matching.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55215 Additional clarifications to logging documentation that make clear why access logs are handled separately. Patch provided by Brian Burch.
Further fixes for https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 Improve HTML markup and follow new XSLT - Part 1. Patch provided by  Konstantin Preier.
Add doc redesign to changelog
Add the other specs to the changelog
Add the JSR and maintenance release number
Whitespace police
Explicitly throw an exception if an HTTP upgrade is attempted on an AJP connection. This ensures the client receives a 500 response.
Servlet and Comet examples belong with the other Servlet examples, not with the JSP examples.
Fix async examples that were broken when the Set Character Encoding Filter was added.
Remove some unnecessary text
Move the rest of the chat app to the servlets examples.
Don't process remaining dispatch requests once the socket has been closed.
Refactor SocketWrapper  - make fields private  - add reset() method to wrapper  - distribute resetting of values between SocketWrapper and KeyAttachment so each resets its own fields
Add a trivial non-blocking (mainly read) example. The primary purpose is to support the development of the non-blocking API with the AJP connector.
Part of fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 Improve mark-up in docs part 2 Patch by Konstantin Preier
Part of fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 Improve CSS - use different colours for odd and even table rows Patch by Konstantin Preier
Fix tabs / whitespace
Fix copy/paste error
Review action code usage across HTTP and AJP processors - remove the unused POST_REQUEST action - align ordering between AJP and HTTP for easier comparison - add missing actions to AJP for implementation / review (see TODOs) - document known NO-OPs for AJP - ensure trying to use comet over AJP triggers an error
Correct the comment on the default timeout
Add the (as yet unused) plumbing to allow the AJP APR/native processor to perform non-blocking reads and writes.
More non-blocking IO plumbing for the AJP APR/native connector. This will allow reads to be non-blocking between messages (if desired) but remain blocking once a message starts. A more sophisticated approach to non-blocking could be taken but this approach is similar to how NIO does it and, depending on how mod_jk writes and reads data, may be all that is realistic.
Remove the second (almost identical) read method and hook everything up to the new read method with optional blocking. The only non-blocking read is for the first byte for the second and subsequent requests on a kept alive connection to enable the worker thread to return to the pool if there is no request to process. Both the behaviour and code should be more similar to the AJP NIO connector now. More refactoring to follow.
Complete a TODO that allows the receive() method to be refactored so it is identical in all three AJP processors
Align the readMessage() signature in NIO with the BIO and APR.
Pull up receive
timeout is an int
Align the setting of the keep-alive timeout with the NIO implementation
Align further with NIO. Simplify the timeout code.
Add a (current unused) method to set socket timeouts
Use the new method to set socket timeouts
Add the keptAlive flag (copied from APR) so that the first requst uses a blocking read as there should be data to read immediately after the connection has been established. Use the new method to set timeouts.
Use the new method to set socket timeouts Add support for a separate keepalive timeout
Add document for org.apache.catalina.tribes.group.GroupChannel.
More definite thread name for MessageDispatch15Interceptor.
Fix Gump failure (hopefully) Move the log failure to the adapter so that the logging occurs before the request and response are recycled. This should improve the information that appears in the logs. The failure was caused because Gump runs with access logs enabled so when the failure occurred the context had been set to null. This meant the the default access logging kicked in which found the standard host level log and logged the issue there rather than in the context level TesterAccessLog.
Add the keptAlive flag to BIO. It is unused but adding it brings BIO closer to the other connectors which will aid refactoring.
Remove comment to align with BIO and NIO to aid future refactoring
Remove unnecessary call to recycle. recycle will be called by Ptoocol as part of releasing the connection.
Use output methods to write PONG packet. Aligns APR/native with BIO and NIO to aid future refactoring.
Refactoring. Pull up process method.
Clean-up. Remove comments that add zero value. Make spacing more consistent.
Fix spacing
Aligning the readMessage() method implementation and the read() method signature between BIO and NIo to aid future refactoring
Start to align the APR/native readMessage() method implementation with BIO and NIO to aid future refactoring.
Move the copying from the inputBuffer to the message buffer into the read() method to align read() in APR/native with BIO and NIO.
Refactoring. Pull up readMessage()
Researched the TODOs from the review of the AJP code against the list of actions.
Enable AJP to work with Servlet 3.1 non-blocking reads. This is not a true non-blocking implementation. That requires further investigation marked by the TODOs in the code.
Ensure available() is consistent with isFinished()
Simple non-blocking write example. Primarily written to have something to test AJP with. Sequential were chosen as it makes it easy to spot output corruption.
Prevent NPE if dispatch results in a nested call to process()
Ensure that when multiple dispatches are requested (e.g. one for write and one for read) if the first calls AsyncContext.complete() that the second dispatch is not processed.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55500 Ensure async timeout is applied when using Servlet 3.0 async with the AJP NIO connector.
Correct several incorrect formats of JdkLoggerFormatter. -Remove duplicate spaces in front of log level. -Add a space between logger name and message. -use system property.
Create AbstractEndpoint.processSocketAsync() which will enable some further refactoring in the AJP processors. This requires adding generics to the endpoint so this patch also deals with the side effects of adding generics.
More side-effects from making endpoints generic
One more side-effect of making endpoints generic
Correct visibility
Use new processSocketAsync() method to align actionInternal code across all three AJP processors
Pull up remaining actions and remove actionInternal() method that is no longer required.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55517 Resynch classpaths for netbeans support Patch provided by Brian Burch
Too quick - another file needed to be updated.
Further patch (part 3) for https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 Improve markup and design of Tomcat's HTML pages Fix some version references for Tomcat 8
Fixing the last Gump failure, created this one. Rethrow the exception so that the access log entry is created. Error handling should be consistent across the connectors now.
Add state checks to non-blocking reads that match those for non-blocking writes.
Fix failing unit test and Gump with BIO Make the test for having to call isReady() before any non-blocking read or write stricter. Previously, an app would get away with this if isReady() would have returned true if it had been called.
Revert r1519798 I realised it wouldn't work just as I hit commit.
Force failure with BIO as the test requires true non-blocking IO to fail as expected
Tomcat only uses package-info.java files for Javadoc so don't bother creating empty class files from them.
When using Servlet 3.1 non-blocking reads with an AJP connector, make the reads between the AJP body messages from the server non-blocking. Once any part of a message is read, the remainder of the message will be read using blocking IO.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55342 Remove unnecessary reset of interrupted flag. If the InterruptedException is thrown, the interrupted flag has been cleared.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55343 Add flag to ignore error of connection creation while initializing the pool.
Correct comment Fix some whitespace formatting 
Fix comment typo
Fix possible memory leak with NIO when executor needs to create a new thread. Pull up common code.
Add some plumbing for non-blocking writes to the AJP connectors. There is no functional change. All writes remain blocking.
Calculate the maximum output chunk size when the processor is created. Since it won't change, there is no need to re-calculate it every time there is some output to write.
Add a note to flush()
Add some plumbing with a view to supporting non-blocking writes.
When using non-blocking IO need to ensure that end of stream is correctly identified so that the onAllDataRead event is correctly fired.
Fix mbeans-descriptors.xml of DataSource. Add undefined attributes and operations to mbeans-descriptor.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55527 
Reduce the version specific references and update the remaining onces to Tomcat 8.
Final part of https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 for Tomcat 8 Improve markup and design of Tomcat's HTML pages Patch by Konstantin Preier
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55521 Ensure that session.expire() doesn't return until the session has been invalidated. Ensure that the return valid of session.isValid() is consistent the current state.
Implement Servlet 3.1 non-blocking writes for AJP. Writes are fully non-blocking, both between and within AJP messages.
Refactoring. Extract ByteBufferHolder into a separate class that can be used by HTTP and AJP.
Increase size of output so a test client has a chance of triggering some buffering in the AJP processor
Add a simple non-blocking write test that currently fails. This won't impact the CI systems since the class is excluded from the unit tests.
Fix some issues with Servlet 3.1 non-blocking writes and APR identified by the 'unit' test.
Fix some issues with the new Resources implementation reported by Dan Mikusa: - The zero-arg constructors for WebResourceSet implementations were either missing or always failed meaning that they could not be specified in a context.xml file as the digester was unable to create them - The internalPath attribute was not configurable
Prevent problems if the message handlers are updated in the middle of handling a message spread across multiple frames. The entire message will be handled by the message handler in force at the start of the message.
Don't register the ReadListener until after onOpen has completed as MessageHandler instances are likely to be registered during onOpen. This prevents incoming messages from being processed until the onOpen event completes.
Fix wrongly named annotation attributes
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54693. - Add a validationQueryTimeout property - Avoid NPE caused by createConnection(..) returns null. (see Comment 6) 
Remove some unnecessary whitespace. Add some @since markers prior to fixing bz 55534.
Revert change to authenticationType. I was working from the Javadoc which was incorrect. The spec confirms that the correct attribute name is authenticationType
Common Annotations spec section 2.11 makes clear DenyAll is permitted at the class level. The Javadoc for JavaEE 5 does not include this but the Javadoc for JavaEE 6 does - again with no indication of a change.
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55534 Commons Annotations 1.1 changes
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55534 More Commons Annotations 1.1 changes
Remainder of fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55534 Commons Annotations 1.2 changes
Whoops. Put the elements in the right annotation.
Fix checkstyle failures - trailing whitespace
Fix checkstyle failures  - no License header  - invalid (old JUnit) imports  - trailing whitespace  - missing @Overrides
Sync codec with latest version from Commons (no change)
Sync fileupload with latest version from Commons  - one minor API change to make a package private constructor public
Sync bcel with latest version from Commons (no change)
Add some tests based on the WS EG discussions around some edge cases. Note that some of these will never happen in practise as Tomcat will have normalized the URI.
And now update after I find the later discussion about empty segments not being permitted (which is good since Tomcat will have normalized them out anyway)
Fix checkstyle warnings - whitespace
UriTemplate should not trigger failures for '/' for for instances used for matching that end in '/'
Fix circular logic as per rjung's suggestion
Fix regression introduced in r1518158 Calls to available() (used by comet) which in turn calls fill(false) should result in a non-blocking rather than a blocking read.
Fix Comet unit test failures on OSX. OSX requires timeout of 0 for non-blocking read
Reduce timing sensitivity of test as some false positives have been observed.
Fix failing org.apache.coyote.ajp.TestAbstractAjpProcessor unit test. Handle EAGAIN result from non-blocking read.
Followup to r1514376. Use value from local variable instead of repeating a method call.
Better adherence to RFC2616 for content-length headers This is the fix for CVE-2013-4286.
Performance tuning after analysis with Yourkit Use bulk write for the payload rather than a loop when there is no mask to apply (i.e. on the client side).
Add support for limiting the size of chunk extensions when using chunked encoding This is part of the fix for CVE-2013-4322.
Improve performance of unit tests and hopefully fix intermittent unit test failure.
Profiling indicates that UTF-8 encoding is the bottleneck. Harmony's encoder is slightly faster than Java 7's so use Harmony's.
When less than 127, no need to convert to unsigned.
Put a limit on the number of Locale to StringManager mappings that will be cached.
https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 IE<=9 fixes for Tomcat 8 docs
Fix EOL
If both the input and output buffers are exhausted at the same time, return UNDERFLOW as more input data would be required to trigger OVERFLOW.
IE <=9 fixes without the conditional comments
The loaded attribute never exists in PersistentManager.  isLoaded is defined as operation in mbeans-descriptors. 
Fix some Javadoc
Remove unused code.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55552 Separate the return type (which must be an object) from the expected type which may be a primitive. This is necessary for EL 3.0 onwards as the default handling of nulls is now different for primitives and objects. The expression engine needs to know what the true expected type is in order to correctly coerce the result to the right type.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52558 Refactor CometConnectionManagerValve so that it does not prevent the session from being serialized in when running in a cluster. 
Apply clarification from the Servlet EG. Attempting to parse parts when no multi-part configuration has been provided will trigger an ISE.
Apply clarification from the Servlet EG. Attempting to parse parts when no multi-part configuration has been provided will trigger an ISE.
Be consistent about how secure is accessed
Update unit tests to align with changes in part parsing without configuration (now throws ISE)
Fix trailing whitespace
Fix indent
More resources refactoring. Remove the need to extract the classes into the work dir.
Remove TODO. WebappClassLoader has all the Lifecycle implementation it needs.
Fix bytes / kilobytes mismatch that resulted in fewer objects being cached.
Remove old, incorrect comment
Fix broken unit test now caching has been fixed.
Move comment to go with code that was moved earlier
Add support for JARs nested in WARs to the Jar abstraction used by the JAR scanner.
Fix EOL
Extend the WebResourceRoot API to allow definition of a base, archive and internal path for the creation of a ResourceSet
Add parsing of the archive path (currently unused) from the supplied URL.
Create JarWarResourceSet as a copy of JarResourceSet and modify StandardRoot to use it when appropriate.
Correctly populate the entries list.
Refactor JarWarResourceSet to extend JarResourceSet to reduce code duplication.
Refactor to reduce code duplication.
Further refactoring to support resource JARs in packed WARs
Add support for a custom URL protocol "war" that is used when accessing JARs inside packed WAR files as the jar protocol does not support nesting.
Pull up common code
Re-order parameters to be more logical
Reduce visibility of fields in abstract methods
Pull up common code
Fix line endings
Update to APR/native connector version 1.1.28 that includes a necessary fix for WebSocket and Servlet 3.1 non-blocking IO.
Update to APR/native connector version 1.1.28 that includes a necessary fix for WebSocket and Servlet 3.1 non-blocking IO. Also update the minimum required version to 1.1.28
Added logging of logging.properties location when system property is set.
Fix error showing in unit tests when socket is closed while still in poller. This happened after a web-socket timeout.
Avoid possible NPE during shutdown.
Fix logic where poller thread could get stuck in infinite loop on connector stop.
Fix logic where sendfile thread could get stuck in infinite loop on connector stop.
Fixed realm documentation - the number of the standard o.a.catalina.Realm implementations provided by Tomcat was not correct. Issue was reported through comments.apache.org.
Improve handling of situation where socket / connector closes down while an application thread is using the socket. This ismost likely to occur with upgraded connections that use concurrent read/write (e.g. WebSocket)
Avoid possible poller error with sendfile
Fix typo
Use java.beans.Expression to simplify method and constructor matching/execution. Approach suggested by Esmond Pitt.
Make test less sensitive to timing
Revert r1523988. Using java.beans.expression was a lot simpler in terms of code volume but it failed to handle varargs correctly and triggered some unit test failures.
Correct r1523998. Reducing the time per loop means the number of loops has to increase.
Fix code style. Add stderr log source (class/method). Add catalina.policy entry for new system property.
Partial revert of r1511907. Suppress unchecked warnings as they can;t be avoided. Revert r1519804 Remove use of createMissingPackageInfoClass which requires Ant 1.8.3
Fix broken message
Fix a TODO. Exclude resources in WEB-INF/classes and WEB-INF/lib from the cache as the class loader has its own caching mechanism.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46727  Refactor default servlet to make it easier to sub-class to implement finer grained control of the file encoding. Based on a patch by Fred Toth.
A few more false positives
Update
Fix comment
Correct log message. Use better language
Fix starting with a security manager
Use the intended (based on the changes to the policy file) name for the new system property.
Rename method for clarity
WsListener->WsContextListener to more clearly differentiate between it and WsSessionListener
Extract FutureToSendHandler to a separate file
Revert addition of closing flag on wrapper. A more robust solution is required.
More robust solution to the problem of blocking writes not be closed when the web application stops. Futures used for blocking writes are registered with the session and the session completes them with an exception if they are outstanding when the session closes.
Collection->List since order is important
Set->LinkedHashSet as order needs to be retained
Fix unit test broken by switch to LinkedHashSet
Always load container SCIs first
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55570 Correct log exceptions so they appear in the logs
BZ55383 Local ASF logo. Fix 'loading comments...' Patch by Konstantin Preier
https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 Improve markup for Welcome pages Patch provided by Konstantin Preier
https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 Improve markup for examples (part 1) Patch provided by Konstantin Preier
Attempt to address intermittent failures suspect to be caused by timing issues
Attempt to address intermittent failures suspect to be caused by timing/threading issues
Fix possible false test failure when the session gets closed before the message write can complete.
ServerContainerProvider was removed from JSR-356
https://issues.apache.org/bugzilla/show_bug.cgi?id=55582 Correct concurrency issue that can result in two instances of JspServletWrapper being created for one tag. Patch provided by Sheldon Shao.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55576 Preserve the order that request parameters were presented by the client.
Logger instance of cluster session manager is changed to non-static in order to enable logging of each application.
Fix typo
Fix unit test now that parameters are returned in the order they are received.
Reduce visibility
Narrow scope of localAddList
Removal of a socket from the poller needs to happen on the poller thread as removal, like addition, is not thread safe. Removal of a socket from the poller needs to remove the socket from the addListif it is present otherwise the closed socket could end up in the poller.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 Use UTF-8 as encoding for the ROOT index.jsp.
Add an empty WEB-INF/classes dir to the WAR for testing WebappClassLoader.getURLs()
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 Improve HTML markup of the ErrorReportValve. The design/layout is still the same, but I'm looking into how it can be improved.
Fix indent
Add support for notify periodic event of cluster.
Correct the javadoc for Lifecycle interface.
Fix broken link to comments.html page when the directory of the docs is not "tomcat-x.x-doc", as reported on the users list.
Fix broken link to HTTP connector in the Proxy HowTo, as reported on the users list.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 Improve markup for examples (part 1).  r1524838 broke the history of the WebSocket Example HTML files. This is because my patch file didn't contain the info that the XHTML files were copied from the HTML files (maybe this is not possible in a patch file).  This commit should restore the history of the files while applying the same changes and renaming them to .xhtml.
Improve Snake Websocket example: - Fix invalid JSON syntax (Strings always need to be in double-quotes) - In JavaScript, use JSON.parse() instead of eval() to parse JSON strings, to avoid potential security problems.
Fix format
Fix typo
Improve WebSocket examples: "use strict"; in JavaScript blocks to enable strict mode.
Fix regression caused by a combination of the TLD refactoring and the new resources implementation. TLDs in JARs in packed WARs were not accessible. There were two parts to the fix: - In TldScanner ensure that that the correct URL for the JAR containing the TLD was used - In TldResourcePath ensure that the correct URL to the TLD was constructed from the JAR URL and the path to the resource within the JAR
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55317 Facilitate weaving by allowing ClassFileTransformer to be added to WebppClassLoader Patch be Nick Williams
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 Improve CSS: - Use media queries in the main CSS file to better control when CSS styles should not be applied for printing. - Use "noPrint" class for ASF logo.
Allow to specify "noHighlight" class on a parent element so that <code> child elements will not be highlighted.
Remove version number from configuration commment.  The user should know to which version the file belongs so maintaining the explicit version number here is not worth it. 
Cosmetic comments change where version "8" is mentioned. 
Replace explicit version number 8(.0) with ant filter variables in docs. 
Remove unneeded mentioning of version number. 
Add document for sessionIdAttribute attribute in JvmRouteBinderValve.
Fix default value of sessionIdAttribute.
Fix copy/paste error
Add missing bracket
Better debug messages
Move the point where the socket is removed from the connections Map so all the actions apart from removal from the Poller are in a single method to facilitate refactoring removal of the socket from the Poller.
Rename method
Refactor the remove list in the Poller to be a close list. The poller now removes the socket if it is in the Poller then destroys it. Note the socket is always destroyed whether it is found in the Poller or not.
Add a warning comment and simplify the code a little.
Refactor the method names some more.
Switch to destroySocket in a few places where it is safe to do so.
Better log message for socket destruction and remove reference to deleted parameter
Fix style for <h4> element in comments section.
Replace tab with spaces
Ensure that connectionCount remains thread-safe
If there are sockets to close, close them rather than waiting for the next Poller run.
Address issue reported with high CPU usage under low load load.
More debug logging for the APR/native connector.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 Improve markup of HTML page. Fix broken link to "ServletToJsp.java.html" - it is generated by Ant txt2html task.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 - Improve HTML markup of generated pages by Txt2HTML ant task. - Use declared encoding ("ISO-8859-1") instead of default encoding to read the source files. - Use declared line separator instead of "line.separator" property so that the file is generated the same on every plattform.
Ensure that the Poller actions socket close requests ASAP
Async timeouts are checked roughly once a second. Check connection and keep-alive timeouts using the same period (rather than roughly every 5s)
Handle error when user closes browser while playing snake game.
Swallow exception when writing to a closed client
Move comments as they are being associated with the wrong values.
IOExceptions need to trigger the closing of the WebSocket connection. Errors need to be propogated for upgraded connections as they are for async connections Handle Windows specific error code for connection abort
jdbc-pool.xml uses UTF-8 encoding.
Fix what seemed to be a wrong usage of "project" variable. This fixes viewing changelog.xml in IE and Firefox where previously things like the LHS menu etc. were not visible (whereas they were visible in Chrome). I do not know why this has worked in Ant's XSLT task before.
Revert r1528615 - this broke the LHS menu for subfolders, sorry.
New try: Use the correct subdir for loading the project.xml into the $project variable, and use $project variable instead of <project> tree that is placed by "&project;" entity.
"application/xml" is the preferred MIME type for XML, and we use this one also in web.xml.
Revert r1528669 - SVN treats files with application/xml as binary. Therefore they need to use text/xml. Sorry for this.
Do not use the comments script in files where the comments section is disabled, to prevent JavaScript errors.
Remove unused expireSessionsOnShutdown attribute in BackupManager.
Ensure the APR/native error for EOF is reported as an EOF.
Remove method call that appears to be unnecessary and on rare occassions has triggered a unit test failure.
Only send a close message on an IOException if the client has not yet received a close control message from the server as the IOException may be in response to the client continuing to send a message after the server sent a close control message. This change is in response to an observed failure in the unit tests. 
- Fix some classnames for resources following refactorings - Add support for InetAddress for the connector address - Do not ignore the thread local listener and add the special engine listener just in case
Fix line wrapping
Rename method as it is used more widely than just async processing
Fix a TODO - Handle RejectedExecutionException for BIO Add i18n support for the associated log message and align BIO, NIO & APR
Remove syncs as SocketProcessor.run() provides the necessary syncs on the socket.
Add a dispatch parameter to the newly renamed processSocket() method and align BIO and APR with NIO that executes the SocketProcessor in-line if no Executor is available
Align implementation of state machine with documented transitions (allow dispatch() when in ASYNC_READ_WRITE_OP)
Fix intermittent issue observed in unit test on CI system. Container is responsible for first call on onWritePossible() / onDataAvailable() 
Re-check error state after service method regardless of keep-alive to ensure unused input is not swallowed on error. This allows the socket to be closed as quickly as possible.
- Must filter out that thread local listener on the context ... - Save the context configuration in configBase if no configFile exists (it's not possible to determine if there are relevant changes or not)
Revert r1529149 as it triggers unit test failures. It needs more thought.
Expand note in docs regarding use of sessionCookiePath="/".
Make access of dispatcher list on socket wrapper thread safe
Partial fix for re-opened https://issues.apache.org/bugzilla/show_bug.cgi?id=49134 Ensure nested realms are correctly destroyed, ensuring that the associated MBeans are deregistered.
Extend the test case to cover RequestProcessors
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 Improve HTML markup of "sample" webb application.
Follow-Up to r1529678: Replace tabs with spaces.
Update web.xml of "sample" web application to Servlet 3.1.
Update remaining XML files with "ISO-8859-1" encoding in the "docs" webapp to the XML-default encoding "UTF-8".
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 Improve HTML markup.
Explicitly state the used encoding in XML files of the "docs" webapp.
Fix the logic for handling dispatches in a thread-safe manner. May be scope for a more efficient implementation.
No need to test dispatches.hasNext() more than once. Add some additional comments.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55629 Remove JMX notification listener when destroying servlet o.a.catalina.manager.StatusManagerServlet
Fix typo
Avoid NPE
Fix a threading/timing issue more easily observed on OSX than on Windows.
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55620 Handle the case of a comma in $CATALINA_HOME or $CATALINA_BASE
Fix comment typo
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55630 Provide a way to disable the custom URLStreamHandlerFactory
It isn't available yet but make sure no-one tries to use 8.0.x with anything less than Tomcat Native 1.1.29 as all prior versions are known to be broken for WebSocket.
Trailing whitespace police
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55633 for NIO. The Comet code that ensured that multiple threads didn't process the same socket when the selector indicated that a socket was ready for read and write pre-dated r1001698 where syncs where added to the SocketProcessor to achieve the same aim for Servlet 3.0 asyncs processing. The Comet code was re-used to handle upgraded connections. The upgrade code did not handle the case where a socket was registered for read and write but only a write event occurred. In this case the read registration was lost. This is the root cause of the lack of responsiveness observed in bug 55633. With the changes in r1001698, a simpler solution can be used for both Comet and HTTP upgrade. The new approach unregisters the socket operations the selector has reported ready for and then triggers a read and/or write as appropriate. For Comet the syncs will ensure that read and write aren't processed in parallel. For HTTP upgrade such parallel processing is permitted.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55633 for APR. If the socket was registered for read and write and only one occurred, the registration for the other event was lost. Ensure that the socket is re-registered with the Poller when necessary.
If the browser crashes or a similar event occurs writing messages will start failing. Rather than ignoring these failures, close the session.
Remove completed TODOs
Revert r1529130 and add a comment that explains why the sync is necessary.
Fix an intermittent failure with TestWebappClassLoaderExecutorMemoryLeak. If the executor threads did not stop quickly enough, Thread.stop() was used. Sometimes this resulted in the executor not shutting down and the test failing. This makes using clearReferencesStopThreads marginally safer.
Some more false positives
Ensure sendfile is enabled by default for APR.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55639 Add a Drawboard WebSocket example.
svn:eol-style = native Sorry for the noise.
Improve Drawboard Example: - Check if buffered messages exceed a specific size, to avoid a DoS. - Combine buffered string message to reduce TCP overhead when sending them.
- Use "100" as maximum number of players instead of "2" that was for debug purposes only. - If a player couldn't enter the room, close the connection.
Fix error in JavaScript code.
Add missing license header. Remove trailing whitespace. Fix Javadoc errors. Remove some blank lines.
Tab police
More tab police
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55638 Fix the corruption of large WebSocket messages when using the NIO connector.
Clear the handler then close the connection so the handler gets to the the exception that caused the problem rather than any exception that may happen during close.
Fix infinite loop issue triggered by the test case for BZ 55638
Whoops. Remove the debug code.
Add .xhtml to the welcome files for the examples webapp
Ensure the examples webapp starts when validation is enabled.
Fix the fix in r1530423
Changes to the programmatic echo endpoint so it can be used with the Authobahn test suite: - handle binary messages  - handle partial messages (enables larger messages)
Remove completed TODOs and pointless Javadoc
Use the constant for the buffer sizes (makes it easier to experiment with performance impacts of different buffer sizes)
Handle write errors when the client drops the connection in the same way read errors are handled.
Fix issue observed with APR, WebSocket and blocking messages. If one client freezes the system freezes once the network buffers are full. When the client unfroze, the backlog of traffic was cleared and then one or more connections were closed unexpectedly. This was caused by incorrectly setting a very short timeout when readding the socket to the Poller after only a subset of the registered events triggered.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55642 Correct logic error in Node.isLiteral() that was returning the inverse of the desired result when the value was an EL expression.
Remove the debug code.
Fix bug in parsing the client message.
Fix bug in the drawboard JavaScript when socket.onmessage is raised while the Image.load event from a previous message did not yet raise which caused messages to be ignored.
Avoid stacktrace in logs if the session closes due to an IO error in the middle of sending a partial message.
The link under Tomcat Context Descriptor section should point to documentation about context.xml and not the one for server.xml. Issue is reported via o.a.comments.
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55620 Prevent Tomcat from starting on Windows when CATALINA_HOME contains a ; character
The link to the Manager App How To was missing. Issue was reported via o.a.comments.
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55620 Prevent Tomcat from starting on Linux when CATALINA_HOME or CATALINA_BASE contains a colon
Update the change log.
Restore Tomcat 7 behaviour of skipping TLDs located directly in WEB-INF/classes or WEB-INF/lib
Fix TLD processing when using JspC.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55251 Do not allow JspC task to fail silently if the web.xml or web.xml fragment can not be generated. 
Rather than only be able to pause websocket message, pause entire calls to event handler so that we can also pause the socket.onclose event handler.
Fix a bug introduced in r1357039 that removed a local close variable which mean that code that should of triggered a socket close, ended up closing the Poller as well.
Javadoc fixes.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54095 Add support to the Default Servlet for serving gzipped versions of static resources directly from disk as an alternative to Tomcat compressing them on each request. Patch by Philippe Marschall.
Fix TestVirtualContext after changes in r1530937
Missed a path that needed changing in r1531120
Allow to draw other forms like line, rectangle and circle/ellipse.
Follow-Up to r1531130: Also set the correct mouse coordinates when canceling the drawing.
Handle coordinates as double instead of int.
Fix whitespaces
Update snapshot
Add standards-based "touch-action" style.
Remove changelog entry for https://issues.apache.org/bugzilla/show_bug.cgi?id=55639 as it is now backported to 7.0.x.
Keep up with the Pool2 snapshots
Align the drawing style in Java2D with the one in HTML5 Canvas.
Update some comments.
Update pool and dbcp snapshots
Fix the regression in r1530269. Enabling/disabling sendfile should occur during bind not during start. Add a warning message if the user tries to explicitly enable sendfile with SSL.
For https://issues.apache.org/bugzilla/show_bug.cgi?id=55620 Correct a copy-paste typo in r1530890
Review by kkolinko - disable use of gzip version for included resources - don't change the content type of the gzip'd version of the resource - use eTag and last modified date from original rather than gzip'd version - don't fall back to write when using gzip'd version
Note requirements for securing the gzipped version of a file.
Update to APR/native connector version 1.1.29
Added small examples for Jar Scanner and Jar Scanner Filter elements. Issue is reported via o.a.comments.
Fixed typo. Issue is reported via o.a.comments.
Refactor WebSocket examples to only require the SCI
Change the default for the new gzip option on the default Servlet to disabled.
Fix gzip test for default Servlet after it was disabled by default
Use correct limits when writing SSL data
All webapps/docs/*.html files are in UTF-8, as well as webapps/ROOT/index.jsp and res/welcome.*.html.
- Do not use a extra Thread for the room as synchronizing access to the Room's internals should suffice.
Add xhtml file extension to list of text file types
Can't use Ant property replacement in files that are generated via XSL processing. Add processing to the stylesheet.
Trailing whitespace police
Fix WebSocket when running under a security manager
Fix Servlet 3.1 non-blocking when running with a security manager
Simplify
Fix Gump failures when the SCI scan finds too many classes.
- Remove (commented-out) <meta name="email" ..."> because "email" is not a registered name. - Reorder the $project declaration
Show crosshair cursor on the canvas. This still needs a workaround for Chrome.
Prevent default mouse event on Canvas element to prevent browsers from marking text (and Chrome from displaying the "text" cursor).
Trailing whitespace police
Add a flag to the SocketWrapper to indicate if the socket is using a secure connection. Initially this is intended for use with the APR connector to better determine what various error codes may mean.
Add a debug message that enables the socket reference (used in most debuig messages) to be matched to the port number (used in tcpdump) to enable unusual behaviour in the debug logs to be easily matched to the corresponding network activity.
Include socket reference in IOExceptions to make debugging easier
Handle the client dropping the connection during the SSL handshake in the same way as it is handled at any other time.
Don't call the onError() method of the endpoint if the WebSocket close message cannot be sent for abnormal closure as this is not unexpected.
Restore the ServletContextListener for the Drawboard example to be able to shutdown the Room (dispose of Graphics2D) when the Context is destroyed.
Tab policy
Follow-Up to r1358057: The non-blocking connector will be used if the TC-native library cannot be found.
Use lazy init for the room in the WebSocket drawing board example. This is primarily to avoid an issue with a hang on Java 6 in Tomcat 7 (the JSR-356 examples require Java 6) but may also help with adding multiple room support.
Whitespace police
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55656 Configure the Digester to use the server class loader when parsing server.xml rather than the class loader that loaded StandardServer. Patch provided by Roberto Benedetti.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55663 Notice files are corrected according to http://www.apache.org/legal/src-headers.html#notice
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55664 Correctly handle Encoder, Decoder and MessageHandler implementations that use a generic type such as Encoder.Text<List<String>>
Update comments that should have been changed when code was generalized.
Handle arrays of generic types in encoders, decoders and MessageHandlers.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55681 Pass the session to the Pojo MessageHandler wrappers so it is passed in to the MessageHandler method calls.
Add log message that initialization of AbstractReplicatedMap has been completed.
Revert the swallowing of the Status.APR_EGENERAL. It can't be the SSL handshake failing as that has to have completed for the code to get this far and it appears to be related (the same?) as the random closes when using the drawing board example.
Removed the extra line-ending information in the files.
Check for closed sockets earlier and reduce code duplication.
Remove socket from list of connections as soon as we know it is going to be closed.
Add wrapper information to error message
The logger of AbstractReplicatedMap should be non-static in order to enable logging of each application.
follow-up r1534566.
Improve debug logging of SocketWrapper that just uses toString()
kkolinko review Fix typo Use less code
Latest attempt to address issues with APR/native, SSL and the drawboard example
Document client side SSL config
Add some timouts rather for IO operations while establishing a WebSocket client connection.
- Prevent recursive invocation of Runnables by Room.invokeAndWait() to prevent errors like ConcurrentModificationException when Room.broadcastRoomMessage() iterates over an ArrayList and then calls Room.invokeAndWait() recursivly, iterating again over the array. - Add comment about blocking Session.close() method.
gzip should be disabled by default
Add to cluster document a description of notifyLifecycleListenerOnFailure and heartbeatBackgroundEnabled.
Update spec version and section number when rejecting a JAR file based upon pre-defined list of trigger-classes.
Use application class loader when calling ReadListener and WriteListener methods
Provide modifyHandshake() with a per session (i.e. per connection) view of the user properties rather than a per endpoint view (that would be shared will all connections to that endpoint). This allows for easier configuration of per connection properties from within modifyHandshake()
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55691 ArrayELResolver needs to handle the case where the base object is an array of primitives.
Remove unnecessary whitespace
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55684 Log a warning but continue if the memory leak detection code is unable to access all threads.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55702 Fix loading of TLD when CATALINA_HOME contains spaces
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55703 Clarify role of singleton attribute for JNDI factories
Add mouse events to the document object so that the canvas correctly gets notified by MouseUp/MouseMove events even if the mouse cursor is outside of the canvas.
Add a description of to the Drawboard page.
Follow-Up to r1536834: Use correct order of initialization methods.
Remove Whitespaces
Simplify the code of DeltaManager#startInternal(). Reduce unnecessary nesting for acquisition of cluster instance.
Remove unnecessary attributes of stateTransferCreateSendTime and receiverQueue from cluster manager template. These attributes should not be defined as a template.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55715 Add a per web application executor to the WebSocket implementation and use it for calling SendHandler.onResult() when there is a chance that the current thread also initiated the write
Fix markup
Review of r1537041: a pair of typos.
Only refresh the Display Canvas on a MouseMove event if mouse was inside of the Canvas.
Fix broken tests
Remove reference to deleted package
Close the stream after using it.
Add @since comment for method Part.getSubmittedFileName() that was added in Servlet 3.1.
Fix indent
Remove option to set repository path. It will always be /WEB-INF/classes Additional resources can be mapped to /WEB-INF/classes via the new resources implementation.
Remove the repository
Simple test to see how many outgoing connections can be created on a single machine.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52323 Add support for code coverage with Cobertura (disabled by default) when running the unit tests
According to the ServiceLoader specification the name of the provider-configuration file is the fully-qualified binary name of the service's type. In this case instead of javax.websocket.server.ServerEndpointConfig.Configurator the file name should be javax.websocket.server.ServerEndpointConfig$Configurator.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52323 Do not download Cobertura, unless it has been enabled.
Followup to r1538084 Add a comment on the new class. (Copied the text from the commit message).
First pass at switching to Jar abstract from Jar scanning code that handles accessing resources in JARs in packed WARs.
Enable the JAR implementation for JARs in packed WARs to correctly handle multiple calls to methods
First pass at using the new resources implementation to provide resources to the class loader.  Class loader resources are handled by treating JARs in WEB-INF/lib as resource JARs (without the internal META-INF/resources/ prefix) mounted at WEB-INF/claasses (rather than the web app root). This enables reuse of the resource handling plumbing.  These resources are marked as class loader only so they are only used in the methods that are explicitly defined to return class loader resources. This prevents calls to getResource("/WEB-INF/classes") returning from one or more of the JAR files.
Switch the web application class loader to load resources via the new resources implementation.
Add getClassLoaderResources() support
Remove the nonFoundResources collection - WebResources will handle this.
Remove unnecessary whitespace
Clean up
Remove the anti JAR locking feature. It will be replaced by tracking of InputStreams obtained from the WebResources. This will allow identification of the resource leaks.
Whitespace
Additional fix for removing anti JAR locking
Remove now unused loaderDir
Remove unneccessary sync
Remove unused JarFiles - class loader resources in JARs are obtained via WebResources
More removal of anti JAR locking
Fix getURLs() so it takes account of any call to addURL() on the class loader Ensure the list of repositories that the loader returns via JMX includes any added via addURL()
Class loader is responsible for setting up WEB-INF/classes
Whitespace
Remove some now unused code
Re-write JAR modification tracking
Refactor the implementation of the requirements of 10.7.2 of the spec. Don't ignore whole JARs, just prevent applications from overriding spec classes and container implementation classes. Note overriding of Java JRE provided classes is already prevented.
Remove unused fields and methods as a result of refactoring JAR handling in the web application class loader
Simplify modification tracking
Rename. Loader is a poor choice as there is a separate Loader component
Copy new field when creating copy of class loader
First cut at adding resource tracking
Make certificates and manifests available
Simplify. Get the manifest via the resources implementation
Use UCDetector to reduce visibility generally in the webresources package. It can always be increased on a case by case basis if necessary.
Document how to enable Cobertura code coverage
Move the Cobertura output up a level
Skip the Cobertura JARs
Better names
Fix failing unit tests after refactoring of Jasper to use the JAR abstraction from the JAR scanner.
Fix remainder of failing tests and a related TODO spotted in the tests as well.
Fix indent
Fix various bugs in Jasper's simplified EL parser and add the test case that found them. This is a precursor to fixing BZ55198 / BZ55735 since that is going to require separating an attribute value into EL and non-EL components
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55735 This fixes a regression caused by the fix to https://issues.apache.org/bugzilla/show_bug.cgi?id=55198 When processing JSP documents, attributes in UninterpretedTag nodes that contain EL should have the the non-EL components XML escaped and the output of the EL components should not be escaped.
Review of r1539036 by Nick Williams.  copyWithoutTransformers(), as defined in the interface InstrumentableClassLoader, returns a ClassLoader. The start() method is not defined in ClassLoader, it is specific to WebappClassLoader. Furthermore, code calling copyWithoutTransformers() won't have access to WebappClassLoader to call start() reflectively if a SecurityManager is enabled.  So, the copyWithoutTransformers() method needs to call start() before it returns the copied class loader. Otherwise, it will be useless to JPA providers and the like.
Fix MBean attribute definition of stateTransfered. The method name is not isStateTransfered() but getStateTransfered().
Correct stop failure log of cluster. Failure cause is not only Valve.
Remove unnecessary sleep when sending session blocks on session sync phase.
Simplify
Make the time the internal executor waits for request processing threads to terminate before continuing with the connector stop process configurable.
More useful error message
Consistently use path as key in our local resources cache to improve hit ratio Consistently convert binary names and resource names to paths to ensure consistent results when looking up resources. This fixes an issue with modified() that was incorrectly indicating that resources had changed.
Need to remove classResources in stop() as they will be recreated in start()
Testing the resources refactoring with Atlassian Jira Now a single entry in resourceEntries is used for classes, retain the URL so getResourceAsStream() still works after the class has been defined
Revert unintended commit
Various fixes:  - Use Commons DBCP rather than commons-dbcp  - Differentiate between DBCP 1.x and 2.x  - Update for improvements in DBCP (mostly in Pool actually) around synchronization  - Remove stagnant point Reduce line length to aid readability.
Whitespace police
Add a workaround for a Jira bug (to be removed later) as Jira is being used for testing
Add a couple of test cases.
Simplify. canRead() includes an exists() check.
Protect against possible NPE
Correctly implement delegation filtering for container packages.
Correct r1539872 - thanks to Cyril Bont
Make the magic constant a constant
Sample Eclipse project for Tomcat 8 - Specifically select a Java 7 JRE (Execution environment "Java SE 1.7") - Add EasyMock 3.2
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55759 Update Eclipse JDT Core Batch Compiler (ecj.jar) from 4.2.2 to 4.3.1.
Reduce calls to exists()
Correct Javadoc.
Remove TODO and improve comment. Review from kkolinko
Improve start time for large web applications by avoiding CNFE from system class loader
Re-order tests to skip more expensive test when posisble
Don't scan the same TLD more than once
Update to Commons Pool 2.0 now it has had its first release
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 Improve markup of XHTML Basic JSPX example: - Since it is intented to be XHTML, change it to actually output XHTML instead of malformed HTML. - Simplify by moving the DOCTYPE declaration into the file itself (Note that my understanding is that HTML5 obsoletes XHTML 1.x DOCTYPES so the DOCTYPE probably can be removed - I don't know if there is actually software that interpretes XHTML documents which are limited to an XHTML 1.1 Basic scheme).
Follow-Up to r1540070: Fix whitespaces.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 Improve HTML markup in the examples.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 Follow-Up to r1540077: Improve HTML markup in the examples.
Internet Explorer (9 - 11) has an option to enable charset guessing if not charset is specified, but it is not enabled by default.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55746 Add documentation for AllRolesMode for CombinedRealm Patch by Cdric Couralet
Simplify (remove unused code)
Simplify - merge unused constructor into used constructor
Simplify - merge locally used methods into constructor
Simplify - switch to local variables
Remove StackMapType. Swallow associated values as they are never used.
Use local variables
Remove unused StackMapTableEntry Swallow associated values as they are never used.
Simply. Only a single constructor is required.
Remove StackMapEntry. Swallow associated values as they are never used.
Simplify
Remove StackMap and StackMapTable. Swallow associated values as they are never used.
chopit parameter is always false in remaining code. Simplify.
Remove unused constants.
Reduce visibility. Use private constructor rather than making class abstract.
Remove unused code
Merge constructors
Remove Unknown. Swallow associated values as they are never used.
Remove Signature. Swallow associated values as they are never used.
Be consistent with exceptions choice for invalid data
Merge constructors
Remove Syntehtic. Swallow associated values as they are never used.
Follow up to r1539173. Remove unused xmlEscape flag.
add signing key
remove whitespace that causes checkstyle to fail
fix IDE warning about uneeded boxing
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55749 Improve error message when SSLEngine is disabled in AprLifecycleListener and SSL is configured for an APR/native connector.
Follow-up to r1540539 after kkolinko review
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55760 Remove unnecessary setting of property that causes problems whe using SPNEGO with IBM JDKs.
Add more detail to the security how-to
If a request that includes an "Expect: 100-continue" header receives anything other than a 2xx response, close the connection. This protects against mis-behaving clients that may not sent the request body in that case and send the next request instead.
Correct two typos. s/a users/as users/, /Manager/Host Manager/
Only schedule a TimerTask when the first player enters the Room (and cancel it if the last player exits the Room).
Re: r1540522 Fix unneeded boxing/unboxing.
Rename
Fix typo reported on users list.
Replace TldLocationsCache with the new TldCache that also caches the contents of the TLDs. This is the next step in the refactoring of TLD handling.
Whitespace
Remove code that was written to avoid jndi:// URLs when accessing resources. It is no longer required as jndi:// URLs are no longer returned.
Already have a reference to the JAR containing the tag so use it rather than looking it up again.
ImplicitTagLibraryInfo represents an implicit tag library corresponding to the tag files in "/WEB-INF/tags/" or a subdirectory of it so there is never a containing JAR file.
jndi URLs are no longer used in Tomcat
Improve error reporting. - Be more precise about the location of the file with the error - Don't swallow exceptions
Don't close jar here - may need to read other files from the JAR.
Revert accidental commit in r1541472
Make the web application path available to the TldResourcePath
Remove TldLocation
Re-order to simplify later refactoring
Rename descriptor representations to avoid name clashes with implementations.
Avoid the need for a bunch of null checks.
Check-point (TLD support broken)
Use cached result of parsing TLDs rather than re-parsing.
Remove unused parameter
Fix a NPE
Remove unused code
Check the parsed TLD cache entries are not stale.
Fix NPE
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55772 Ensure that the request and response are recycled after an error during async processing.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55776 Normalize resource requests before processing them.
Normlization is now handled by the WebResourceRoot
Take account of WebResourceRoot being stricter with traversal attempts.
Fix test now checking in getResource is stricter
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55778 Make value used for javax.security.sasl.qop with SPNEGO configurable.
Update
Trailing whitespace
remove dead code left after TldLocation refactor
remove IDE warnings in TagLibraryInfoImpl
Use Digester to load implicit.tld taglib descriptors
Refactor TagPluginManager to use Digester The split in packages is due to import restrictions between o.a.tomcat and o.a.jasper
Remove ParserUtils and DOM-like TreeNode now all descriptors are parsed using Digester
Remove unnecessary code - super class does exactly the same thing.
Work around false positive test failure
Initialize the JSP runtime in Jasper's initializer to eliminate the need for a Jasper-specific listener in the container.
update changelog about removal of JasperListener
Revert part of r1542565 which added rather than removed an IDE warning
Fix a FindBugs warning. Throw NPE rather than triggering one.
Fix FindBugs warning Use separate catch blocks when different actions are required for different exceptions
Fix typo in new attribute name
Fix typo
Fix a couple of typos and clarify what QOP stands for.
Add file of inspection rules for Intellij IDEA
Add license block
Try to capture some of the coding style not covered by the validate target. 
Update comments. No JNDI permission is granted now JNDI is not used to access files.
Remove unused code
Followup to 1542828. Highlight a class name
Remove unused method
Fix indent
Remove unused import
Minor clean-up  - inner class to end of file  - no need for public modifiers in interface
Remove unused code
Grant read permissions to all resource locations used by the web application
Better conversion of base URLs to file permissions.
Use local variable since we already have a reference to the ServletContext
Clean up
Fix regression introduced in r1445964. Extract the correct lines from the JSP when displaying the error
Add kkolinko's unit test for https://issues.apache.org/bugzilla/show_bug.cgi?id=55792
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55792 EL 3.0 introduced the possibility of nested {...} sequences within EL expressions so update the JSP parser to handle them.
Add an initial unit test for the WebappClassLoader
Correct a typo
Followup to r1456457 Correct typo in the name of a private field
Re-order / clean-up. No functional change.
Remove unused constants
Rename for consistency with the rest of the Tomcat code base
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55798 Log an error if the file can't be found
Clarify purposes of buffers.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55799 Implement the restriction required by the JSR356 specification that only one message can be written to a remote endpoint at a time.
Implement the restriction required by the JSR356 specification that only one message can be written to a remote endpoint at a time.
Remove dataMessageInProgress since it is no longer required along with the supporting code.
Protect against NPE.
Further work on https://issues.apache.org/bugzilla/show_bug.cgi?id=55799 If an IO error occurs while sending (or receiving) a WebSocket message pretty much the only thing that can be done is to close the connection - hopefully in a graceful manner. Therefore, leave the state machine in the "message in progress" state if an error occurs as this will prevent further attempts to send non-control messages. The close message is a control message so it will not be blocked. Note that the close message may not reach the other end of the connection.
Fix a couple of log message TODOs
Continuing the https://issues.apache.org/bugzilla/show_bug.cgi?id=55799 code review The check that only allowed control messages to be added to the queue is not valid so remove it. If a control message is sent in the middle of a sequence of text message parts when the current text part completes and the control message is sent there is a strong chance that the next text message part will need to be queued until the control message completes.
More https://issues.apache.org/bugzilla/show_bug.cgi?id=55799 If the connection is closed mid-message, report this cleanly back to the caller.
Be more explicit about what the xmlNamespaceAware attribute controls
Update comment
Extend the reach of the Context attribute xmlValidation to cover XML parsing by Jasper the JSP engine. Fix a TODO and enable validation (if required) for implicit TLD files.
Align the XML parser configuration between the Digester (web.xml, web-fragment.xml, *.tld) and JspDocumentParser (*.jspx, *.tagx)
Fix copy/paste oversight in r1544208
Better Javadoc
Rename fields to align with attribute names.
Minor clean-up. Inherit the Javadoc.
Separate validation of *.jspx and *.tagx files into a new option.
Followup to r1544460 Correct typos in javadoc
Followup to r1544455 and r1544460 Rename method arguments as well
Add command line support for TLD and JSP document validation to JspC
Reinstate the TLD validation option
Better name
Better names
Switch from ServletContext attribute to init-param. Note that Jasper was incorrectly (now correctly) looking at init-params in some places.
Line length
Align documentation with the code. The attribute names were wrong.
Fix copy/paste error in log message
Do not include Cobertura and instrumented classes into the junit classpath, unless Cobertura is enabled.  This allows to turn Cobertura off and on at any time. This avoids "mkdir ${cobertura.home}" that breaks builds at Apache Gump.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52323 Correct typo, add note about licensing
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52323 Exclude servlet-api and Jetty JARs from Cobertura classpath. It works without them.
Exclude AprSocket class from instrumentation.  Cobertura fails to instrument it, because it causes loading jni.socket.AprSocketContext and jni.Library which fails when tcnative library is absent in java.library.path.  No need to backport, as this class is absent in Tomcat 7.
When running under a security manager disabled deployXML by default.
Fix typos
Fix trailing whitespace
Fix logic error that meant that unpackWARs was ignored if a WAR failed to deploy (since the Context is an instance of FailedContext in that case)
Prevent a web application from deploying if it contains a context.xml, deployXML is false and there is no explicit descriptor as the descriptor may contain necessary security information.
Update unit tests and documentation now that deployment fails if deployXML is true and the application has an embedded context.xml
Remove unused code.
Ensure that the Host's contextClassName attribute is used when parsing descriptors that do not define one.
Correct comment
Document new attribute
Correct typo in a message
add testcase to show problem with XSD validation of JSP documents
use an InputSource in JspDocumentParser to provide a base URI for resolution
Convert JspDocumentParser to an DefaultHandler2 Added TODO on using JarFactory to resolve Tomcat-specific URLs returned by the Jar abstraction.  Still need to figure how to do that.
Correct the documentation for Cluster manager.
Expose stateTimestampDrop of org.apache.catalina.ha.session.DeltaManager via JMX.
Test for finished request before doing any processing
Ensure that onAllDataRead() event is always fired once (and once only) after the request body has been read
Fix regression in fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55799 that broke stream messages. Add a test case for stream messages.
Remove the option to use schema validation for *.jspx and *.tagx files
Remove tldNamespaceAware property from mbeans-description file. Add mention of tldValidation option to systemprops document, as it has been restored.  (Followup to r1513787, r1544585)
Align description of properties of StandardContext in mbeans-descriptors.xml with its Javadoc.
Review of r1545580 Rephrase.
Avoid NPEs if asyncContext is completed by listener
Correct a typo.
Correct a typo in documentation: a network interface name is not a boolean option. (Reviewing r1498342 )
Mark private fields as final. (Review of r1508200 )
Fix Cobertura runs that were broken by r1545075  I do not know what exactly went wrong, but I suspect that re-declaring a <path> with the same id was overwriting the previous definition. Thus I moved those into separate <target> that executes conditionally.
Followup to r1545613 Add final modifier to a private field.
Refactor to remove the base field from LocalResolver. Populate the LocalResolver with the full URLs to the well-known resources.
Need to convert Path to string before checking the extension scanWebInfClasses() still requires an implementation for when scanAllDirectories is enabled
Create dependency to the TLD file rather than to the webappPath of the root of the search Add a test case for bug 55807 and the other issues fixed in TldScanner while investigating bug 55807
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55807 The JSP compiler used a last modified time of -1 for TLDs in JARs expanded in to WEB-INF/classes (IDEs often do this expansion) when creating the dependency list for JSPs that used that TLD. This meant JSPs using that TLD were recompiled on every access.
Grr. Wrong branch.
Review of r1546165 Do not waste time converting the whole path to lowercase. Convert only the filename, as it is its extension that we are testing here.
Create a new tomcat-util-scan.jar that contains the classes for JAR scanning and XML descriptor processing. Update the .pom files with the new dependencies. Review the .pom file dependencies and update to take account of Tomcat 8 refactoring.
Fix NPE reported on users list when HTTP session ends
Tab police
Additional fix required for bug 55799
Add the new Jar to the JARs to skip
Add a debug message when the session ID changes on authentication
Remove unnecessary "throws ServletException"
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55804 If the GSSCrednetial for the cached principal expires when using SPNEGO authentication, force a re-authentication.
Got Windows auth working with Tomcat running on a Linux server. Add the details to the docs.
No need to use <strong> on a heading.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 Include "Open Sans" font and use it for the documentation.
Fix tab.
svn:eol-style = native
Trivial clean-up
Correct URL for fragment
When the ping timeouted, make sure that memberDisappeared method is not called by specifying the members that has already been removed.
Add log message of session relocation when member disappeared.
Fixed typos. Issue reported via o.a.comments.
If ping message fails, prevent the wrong timeout detection of normal member that is no failure members.
Merge changes from bcel r1521061-1547757
Fix unboxing warning
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55837 getRealPath() should return a result for resources that don't exist where possible Add some unit tests to check this. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55839 Extend support for digest prefixes {MD5}, {SHA} and {SSHA} to all Realms rather than just the JNDIRealm.
Additional fix for BZ 55839 required by DataSourceRealm
Additional fix for BZ 55839 required by JDBCRealm
Additional fix for BZ 55839 required by MemoryRealm
Fix a file locking issue with TLD files.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55842 Check if the output buffer can grow before flushing it when using a writer.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55851 Enable SPNEGO to work with IBM JDKs. Based on a patch by Arunav Sanyal.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55801 Add the ability to use a custom SSLContext when creating client wss connections. Patch provided by Maciej Lypik.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55811 Do not parse web-fragment.xml files when an empty absolute-ordering element is present.
Improve parsing of trailing headers This is part of the fix for CVE-2013-4322.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55820 Include the 172.16/12 range in the default value for internal proxies.
New field can be final
Add an option to the Context to control the blocking of XML external entities when parsing XML configuration files and enable this blocking by default. The block is implemented via a custom resolver to enable the logging of any blocked entities. This is the fix for CVE-2013-4590.
Update
Fix failing tests. TldParser needs a RuleSet.
Fix Windows specific issue when converting a file system path to a web application path ('\' -> '/')
Unused method initialize() was removed in r1542957. Remove orphaned references from javadoc. 
Fix Javadoc. 
Methods need to be public for digester to be able to use them.
If a file is too big to be cached, return the original resource not the CacheResource instance else the resource content will still be cached.
Use an int for the maximum object size to be cached in bytes since it is cached using a byte array and that is limited to Integer.MAX_VALUE. Test objects to be cached against the maximum object size, not the maximum cache size.
Simplify assuming that the resources implementation will generate an InputStream from the cached byte array if one is available.
Change the caching approach slightly. Previously, resources were only cached if they were smaller than maxObjectSizeBytes. Now they are always cached (so the metadata is cached) but the content is only cached if they are smaller than maxObjectSizeBytes.
Expand validation tests to make sure there are no parsing errors.
In o.a.tomcat.websocket.server.WsHttpUpgradeHandler.init(WebConnection) if the endpoint is NULL the connection will not be initialized. Then in o.a.tomcat.websocket.server.WsHttpUpgradeHandler.destroy() the connection should be tested for NULL.
Back to using snapshots for Pool and DBCP to pick up latest versions with improved JMX stats
Consistent naming
More logical grouping of components (group by Host then by Context)
More descriptive name
Fix failing test be swapping order of host and context properties in object names. Add a test that confirms that property order is not significant in ObjectName.
Better message text (reported via users list)
In AbstractReplicatedMap#finalize, remove rpcChannel from channel Listener of group channel before sending MapMessage.MSG_STOP message. This prevent that the node that sent the MapMessage.MSG_STOP by normal shutdown is added to member map again by ping at heartbeat thread in the node that received the MapMessage.MSG_STOP.
Various caching improvements: - Collect cache stats and make them available over JMX. - Separate the root resources and Cache in JMX. - Clear the cache when it is disabled. - Clear the traced resources when tracing is disabled. - Use a concurrent set for the traced resources.
Make the trace resources accessible via JMX.
Need to include new Cache MBean in test (thanks Gump)
Fix an edge case spotted while testing other functionality. If a context.xml file is added to a DIR it was always ignored. It will now trigger a redeploy.
Fix the sample configuration of StaticMembershipInterceptor in order to prevent warning log. uniqueId must be 16 bytes.
Review of r1550397 (Note: A commit e-mail for r1550397 has not reached the dev@ list)  Fix duplicate description. Remove duplicate property.
Add back uri normalization for cache lookup. Test submitted by Violeta Georgieva.
Fix my typos in the test.jsp test file.
Fix IDE warning = uri can't be null here
Add missing license header
Rename to match class being tested. Fix Javadoc warning.
Alternative fix for normalization issue that doesn't depend on RequestUtils which isn't available to Jasper.
Alternative fix for normalization issue that doesn't depend on RequestUtils which isn't available to Jasper.
startsWith("/META-INF/tags") used to be allowed, but needed a specific hack (that was removed along with the check, unfortunately).
Followup to r1550695: svn:eol-style=native
Fix a find bugs warning about String comparison
svn:eol-style=native
Fix getting last modified for tagfiles in JAR so that it is not marked as not found. I chose to not fix and use getResource in that case (it looked slower to go through the URL since the point is to avoid using JAR URLs I suppose), but this could need fixing too just in case it is used.
In addition to r1542550 where TagLibraryInfoImpl.createVariable(...) method is removed. According to web-jsptaglibrary schema, variableType->declare is 'true' by default. Adjust default value for 'declare' in o.a.t.util.descriptor.tld.TldRuleSet.Variable to the one expected by the schema.
Use existing local variable instead of a getter. Spotted thanks to "manager can be null" IDE warning.
Add a unit test for tag files packaged in JARs
No need to set defaults
Fix memory leak when something goes wrong when serving static resources.
jndi: URLS are no longer used. Remove some unused code.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55884 Ensure that URLs that are converted to file paths are correctly decoded. The primary use is to ensure that %20 sequences are converted to spaces.
Better handling if no message handler is configured. Message is just ignored.
Need to handle case where message size limits are larger than the default buffer size. (Limits smaller than the buffer size were handled correctly.)
Throw exception if max message size is too big
Performance improvement The context class loader was set in *Endpoint#processSocket() in case a new thread was created since this method may be triggered from web application code and that in turn would trigger a memory leak since the thread would end up with the web app class loader as its context class loader. However, this is only an issue when creating threads and since getting the current class loader is expensive, move this code to where threads are created rather than calling it on every call to *Endpoint#processSocket(). This appears (on my fairly unscientific tests) to remove ~5% of the overhead from all request processing.
Performance improvement Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55855 Make the adding of the WsFilter lazy so it doesn't get added to web apps that don't need it.
Fix failing test after adding test-lib.jar to test web app
Observed strange lock-up on OSX when two threads were writing concurrently to this Map. Switch to ConcurrentHashMap in an attempt to avoid the lock-up in future.
Need to publish new tomcat-util-scan JAR
Avoid NPE on shutdown if application doesn't use WebSocket
Avoid a warning that executor hasn't shutdown yet if the endpoint is not configured to wait for the executor to shutdown. (BIO is configured not to wait by default as threads in keep-alive can't be interrupted.)
Add time stamp to GET_ALL_SESSION message.
Fix typo.
Fix a reported issue when running under a security manager. Refactor to enable some basic unit testing to hopefully avoid some of these issues in future.
Add a basic unit test
Fix indentation
Observed a hard to reproduce test failure with the non-blocking IO tests. Can't reproduce it yet. Working assumption is that Poller and application thread have a different view of the async field on the SocketWrapper so make all the flags the Poller uses volatile.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48550 Follow-Up to r1511468: Fix example servlets to output text as UTF-8. This fixes encoding issues with the "Request Parameters" and "Cookies" servlet examples as otherwise the browser would encode the form data with the document encoding (ISO-8859-1) but Tomcat will interpret it as UTF-8.
Reset test side-efect between test cases. 
Clean-up. No functional change.
Refactoring the starting of individual filters into a separate private method so it can be reused elsewhere in the class.
Revert r1551991 - The solution I had in mind isn't spec compliant
Revert r1551352. Lazy init of WsServerContainer causes problems with Atmosphere that can't easily be avoided.
Alternative partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55855. Don't do the expensive 'Is this a WebSocket upgrade request check' if no endpoints have been registered
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55905 Prevent NPE when the specified tld resource does not exists.
Add a link from extras page to download page. Issue is reported via o.a.comments.
Followup to r1552080: avoid hard-coded download link
JspC passes configuration with ServletContext init params so a real implementation is required.
Avoid possible NPE
Add a note about creating release builds on non-Windows platforms.
fix #55917 by allowing 8-bit ISO-8859-1 characters in V0 cookie values
revert 1553187
fix typo
Fix NPEs in test
Clarify based on feedback on users@ list
Be more precise about how maxConnections works
Align names between 7.0.x and 8.0.x
Align names between 7.0.x and 8.0.x (missed an mbean attribute)
Align names between 7.0.x and 8.0.x (more places - thanks to kkolinko)
Move control of caching and linking options from the Context to the WebResourceRoot to enable them to by changed while the web application is running.
Rename trace[d] -> track[ed]
Document the track locked files option
Followup to r1553833: A few more trace[d] -> track[ed] renaming.
Followup to r1553838 Fix a missing bracket in documentation
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55939 Ensure that flags used for non-blocking writes are reset between requests.
Happy new 2014. 
Avoid NPE if the write listener is called once immediately after being set, even if no data was written (= the app doesn't send any message during the init of the connection). I don't think Tomcat does it yet (this doesn't need to be ported to Tomcat 7 since it is not a Servlet 3.1 impl).
Add test cases for name checks in spec Cookie class
fix test after switching from STRICT_SERVLET to more specific properties
Refactor ServerCookie to separate cookie state from the helper code used to generate the header. This change is purely a movement of code to improve readability.  ServerCookie is now a pure data object holding MessageBytes, typically resulting from the parse of the Cookie header done by Cookies.  The appendCookieValue static helper method is moved to a new class, SetCookieSupport, that Response uses when addCookie is called.
Back to a proper Commons Pool release now 2.1 has been released (DBCP snapshot requires Pool 2.1 or later)
Simplify interface to SetCookieSupport.
Inline method call and eliminate an unneeded StringBuffer allocation.
Move methods only used by SetCookieSupport into that class.
test cases for Set-Cookie generation
Followup to r889966: The genStrAsCharArray init param in Jasper has been renamed to genStringAsCharArray in Tomcat 7.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55888 Clarify that Container elements may only no more than one Realm.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55937 Treat a context path of "/ROOT" as equivalent to "" (i.e. it is treated as the ROOT application). Note that when deploying an application via the manager text interface to /ROOT, it was deployed as the ROOT application but reported that the deployment had failed. It now deploys it as the ROOT application and reports a successful deployment to the context path "/"
Fix auto-boxing warnings
Suppress unused code warnings
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55958 Differentiate between foo.war the directory and foo.war the file
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55960 Improve SSO unit tests Patch by Brian Burch
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55970 Ignore non-JAR resources in WEB-INF/lib when checking to see if a reloadable web application has updated JARs.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55974 Preserve the order of reported errors and warnings
Remove unnecessary casts.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55976 Fix sendfile support on NIO
add tests for setting v1 cookie values
Refactor to aid re-use
Add tests for setting null and duplicate read and write listeners for non-blocking IO.
Fix failures in newly added tests
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55978 Ensure that container makes first call on onWritePossible when using non-blocking IO with an HTTP upgraded connection
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55893 Split AccessLogValve and extract the formatting logic in an AbstractAccessLogValve to facilitate other implementations that output to destinations other than files. Patch provided by Cyrille Le Clerc
More graceful handling (a 403 rather than a 500 response) when file permissions allow Tomcat to know a resource exists but not to read it
pathInJar may be zero length so avoid out of bounds error
ResourceSets added via a context.xml file need a default internalPath
Ensure directory name is displayed as part of directory listings
Follow up to r1557113 - fix failure when running under a security manager
Refactor cookie parsing tests into individual test cases
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55743 Enable the stop script to work when the shutdown port is disabled and a PID file is defined.
https://issues.apache.org/bugzilla/show_bug.cgi?id=55986 Ensure that if Tomcat is stopped via "kill -9 <PID>" that the script doesn't falsely report that it is still running. Based on a patch by jess.
I've been working on DBCP2 so snapshot version needs to be updated.
Add new JAR
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55995 Fix NPE when using JspC and there are JARs containing TLDs on the classpath
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56003 tool-wrapper.[sh|bat] requires tomcat-util.jar on the class path
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55996 Ensure Async requests timeout correctly.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55855 Provide a context level option to exclude container SCIs.
Simplify configuration now that the SCI does not use the JarScanner for container JARs.
Correct Javadoc
Add support (with tests) for read-only web resource sets.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56010 Don't throw an IllegalArgumentException when JspFactory.getPageContext is used with JspWriter.DEFAULT_BUFFER Based on a patch by Eugene Chung. (markt)
- Add dedicated listener for framework and EE integration. - Fix context classloader with SSO session expiration.
- Add new methods to test class.
Trailing whitespace police
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56025 Always call ServerEndpointConfig.Configurator.getNegotiatedSubprotocol() CReate the EndPoint instance after calling ServerEndpointConfig.Configurator.modifyHandshake()
Fix IDE warnings - add @Override annotations
Remove setParentClassLoader() as it could result in odd behaviour if the class loader is constructed with one parent and then this method is called to change the parent. This class will have visibility of the new parent but any code inherited from the super class will still see the old parent.
Remove deprecated code
Fix indent
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55943 Better implementation of the class loader check that prevents web applications from trying to override J2SE implementation classes. Refactor the way a null parent class loader was handled which enables a number of null checks and object creation calls to be removed
Set svn:eol-style = native
Cosmetic cleanup - no functional change.
Refactor check for characters allowed in a Cookie name to use a BitSet rather than searching through a String.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56029 a regression in the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55198 Remove the code to skip whitespace from the 'simple'EL parser. It is far simpler to retain the whitespace than it is to teach this simple parser parser when to insert it. This also has the benefit that the EL should remain unchanged. A a number of test cases for BZ 56029
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56012 Imports from unnamed packages are now explicitly illegal
Remove unused code
Add the test case from bug 56031 as it suggested there may be further issues - there were not
Revert changes in r1559397 for this file. The first attempt at a fix introduced a different regression
Second attempt at fixing https://issues.apache.org/bugzilla/show_bug.cgi?id=56029 This fixes BZ56029 by storing any whitespace before a token with the token and then including it when the expression is re-created. It also fixes an issue with the function parsing that meant that ternary expressions could be corrupted if two tokens were parsed before the mark was reset.
Move JVM vendor detection to a global constant. Fix detection of Sun/Oracle JVM that only worked for older Sun branded JVMs.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56013 IBM JDK only understands indefinite lifetime
Fix typo
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56021 Make it possible to use the Windows-My keystore that requires keystoreFile="" to be set on the connector.
Reduce visibility
Remove unused code
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55956 Make the forwarded remote IP available on the Manager status page
Additional fix for bug 56029. Now whitespace is not skipped, make sure it is trimmed before the function name is used. Includes a test case based on a jspx file by kkolinko.
Fix for NPE introduced by r1559707 that caused ELParser test to fail.
Refactor cookie name validation into a helper class to prepare for enabling RFC6265. This should have no functional change.
Further work for https://issues.apache.org/bugzilla/show_bug.cgi?id=56029 Review from kkolinko - Fix bug in parsing functions and whitespace - More efficient resetting of StringBuidler - Use String.substring() for token and whitespace - avoid unnecessary use of trim()
Fix line endings
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56032 After an IO error sending a WebSocket message, close the connection.
Simplify bind and unbind on stop
Simplify bind and unbind on start
Remove unnecessary code
Fix order of magnitude error in the wait time
Writes don't timeout currently with BIO
Initial enum for ContainerEventType. Lots more event types to add.
Drop this idea for now
- Drop the code from SSO (I didn't know StandardSession.expire was already setting the context CL. - Add bind/unbind to StandardSession.expire instead (and only do it if the classloader actually changes). - See later if the bind/unbind code can be moved to StandardContext, but all uses seem slightly different.
Remove unused code
Use try with resoucres
Clean-up  - Container will always be a Context  - only need one call to Thread.currentThread().getContextClassLoader()  - Fix logic hole if loader.getClassLoader() returns null  - Formatting to make code easier to read
Code clean-up  - BackupManager is an instance of ClusterManagerBase  - StandardManager is an instance of ManagerBase
Add bind()/unbind() to Context
Migrate AsyncContext to use Context bind()/unbind()
Add new message
Migrate StandardHostValve to use Context bind/unbind
More migrations to Context bind()/unbind()
Migrate to Context bind()/unbind()
- Call onClose before actually closing anything (sending a close message closes the endpoint). - If onClose throws an exception, call onError. - After using a blocking send, clear the client buffer in case it gets reused (I have no idea why this is needed ...).
Revert: Call onClose before actually closing anything (sending a close message closes the endpoint).
No need to load classes that have been deleted.
Remove unused code
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56039 Enable JmxRemoteLifecycleListener to work with SSL. Patch by esengstrom.
Fix some arcane introspection errors.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56042 If a request in async mode has an error but has already been dispatched don't generate an error page in the ErrorReportValve so the dispatch target can handle it.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56044 Separate out the EL and WebSocket implementations into separate JARs for embedded.
Replace mailing lists links so that they point to the Mailng List page on the site, so that people have a chance to read instructions there
Need to publish new JARs
Include javax.annotation.sql.* classes in annotations-api.jar
Add missing jsp XSDs
Re-use servlet-api notice and license for embed-core since it is the same
Add missing jsp XSDs
Remove pointless @author tags
How did this creep in?
Remove another generic author tag
Remove / clean-up pointless javadoc
Remove my remaining author tags. 
Remove svn keywords from test/**
Remove svn:keywords property from test/**  svn propdel svn:keywords --depth infinity
Remove $Id keyword from webapps/**
Remove svn:keywords property from webapps/**  svn propdel svn:keywords --depth infinity
Remove $Id keyword from res/**
Remove svn:keywords property from res/**  svn propdel svn:keywords --depth infinity
Remove $Id keyword from bin/**
Remove svn:keywords property from bin/**  svn propdel svn:keywords --depth infinity
Remove $Id keyword from conf/**
Remove svn:keywords property from conf/**  svn propdel svn:keywords --depth infinity
Tim confirmed it was OK to remove his @author tags
Jean-Francois confirmed it was OK to remove his @author tags
Filip confirmed it was OK to remove his @author tags
Remove svn:mime-type property from *.dtd files. The value was application/xml-dtd.  A mime-type is not needed on these source files, and it is inconvenient: application/* mime types make SVN to treat the files as binary ones.
A few more of Filip's author tags
Remove $Id keyword from java files in java/javax/**
Clean-up Javadoc after removing author tags
Clean-up more Javadoc after removing author tags
Remove $Id keyword from java files in java/javax/**
Remove SVN $Id keyword and similar constructs for other source code management systems from XML Schema and DTD files.
Remove $Version$ keyword from java files in java/javax/**  It was not expanded, because none of these files have it set in their svn:keywords property.
Remove svn:keywords property from java/javax/**  svn propdel svn:keywords --depth infinity
Remove $Id keyword from java files in catalina/*
Remove $Id keyword from java files in catalina/ant/**
Remove $Id keyword from files in catalina/ha/** 
Remove $Id keyword from files in catalina/tribes/**
Remove $Id keyword from files in catalina/core/**
Remove $Id keyword from files in catalina/startup/**
Remove $Id keyword from files in catalina/realm/**
Remove $Id keyword from files in catalina/ssi/**
Remove $Id keyword from files in catalina/**
Remove $Revision keyword from files in catalina/**
Remove svn:keywords property from catalina/ha/**  svn propdel svn:keywords --depth infinity
Remove svn:keywords property from catalina/tribes/**  svn propdel svn:keywords --depth infinity
Remove svn:keywords property from catalina/(ant|authenticator|comet|connector)/**  svn propdel svn:keywords --depth infinity
Remove svn:keywords property from catalina/(core|deploy|filters|loader|manager)/**  svn propdel svn:keywords --depth infinity
Remove svn:keywords property from catalina/(mapper|mbeans|realm|security|servlets|session)/**  svn propdel svn:keywords --depth infinity
Remove svn:keywords property from catalina/(ssi|startup|users)/**  svn propdel svn:keywords --depth infinity
Remove svn:keywords property from catalina/** With this all of catalina/** has been processed.  svn propdel svn:keywords --depth infinity 
Remove svn:keywords property from coyote/** With this all of coyote/** has been processed. (None of the files here contained any keywords).  svn propdel svn:keywords --depth infinity 
Remove $Id keyword from files in org/apache/el/**
Remove svn:keywords property from org/apache/el/** With this all of el/** has been processed.  svn propdel svn:keywords --depth infinity  
Remove $Id keyword from files in jasper/**
Remove $Revision keyword from files in jasper/**
Remove svn:keywords property from jasper/** With this all of jasper/** has been processed.  svn propdel svn:keywords --depth infinity  
Remove $Id keyword from files in juli/**
Remove svn:keywords property from juli/** With this all of juli/** have been processed.  svn propdel svn:keywords --depth infinity  
Remove $Id keyword from files in naming/**
Remove svn:keywords property from naming/** With this all of naming/** have been processed.  svn propdel svn:keywords --depth infinity  
Remove $Id keyword from files in tomcat/jni/**
Remove svn:keywords property from tomcat/jni/**  svn propdel svn:keywords --depth infinity  
Remove $Id keyword from files in tomcat/util/bcel/**
Remove svn:keywords property from tomcat/util/bcel/**  svn propdel svn:keywords --depth infinity  
Remove $Id keyword from files in tomcat/util/codec/**
Remove svn:keywords property from tomcat/util/codec/**  svn propdel svn:keywords --depth infinity  
Remove $Id keyword from files in tomcat/util/descriptor/**
Remove svn:keywords property from tomcat/util/(buf|collections|descriptor)/**  svn propdel svn:keywords --depth infinity  
Remove $Id keyword from files in tomcat/util/file/**
Remove svn:keywords property from tomcat/util/(digester|file)/**  svn propdel svn:keywords --depth infinity  
Remove $Id keyword from files in tomcat/util/http/fileupload/**
Remove svn:keywords property from tomcat/util/http/fileupload/**  svn propdel svn:keywords --depth infinity  
Remove $Id keyword from files in tomcat/util/modeler/**
Remove svn:keywords property from tomcat/util/modeler/**  svn propdel svn:keywords --depth infinity  
Remove $Id keyword from all remaining files in tomcat/util/**
Remove svn:keywords property from the rest of files in tomcat/util/**  svn propdel svn:keywords --depth infinity  
Remove $Id keyword from all remaining files in tomcat/**
Remove svn:keywords property from the rest of files in tomcat/** With this all of java/** have been processed.  svn propdel svn:keywords --depth infinity  
Remove svn:keywords property from modules/bayeux/** With this all of modules/bayeux/** has been processed. (None of the files here contained any keywords).  svn propdel svn:keywords --depth infinity
Remove $Id keyword from files in modules/jdbc-pool/**
Remove svn:keywords property from modules/jdbc-pool/** With this all of modules/jdbc-pool/** have been processed.  svn propdel svn:keywords --depth infinity
Remove svn:keywords property from modules/tomcat-lite/** With this all of modules/tomcat-lite/** have been processed. (None of the files here contained any keywords).  svn propdel svn:keywords --depth infinity
Remove $Id keyword from files in /*
Remove svn:keywords property from the rest of files in Tomcat 8. Remove svn:keywords property from modules/tomcat-lite/** With this all of Tomcat 8 files have been processed.  svn propdel svn:keywords --depth infinity
Correct Javadoc
Remove my @Author Tags
Remove my @Author Tags
add .idea project directory to git ignores
The type of logger attribute of Context MBean should be not org.apache.commons.logging.Log but org.apache.juli.logging.Log. 
Add a TODO to remind me to come back and look at this
Followup to r1561083 Remove svn:mime-type property from *.dtd files. The value was application/xml-dtd.  A mime-type is not needed on these source files, and it is inconvenient: application/* mime types make SVN to treat the files as binary ones.
Correct typo in definition of default value for contentType attribute of jsp:directive.page element in jspxml Schema and DTD.
Fix two more errors in jspxml.dtd, found by validating the file in Eclipse IDE. 1. Complained for missing '(' in definition of jsp:text. 2. Element jsp:fallback (mentioned in jsp:plugin) was not defined.
Fix bug handling the Sec-WebSocket-Protocol header returned to the client
Correct tag nesting
Update snapshot version
Revert accidental commit
More info if test fails in access log valve check. 
Fix regression in fix for BZ55996
8.0.0 will not be released
Prep for next release
Saw a failure on Windows. Switch to our standard pattern for waiting that allows the possibility of a long wait but will finish sooner if it can rather than using a fixed wait.
Make the xmlBlockExternal option in Catalina and Jasper to be true by default.
Prep for next release
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56085 ServletContext.getRealPath(String) should return null for invalid input rather than throwing an IllegalArgumentException
Simplify the code of o.a.c.ha.tcp.SimpleTcpCluster.createManager(String). Remove unnecessary class cast.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56082 Fix thread safety issue in JULI's LogManager implementation
Fix formatting
Add missing entry
Enable non-blocking reads to take place on non-container threads.
Update to latest DBCP snapshot
Upgraded Eclipse to Kepler. Fix resulting IDE warnings
Keep up with DBCP2
Need to update site and announce but this is when files were copied to mirrors etc.
Consistent text in rtext
Update
Fix WebDAV
Fix typo.
Simplify. File.isDirectory() already checks for existence.
Keep up with DBCP2
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56104 Correct the version number for the installer
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56096 When creating JMXConnectorServer use the correct rmiBindAddress. Patch provided by Jim Talbut.
Fix javadoc markup (reviewing r1561778, r1561773). Do not include unrelated text into the value of @version, @param.
Javadoc: fix typo and unclosed <b> tag
Move class Javadoc to the correct place
Update the changelog.
According to JavaEE specification (EE.5.4.1.3) when an env entry is specified in the web deployment descriptor and with annotation then the definition in the web deployment descriptor is with priority.
Whitespace police
Keep a note of Commons DBCP updates
Pickup yesterdays DBCP changes
Followup to r1562597 Align return value in stub class with the default one in StandardContext
Followup to r1562597 xmlBlockExternal is now true by default. It is the false value that now needs to be passed explicitly.
Fix CVE-2014-0050 DoS with malformed Content-Type header and multipart request processing. Update to latest code (r1565159) from Commons FileUpload
Followup to r1565163 Catch exceptions thrown by getParts() and report them as other upload errors  (in the message box on the HTML page).  Without this an uncaught exception resulted in Error 500.  I am removing warPart cleanup code, because Tomcat already does such cleanup when Request is recycled (Tomcat code deletes all parts in a request, and part.delete() could throw an IOException).
Simplify code. There is no need to iterate over parts and cleanup them, Tomcat takes care of that in Request.recycle().
Update Commons DBCP snapshot
Changelog entry for r1565300, r1565416.
Correct typo in message printed by validateAccessLog() when a testcase runs too long.
Fix build of DBCP2. The project structure has changed and the classes are now in src/main, like in Pool2.  This issue was reported in the VOTE thread for 8.0.2.
Add a check to the build to catch problems copying the DBCP resources
Tab police
Prep for next release
Properties file move locations as well.
Update DBCP build to pick up version with SecurityManager improvements
Fix a secondary issue identified in https://issues.apache.org/bugzilla/show_bug.cgi?id=56079
Remove mentioning of TC 6 from docs. Remove doClusterLog and clusterLogName description from cluster docs, those no longer exist. 
Cast is no longer necessary with DBCP 2
Restore the ability to use addURL()
Whitespace police
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56125 Correctly construct the URL for a resource that represents the root of a JAR file.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56115 Expose the httpusecaches property of Ant's get task as some users may need to change the default. Based on a suggestion by Anthony. 
Working off a Commons Pool release again.
Followup to r1566695 Correct typo
Prep for next release
Generate a valid root element for all possible versions of web.xml
Update
Keep pace with DBCP 2
Fix checkstyle failure of trailing whitespace. Add changelog entry for r1567306
Correct typo in test method names
Followup to r1567148 Expand validation tests for merged web.xml: add default conf/web.xml into the merged one.
Assert that version of merged web.xml is as expected.
Assert that version number of written and re-parsed web.xml is as expected.
In some circumstances asynchronous requests could time out too soon.
Add 8.0.3 release date
Tweak error message to show actual file name
Remove use of optimize flag that has been a NO-OP since Java 1.1 Patch by ebourg via GitHub
Pick up latest JMX changes in DBCP. Individual connections are now registered for JMX.
Log close code and reason when the Websocket connection is closed.
Keep pace with DBCP 2
Followup to r1567717 Remove several other uses of compile.optimize property, the optimize flag is noop for current versions of javac (as Ant manual says).  Provide explicit default for compile.deprecation property. It controls whether -deprecation flag (a synonym for -Xlint:deprecation) is passed to javac. No functional change here, as String->boolean conversion in Ant treats any value except of "on", "true", "yes" as false (Project.toBoolean()).
Followup to r1567717 Remove several other uses of compile.optimize property. The optimize flag is noop for current versions of javac (as Ant manual says).
Pick up DBCP 2 updates - performance improvement for validation queries - fix a threading bug under very heavy load
Simplify Windows *.bat files: remove %OS% checks, as current java does not run on ancient non-NT operating systems.
https://issues.apache.org/bugzilla/show_bug.cgi?id=56143 Allow service.bat to be launched from a non-UAC console, by using arguments instead of env variables to pass options to prunsrv.  + Fix regression in r1567742 that values for --StdOutput, --StdError were lost. + Pass --LogPath option to service removal command, to avoid using default value for this option
Avoid using the same path for "tomcat-juli.jar" twice  when CATALINA_HOME and CATALINA_BASE are the same.
Fixing https://issues.apache.org/bugzilla/show_bug.cgi?id=56143 Update documentation and changelog.
Avoid possible deadlock when one thread tries to close a connection while another thread tries to write to it.
Align Commons Daemon options between service.bat and exe installer  service.bat changes: --DisplayName --StartPath, --StopPath (They should be unnecessary in --StartMode jvm, but exe installed sets them and they are visible and settable in configuration dialog) --JvmOptions: Just reordered, non significant --Classpath change mentioned in changelog was in r1568780  exe installer changes: --JvmMs, --JvmMx  --LogPath fix from r1568779 was applied to exe installer as well.
Correct typo (s/priviledges/privileges), wrap lines
Add SSL Valve to docs
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56137 Explicitly use NIO connector in SSL example in server.xml so it doesn't break if APR is enabled.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56139 Avoid a web application class loader leak in some unit tests when running on Windows.
Make it easier for TomEE to modify the j2seClassLoader
s/j2se/javase/
Update
Update tests to check correct handling of all elements added between 2.2 and 2.3.
Update tests to check correct handling of all attributes added between 2.2 and 2.3.
Update tests to check correct handling of all top-level elements added between 2.3 and 2.4.
Update tests to check correct handling of all other elements added between 2.3 and 2.4.
Update tests to check correct handling elements added between 2.5 and 3.0.
Update tests to check correct handling elements added between 3.0 and 3.1 Add missing deny-uncovered-http-methods element from merged web.xml
Update changelog
Simplify patternsets where possible Avoid pattern sets ending in "/*" as much as possible as they usually result in JARs containing empty packages with the contents of the package in a different JAR
Follow up to r1570114 Need to include *.properties as well as *.class
Simplify
Tomcat 8 requires Java 7 so make that the default compiler source and target versions for JSP compilation.
Add a test case that demonstrates Bug 56147 is not reproducible.
Whoops. Forgot to make sure the test actually passed.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56172 Avoid possible request corruption when using the AJP NIO connector and a request is sent using more than one AJP message. Patch provided by Amund Elstad.
Allow to limit JUnit test run to a number of selected test case methods.   BUILDING.txt says that Ant 1.8.x is needed. If we require a later version of Ant, e.g. 1.9.3 due to javadoc task security fixes, then Ant 1.8.2 comment in BUILDING.txt can be removed.
Update to latest snapshot
Alternative fix to the empty dir in JAR file issue
Changelog entry for r1570601
Fix typos
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56179 Supporting lambda expressions requires additional lookaheads to ensure the correct grammar is used.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56179 Re-generate parser Add some test cases
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56177 Handle dependency tracking for TLDs when using JspC with a tag library JAR that is located outside of the web application.
Update Commons Pool 2 to 2.2.
Followup to r1570629 Simplify include patterns in <patternset id="files.tomcat-util">.
Another DBCP 2 update. This is the last functional update expected before the DBCP 2.0 release. There may be a few more interim updates as things are cleaned up in preparation for the DBCP 2.0 release.
Test for https://issues.apache.org/bugzilla/show_bug.cgi?id=56185
Keep pace with DBCP2 changes (just various bits of clean-up)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56189 Remove unused file.
Correct a pair of comment typos
Followup to r1570175 Update compilerSourceVM and compilerTargetVM values in jasper-howto.xml as well.
Avoid internal NullPointerExceptions if a resource is requested from outside the web application root.
DBCP update
Revert r1573321 as it triggers unit test failures
Drop the use of filesonly - it caused failures with some applications that scan Tomcat JARs such as Jira.
Alternative solution to avoiding adding empty packages to JARs.
Avoid NPE in resource cache when making an invalid request for a resource outside of the web application.
Better way to avoid NPE in resource cache - don't let the request get that far when we know we are going to fail it anyway.
DBCP 2.0 has been released.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56010 Documentation part of the fix  The constants mentioned in JspFactory.getPageContext(..) belong to JspWriter. There are no such constants in PageContext. Javadoc in JavaEE 7 (as referenced in bug 56010) has been updated.
Note DBCP update to a release version.
Avoid possible NPE (it really needs to throw a rejected execution instead anyway).
Fix wrong booleans (which shouldn't change anything in practice, but the code is wrong).
Avoid possible NPE.
Handle the maxActive -> maxTotal rename
Use the log fallback to log access anyway when something unexpected occurs. Do the same at the end of event to avoid the possibility of skipping recycling.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56217 Left align makes more sense entries might be very long
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56204 Clean-up
FindBugs: Avoid NPE when flushing batched WebSocket messages.
Findbugs: Remove pointless null check. Refactor.
FindBugs: Remove unnecessary null check
Add FindBugs fixes to change log
Update false positives
When reporting threads that are still running while web application is being stopped, print their stack traces to the log.  Minor fixes: Remember result of Thread.getName() as that method is not trivial. Strip trailing whitespaces from changelog.
Align documentation of DBCP examples to match changes from DBCP 1 -> DBCP 2. Specifically, change "maxActive" -> "maxTotal" and "maxWait" -> "maxWaitMillis" in all examples.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56199 Restore validateXml option to JspC
Better fix for BZ56199 Fix failing unit tests caused by original fix.
Follow up to r1574785 - Ensure blockExternal init param is set - Remove unused constant
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56190 AsyncContext.complete() should close the response. dispatch() should be used if further output to the response is required.
Update changelog
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56223 Throw an IllegalStateException if a call is made to ServletContext.setInitParameter() after the ServletContext has been initialized
Fix broken test, uncovered by the fix for BZ 56223.
Improve the robustness of web application undeployment based on some code analysis triggered by the report for BZ 54315
Javadoc typo.
Add isBlocking util method, like in AbstractOutputBuffer.
Add harmonized util methods for the five listener events.
Add more comments to explain the locks. Reduce scope of the writeLock in onWritePossible
Add experimental NIO2 connector. Based on code developed by Nabil Benothman.
Followup to r1575885 Do not hold writeLock when calling onError().
Followup to r1575905: svn:eol-style=native for new files
Checkstyle: 1. Trailing whitespace 2. Unused import
Checkstyle: tab character
Fix NIO2 mbean names tested by the registration test, it would otherwise use the NIO1 names.
Fix AJP NIO2 protocol selection.
Fix reported boxing warnings.
Fix a couple of Javadoc nags
Add code to do a clean close of all current connections.
Stop using writeTimeout for now (I don't see the point at the moment).
Try to see the testsuite state ...
CheckStyle: fix order of imports
- Closing is not an async operation, but needs to be performed, so ignore errors if some pending things are going on with SSL. - Also fix some warnings.
Entropy attribute for Manager gone since TC 7. 
Fixed java.lang.NegativeArraySizeException when execute the command of Expire sessions of manager web application to context in which the session timeout is disabled.
Use the behavior of the NIO connector if there is a pending write when attempting a SSL close (= throw an IOE and expect a real close).
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56244 Fix MBeans descriptor for WebappClassLoader MBean: The jarPath property on WebappClassLoader has been removed in Tomcat 8.
Rephrase changelog message
Document the "execute.test.nio2" option.
Correct a typo
Add a work-around for XML documents (often TLDs) that only refer to J2EE schemas by file name
Increase the write timeout (5s -> 10s) to see how the test reacts (or if it's a deadlock somewhere), I see some significant spikes in my own testing if I put some load on my computer.
- Fix SSL output with blocking writes when a handshake occurs during the flow. - Fix relevant test as pointed out by Konstantin.
- Harmonize with the NIO1 connector for upgrade close. - Actually understand where the (cosmetic) async close traces were coming from.
Revert timeout change (no effect).
Add support for LAST_ACCESS_AT_START system property to Manager web application.
Add methods of get the idle time from last client access time to org.apache.catalina.Session. 
Fix whitespace.
Add some progress info to the websockets frame test.
Clean-up. No functional change.
Fix an Eclipse nag now the received message is used.
Switch to a semaphore here (for the flush, since the previous one would have issues if run after non blocking writes).
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56246 Fix NullPointerException in MemoryRealm when authenticating an unknown user.
Use a regular processSocket to cleanup after an error, so that the connection is removed, etc.
Add non SSL version of the frame test.
Correct comment
Better Javadoc
The test now uses too much memory for the test server, so split it SSL / non SSL.
Remove unused imports
Set eol prop.
Reduce calls to getManager(). (That is not a simple getter, but it performs some locking).
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56253 When listing resources that are provided by a JAR, fix possible StringIndexOutOfBoundsExceptions. Add some unit tests for this and similar scenarios and fix the additional issues those unit tests identified. Based on a patch by Larry Isaacs. 
Disable SSL websocket "firehose" test for now on NIO2, since a legitimate explanation for the failure has been found.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56248 Allow the deployer to update an existing WAR file without undeploying the existing application if the update flag is set. This allows any existing custom context.xml for the application to be retained. To update an application and remove any existing context.xml simply undeploy the old version of the application before deploying the new version.
Correct some errors in r1577182
Clean-up / consistency
Whitespace police
Enable Tomcat to work in a OSGI environment with alternative Servlet and JSP API JARs.
Simplify
With the writeLock in use in the superclass, remove the useless extra locking (after testing).
Review by kkolinko Avoid adding nulls to the map Log a warning for problems in addSelf() as well as add()
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56236 Add issue number
Fix trailing whitespace. Sorry for the noise.
Start harmonizing exception types (todo: same thing for completion handlers).
Add a couple more tests based on a report on the users list (There tests pass, the problem looks to be elsewhere)
Experiment some more with this test and NIO2 (sorry for the noise).
Better reporting for skipped tests. With org.junit.Assume the tests are clearly reported as 'skipped' in JUnit test run summary.
Improve the FutureWrite logic so that writing starts when creating it, and then will recurse on get until the content is actually written.
Better reporting for skipped tests. With org.junit.Assume the tests are clearly reported as 'skipped' in JUnit test run summary.
Better reporting for skipped tests. With org.junit.Assume the tests are clearly reported as 'skipped' in JUnit test run summary.
Add missing code to retry if no bytes are written (handshake) like for blocking IO, and use EOFException instead.
Correct typo in the message
Make sure the byte buffer passed as a parameter is used in all read/write operations (come code is from the NIO1 which forces using the main read/write buffers).
1. Do not hardcode the path to output directory. It can be controlled via build.properties. 2. Cleanup after the test.
Properly delete %TEMP%/ser{number}.tmp temporary file that was used to test serialization of a Principal.  On Windows the test could not delete the file, because FileInputStream has not been properly closed after reading. Thus rerunning the testsuite left a bunch of such files in the %TEMP% directory.  The file is now created in output/tmp instead of the system temporary directory.
Implement the read/write pending contract in the SSL channel (not doing so would likely still trigger the exception, but would add corruption).
- Cleanup and prefer non direct buffers for SSL by default (32KB of direct buffers per connection looks a bit too much). - Give up on the SSL test for now.
Better reporting for skipped tests. With org.junit.Assume the tests are clearly reported as 'skipped' in JUnit test run summary.
Followup to r1576628: correct typo in a message
Followup to r1577831 Clarify the new socket.directSslBuffer option.
Clean an IDE warning about unthrown exception. Since r1577757 the setSSLEngine() method is a pure setter, it no longer calls reset() and no longer throws an IOException.  (An alternative way to silence such warnings is to document the exception in Javadoc for the method).
Better reporting for skipped tests. With org.junit.Assume the tests are clearly reported as 'skipped' in JUnit test run summary.
Add definition of org.apache.catalina.ant.FindLeaksTask.
Implement org.apache.catalina.ant.VminfoTask, org.apache.catalina.ant.ThreaddumpTask and org.apache.catalina.ant.SslConnectorCiphersTask.
Add the option to ignore the constraint of the first line of the response message that must be "OK -". Default is false.
Review from kkolinko The filename of a tagged war file should be  versioned + tag + baseName.war.  The "tag" part was lost.
Make upload process more robust. If upload fails and it was going to update an existing WAR, don't remove the existing WAR.
Improve processing of chuck size from chunked headers. Avoid overflow and use a bit shift instead of a multiplication as it is marginally faster. This is the fix for CVE-2014-0075 
Correct regression introduced in 8.0.0-RC2 as part of the Servlet 3.1 non-blocking IO support that broke handling of requests with an explicit content length of zero. This is the fix for CVE-2014-0095 
Whitespace police
Redefine globalXsltFile as relative to CATALINA_BASE/conf or CATALINA_HOME/conf This is part 1 of 2 of the fix for CVE-2014-0096 
Prevent user supplied XSLTs from defining external entities This is part 2 of 2 of the fix for CVE-2014-0096 
Update changelog
Corrected link to Tomcat 8.0 documentation. Issue is reported via comments at apache.org
Fix possible overflow when parsing long values from a byte array. This is the fix for CVE-2014-0099 
Fix properties
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56268 Specify the default value of the ${build} in the build section.
Followup to r1578260 Amend javadoc for the new option. Move Ant task changes from "Web applications" to "Other" section of changelog.
Make default Java version for JSPs Java 7
Update JDT to P20140317-1600 to add Java 8 support and enable "1.8" as a valid option for source and target JVM versions for JSPs.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56265 Do not escape values of dynamic tag attributes containing EL expressions Patch by kkolinko
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56283 Add issue number for r1579174
whitespace police
Prep for next release
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54475 Add Java 8 support to SMAP generation for JSPs. Patch by Robbie Gibson.
Handle possible status line i18n in tests.
- Reliably allow blocking following non blocking if some flushing is needed on end. - Use debug log level in case of a rejected execution, which can occur on shutdown.
Add missing clear after writing the buffers (in practice this shouldn't be needed though). If an exception occurs the response will be recycled so no need for a finally.
Fix time in test (oops).
Improve test so that it cannot hang forever (it will check it gets an exception and completed, instead).
- Actually follow the instructions on proper NIO2 shutdown. Much cleaner indeed. - The downside is that the executor is exclusive to the thread group (no way around this), so it cannot be shared with other connectors. - Add a warning if using a shared executor.
Improve trigger of the onWritePossible notification.
Forgot to check the return value for blocking writes as all other places do, oops (some platforms could be returning a negative value after a disconnect rather than throw an exception).
Remove unused code.
Remove more unused code. Reduce visibility of static fields
Rework the fix for 56190 as the previous fix did not recycle the request in all cases leading to mis-routing of requests. 
Fix changelog
Make exception handling more robust - review by remm.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56273 If the Manager web application does not perform an operation because the web application is already being serviced, report an error rather than reporting success.
Add the bug reference.
Allow web applications to package tomcat-jdbc.jar and their JDBC driver of choice in the web application.
Minor clean-up
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56293 Cache resources loaded by the class loader from /META-INF/services/ for better performance for repeated look ups.
Fix typos spotted by Cyril Bont.
Fix bug in example
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56304 WebSocket + BIO HTTP + Production = bad idea
Whitespace police
Review after unexpected failed test on OSX - completed needs to be volatile - prevent infinite loop
Another unit test run failure on OSX and a more careful review. Handle the case where timeout completes request before the Runnable's error handling does.
Prep for next release.
8.0.4 didn't make it
Specify that Apache Ant version 1.8.2 or later is required for building Tomcat.
Fix extension validation for the new resources implementation
Refactor - remove unnecessary null check - use try-with-resources
Fix Java 8 compatibility (order of elements is reversed, which does not seem wrong, it is probably undefined).
Locks should be outside try/catch/finally block.
Try with resources for javax.*
try with resources
Lock outside try/catch/finally
Lock ouside try/catch/finally
Lock outside try/catch/finally
Try with resources
try with resources
try with resources
Update progress
Another package
Review changes
Code review - lock outside try/catch/finally
Code review - use multicatch to reduce code duplication - use Util.handleThrowable() to reduce code duplication
Update with progress
- Remove useless IOE on flush. - Remove nearly all extra fields from the socket wrapper.
More try-with-resources
More try-with-resources
Fix Javadoc
More try-with-resources
More try-with-resources
Locks should be outside try/finally
Locks should be outside try/finally
More try-with-resources
Locks should be outside try/finally
Locks should be outside try/finally
More try-with-resources
More try-with-resources
Fix custom UTF-8 decoder so that a byte of value 0xC1 is always rejected immediately as it is never valid in a UTF-8 byte sequence. Update UTF-8 decoder tests to account for UTF-8 decoding improvements in Java 8. The custom UTF-8 decoder is still required due to bugs in the UTF-8 decoder provided by Java. Java 8's decoder is better than Java 7's but it is still buggy.
Complete first pass of try-with-resources
Update changelog for try-with-resources
Add Support for copyXML attribute of Host to Host Manager.
Ensure that "name" request parameter is used as a application base of host if "webapps" request parameter is not set when adding host in HostManager Application.
Whitespace police
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56320 Fix fd leak when sendfile is used
Clean-up. No functional change.
Restore optimisation removed in r1549711 Refactor so InputStream is never opened if sendfile is used Add lots of comments
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56321 hen a WAR is modified, undeploy the web application before deleting any expanded directory as the undeploy process may refer to classes that need to be loaded from the expanded directory. If the expanded directory is deleted first, any attempt to load a new class during undeploy will fail.
Add release date
Remove the implementation of org.apache.catalina.LifecycleListener from org.apache.catalina.ha.tcp.SimpleTcpCluster. SimpleTcpCluster does not work as LifecycleListener, it works as nested components of Host or Engine.
Cleanup waiting async connections on shutdown, to avoid any abrupt close if everything is well behaved.
56336: Fix apparent AJP output issue [untested and unverified, no test case].
Remove useless methods.
- Handle incomplete writes as it is very easy to do, just in case (it never happens for me though). - Try again that SSL test.
Still failed.
Remove cluster and replicationValve from cluster manager template. These instance are not necessary to template.
Add support for cross context session replication to BackupManager.
Remove the unnecessary cross context check.  It does not matter whether the context that is referenced by other context is set to crossContext=true.  The context that refers to the different context must be set to crossContext=true.
Move to org.apache.catalina.ha.session.ClusterManagerBase common logics of org.apache.catalina.ha.session.BackupManager and org.apache.catalina.ha.session.DeltaManager.
Revert changes from r1581820 as it triggers an IOE
ois is closed in finally block - no need to close it in catch blocks as well.
Simplify the code of o.a.c.ha.tcp.SimpleTcpCluster. In order to add or remove cluster valve to Container, use pipeline instead of IntrospectionUtils.
Set null rather than this.
changelog for r1584507.
Code cleanups and i18n in NIO2.
Port i18n to the NIO1 connector, for consistency.
Fix trigger of the read event (so registerForEvent is actually useful).
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56339 Avoid an infinite loop if an application calls session.invalidate() from the session destroyed event for that session.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56343 Avoid NPE if WebSocket API JAR from RI is used.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56327 Enable AJP as well as HTTP connectors to be created via JMX. Patch by kiran.
Fix the logic (although it shouldn't actually cause any issue).
Minor cleanups, improve logic (less returns) and possibly fix a scenario where failed could be called twice in SSL.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56365 Simplify file name matching code in StandardJarScanFilter.
Correct a typo
Fix Javadoc warning
- Add possibly missing notification. - Try again the SSL websocket test, will revert the commit if not fixed.
Does not fix the testsuite run, so revert.
Ensure that the static resource cache is able to detect when a cache entry is invalidated by being overridden by a new resource in a different WebResourceSet
Replace double space with single one.
Correct windows-service-howto.xml according to Apache Commons Daemon procrun documentation. E.g. the default value for LogPath option was documented incorrectly.
- Possible SSL NIO2 fixes for gather (if there are more than two buffers, which doesn't really happen) and incomplete netOutBuffer writes (which also shouldn't happen). - Try again the SSL test, just in case.
Since nobody apparently objects, and with the testsuite passing 100% very reliably, upgrade NIO2 to beta.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56334 Correct double backslash escaping in attributes
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56369 Ensure that removing an MBean notification listener reverts all the operations performed when adding an MBean notification listener. 
svn:eol-style = native
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55483#c4 Return exact match as soon as it is found. Note without the change the same method is returned it just takes a little longer
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56405 Restore directory listings
Align with 7.0.x
Remove debug code
Correct message displayed by service.bat for an invalid command.
Improve a bit the changelog.
Followup to r1586897 : Apply the same not-null optimization to removeAttributeChangeNotificationListener method.
Align DisplayName of Tomcat service installed by service.bat with one installed by the *.exe installer: Use "X.0" version number in both instead of "X".
Print a warning in case if neither server nor client jvm is found by service.bat. Fix comments (addresses sebb's note in "Re: r1000718").
Updated required version of tcnative to 1.1.30. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56027 Add more nuanced support for entering/requiring FIPS mode when using APR connector. 
Fixed documentation, added changelog. 
Remove duplicated lines
Further fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56334
Add i18n error messages
Fix test failures
Better debugging. Makes it clear if one listener or all listeners failed.
Improve implementation of Lifecycle for WebappClassLoader. State is now correctly reported rather than always reporting as NEW.
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56390 Fixes locking of JARs that do not contain TLDs.
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56390 Fixes the locking of a JAR file when obtaining last modified time of a TLD within the JAR
Update changelog
Fix an Eclipse nag Correct signature of SSL.fipsModeGet(), as native code is implemented as throwing an Exception in this method.
Whitespace police
Small optimisation. The resolver and the factory are only used when running under a security manager so only load them in this case. Also avoid a possible memory leak when creating these objects. This is part 1 of 7 of the fix for CVE-2014-0119
Ensure <th> elements have the same text-align property on every browser.
Update changelog
Modify generic exception handling so that StackOverflowError is not treated as a fatal error and can handled and/or logged as required.
Avoid StackOverflowError on non-Windows systems if a file named '\' is encountered when scanning for TLDs.
- The input buffer is the place where there was code duplication between the two NIO connectors. Resolve that, there should now be no meaningful code duplication elsewhere. - Note that the NIO2 code is the one shared (some additional "1" state for the parsing state - should be transparent for NIO - and use flush(boolean) in the shared code). - Testsuite for NIO and NIO 2 looks ok.
Followup to r1588299: svn:eol-style=native
Simplify code (apparently unused parameters and methods).
Update Javadoc, as addValve/removeValve methods belong to Pipeline.  The addValve() method is still here (to be called by digester), but ContainerBase.removeValve() has been removed in Tomcat 7.  This staleness in Javadoc has been noted on the users mailing list.
Allow some method override since it is a bit too convoluted with NIO2.
Minor flush tweaks.
When not inline, do not use a new thread since the completion handler is already run in a new thread.
Increase the default maximum size of the executor used for async writes
WebSocket has own section in changelog.
Refactor server container shutdown into the destroy method Destroy the thread group on shutdown Log a warning if the thread group can't be destroyed
Ensure that threads created to support WebSocket clients are stopped when those clients no longer need them. Note that while this happens automatically for WebSocket client calls made by web applications, stand-along clients must call the Tomcat specific method WsWebSocketContainer.destroy().
Update changelog
Whitespace police
Reviewing r1589103 s/J2EE/JavaEE/ in a message
Correct a typo Add changelog entry for Tomcat Native upgrade
Tomcat 8 uses Java 7 where RFC 5746 is supported in all versions so remove unused/unnecessary code.
Restore accidently commented out code
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56391 Re-write renegotiation test to test that renegotiation works rather than to test that an exception is not triggered it it is attempted.
Windows OK. Seeing failures on Linux - add debug code.
Additional information for debugging the test: log on which iteration it failed.  (It is possible to chain AssertionErrors, but JUnit does not print stack trace for the nested AE. Thus I am resorting to writing them to the log).
Do 10 requests even if the listener is complete, to check if everything is still fine after the handshake.
Disable SSL renegotiation test for NIO
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56348 Fix slow async reads on non-container thread. Align code with APR. Ensure that selector is woken up when a socket is registered for a new event
Add session ID to the exception message to aid debugging.
Whitespace police
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56449 When creating a new session, add the message handlers to the session before calling Endpoint.onOpen() so the message handlers are in place should the onOpen() method trigger the sending of any messages.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56430 Extend checks for suspicious URL patterns to include patterns of the form <code>*.a.b</code> which are not valid patterns for extension mappings.
Align the AJP and HTTP connector implementations with the documented behaviour and use JVM defaults for socket linger.
Fixed broken links to java.sun.com. Issue reported via comments.apache.org
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56382 Add information about finished deployment and its execution time to the logs. Patch provided by Danila Galimov.
With the linger change, I am now getting async close exceptions on the accept on shutdown. Ignore exceptions when not running and cleanup.
Revert 1589666. Default linger setting is required.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56416 Document correct default for socket linger.
Minor optimisation
Fix text
Refactoring to reduce code duplication.
Add some defensive coding around some XML activities that are triggered by web applications and are therefore at potential risk of a memory leak. This is part 2 of 7 of the fix for CVE-2014-0119 
More refactoring to reduce code duplication.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56383 Properties for disabling server information and error report are added to the o.a.catalina.valves.ErrorReportValve. Based on the patch provided by Nick Bunn.
More defensive coding around some XML activities that are triggered by web applications and are therefore at potential risk of a memory leak. This is part 3 of 7 of the fix for CVE-2014-0119 
Fix indents and copy/paste errors This is part 4 of 7 of the fix for CVE-2014-0119
Parser uses lazy init so move creation of parser inside the block that uses the container class loader. This is part 5 of 7 of the fix for CVE-2014-0119
Return the type attribute in the <style>. Removed by mistake with the previous commit.
More defensive coding around some XML activities that are triggered by web applications and are therefore at potential risk of a memory leak. This is part 6 of 7 of the fix for CVE-2014-0119 
A quotation mark is missing.
Add new constant missed in previous commit This is part 7 of 7 of the fix for CVE-2014-0119
Add javadoc for AbstractReplicatedMap ctr parameters added in r1498820 That feature is controlled via "terminateOnStartFailure" option of BackupManager.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56458 Report WebSocket sessions that are created over secure connections as secure rather than as not secure.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56418 Ensure that the Manager web application does not report success for a web application deployment that fails. Based on a patch by slaurent.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56425  Improve method matching for EL expressions. When looking for matching methods, an exact match between parameter types is preferred followed by an assignable match followed by a coercible match.
Stop threads used for secure WebSocket client connections when they are no longer required and give them better names for easier debugging while they are running.
Follow-Up to r1590120: Simplify code by using Integer.compare(int, int) which is available since Java 1.7.
Whitespace police
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56441 Raise the visibility of exceptions thrown when a problem is encountered calling a getter or setter on a component attribute from debug to warning.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56027 Alternative implementation for the new values of FIPSMode option in AprLifecycleListener
Move filters into their own menu section in Documentation webapp.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56365 Reviewing and fixing StandardJarScanFilter implementation: 1. Do not parse the same system property 3 times. Once per class is enough. 2. In check() method do not do defensive copying of HashMap for each jar name that we are filtering. It is unlikely that check() and setXxx() methods were called concurrently. If they were, then one can wait for the other to complete.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56365 Correct errors in StandardJarScanFilter documentation.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56365 Improve documentation, update changelog.
Correct formatting and a few minor typos. No substantial changes to the text.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56441 Minor improvements for r1590285: Do not omit stacktrace on InvocationTargetException in a getter. Better wording for changelog.
Fix http://issues.apache.org/bugzilla/show_bug.cgi?id=56027 Follow-up to r1590300: Introduce a constant.
Correct a typo
Cleanup the test output (mixing out and err is confusing), add some info and wait more (somehow NIO2 gets an exception later).
Since I looked at the traces, replace exception wrap with unwrap for IOException.
Followup to r1590377 s/Wait/Waited/ and be more detailed
Review of r1590378: Simplify: instanceof operator does not-null check
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56383 Review of r1589994: - Reduce visibility of fields that have getter methods - Do not print <h3></h3> line if showServerInfo is turned off
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56383 Use non-empty title when both showServerInfo and showReport are false.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56383 Document the new feature on the "security HowTO" page. Move error valve documentation lower in the valves list (access log valves and access control valves should be the first ones there).
Improving valves documentation. Wrap Access Logging valves into a distinct section.
Improving valves documentation. Wrap RemoteAddrValve and RemoteHostValve valves into a distinct section.
Improving valves documentation. Move RemoteIpValve and SSLValve into new section "Proxies Support".
Improving valves documentation. Move valves implementing an Authenticator into new section "Authentication".
Fix broken link. I noted it when backporting r1519668 to TC7.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56334 Reviewing r1587887: s/ attrs.getValue(i) / attributeValue / in the messages as well, so that the actual expression text that is processed is printed in the message.
Increase length of text written so expected exception is triggered on client disconnect with NIO2.
Need even larger writes to keep test happy on Windows VM
Fix Javadoc warnings
Drop useless null checks.
Clarify
Document JspAttribute.isDynamic() and correct wrong value of this flag for "omit" attribute of <jsp:attribute> action.  I think there were no observable consequences of this typo. The "dynamic" flag makes sense only for attributes of a CustomTag.
Correct the handling of back-slash escaping in the EL parser and no longer require that "\$" or "\#" must be followed by "{" in order for the back-slash escaping to take effect.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56334 Additional tests and fixes Includes the following:  1. Allow '\' in xmlns attributes of UninterpretedTag. A test added.  (Java escaping was missing. Xml-escaping is still missing. I think it is unlikely that anybody would use such values for xmlns attributes)  2. Fix interaction between Validator.ValidateVisitor.checkXmlAttributes(CustomTag ..) and getJspAttribute().  - EL expression was parsed twice in both methods. Now I am passing the already parsed EL. - getJspAttribute() has EL validation code, so reduce duplication - When calling getJspAttribute() you have to pass original attrs.getValue(i), not the textual value.  3. Fix Validator.ValidateVisitor.XmlEscapeNonELVisitor - It was not EL-escaping its text. Tests added.
Correct unit tests now EL Parser has been fixed to correctly parse "\$" as "$".
- Add setTimeout, for handling of the upload timeout. - Cleanup.
- Fix possible (very rare) corruption doing keepalive after a Comet request. - Stop ignoring read pending exceptions.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56481 Work around case insensitivity issue in URLClassLoader
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56492 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56492 Avoid eclipse debugger pausing on uncaught exceptions when tomcat renews its threads
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56463 Property for disabling server information is added to the DefaultServlet.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56383 Document ErrorReportValve's new property 'showReport' on the "security HowTO" page.
No functional change. Rename fields and variables and update comments to reflect current usage
Make naming context tokens for containers more robust by using a separate object
Alphabetical order
+=o.a.naming
- Improve comet keepalive cleanup (if a read pending it is not possible to interrupt it), and do the same for async.
Retain the order the URLs were added in when calculating the result for getURLs()
Update changelog
Update changelog
Fix test failure with NIO2 where additional, unexpected access log entry was being created during connector shutdown.
Review of r1593288: Do not forget to call the symmetrical unset method on stop.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56472#c1  Per my comment on that issue, always set 'NamingContextListener.initialized' field to 'true' so that its cleanup on configure_stop event is not skipped.
Small optimization: move "getRegistry(null, null)" call out of the loop.
Work around intermittent unit test failures on OSX.
Testing with Java 9 early access. UTF-8 issues resolved.
Update package renamed Apache Commons BCEL to r1593495 to pick up some additional changes for Java 7 support and some code clean up.
Simplify
Update package renamed Apache Commons FileUpload to r1569132 to pick up some small improvements (e.g. better <code>null</code> protection) and some code clean up.
Update package renamed Apache Commons Codec to r1586336 to pick up some Javadoc fixes and some code clean up.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56400 Switch to svn copy for DBCP2 and Pool2
Better change log entry for DBCP changes
Remove unused code. unparsedURIMB was written but never read.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56501 HttpServletRequest.getContextPath() should return the undecoded context path used by the user agent.
Revert part of r1593563 Restore original comment. (Tomcat JDBC pool can be tested against original Commons DBCP, if someone wants.)
Split into two paragraphs, so that note is more visible.
Fix broken javadoc links. Noted when reviewing results of 'ant release' step from buildbot.
Remove svn keywords from forked Apache Commons Pool2 and DBCP2
In tests: allow to configure directory where JUnit reports and access log are written to. This is useful for Apache Gump, where BIO, NIO and NIO2 test runs are configured separately.
Followup to r1593773: Explicitly create the logs directory. JUnit fails when the directory where it writes its reports does not exist. It happened at Apache Gump.
Simplify. No functional change.
- ThreadLocalLeakPreventionListener: Trigger thread renewals for StandardContext only. (Do not trigger them for FailedContext and similar). - StandardThreadExecutor: Pass 'threadRenewalDelay' to the thread pool executor. Otherwise this setting configured at initialization time is effectively ignored. - Improve documentation.
Fix tests failing at Buildbot and make them more friendly to Git.  Buildbot uses Subversion 1.6 (or earlier). Thus there are .svn directories everywhere in the source tree, which caused failure of webresources tests.
Fix regression introduced in r1239520 that broke loading of users from tomcat-users.xml when using the JAASMemoryLoginModule
Correct regression introduced in r797162 that broke authentication of users when using the JAASMemoryLoginModule.
Correct typos in class name
Fix double checked locking issue identified by FindBugs
Fix FindBugs false positive
Update filter after split into two classes
Follow up to fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56400 - Update description of DBCP packaging in buidling.txt - remove DBCP2 and Pool2 versions from build.properties.default - update svn-merge docs - remove external tomcat-dbcp.jar from sample Eclipse class path - remove reference in Javadoc to class that does not exist
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56513 Make it crystal clear that using sendfile will disable any compression that might otherwise have been used.
Whitespace police
Address root cause of ReadPendingException rather than swallowing it.
Give the thread shutting down the existing connections a chance to finish before forcibly closing them and triggering an exception on each connection that is forcibly closed.
Require RuntimePermission when introducing a new token.
Replace looped String-concatenation with StringBuilder. No functional change.
Keep Checkstyle happy
Return value is never used (and is hard coded to true anyway) so change return type to void.
Merge processSocket() and dispatchForEvent()
Remove unnecessary casts
Align code across the Processors Note for NIO that the socketWrapper is the KeyAttachment which allows the NIO code to be simplified
Pull up common async code
Consistent naming
Remove unused code
Remove duplicate method
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56518 Refactor NIO's SocketProcessor to use KeyAtrtachment rather than Socket to align it with the other implementations. This enables a number of attachment->socket->attachment transitions to be skipped which appears to resolve the root cause of BZ 56518. Since the wrapper is available and can be processed, it becomes possible to reduce the connection count when the socket is closed by the interrupt.
Whitespace police
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56399 When recycling a Coyote request, ensure that Catalina request have been recycled.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56516 Place declarations for all scripting variables marked with declare=true at the start of the page so they are always visible to the entire page.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56522 When setting a value for a ValueExpression, ensure that the expected coercions take place such as a null string being coerced to an empty string.
Add BZ 56516 to changelog
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56523 When using SPNEGO authentication, log the exceptions associated with failed user logins at debug level rather than error level.
Revert fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56516
Fix http://issues.apache.org/bugzilla/show_bug.cgi?id=56399 Simplify. Reduce logging level. Update changelog (this change was omitted from 8.0.6).
Copy missing resources file from Apache Commons DBCP 2 to packaged renamed copy of DBCP 2
Prep for next release
Prep for next release
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56529 Fixed NoSuchElementException while handling attributes with empty string value in custom tags. Patch provided by Hariprasad Manchi.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56529 Test case for attributes with empty string values in custom tags.
Update changelog
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56536 Ensure that HttpSessionBindingListener.valueUnbound() uses the correct class loader when the <code>SingleSignOn</code> valve is used.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56529 Review of r1595174: 1. Call iterator() once. It creates an object, so it is better do not waste such calls. 2. Style issues: - "" does not make sense as 'generic' default for textAttributeValue. It makes sense for this specific case only. - 3 spaces indent -> 4 spaces
Whitespace
Prep for next release
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56526 Improved StuckThreadDetectionValve to allow to interrupt stuck threads.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56526 Followup to r1595331: correct version number in changelog. (Tomcat 8.0.8 has been tagged an hour earlier).
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56529 Followup to r1595230 Minor improvement to the testcase: check the actual response produced by test JSP page.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56461 New option to make context startup fail if a load-on-startup servlet fails
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56399 Improve implementation of CoyoteAdapter.checkRecycled() to do not use an exception for flow control.
Code clean-up. No functional change. Merge exception handling blocks were code is identical. Spotted while reviewing use of ExceptionUtils.unwrapInvocationTargetException()
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56446 Clearer handling of exceptions when calling a method on a POJO based WebSocket endpoint. Based on a suggestion by Eugene Chung.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56387 Refactor handling of class loading attempts after web application stop.
Follow up to r1596004. Actually throw the exception.
svn:eol-style=native
Correct indent
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56546 Reduce logging level for stack traces from SEVERE to INFO.
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56545 Pre-load an additional class if running under a security manager 
FindBugs. Remove unnecessary null check
Experiment with the Simbian duplicate code detection tool. Remove 100+ lines of duplicate code
FindBugs setup() vs setUp()
Fix logic error
Simplify
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56545 Pre-load two more classes to avoid exceptions when running under a security manager
Further simplify the code Merge two try/catch inside two branches of if/else. factoryClass cannot be null after loadClass()/Class.forName() calls.
Improve handling of Throwable. Add changelog entry.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56543 Update JDT to 4.4.RC1
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56521 Implement a TODO Reuse the async write buffer between writes to reduce allocation and GC overhead. Based on a patch by leonzhx. Also:  - don't re-allocate the buffer / move the data in the buffer if the buffer is partially written on a subsequent write  - make the buffer size configurable, defaulting to 8k
Correct comment
fixed timing and enclosed thread.join in a finally to avoid stopping the webapp before the request is finished (in case of assertion failure)
Add release date
Use ISO 8601 date format, like it was done for earlier versions
Apply patch 01 from jboynes to improve cookie handling. Allow attribute names as cookie names. Patch should be safe since it relaxes the current behaviour.
Apply patch 02 from jboynes to improve cookie handling. Refactor cookie tests to test each CookieNameValidator directly. I made a few additional changes. The patch should be safe since it only impacts the unit tests. 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56543 Followup to r1596227 Update POM and IDE files to the new ECJ version
Apply patch 03 from jboynes to improve cookie handling. Allow V0 cookies to use names that start with $. Add a (currently unused) RFC6265 Cookie validator. Patch should be safe since it relaxes the current behaviour.
FindBugs Fix false positive
Apply patch 04 from jboynes to improve cookie handling. Prevent V0 cookies using '=' in cookie names I've checked back though the archives and I can find no record of a user asking for this feature. Also, given the known behaviour of browsers it is unlikely to have worked any way. On that basis, this should be safe.
Apply patch 05 from jboynes to improve cookie handling. Simplify logic for detecting cookie upgrades. I made a few additional changes.  - s/isnt/isNot/ in method names  - whitespace clean-up  - correct some comments The patch should be safe since the logic is unchanged. 
Apply patch 06 from jboynes to improve cookie handling. Remove duplicate code. The patch should be safe since the logic is unchanged. 
Apply patch 07 from jboynes to improve cookie handling. Simplify code that detects if we need to upgrade a cookie from V0 to V1 The patch should be safe since the logic is unchanged. 
Apply patch 08 from jboynes to improve cookie handling. Encapsulate use of ALWAYS_ADD_EXPIRES as it only applies to Set-Cookie generation. The patch should be safe since the logic is unchanged. 
Apply patch 09 from jboynes to improve cookie handling. Code cleanup. I did not remove the final markers from the static methods as I see no need to remove them and good reasons to keep them. The patch should be safe since the logic is unchanged. 
Apply patch 10 from jboynes to improve cookie handling. Separate the code that determines whether a value should be quoted in Set-Cookie from the checks that are performed when parsing a Cookie header sent by a client. I also did a small amount of clean up. The patch should be safe since the logic is unchanged. 
Apply patch 11 from jboynes to improve cookie handling. Eliminate an unneeded StringBuilder. I also added to TODO marker. The patch should be safe since the logic is unchanged. 
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56546 Avoid stack trace with org.apache.catalina.connector.TestMaxConnections Ensure request processing has finished by increasing unload delay to allow request that was waiting in the accept queue to be processed before shutdown completes.
DBCP updates
Whitespace police after merge from Commons
Apply patch 12 from jboynes to improve cookie handling. Move header-specific parsing code into a separate class associated with that header type. This is in anticipation of adding new header parsers, starting with Cookie The patch should be safe since the logic is unchanged. 
hopefully fixed timing issue in TestStuckThreadDetectionValve when the test is run on ASF buildbot...
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55975 Apply consistent escaping for " and \
If the SSL reneg test only fails on MacOs, it would be better to continue running it on the other platforms.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56561 Fixed NoSuchElementException when an attribute has empty string as value
Update changelog.
Set bugtraq:logregex property on the root directory. This allows TortoiseSVN to parse arbitrary references to Bugzilla issues in addition to those that follow "Fix ..." template. Just the issue URL or "BZ + number" is enough.
https://issues.apache.org/bugzilla/show_bug.cgi?id=56561 Followup to r1597532: check the output of the new test.
Fix a TODO Only set the JspFactory if not already set
Keep change log to max 80 chars wide
Implement first part of pull request from Greg Wilkins to make Jasper more independent from Tomcat.
Implement second part of pull request from Greg Wilkins to make Jasper more independent from Tomcat. Add ServiceLoader based discovery support to the JULI LogFactory
Implement third part of pull request from Greg Wilkins to make Jasper more independent from Tomcat. Add support for using an existing list of TLDs rather than scanning for them This closes #4
Simplify available() and isFinished() as current implementation broke Comet chat example.
ISE is expected when using AsyncChannels. Handle it the same way an IOException is handled rather than expecting the client code to catch and handle it.
Refactor test to enable a clean server shutdown. This prevents the web application class loader complaining about a still running thread on server stop.
Add license header
Add license header
Add license header
Discern the first and the second requests in the test case.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55282 o.a.t.util.descriptor.web.ApplicationListener overrides equals and hashCode methods.
Fix copy/paste error and return a 500 rather 400 response
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56555 When Tomcat closes the connection based on the HTTP status code of the response, ensure that only one connection header is sent to the client.
No need for the expectation check in an error state as the connection will be closed any way.
Fix indent
Remove Response methods where the only function is to call action() and call action() directly.
Remove unnecessary method
Better comments Formatting (use longer line lengths)
Formatting clean-up No functional change
Less fuzzy way to call onDataAvailable (no real fix though).
Check committed before changing any field values Remove various incorrect comments
Simplify logic Call Response.recycle() from Response.reset() rather than in Response.reset():  - doing ~half of what recycle() does  - calling ActionCode.RESET which resets the OutputBuffer which in turn calls Response.recycle()
Trivial format fix
Trivial format tweaks
More formatting changes
Remove listener calls optimizations, they skip a lot of things which could be useful and ultimately it doesn't work that well.
- Test autobahn myself, add two new echo endpoints and my example config. - Issues with the async endpoint, 9.7 and 9.8.
Typos.
Add CVE numbers, correct a typo.
Followup to r1598483:  1. svn:eol-style 2. Add *.json to text.files patternset in build.xml 3. Add json file to rat-excludes.txt Per RFC7159 I see no way to add license comment to a JSON file. It is a data file.
Fix regression with the websockets examples after fixing the testing. The initial notification is still problematic.
Add some info and disable the async test (one CVE saved hehe).
Avoid having an import.
Revert fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56555 which, after further discussion, was classed as INVALID.
Fix IDE warning
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56582 Convert implementations of ActionHook.action(..) to use switch(enum) operator. First, SpdyProcessor.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56582 Convert implementations of ActionHook.action(..) to use switch(enum) operator. Second part: HTTP processors.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56582 Convert implementations of ActionHook.action(..) to use switch(enum) operator. Third and the last part: AJP processors.  Potential error spotted: DISPATCH_EXECUTE is not implemented for AJP. Placed a FIXME marker.
Pull up error flag
Tweak comments
As per RFC2616, an unknown expect header should result in a 417 response.
Align code with comment and use a 500 response (internal server error) as per the comment rather than a 400 response.
Reduce duplicate by moving error handling into addInputFilter. Also makes error handling consistent. Reduce visibility of addInputFilter()
Tiny bit of de-duplication. Add reference to RFC2616 for case insensitivity of transfer encoding names.
https://issues.apache.org/bugzilla/show_bug.cgi?id=56582#c1 Implement DISPATCH_EXECUTE action for AJP connector.
Add a (currently disabled) test for errors with a chunked response after the response has been committed.
Clean-up
Refactoring. Switch from a boolean to an Enum for error state so we can differentiate between an error that requires the connection is closed after the current response is completed and an error that requires that the connection is closed immediately. This commit should be a NO-OP. While the different error states are set, the only the presence of an error (or not) is tested - i.e. no change from the implementation prior to this commit. Try to be consistent when an error occurs. Set the status code first (if required), then set the error state and finally log (if required).
Formatting.
Move resetting of error state to the processor's recycle method.
Trivial reformatting to trigger a CI build to see if the CI server is fixed.
Improve error handling for an unhandled exception after the response has been committed. Tomcat will now attempt to: - flush any unwritten response data to the client - prevent further writes to the response - close the connection  This means that the client should experience an unclean close that will enable them to differentiate (when chunked encoding is used) between an incomplete response that encountered an error and a complete response that did not (prior to this commit, Tomcat completed the request normally and - depending on the response data written to that point - it may not have been visible to the client that the response was incomplete at that point.
Fix regression in r1600449
Add error handling changes.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56588 Remove unnecessary code - essentially revert r1492307 - that is no longer required now that Jasper is initialized via an SCI.
Update the error count regardless of how the error flag was set Ensure that an request can only contribute to the error count once
Fix further regressions in the error handling changes (r1600449 and r1600495)
Remove null check, as "instanceof" condition on the next line takes care of nulls.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56573 Change the value returned by Session.getRequestURI() from the value obtained from HttpServletRequest.getRequestURI() to the value obtained from HttpServletRequest.getRequestURI() with the scheme changed to ws or wss as appropriate. Note that the WebSocket Expert Group is expected to clarify the expected behaviour for Session.getRequestURI() which may result in further changes.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56573 Restore query string. Add test cases.
Add a test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=56568
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56568 Allow JSP error pages to handle any HTTP method
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56577 Better executor configuration.
Don't assume that tests use the StandardManger
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56578 Correct regression in the fix for 56339 that prevented sessions from expiring when using clustering. The effect of removing expiring = true; from the DeltaSession is that if parallel calls are made to expire() then there is a slightly greater chance of some of those calls blocking while the first completes. This is because expiring is now set to true a little later.
Verify that response is flushed when servlet fails with an unexpected exception.
Fix http://issues.apache.org/bugzilla/show_bug.cgi?id=56581 If an error on a JSP page occurs when response have already been committed, do not clear the buffer of JspWriter, but flush it.
https://issues.apache.org/bugzilla/show_bug.cgi?id=56568 Fix missing "return" statement for JSP method name check.
Try removing the beta tag from the NIO2 connector to get more feedback, after the latest round of fixes. In practice since it is not used by default, it doesn't change much.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56600 Fix missing "return;" statements after sendError(): do not waste time generating response for PROPFIND requests that contain broken XML document.
Correct a typo.
Revert fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56573 The fix triggered a TCK failure
Handle exceptions when trying to flush the response.
kkolinko review Use finishResponse() rather than flushBuffer to avoid chunking if not necessary. Add finishResponse() to ErrorReportValve.report() Don;t try and reset the response if it has already been marked as in error
Clean-up. No functional change.
i18n for ChunkedInputFilter error message Add error flag to allow subsequent attempts at reading after an error to fail fast
Correct bug reference. These are all V1 cookies. bug 55975 is a V0 cookie issue
Swap the order of the checks since the filter can't be an the error state once the request has been read.
Remove unnecessary call since doRead() calls checkError()
Correct a location where an exception was still thrown directly rather than via the utility method where the error flag is also set.
Refactor to more closely align AsyncTimeout implementations
Pull up waitingRequests. NIO2 used a ConcurrentHashMap whereas BIO and APR/native used a Queue. Switch to ConcurrentHashMap for all since what we really want here is a Set (and there isn't a ConcurrentHashSet implementation).
Pull up AsyncTimeout APR/native used a separate flag to stop the thread. This avoided issues where running was set true->false-true in quick succession. This fix is now available to NIO2 and BIO as well. Note NIO does not (currently) use the AsyncTimeout
Ensure that the new attribute name username is used in the tomcat-users.xml examples rather than the old name of user.
Fix failures to timeout async requests after refactoring. The removed condition was added to the APR connector (by me) some time ago but reviewing the current code I can see no reason for it to stay.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56612 Correctly parse two consecutive escaped single quotes when used in UEL  expression in a JSP. Includes various unit tests that check the parsing of ${'\'\''}
Provide a better error message when asynchronous operations are not supported by a filter or servlet. Patch provided by Romain Manni-Bucau. Issue was reported via dev at tomcat.a.o.
Use StringManager for the async not supported message.
Remove obsolete documentation from realm package javadoc. The text is something very old that talks about "debug" attribute and that there are two standard realms, JDBCRealm and MemoryRealm. The up-to-date documentation is maintained in docs/config/realm.html
Further fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56606 Update documentation for MemoryRealm. Align MemoryUserRule class (in MemoryRuleSet.java) with MemoryUserCreationFactory class (in MemoryUserDatabase.java) so that "username" attribute is read first.
Move code that parses EL expressions within JSP template text from Parser to JspReader class. This is done to get access to JspReader.nextChar(mark) to avoid calling reader.mark() in a loop, as that method allocates new Mark object on each call.  Also removed duplicate "start = reader.mark();" call, as parseELExpression() does update 'start'.
Fix comment typo and other clean-up
Correct typo in the name of a test class
https://issues.apache.org/bugzilla/show_bug.cgi?id=56581 Add test case for bug 56581. It tests exception handling for committed responses.
https://issues.apache.org/bugzilla/show_bug.cgi?id=56546 (very partial) Reduce verbosity of clear references logging. Although it is a good tool for detecting leaks, the severity does not match the likely impact. Also avoid having more than one logging for one event even if filtering becomes less flexible.
Partial revert to upgrade messages to warn.
Pull up getLog() and add some supporting plumbing
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56518 Do not attempt an NIO write if a thread has been interrupted as it can lead to a connection limit leak
Changelog entry for r1599500
Amend changelog entry for r1597982 and move it into Coyote section (instead of Jasper one).
Set the path for cookies created by the examples web app This reduces the opportunity for using such cookies for malicious purposes should the advice to remove the examples web application from security sensitive systems be ignored.
Changelog for BZ 56581: Fix a typo and improve wording.
Followup to r1602522 Add "/" to the path like we do for session cookies. Use request.getContextPath() as I think it makes a better example.  If I examples are named "/examples" then either code works. If I rename them to some Cyrillic name then the new code works while the old one does not. Tested with Firefox 29 on Windows 7.
Attempt to obfuscate session cookie values associated with other web applications when viewing HTTP request headers with the Request Header example from the examples web application. This reduces the opportunity to use this example for malicious purposes should the advice to remove the examples web application from security sensitive systems be ignored.
Update Eclipse compiler JAR to 4.4RC4
Simplify the logic
Simplify the logic
Simplify the logic
https://issues.apache.org/bugzilla/show_bug.cgi?id=56518 Followup to r1602510: correct a copy-paste.
Make sure tests for classes in the examples webapp can be run from the command line
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56620 Avoid bogus access log entries when pausing the NIO HTTP connector. Ensure that any requests partially read before the connector is paused are logged in the access log with the correct start time.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56620 More general fix for incorrect request start times.
Use StandardCharsets.
Followup to r1601583: Use Collections.newSetFromMap to convert ConcurrentHashMap into a Set.
Add the other echo endpoints
Enable the async echo endpoint
Ensure that the asynchronous WebSocket echo endpoint in the examples web application always waits for the previous message to complete before it sends the next. Fixes some failures with this endpoint and the Autobahn tests
Disable async echo endpoint again until we can put in some configurable limits on message size to buffer.
Review of r1597602: 1) Be satisfied by the first result from ServiceLoader and break the loop. 2) Throw LogConfigurationException, which is a subtype of RuntimeException.
- Fix apparent issues for caches configuration (socket properties is likely not set yet, and the channel pool size was not using the right property). - Still not convinced about the usefulness of these caches even if raw benchmarks could show some slight improvements, so keep them disabled in NIO2.
Also drop experimental mention for NIO2 in the docs, since tests pass with no further issues.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56636 Correct various issues in method signature matching
Correct test method names to reflect what is being tested
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56638 When using ELProcessor.defineFunction(String,String,String,String) and no function name is specified, use the method name as the function name as required by the specification.
Fix indentation
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56611 Refactor code to remove inefficient calls to Method.isAnnotationPresent(). Based on a patch by Jian Mou.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56334#c15 Handle potential whitespace around input.
Add a new limit, defaulting to 2MB, for the amount of data Tomcat will swallow for an aborted upload.
Correct test. Exceeded the swallow limit aborts the connection.
Grr. Different behaviours on different OSes
Followup to the tests for fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56334#c15 Enable result check for test 07g.
Correct a typo in changelog.
Bump version number after tagging
Align Wrapper javadoc with actual implementation that was changed by r926377.
Additional fix for BZ 56611 and remove method Tomcat$ExistingStandardWrapper.hasAsync(), because 1). This method should have been "final" as it is used by class constructor. 2). Wrapper.isAsyncSupported(), Wrapper.setAsyncSupported() are available as a replacement.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56611 Refactor code to remove inefficient calls to Method.isAnnotationPresent().  Additional fixed that were missed in r1603591.
Use for-each iterations
Fix http://issues.apache.org/bugzilla/show_bug.cgi?id=44312 Log an error if there is a conflict between Host and Alias names.  This also includes the following:  1. Implemented exactFind() methods that combine find() with a check that an exact match was found. This allows to simplify the code.  2. Fixed behaviour of Mapper.removeHost() in case if the host is not found. Now it won't throw an NPE.  3. Fixed error logging of various Mapper.removeXxx() methods, where only "(pos<0)" case was logged as "not found". The change is that now it logs in wrong-match-found case as well. I did not introduce i18n there, as I do not see a real use case for those messages.
Fix bug in StandardContext.removeApplicationListener() introduced by the fix for BZ 56588. This was noted by FindBugs as "Calling String[].equals(String)".
Correct copy-pasted comments
Mode test for adding duplicates from setUp() into a test method. Add two additional tests.
For https://issues.apache.org/bugzilla/show_bug.cgi?id=56653 Test for concurrency issue with Mapper$ContextList.nesting field.
Fix http://issues.apache.org/bugzilla/show_bug.cgi?id=56653 Fix concurrency issue with Mapper$ContextList when removeContextVersion() is called.  Followup improvement to http://issues.apache.org/bugzilla/show_bug.cgi?id=44312 Make the removeHost(), removeHostAlias() methods more strict. They now check whether type of the mapping that they are removing.  ContextList class is made immutable. Added HostMapping class. It allows to update ContextList instances in MappedHost. The HostMapping.alias flag allows to discern whether it is the primary mapping or an alias.
Mapper improvements - Mark MappedContext.versions field as volatile, because it is updated when a Context is started or stopped. - Mark MapElement fields as final and add them to constructors. - Change super class of MappedContext from MapElement<Context> to MapElement<Void>. It does not wrap any real object, its "object" field is always null.
Assert that MappingData object is empty before performing mapping work. The old code just skipped all work in that case, but I do not see why that would be useful, and it may return inconsistent results. The comet and async examples do work successfully with this change.  This allows to simplify the code in Mapper.internalMap() by removing a number of checks.
Make sure that context.versions array always has at least 1 element. Do not assign 0-length array to this field.
Small improvements, no functional change. Save contexts[pos] is a local variable. Skip versions lookup when there is the only version available.
Remove fields "context" and "wrapper" and their setters from Catalina Request object. This information is available from MappingData object.  A pair of (context == null) checks removed, as such checks are already done earlier in the same method.
Simplify code, no functional change.  This makes it clear that setting "mapRequired = true;" and "getMappingData().recycle();" call are always performed together.
Correct comments
Rename constructor argument, to align with actual usage.
https://issues.apache.org/bugzilla/show_bug.cgi?id=56657 If sessionid belongs to the latest version of webapp, use the latest version.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56657#c2 Ensure that re-mapping selects the context version that we expect.
Simplify. No need for a local variable that is read once.
Simplify. No need for a local variable that is read once.
Simplify. No need for a local variable that is read once.
Extend attempts at obfuscation to the Cookies example
Starting to look at WebSocket compression. These implementations will be required to process the extension negotiation.
Add an interface for the transformation (by an extension) of WebSocket frames. Only supports transformation of incoming messages at this point.
Add support for parsing the extension header
Strengthen WebSocket extension parameter validation
Add the initial implementation for the permessage-deflate implementation This is a work-in-progress - There are still multiple Autobahn failures (or rather there will be once it is plumbed in) - No support (yet) for compression of outgoing messages
Add some inner classes that will be required when Transformation / extension support is plumbed in.
Add plumbing to enable permessage-deflate implementation This is still a work-in-progress
Trivial format change
Correct comment to cover duplicate "Alias"es case. Amend testcase.
Amend the test case for BZ 44312. Add a case when duplicate is an Alias
Amend changelog message for https://issues.apache.org/bugzilla/show_bug.cgi?id=44312#c6
Improve constructors. Avoid creating 0-length arrays, when they will be replaced by some known value.
Re-working the fix for http://issues.apache.org/bugzilla/show_bug.cgi?id=56653  I rollback addition of HostMapping class (reverting most of r1604319) I will work on an alternative solution that should be easier to backport to Tomcat 7.  (This revert temporarily breaks support for Aliases, per comment 2 in BZ 56653. The alternative solution will fix it.)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56653 Alternative fix for aliases support issue
Refactor transformations to enable the handing of overflow (the previous code ignored this possibility).
Add a new utility method and make use of it (will also be used in permessage-deflate)
Handle decompression for messages split across multiple frames.
Update the API stability section of the release notes now that Tomcat 8 has had its first stable release.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56665 Correct the generation of the effective web.xml when elements contain an empty string as value.
Fix copy/paste error in r1605054 Control messages should be read into the control message buffer
whitespace
Handle preference selection for multiple extension headers with the same name Tighten up parameter validation for permessage-deflate
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56543 Update to the Eclipse JDT Compiler 4.4
Add the initial hooks to get the Windows binaries signed by Symantec's code signing service. This work is still at the evaluation stage.
Avoid NPE with storeconfig.
Improve exception routing so that a thrown exception interrupts the store process (avoid server.xml overwrite with a broken one).
Skip domain property instead.
Add back dead code.
Add a property to skip code signing as suggested by kkolinko
Refactoring with a view to adding transformation (i.e. extension) support to outgoing messages.
Refactoring with a view to adding transformation (i.e. extension) support to outgoing messages. Extract MessagePart into standalone class
Fix an i18n TODO
This time with the unsupported extension name
Correct comment
Plumbing to enable transformation / extension processing for outgoing server messages.
When Eclipse Compiler JAR is updated, make sure to delete its old version from the build/lib directory.
Simplify "setproxy" target.  The "proxy.use" flag can now be "on", "yes" or "true", so document "true" as the recommended value. The property expansion feature for if/unless attributes is since Ant 1.8.0.
Followup to r1604472 for better compatibility. Reintroduce setter methods removed by r1604472 and mark them deprecated.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56663 BZ56663: Improve available to also include buffered bytes in the Servlet layer, handle a case (thanks telnet) where the amount of remaining bytes could become negative (the input is still finished then of course), filter an extra write event with non blocking write IO if async completes after the first read.
Avoid NPE.
Revert null check to check the full testsuite results (sorry for the noise).
Add back the NPE check for now since the testsuite confirms it with all connectors. http://ci.apache.org/builders/tomcat-trunk/builds/224/steps/compile_1/logs/stdio
Add link from an alias MappedHost to the real MappedHost that it represents.
Fix root cause of NPE when using WebSocket clients.
Add a collection of aliases to MappedHost object to simplify enumeration. This adds some cost to addHost/removeHost[Alias], but simplifies addContextVersion/removeContextVersion(). Require that addContextVersion(), removeContextVersion() methods were called on a real host. Ignore them on an alias.
Simplify. Read local variable.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56658 Avoid delay between registrations of mappings for context and for its servlets.
Trivial change to add configuration fields to SSLValve for header names.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56666 When clearing the SSO cookie use the same values for domain, path, httpOnly and secure as were used to set the SSO cookie.
Whitespace
Remove method parameter that is always true.
Set the cache size to zero when it is cleared
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56693 Fix various issues in the static resource cache implementation where the cache retained a stale entry after the successful completion of an operation that always invalidates the cache entry such as a delete operation.
Update Checkstyle to version 5.7
Fix a warning with the Litmus WebDAV testsuite
Remove commented-out line. (It works as well, but responds with permanent redirect to the longer url).
Add docs for new ssl attributes.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56694 Remove references to checkInterval attribute that are no longer valid and related fixes.
Wrap the root cause rather than just using the message.
Reduce visibility (kkolinko review)
Fix Javadoc nags
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56652 Add support for method parameters that use arrays and varargs to ELProcessor.defineFunction()
When the current PathInfo is modified as a result of dispatching a request, ensure that a call to HttpServletRequest.getPathTranslated() returns a value that is based on the modified PathInfo.
Add NPE protection
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56677 Ensure that HttpServletRequest.getServletContext() returns the correct value during a cross-context dispatch. 
kkolinko review - add missing trim() call
kkolinko review: Extend NPE protection
svn:eol-style = native
Update to Tomcat Native Library version 1.1.31 to pick up the Windows binaries that are based on OpenSSL 1.0.1h.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56698 When persisting idle sessions, only persist newly idle sessions. Patch provided by Felix Schumacher.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56685 Add quotes necessary for <code>daemon.sh</code> to work correctly on Solaris. Based on a suggesiton by lfuka.
Add missing link for rewrite.
Fix checkstyle nags. Add an issue number.
Avoid doing anything if the endpoint is not running (avoids possible NPE with the caches (?) ) and create caches first in start (just in case). Note: I still don't see much real benefit in these caches, and their configuration is even more questionable (but it is there and documented).
Improve the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=44312 Check that addWrapper/removeWrapper, add/clear/removeWelcomeFile[s] are performed on the real Host, as expected by the caller.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56704 Add OpenSSL cipher suite parser for JSSE. It allows using the same value for both native and JSSE, and makes it easy to define safe default or custom cipher suites. Code submitted by Emmanuel Hugonnet.
Fix warnings
Checkstyle
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56684 Add a workaround for a bug that should never happen along with some basic debug logging.
Set svn:eol-style=native This file is mentioned in "text.files" patternset in build.xml.
Set svn:eol-style=native
Improve changelog entry wording.
Remove test code
Simplify. No functional change.
Correct a comment. "chunked" filter is at [1] (Constants.CHUNKED_FILTER). "identity" filter is at [0] (Constants.IDENTITY_FILTER).
Allow to configure maxSwallowSize attribute of an HTTP connector via JMX. This makes sense when configuring a new connector via JMX.
Merge changes from Pool 2 to r1609323.
Revert r1609326 as it contained fixes for multiple separate issues
Merge changes from Pool 2 to r1609323.
Merge changes from DBCP 2 up to r1609329.
Merge BCEL changes to r1609331. No fucntional change. Cosmetic changes only.
Notice apparent problems with NIO2 "sendfile" (only with SSL from what I can see) while testing ciphers. Temporarily disable for now.
Merge changes from FileUpload up to r1596086.
No changes to codec. Just update mergeinfo to reflect that
Whitespace police after merges
Fix various NIO2 sendfile issues discovered while testing ciphers, and refactor to optimize its behavior.
56709: Fix property name is message.
BZ 56661: Fix Servlet API getLocalAddr().  Use new custom request attribute "AJP_LOCAL_ADDR" forwarded by the next mod_jk 1.2.41 to set the local IP address returned by getLocalAddr():  Before this change Tomcat handled getLocalAddr() like getLocalName().  Needs some testing before backport. 
Remove trailing space to please Checkstyle and Gump. 
Add changelog entry for BZ56661, r1609593. 
Add a system property for cipher configuration. Add a "simple but safe" default cipher suite in catalina.properties. More complex cipher suites that have been proposed are either not as safe (weak ciphers present) or not very compatible according to my testing (OpenJDK has trouble, but the Oracle JVM fares better).
Add missing doc.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56712 Fix session time comparisons in PersistentManagerBase. When asking for session times use internal**() methods to avoid an IllegalStateException.  Speed up TestPersistentManager test for BZ 56698 by removing sleep(1000) and fix occasional failures.
Improve changelog message: be more specific on the scope of the change.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56658#c3 Fix regression that context reloads were broken. Correct changelog entries.
Combine similar tests into same file. No functional change. ContextRoot and WelcomeFile mapper tests are moved into TestMapperWebapps class.
Test for add/remove ContextVersion. The issue was reported for Tomcat 7 in "Time for 7.0.55" thread on dev mailing list. I see no failures with Tomcat 8.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56710 Do not perform wrapper mapping if context is being reloaded, as such mapping is useless and may fail unexpectedly. Let mapper know that context is being reloaded.  Ignore removeWrapper(), removeWelcomeFile() calls when context is being reloaded, as that is useless work. During undeploy the context should have already been unregistered. During reload the context will be re-registered via addContextVersion().
Fix "No context found:" warnings from Mapper.addWrappers() -> findContextVersion() during context startup. If context has not been started yet, its "AFTER_START" lifecycle event will come later.  A typical stacktrace: SEVERE [main] org.apache.catalina.mapper.Mapper.findContextVersion No context found:  	at org.apache.catalina.mapper.Mapper.findContextVersion(Mapper.java:372) 	at org.apache.catalina.mapper.Mapper.addWrappers(Mapper.java:401) 	at org.apache.catalina.mapper.MapperListener.registerWrapper(MapperListener.java:430) 	at org.apache.catalina.mapper.MapperListener.containerEvent(MapperListener.java:154) 	at org.apache.catalina.core.ContainerBase.fireContainerEvent(ContainerBase.java:1186) 	at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:732) 	at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:700) 	at org.apache.catalina.core.StandardContext.addChild(StandardContext.java:2738) 	at org.apache.catalina.startup.ContextConfig.configureContext(ContextConfig.java:1364) 	at org.apache.catalina.startup.ContextConfig.webConfig(ContextConfig.java:1177) 	at org.apache.catalina.startup.ContextConfig.configureStart(ContextConfig.java:767) 	at org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:302) 	at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:117) 	at org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:90) 	at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5083)
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56717 Fix duplicate registration of MapperListener during repeated starts of embedded Tomcat. Properly unregister it when Tomcat stops.
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56717 Allow repeated Mapper.addHost() calls for the same host. E.g. if the host has been implicitly added by addContextVersion() call.
Add missing changelog: no NIO2 sendfile timeout [it should have used the regular socket timeout].
Fix http://issues.apache.org/bugzilla/show_bug.cgi?id=56724 Write an error message to Tomcat logs if container background thread exits unexpectedly.
Fix regression with r1611506: NPE on stop (only threadStop should set thread to null, or it needs a sync).
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53198 driverClassName should not be mandatory https://issues.apache.org/bugzilla/show_bug.cgi?id=53198
Make tests pass by properly using the mock objects and not rely on a pre existing table.
Code depends on DBCP2 from Tomcat
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53367 Properly handle interrupts in the FairBlockingQueue  https://issues.apache.org/bugzilla/show_bug.cgi?id=53367
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53367 Assume error until proven otherwise
Fix errors noted by checkstyle when building Tomcat: - Added missing license header in a test class - Tabs -> Spaces - Imports order, unused import
Revert generics changes from r1613123 The code is compiled with Java 7, so why change them? With recommended Eclipse settings those produce compiler warnings. (Generic types/Redundant type arguments  warning)
Correct the label in the list of sessions by idle time for the bin that represents the idle time immediately below the maximum permitted idle time when using the expire command of the Manager application.
When scanning class files (e.g. for annotations) and reading the number of parameters in a <code>MethodParameters</code> structure only read a single byte (rather than two bytes) as per the JVM specification. Patch provided by labes. This closes #12.
Allow the JNDI Realm to start even if the directory is not available. The directory not being available is not fatal once the Realm is started and it need not be fatal when the Realm starts. Based on a patch by Cdric Couralet. This closes #11 
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56746 Allow secure WebSocket client threads to use the current context class loader rather than explicitly setting it to the class loader that loaded the WebSocket implementation. This allows WebSocket client connections from within web applications to access, amongst other things, the JNDI resources associated with the web application.
Fix checkstyle complaints about trailing whitespace.
Rename enumeration to the singular form for consistency
Revert unintentional code signing changes from r1614297
Start to add some tests for the OpenSSL to JSSE mapping. This test currently fails so it is commented out while I work my way through the failures.
Add missing cipher using parameters defined in ssl2_lib.c form OpenSSL 1.0.1h
Preparation for supporting more than one JSSE name for a cipher (different implementations may use different names) and for renaming enumeration entries to use the names from the TLS cipher registry to make it clear which cipher is being referred to.
Use standard name. Add comment with cipher ID.
Make test for OpenSSL to JSSE mapping for sophisticated. Still commented out as there are still failures that need to be resolved.
IBM cipher suite names can use SSL_ or TLS_ at the start so modify mapping test to take account of this. Test still fails so it is still commented out.
Simplify construction
Annotate a disabled (work-in-progress) test with @Ignore, so that it is recognized and skipped, instead of failing the whole testsuite run with "No runnable methods" error.  Fix checkstyle errors such as imports order and missing license header.
Add some SSL_... -> TLS_... mappings for Oracle which uses SSL_ in some cases Correct a standard name
Add some SSL_... -> TLS_... mappings for Oracle which uses SSL_ in some cases Correct a few more standard names
Complete the lists of unmapped ciphers Test now passes but keep disabled as it currently requires openssl and that needs to be optional
Make the execution of the OpenSSL tests depend on the presence of an OpenSSL binary. By default, the tests look on the current path for the binary but an option exists to explicitly define the path as well.
Fix OpenSSL path configuration Add test to check for new/missing OpenSSL ciphers (currently disabled)
Refactor the openssl binary location setting to correctly handle case when it is not set
Add notes on why some cipher suites are not expected to be returned by 'openssl ciphers'. Enable the test
Check OpenSSL doesn't return any ciphers we don't recognise and fix a couple of overly broad exclusions.
Use registered names where available for cipher enumeration Fix a couple of typos that crept in Add a test to confirm standard names are used
Whoops. Remove debug code.